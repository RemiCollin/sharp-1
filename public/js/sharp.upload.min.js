function createSharpFile(e){var t=null,i=e.data("thumbnail");if(i){var n=i.split("x");2==n.length&&(t={width:n[0],height:n[1]})}var r=e.data("file_filter"),s=e.data("file_filter_alert");e.sharp_file({url:t?"/admin/uploadWithThumbnail":"/admin/upload",thumbnail:t,progress:!0,file_filter:r,file_filter_alert:s,done:function(e){return e.result.err?(alert(e.result.err),!1):!0},browseButton:{text:'<i class="fa fa-upload"></i> '+e.data("browse_text"),className:"btn"},deleteButton:{text:'<i class="fa fa-times"></i>',className:"btn"}})}function getReadableFileSizeString(e){var t=-1,i=[" Ko"," Mo"," Go"," To","Po","Eo","Zo","Yo"];do e/=1024,t++;while(e>1024);return Math.max(e,.1).toFixed(1)+i[t]}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function($,e){var t=0,i=Array.prototype.slice,n=$.cleanData;$.cleanData=function(e){for(var t=0,i;null!=(i=e[t]);t++)try{$(i).triggerHandler("remove")}catch(r){}n(e)},$.widget=function(e,t,i){var n,r,s,a,o={},l=e.split(".")[0];e=e.split(".")[1],n=l+"-"+e,i||(i=t,t=$.Widget),$.expr[":"][n.toLowerCase()]=function(e){return!!$.data(e,n)},$[l]=$[l]||{},r=$[l][e],s=$[l][e]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},$.extend(s,r,{version:i.version,_proto:$.extend({},i),_childConstructors:[]}),a=new t,a.options=$.widget.extend({},a.options),$.each(i,function(e,i){return $.isFunction(i)?void(o[e]=function(){var n=function(){return t.prototype[e].apply(this,arguments)},r=function(i){return t.prototype[e].apply(this,i)};return function(){var e=this._super,t=this._superApply,s;return this._super=n,this._superApply=r,s=i.apply(this,arguments),this._super=e,this._superApply=t,s}}()):void(o[e]=i)}),s.prototype=$.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix||e:e},o,{constructor:s,namespace:l,widgetName:e,widgetFullName:n}),r?($.each(r._childConstructors,function(e,t){var i=t.prototype;$.widget(i.namespace+"."+i.widgetName,s,t._proto)}),delete r._childConstructors):t._childConstructors.push(s),$.widget.bridge(e,s)},$.widget.extend=function(t){for(var n=i.call(arguments,1),r=0,s=n.length,a,o;s>r;r++)for(a in n[r])o=n[r][a],n[r].hasOwnProperty(a)&&o!==e&&(t[a]=$.isPlainObject(o)?$.isPlainObject(t[a])?$.widget.extend({},t[a],o):$.widget.extend({},o):o);return t},$.widget.bridge=function(t,n){var r=n.prototype.widgetFullName||t;$.fn[t]=function(s){var a="string"==typeof s,o=i.call(arguments,1),l=this;return s=!a&&o.length?$.widget.extend.apply(null,[s].concat(o)):s,this.each(a?function(){var i,n=$.data(this,r);return n?$.isFunction(n[s])&&"_"!==s.charAt(0)?(i=n[s].apply(n,o),i!==n&&i!==e?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):$.error("no such method '"+s+"' for "+t+" widget instance"):$.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+s+"'")}:function(){var e=$.data(this,r);e?e.option(s||{})._init():$.data(this,r,new n(s,this))}),l}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=$(i||this.defaultElement||this)[0],this.element=$(i),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=$.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=$(),this.hoverable=$(),this.focusable=$(),i!==this&&($.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=$(i.style?i.ownerDocument:i.document||i),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(t,i){var n=t,r,s,a;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof t)if(n={},r=t.split("."),t=r.shift(),r.length){for(s=n[t]=$.widget.extend({},this.options[t]),a=0;a<r.length-1;a++)s[r[a]]=s[r[a]]||{},s=s[r[a]];if(t=r.pop(),1===arguments.length)return s[t]===e?null:s[t];s[t]=i}else{if(1===arguments.length)return this.options[t]===e?null:this.options[t];n[t]=i}return this._setOptions(n),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,t,i){var n,r=this;"boolean"!=typeof e&&(i=t,t=e,e=!1),i?(t=n=$(t),this.bindings=this.bindings.add(t)):(i=t,t=this.element,n=this.widget()),$.each(i,function(i,s){function a(){return e||r.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||$.guid++);var o=i.match(/^(\w+)\s*(.*)$/),l=o[1]+r.eventNamespace,p=o[2];p?n.delegate(p,l,a):t.bind(l,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){$(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){$(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){$(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){$(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,i){var n,r,s=this.options[e];if(i=i||{},t=$.Event(t),t.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],r=t.originalEvent)for(n in r)n in t||(t[n]=r[n]);return this.element.trigger(t,i),!($.isFunction(s)&&s.apply(this.element[0],[t].concat(i))===!1||t.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(e,t){$.Widget.prototype["_"+e]=function(i,n,r){"string"==typeof n&&(n={effect:n});var s,a=n?n===!0||"number"==typeof n?t:n.effect||t:e;n=n||{},"number"==typeof n&&(n={duration:n}),s=!$.isEmptyObject(n),n.complete=r,n.delay&&i.delay(n.delay),s&&$.effects&&$.effects.effect[a]?i[e](n):a!==e&&i[a]?i[a](n.duration,n.easing,r):i.queue(function(t){$(this)[e](),r&&r.call(i[0]),t()})}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function($){"use strict";var e=0;$.ajaxTransport("iframe",function(t){if(t.async){var i=t.initialIframeSrc||"javascript:false;",n,r,s;return{send:function(a,o){n=$('<form style="display:none;"></form>'),n.attr("accept-charset",t.formAcceptCharset),s=/\?/.test(t.url)?"&":"?","DELETE"===t.type?(t.url=t.url+s+"_method=DELETE",t.type="POST"):"PUT"===t.type?(t.url=t.url+s+"_method=PUT",t.type="POST"):"PATCH"===t.type&&(t.url=t.url+s+"_method=PATCH",t.type="POST"),e+=1,r=$('<iframe src="'+i+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var e,s=$.isArray(t.paramName)?t.paramName:[t.paramName];r.unbind("load").bind("load",function(){var e;try{if(e=r.contents(),!e.length||!e[0].firstChild)throw new Error}catch(t){e=void 0}o(200,"success",{iframe:e}),$('<iframe src="'+i+'"></iframe>').appendTo(n),window.setTimeout(function(){n.remove()},0)}),n.prop("target",r.prop("name")).prop("action",t.url).prop("method",t.type),t.formData&&$.each(t.formData,function(e,t){$('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(n)}),t.fileInput&&t.fileInput.length&&"POST"===t.type&&(e=t.fileInput.clone(),t.fileInput.after(function(t){return e[t]}),t.paramName&&t.fileInput.each(function(e){$(this).prop("name",s[e]||t.paramName)}),n.append(t.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),t.fileInput.removeAttr("form")),n.submit(),e&&e.length&&t.fileInput.each(function(t,i){var n=$(e[t]);$(i).prop("name",n.prop("name")).attr("form",n.attr("form")),n.replaceWith(i)})}),n.append(r).appendTo(document.body)},abort:function(){r&&r.unbind("load").prop("src",i),n&&n.remove()}}}}),$.ajaxSetup({converters:{"iframe text":function(e){return e&&$(e[0].body).text()},"iframe json":function(e){return e&&$.parseJSON($(e[0].body).text())},"iframe html":function(e){return e&&$(e[0].body).html()},"iframe xml":function(e){var t=e&&e[0];return t&&$.isXMLDoc(t)?t:$.parseXML(t.XMLDocument&&t.XMLDocument.xml||$(t.body).html())},"iframe script":function(e){return e&&$.globalEval($(e[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function($){"use strict";$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$('<input type="file">').prop("disabled")),$.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),$.support.xhrFormDataFileUpload=!!window.FormData,$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:$(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,t){return e=this.messages[e]||e.toString(),t&&$.each(t,function(t,i){e=e.replace("{"+t+"}",i)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){return e.isDefaultPrevented()?!1:void((t.autoUpload||t.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(e){var t;return"function"===$.type(e.formData)?e.formData(e.form):$.isArray(e.formData)?e.formData:"object"===$.type(e.formData)?(t=[],$.each(e.formData,function(e,i){t.push({name:e,value:i})}),t):[]},_getTotal:function(e){var t=0;return $.each(e,function(e,i){t+=i.size||1}),t},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?$.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i=Date.now?Date.now():(new Date).getTime(),n;if(t._time&&t.progressInterval&&i-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=i,n=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=n-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(i,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=n,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(i,n,t.bitrateInterval),this._trigger("progress",$.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",$.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(e){var t=this,i=e.xhr?e.xhr():$.ajaxSettings.xhr();i.upload&&($(i.upload).bind("progress",function(i){var n=i.originalEvent;i.lengthComputable=n.lengthComputable,i.loaded=n.loaded,i.total=n.total,t._onProgress(i,e)}),e.xhr=function(){return i})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(e){var t=this,i,n=e.files[0],r=e.multipart||!$.support.xhrFileUpload,s="array"===$.type(e.paramName)?e.paramName[0]:e.paramName;e.headers=$.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),r&&!e.blob&&this._isInstanceOf("File",n)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"'),r?$.support.xhrFormDataFileUpload&&(e.postMessage?(i=this._getFormData(e),e.blob?i.push({name:s,value:e.blob}):$.each(e.files,function(t,n){i.push({name:"array"===$.type(e.paramName)&&e.paramName[t]||s,value:n})})):(t._isInstanceOf("FormData",e.formData)?i=e.formData:(i=new FormData,$.each(this._getFormData(e),function(e,t){i.append(t.name,t.value)})),e.blob?i.append(s,e.blob,n.name):$.each(e.files,function(n,r){(t._isInstanceOf("File",r)||t._isInstanceOf("Blob",r))&&i.append("array"===$.type(e.paramName)&&e.paramName[n]||s,r,r.uploadName||r.name)})),e.data=i):(e.contentType=n.type||"application/octet-stream",e.data=e.blob||n),e.blob=null},_initIframeSettings:function(e){var t=$("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=$(e.fileInput),i=e.paramName;return i?$.isArray(i)||(i=[i]):(i=[],t.each(function(){for(var e=$(this),t=e.prop("name")||"files[]",n=(e.prop("files")||[1]).length;n;)i.push(t),n-=1}),i.length||(i=[t.prop("name")||"files[]"])),i},_initFormSettings:function(e){e.form&&e.form.length||(e.form=$(e.fileInput.prop("form")),e.form.length||(e.form=$(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===$.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=$.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var n=$.Deferred(),r=n.promise();return t=t||this.options.context||r,e===!0?n.resolveWith(t,i):e===!1&&n.rejectWith(t,i),r.abort=n.promise,this._enhancePromise(r)},_addConvenienceMethods:function(e,t){var i=this,n=function(e){return $.Deferred().resolveWith(i,e).promise()};t.process=function(e,r){return(e||r)&&(t._processQueue=this._processQueue=(this._processQueue||n([this])).pipe(function(){return t.errorThrown?$.Deferred().rejectWith(i,[t]).promise():n(arguments)}).pipe(e,r)),this._processQueue||n([this])},t.submit=function(){return"pending"!==this.state()&&(t.jqXHR=this.jqXHR=i._trigger("submit",$.Event("submit",{delegatedEvent:e}),this)!==!1&&i._onSend(e,this)),this.jqXHR||i._getXHRPromise()},t.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},t.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},t.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},t.progress=function(){return this._progress},t.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(e,t){e.uploadedBytes=e.uploadedBytes||0;var i=this,n=e.files[0],r=n.size,s=e.uploadedBytes,a=e.maxChunkSize||r,o=this._blobSlice,l=$.Deferred(),p=l.promise(),u,d;return this._isXHRUpload(e)&&o&&(s||r>a)&&!e.data?t?!0:s>=r?(n.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",n.error])):(d=function(){var t=$.extend({},e),p=t._progress.loaded;t.blob=o.call(n,s,s+a,n.type),t.chunkSize=t.blob.size,t.contentRange="bytes "+s+"-"+(s+t.chunkSize-1)+"/"+r,i._initXHRData(t),i._initProgressListener(t),u=(i._trigger("chunksend",null,t)!==!1&&$.ajax(t)||i._getXHRPromise(!1,t.context)).done(function(n,a,o){s=i._getUploadedBytes(o)||s+t.chunkSize,p+t.chunkSize-t._progress.loaded&&i._onProgress($.Event("progress",{lengthComputable:!0,loaded:s-t.uploadedBytes,total:s-t.uploadedBytes}),t),e.uploadedBytes=t.uploadedBytes=s,t.result=n,t.textStatus=a,t.jqXHR=o,i._trigger("chunkdone",null,t),i._trigger("chunkalways",null,t),r>s?d():l.resolveWith(t.context,[n,a,o])}).fail(function(e,n,r){t.jqXHR=e,t.textStatus=n,t.errorThrown=r,i._trigger("chunkfail",null,t),i._trigger("chunkalways",null,t),l.rejectWith(t.context,[e,n,r])})},this._enhancePromise(p),p.abort=function(){return u.abort()},d(),p):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,i,n){var r=n._progress.total,s=n._response;n._progress.loaded<r&&this._onProgress($.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n),s.result=n.result=e,s.textStatus=n.textStatus=t,s.jqXHR=n.jqXHR=i,this._trigger("done",null,n)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var i=this,n,r,s,a,o=i._getAJAXSettings(t),l=function(){return i._sending+=1,o._bitrateTimer=new i._BitrateTimer,n=n||((r||i._trigger("send",$.Event("send",{delegatedEvent:e}),o)===!1)&&i._getXHRPromise(!1,o.context,r)||i._chunkedUpload(o)||$.ajax(o)).done(function(e,t,n){i._onDone(e,t,n,o)}).fail(function(e,t,n){i._onFail(e,t,n,o)}).always(function(e,t,n){if(i._onAlways(e,t,n,o),i._sending-=1,i._active-=1,o.limitConcurrentUploads&&o.limitConcurrentUploads>i._sending)for(var r=i._slots.shift();r;){if("pending"===i._getDeferredState(r)){r.resolve();break}r=i._slots.shift()}0===i._active&&i._trigger("stop")})};return this._beforeSend(e,o),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(s=$.Deferred(),this._slots.push(s),a=s.pipe(l)):(this._sequence=this._sequence.pipe(l,l),a=this._sequence),a.abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(s&&s.rejectWith(o.context,r),l())},this._enhancePromise(a)):l()},_onAdd:function(e,t){var i=this,n=!0,r=$.extend({},this.options,t),s=t.files,a=s.length,o=r.limitMultiFileUploads,l=r.limitMultiFileUploadSize,p=r.limitMultiFileUploadSizeOverhead,u=0,d=this._getParamName(r),h,f,c,g,m=0;if(!l||a&&void 0!==s[0].size||(l=void 0),(r.singleFileUploads||o||l)&&this._isXHRUpload(r))if(r.singleFileUploads||l||!o)if(!r.singleFileUploads&&l)for(c=[],h=[],g=0;a>g;g+=1)u+=s[g].size+p,(g+1===a||u+s[g+1].size+p>l||o&&g+1-m>=o)&&(c.push(s.slice(m,g+1)),f=d.slice(m,g+1),f.length||(f=d),h.push(f),m=g+1,u=0);else h=d;else for(c=[],h=[],g=0;a>g;g+=o)c.push(s.slice(g,g+o)),f=d.slice(g,g+o),f.length||(f=d),h.push(f);else c=[s],h=[d];return t.originalFiles=s,$.each(c||s,function(r,s){var a=$.extend({},t);return a.files=c?s:[s],a.paramName=h[r],i._initResponseObject(a),i._initProgressObject(a),i._addConvenienceMethods(e,a),n=i._trigger("add",$.Event("add",{delegatedEvent:e}),a)}),n},_replaceFileInput:function(e){var t=e.clone(!0);$("<form></form>").append(t)[0].reset(),e.after(t).detach(),$.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(i,n){return n===e[0]?t[0]:n}),e[0]===this.element[0]&&(this.element=t)},_handleFileTreeEntry:function(e,t){var i=this,n=$.Deferred(),r=function(t){t&&!t.entry&&(t.entry=e),n.resolve([t])},s;return t=t||"",e.isFile?e._file?(e._file.relativePath=t,n.resolve(e._file)):e.file(function(e){e.relativePath=t,n.resolve(e)},r):e.isDirectory?(s=e.createReader(),s.readEntries(function(s){i._handleFileTreeEntries(s,t+e.name+"/").done(function(e){n.resolve(e)}).fail(r)},r)):n.resolve([]),n.promise()},_handleFileTreeEntries:function(e,t){var i=this;return $.when.apply($,$.map(e,function(e){return i._handleFileTreeEntry(e,t)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var t=e.items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries($.map(t,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):$.Deferred().resolve($.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=$(e);var t=e.prop("webkitEntries")||e.prop("entries"),i,n;if(t&&t.length)return this._handleFileTreeEntries(t);if(i=$.makeArray(e.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&$.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(n=e.prop("value"),!n)return $.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return $.Deferred().resolve(i).promise()},_getFileInputFiles:function(e){return e instanceof $&&1!==e.length?$.when.apply($,$.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var t=this,i={fileInput:$(e.target),form:$(e.target.form)};this._getFileInputFiles(i.fileInput).always(function(n){i.files=n,t.options.replaceFileInput&&t._replaceFileInput(i.fileInput),t._trigger("change",$.Event("change",{delegatedEvent:e}),i)!==!1&&t._onAdd(e,i)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,i={files:[]};t&&t.length&&($.each(t,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),this._trigger("paste",$.Event("paste",{delegatedEvent:e}),i)!==!1&&this._onAdd(e,i))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=this,i=e.dataTransfer,n={};i&&i.files&&i.files.length&&(e.preventDefault(),this._getDroppedFiles(i).always(function(i){n.files=i,t._trigger("drop",$.Event("drop",{delegatedEvent:e}),n)!==!1&&t._onAdd(e,n)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==$.inArray("Files",t.types)&&this._trigger("dragover",$.Event("dragover",{delegatedEvent:e}))!==!1&&(e.preventDefault(),t.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),$.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,t){var i=-1!==$.inArray(e,this._specialOptions);i&&this._destroyEventHandlers(),this._super(e,t),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof $||(e.fileInput=$(e.fileInput)),e.dropZone instanceof $||(e.dropZone=$(e.dropZone)),e.pasteZone instanceof $||(e.pasteZone=$(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===$.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var e=this,t=this.options,i=$(this.element[0].cloneNode(!1));$.each(i.data(),function(n,r){var s="data-"+n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();i.attr(s)&&(e._isRegExpOption(n,r)&&(r=e._getRegExp(r)),t[n]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var t=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(i){e.files=i,t._onAdd(null,e)}):(e.files=$.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var t=this,i=$.Deferred(),n=i.promise(),r,s;return n.abort=function(){return s=!0,r?r.abort():(i.reject(null,"abort","abort"),n)},this._getFileInputFiles(e.fileInput).always(function(n){if(!s){if(!n.length)return void i.reject();e.files=n,r=t._onSend(null,e).then(function(e,t,n){i.resolve(e,t,n)},function(e,t,n){i.reject(e,t,n)})}}),this._enhancePromise(n)}if(e.files=$.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}),function($){$.fn.sharp_file=function(e){var t={image:!1,progress:!1,url:null,thumbnail:!1,browseButton:{text:"browse",className:"btn"},deleteButton:{text:"&times; remove",className:"btn"},file_filter:"",file_filter_alert:"",file_label_pattern:'<div class="type"><i class="fa fa-file-o"></i><span>%type%</span></div><span class="mime">(%mime%)</span><span class="size">%size%</span>',done:function(e){return!0},submit:function(e){return!0}},i=$.extend(t,e);return this.each(function(){var e=$(this),t="_"+Math.random().toString(36).substr(2,9),n=$("<input/>").attr("type","file").attr("name","file").attr("id",t);n.css({display:"block",visibility:"hidden",width:"0",height:"0"}),$(this).append(n);var r=$("<a/>").addClass(i.browseButton.className).addClass("sharp-file-browse").html(i.browseButton.text);$(this).append(r);var s=null;i.progress&&(s=$("<div/>").addClass("sharp-file-progress").css({width:"0"}),$(this).prepend(s));var a=null;i.thumbnail&&(a=$(this).find(".sharp-file-thumbnail"),0==a.length&&(a=$("<img/>").addClass("sharp-file-thumbnail"),$(this).prepend(a)));var o=$(this).find(".sharp-file-label");0==o.length&&(o=$("<div/>").addClass("sharp-file-label"),$(this).append(o));var l=$(this).find(".sharp-file-id"),p=$(this).find(".sharp-file-path"),u=$("<a/>").addClass(i.deleteButton.className).addClass("sharp-file-delete").html(i.deleteButton.text);$(this).append(u),n.fileupload({dataType:"json",url:i.url,add:function(e,t){if(i.file_filter){var n=new RegExp("(\\.|\\/)("+i.file_filter.replace(/,/g,"|")+")$","i");if(t.originalFiles[0].type.length&&!n.test(t.originalFiles[0].type))return alert(i.file_filter_alert?i.file_filter_alert:i.file_filter),!1}t.submit()},submit:function(e,t){return r.css("visibility","hidden"),i.submit(t)},done:function(t,n){if(i.progress&&s.css("width","0%"),r.css("visibility","visible"),i.done(n)){e.addClass("valuated");var u=i.file_label_pattern.replace(/%type%/i,n.originalFiles[0].name.split(".").pop());u=u.replace(/%mime%/i,n.originalFiles[0].type),u=u.replace(/%size%/i,getReadableFileSizeString(n.originalFiles[0].size)),o.html(u),i.thumbnail&&n.result.file.thumbnail?(a.attr("src",n.result.file.thumbnail).show(),e.addClass("with_thumbnail")):e.removeClass("with_thumbnail"),l.val(n.result.file.name),p.val(n.result.file.path)}},progressall:function(e,t){if(i.progress){var n=parseInt(t.loaded/t.total*100,10);s.css("width",n+"%")}}}),r.on("click",function(){$("#"+t).click()}),u.on("click",function(){e.removeClass("valuated"),l.val("")}),$(this).bind("fileuploadsubmit",function(e,t){var n={};i.thumbnail&&$.each(i.thumbnail,function(e,t){var i="thumbnail_"+e;n[i]=t}),t.formData=n})})}}(jQuery),$(window).load(function(){$(".sharp-file").each(function(){createSharpFile($(this))})});