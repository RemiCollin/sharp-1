function createSharpDate(t){var e={};t.data("lang")&&(e.lang=t.data("lang")),t.data("has_date")&&(e.datepicker=t.data("has_date")),t.data("has_time")&&(e.timepicker=t.data("has_time")),t.data("step_time")&&(e.step=t.data("step_time")),t.data("max_date")&&(e.maxDate=t.data("max_date")),t.data("min_date")&&(e.minDate=t.data("min_date")),t.data("max_time")&&(e.maxTime=t.data("max_time")),t.data("min_time")&&(e.minTime=t.data("min_time")),t.data("start_date")&&(e.startDate=t.data("start_date")),t.data("format")&&(e.format=t.data("format")),t.data("start_on_sunday")&&(e.dayOfWeekStart=0),t.sharp_date(e)}function Editor(t){t=t||{},t.element&&(this.element=t.element),t.toolbar=t.toolbar||Editor.toolbar,t.hasOwnProperty("status")||(t.status=["lines","words","cursor"]),this.options=t,this.element&&this.render()}function fixShortcut(t){return t=isMac?t.replace("Ctrl","Cmd"):t.replace("Cmd","Ctrl")}function createIcon(t,e){e=e||{};var i=document.createElement("a"),n=e.shortcut||shortcuts[t];return n&&(n=fixShortcut(n),i.title=n,i.title=i.title.replace("Cmd","⌘"),isMac&&(i.title=i.title.replace("Alt","⌥"))),i.className=e.className||"icon-"+t,i}function createSep(){return el=document.createElement("i"),el.className="separator",el.innerHTML="|",el}function getState(t,e){e=e||t.getCursor("start");var i=t.getTokenAt(e);if(!i.type)return{};for(var n=i.type.split(" "),r={},o,s,a=0;a<n.length;a++)o=n[a],"strong"===o?r.bold=!0:"variable-2"===o?(s=t.getLine(e.line),/^\s*\d+\.\s/.test(s)?r["ordered-list"]=!0:r["unordered-list"]=!0):"atom"===o?r.quote=!0:"em"===o&&(r.italic=!0);return r}function toggleFullScreen(t){var e=t.codemirror.getWrapperElement(),i=document,n=i.fullScreen||i.mozFullScreen||i.webkitFullScreen,r=function(){e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},o=function(){i.cancelFullScreen?i.cancelFullScreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitCancelFullScreen&&i.webkitCancelFullScreen()};n?o&&o():r()}function toggleBold(t){var e=t.codemirror,i=getState(e),n,r="**",o="**",s=e.getCursor("start"),a=e.getCursor("end");i.bold?(n=e.getLine(s.line),r=n.slice(0,s.ch),o=n.slice(s.ch),r=r.replace(/^(.*)?(\*|\_){2}(\S+.*)?$/,"$1$3"),o=o.replace(/^(.*\S+)?(\*|\_){2}(\s+.*)?$/,"$1$3"),s.ch-=2,a.ch-=2,e.setLine(s.line,r+o)):(n=e.getSelection(),e.replaceSelection(r+n+o),s.ch+=2,a.ch+=2),e.setSelection(s,a),e.focus()}function toggleItalic(t){var e=t.codemirror,i=getState(e),n,r="*",o="*",s=e.getCursor("start"),a=e.getCursor("end");i.italic?(n=e.getLine(s.line),r=n.slice(0,s.ch),o=n.slice(s.ch),r=r.replace(/^(.*)?(\*|\_)(\S+.*)?$/,"$1$3"),o=o.replace(/^(.*\S+)?(\*|\_)(\s+.*)?$/,"$1$3"),s.ch-=1,a.ch-=1,e.setLine(s.line,r+o)):(n=e.getSelection(),e.replaceSelection(r+n+o),s.ch+=1,a.ch+=1),e.setSelection(s,a),e.focus()}function toggleBlockquote(t){var e=t.codemirror;_toggleLine(e,"quote")}function toggleUnOrderedList(t){var e=t.codemirror;_toggleLine(e,"unordered-list")}function toggleOrderedList(t){var e=t.codemirror;_toggleLine(e,"ordered-list")}function drawLink(t){var e=t.codemirror,i=getState(e);_replaceSelection(e,i.link,"[","](http://)")}function drawImage(t){var e=t.codemirror,i=getState(e);_replaceSelection(e,i.image,"![","](http://)")}function undo(t){var e=t.codemirror;e.undo(),e.focus()}function redo(t){var e=t.codemirror;e.redo(),e.focus()}function togglePreview(t){var e=t.toolbar.preview,i=t.constructor.markdown,n=t.codemirror,r=n.getWrapperElement(),o=r.lastChild;/editor-preview/.test(o.className)||(o=document.createElement("div"),o.className="editor-preview",r.appendChild(o)),/editor-preview-active/.test(o.className)?(o.className=o.className.replace(/\s*editor-preview-active\s*/g,""),e.className=e.className.replace(/\s*active\s*/g,"")):(setTimeout(function(){o.className+=" editor-preview-active"},1),e.className+=" active");var s=n.getValue();o.innerHTML=i(s)}function _replaceSelection(t,e,i,n){var r,o=t.getCursor("start"),s=t.getCursor("end");e?(r=t.getLine(o.line),i=r.slice(0,o.ch),n=r.slice(o.ch),t.setLine(o.line,i+n)):(r=t.getSelection(),t.replaceSelection(i+r+n),o.ch+=i.length,s.ch+=i.length),t.setSelection(o,s),t.focus()}function _toggleLine(t,e){for(var i=getState(t),n=t.getCursor("start"),r=t.getCursor("end"),o={quote:/^(\s*)\>\s+/,"unordered-list":/^(\s*)(\*|\-|\+)\s+/,"ordered-list":/^(\s*)\d+\.\s+/},s={quote:"> ","unordered-list":"* ","ordered-list":"1. "},a=n.line;a<=r.line;a++)!function(n){var r=t.getLine(n);r=i[e]?r.replace(o[e],"$1"):s[e]+r,t.setLine(n,r)}(a);t.focus()}function wordCount(t){var e=/[a-zA-Z0-9_\u0392-\u03c9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g,i=t.match(e),n=0;if(null===i)return n;for(var r=0;r<i.length;r++)n+=i[r].charCodeAt(0)>=19968?i[r].length:1;return n}function createSharpMarkdown(t){for(var e=t.data("toolbar")?t.data("toolbar"):defaultToolbar,i=[],n=0,r=e.length;r>n;n++){var o=e[n];i.push(" "==o?"|":{name:config_to_toolbar[o][0],action:config_to_toolbar[o][1]})}t.sharp_markdown({toolbar:i}),void 0!=t.data("height")&&t.parents(".sharp-field-markdown").find(".CodeMirror").css("height",t.data("height"))}function createSharpRef(t){var e={};if(t.data("create")&&(e.create=t.data("create")),t.sharp_ref(e),t.data("to_add")){var i=t.data("to_add");t[0].selectize.addOption({value:i,text:i}),t[0].selectize.addItem(i)}}function createSharpTags(t){var e={render:{option_create:function(e,i){return'<div class="create">'+t.data("add_text")+" <strong>"+i(e.input)+"</strong>&hellip;</div>"}}};if(t.data("addable")&&(e.create=function(t,e){e({value:"#"+t,text:t})}),t.sharp_tags(e),t.data("to_add")){var i=t.data("to_add").split(",");for(k=0;k<i.length;k++)t[0].selectize.addOption({value:i[k],text:i[k]}),t[0].selectize.addItem(i[k])}}function createSharpRefSublistItem(t){var e={linked_ref_field:t.data("linked_ref_field"),initial_value:t.data("initial_value")};t.sharp_refSublistItem(e)}function createSharpFile(t){var e=null,i=t.data("thumbnail");if(i){var n=i.split("x");2==n.length&&(e={width:n[0],height:n[1]})}var r=t.data("file_filter"),o=t.data("file_filter_alert");t.sharp_file({url:e?"/admin/uploadWithThumbnail":"/admin/upload",thumbnail:e,progress:!0,file_filter:r,file_filter_alert:o,done:function(t){return t.result.err?(alert(t.result.err),!1):!0},browseButton:{text:'<i class="fa fa-upload"></i> '+t.data("browse_text"),className:"btn"},deleteButton:{text:'<i class="fa fa-times"></i>',className:"btn"}})}function getReadableFileSizeString(t){var e=-1,i=[" Ko"," Mo"," Go"," To","Po","Eo","Zo","Yo"];do t/=1024,e++;while(t>1024);return Math.max(t,.1).toFixed(1)+i[e]}$(function(){var t=window.location.hash;t&&$('ul.entity-tabs a[href="'+t+'"]').tab("show"),$(".entity-tabs a").click(function(t){t.preventDefault(),$(this).tab("show"),history.pushState?history.pushState(null,null,this.hash):location.hash=this.hash})}),function(t,e){function i(e,i){var r,o,s,a=e.nodeName.toLowerCase();return"area"===a?(r=e.parentNode,o=r.name,e.href&&o&&"map"===r.nodeName.toLowerCase()?(s=t("img[usemap=#"+o+"]")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||i:i)&&n(e)}function n(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),n&&n.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var n,r,o=t(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,n){return!!t.data(e,n[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var n=t.attr(e,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(e,!r)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(i,n){function r(e,i,n,r){return t.each(o,function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),r&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+n]=function(i){return i===e?a["inner"+n].call(this):this.each(function(){t(this).css(s,r(this,i)+"px")})},t.fn["outer"+n]=function(e,i){return"number"!=typeof e?a["outer"+n].call(this,e):this.each(function(){t(this).css(s,r(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,i,n){var r,o=t.ui[e].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(t,e,i){var n,r=t.plugins[e];if(r&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(n=0;r.length>n;n++)t.options[r[n][0]]&&r[n][1].apply(t.element,i)}},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return e[n]>0?!0:(e[n]=1,r=e[n]>0,e[n]=0,r)}})}(jQuery),function(t,e){var i=0,n=Array.prototype.slice,r=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(o){}r(e)},t.widget=function(i,n,r){var o,s,a,l,u={},c=i.split(".")[0];i=i.split(".")[1],o=c+"-"+i,r||(r=n,n=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[c]=t[c]||{},s=t[c][i],a=t[c][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new a(t,i)},t.extend(a,s,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),l=new n,l.options=t.widget.extend({},l.options),t.each(r,function(i,r){return t.isFunction(r)?(u[i]=function(){var t=function(){return n.prototype[i].apply(this,arguments)},e=function(t){return n.prototype[i].apply(this,t)};return function(){var i,n=this._super,o=this._superApply;return this._super=t,this._superApply=e,i=r.apply(this,arguments),this._super=n,this._superApply=o,i}}(),e):(u[i]=r,e)}),a.prototype=t.widget.extend(l,{widgetEventPrefix:s?l.widgetEventPrefix||i:i},u,{constructor:a,namespace:c,widgetName:i,widgetFullName:o}),s?(t.each(s._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,a,i._proto)}),delete s._childConstructors):n._childConstructors.push(a),t.widget.bridge(i,a)},t.widget.extend=function(i){for(var r,o,s=n.call(arguments,1),a=0,l=s.length;l>a;a++)for(r in s[a])o=s[a][r],s[a].hasOwnProperty(r)&&o!==e&&(i[r]=t.isPlainObject(o)?t.isPlainObject(i[r])?t.widget.extend({},i[r],o):t.widget.extend({},o):o);return i},t.widget.bridge=function(i,r){var o=r.prototype.widgetFullName||i;t.fn[i]=function(s){var a="string"==typeof s,l=n.call(arguments,1),u=this;return s=!a&&l.length?t.widget.extend.apply(null,[s].concat(l)):s,this.each(a?function(){var n,r=t.data(this,o);return r?t.isFunction(r[s])&&"_"!==s.charAt(0)?(n=r[s].apply(r,l),n!==r&&n!==e?(u=n&&n.jquery?u.pushStack(n.get()):n,!1):e):t.error("no such method '"+s+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")}:function(){var e=t.data(this,o);e?e.option(s||{})._init():t.data(this,o,new r(s,this))}),u}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var r,o,s,a=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(a={},r=i.split("."),i=r.shift(),r.length){for(o=a[i]=t.widget.extend({},this.options[i]),s=0;r.length-1>s;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(i=r.pop(),1===arguments.length)return o[i]===e?null:o[i];o[i]=n}else{if(1===arguments.length)return this.options[i]===e?null:this.options[i];a[i]=n}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,n,r){var o,s=this;"boolean"!=typeof i&&(r=n,n=i,i=!1),r?(n=o=t(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,o=this.widget()),t.each(r,function(r,a){function l(){return i||s.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?s[a]:a).apply(s,arguments):e}"string"!=typeof a&&(l.guid=a.guid=a.guid||l.guid||t.guid++);var u=r.match(/^(\w+)\s*(.*)$/),c=u[1]+s.eventNamespace,h=u[2];h?o.delegate(h,c,l):n.bind(c,l)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var r,o,s=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(t.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?i:r.effect||i:e;r=r||{},"number"==typeof r&&(r={duration:r}),s=!t.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&t.effects&&t.effects.effect[a]?n[e](r):a!==e&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){t(this)[e](),o&&o.call(n[0]),i()})}})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,r=1===i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var n=null,r=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(n=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(n=t(e.target)),n&&(!this.options.handle||i||(t(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(r=!0)}),r))?(this.currentItem=n,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(e,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=t("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-t(document).scrollTop()<s.scrollSensitivity?a=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(a=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed)),e.pageX-t(document).scrollLeft()<s.scrollSensitivity?a=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(a=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],o=this._intersectsWithPointer(n),o&&n.instance===this.currentContainer&&r!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==r&&!t.contains(this.placeholder[0],r)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],r):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=t.left,s=o+t.width,a=t.top,l=a+t.height,u=this.offset.click.top,c=this.offset.click.left,h="x"===this.options.axis||n+u>a&&l>n+u,d="y"===this.options.axis||e+c>o&&s>e+c,f=h&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?f:e+this.helperProportions.width/2>o&&s>i-this.helperProportions.width/2&&n+this.helperProportions.height/2>a&&l>r-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),r=i&&n,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return r?this.floating?s&&"right"===s||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&n||"left"===o&&!n:r&&("down"===r&&i||"up"===r&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){a.push(this)}var n,r,o,s,a=[],l=[],u=this._connectWith();if(u&&e)for(n=u.length-1;n>=0;n--)for(o=t(u[n]),r=o.length-1;r>=0;r--)s=t.data(o[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&l.push([t.isFunction(s.options.items)?s.options.items.call(s.element):t(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=l.length-1;n>=0;n--)l[n][0].each(i);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,r,o,s,a,l,u,c=this.items,h=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(r=t(d[i]),n=r.length-1;n>=0;n--)o=t.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(h.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=h.length-1;i>=0;i--)for(s=h[i][1],a=h[i][0],n=0,u=a.length;u>n;n++)l=t(a[n]),l.data(this.widgetName+"-item",s),c.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,o;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);
if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,n=e.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),r=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(r)}):"img"===n&&r.attr("src",e.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(t,r){(!i||n.forcePlaceholderSize)&&(r.height()||r.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_contactContainers:function(n){var r,o,s,a,l,u,c,h,d,f,p=null,g=null;for(r=this.containers.length-1;r>=0;r--)if(!t.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(p&&t.contains(this.containers[r].element[0],p.element[0]))continue;p=this.containers[r],g=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",n,this._uiHash(this)),this.containers[r].containerCache.over=0);if(p)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",n,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(s=1e4,a=null,f=p.floating||i(this.currentItem),l=f?"left":"top",u=f?"width":"height",c=this.positionAbs[l]+this.offset.click[l],o=this.items.length-1;o>=0;o--)t.contains(this.containers[g].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!f||e(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[l],d=!1,Math.abs(h-c)>Math.abs(h+this.items[o][u]-c)&&(d=!0,h+=this.items[o][u]),s>Math.abs(h-c)&&(s=Math.abs(h-c),a=this.items[o],this.direction=d?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;a?this._rearrange(n,a,null,!0):this._rearrange(n,null,this.containers[g].element,!0),this._trigger("change",n,this._uiHash()),this.containers[g]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",n,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(e=t(r.containment)[0],i=t(r.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(e){var i,n,r=this.options,o=e.pageX,s=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(t,e){function i(t,e,i){return function(n){i._trigger(t,n,e._uiHash(e))}}this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&r.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||r.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(r.push(function(t){this._trigger("remove",t,this._uiHash())}),r.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)e||r.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),n=0;r.length>n;n++)r[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(n=0;r.length>n;n++)r[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})}(jQuery),/**
 * @preserve jQuery DateTimePicker plugin v2.2.5
 * @homepage http://xdsoft.net/jqplugins/datetimepicker/
 * (c) 2014, Chupurnov Valeriy.
 */
function($){"use strict";var t={i18n:{ru:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayOfWeek:["Вск","Пн","Вт","Ср","Чт","Пт","Сб"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeek:["zo","ma","di","wo","do","vr","za"]},tr:{months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],dayOfWeek:["Paz","Pts","Sal","Çar","Per","Cum","Cts"]},fr:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayOfWeek:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeek:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"]},th:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],dayOfWeek:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."]},pl:{months:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],dayOfWeek:["nd","pn","wt","śr","cz","pt","sb"]},pt:{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"]},ch:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeek:["日","一","二","三","四","五","六"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeek:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"]},kr:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeek:["일","월","화","수","목","금","토"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeek:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"]},da:{months:["January","Februar","Marts","April","Maj","Juni","July","August","September","Oktober","November","December"],dayOfWeek:["Søn","Man","Tir","ons","Tor","Fre","lør"]},ja:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeek:["日","月","火","水","木","金","土"]}},value:"",lang:"en",format:"Y/m/d H:i",formatTime:"H:i",formatDate:"Y/m/d",startDate:!1,step:60,closeOnDateSelect:!1,closeOnWithoutClick:!0,timepicker:!0,datepicker:!0,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,lazyInit:!1,mask:!1,validateOnBlur:!0,allowBlank:!0,yearStart:1950,yearEnd:2050,style:"",id:"",roundTime:"round",className:"",weekends:[],yearOffset:0};Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){for(var i=e||0,n=this.length;n>i;i++)if(this[i]===t)return i;return-1}),$.fn.xdsoftScroller=function(t){return this.each(function(){var e=$(this);if(!$(this).hasClass("xdsoft_scroller_box")){var i=function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e.x=i.pageX,e.y=i.pageY}else("mousedown"==t.type||"mouseup"==t.type||"mousemove"==t.type||"mouseover"==t.type||"mouseout"==t.type||"mouseenter"==t.type||"mouseleave"==t.type)&&(e.x=t.pageX,e.y=t.pageY);return e},n=0,r=e.children().eq(0),o=e[0].clientHeight,s=r[0].offsetHeight,a=$('<div class="xdsoft_scrollbar"></div>'),l=$('<div class="xdsoft_scroller"></div>'),u=100,c=!1;a.append(l),e.addClass("xdsoft_scroller_box").append(a),l.on("mousedown.xdsoft_scroller",function(i){o||e.trigger("resize_scroll.xdsoft_scroller",[t]);var r=i.pageY,s=parseInt(l.css("margin-top")),c=a[0].offsetHeight;$(document.body).addClass("xdsoft_noselect"),$([document.body,window]).on("mouseup.xdsoft_scroller",function h(){$([document.body,window]).off("mouseup.xdsoft_scroller",h).off("mousemove.xdsoft_scroller",n).removeClass("xdsoft_noselect")}),$(document.body).on("mousemove.xdsoft_scroller",n=function(t){var i=t.pageY-r+s;0>i&&(i=0),i+l[0].offsetHeight>c&&(i=c-l[0].offsetHeight),e.trigger("scroll_element.xdsoft_scroller",[u?i/u:0])})}),e.on("scroll_element.xdsoft_scroller",function(t,i){o||e.trigger("resize_scroll.xdsoft_scroller",[i,!0]),i=i>1?1:0>i||isNaN(i)?0:i,l.css("margin-top",u*i),r.css("marginTop",-parseInt((s-o)*i))}).on("resize_scroll.xdsoft_scroller",function(t,i,n){o=e[0].clientHeight,s=r[0].offsetHeight;var c=o/s,h=c*a[0].offsetHeight;c>1?l.hide():(l.show(),l.css("height",parseInt(h>10?h:10)),u=a[0].offsetHeight-l[0].offsetHeight,n!==!0&&e.trigger("scroll_element.xdsoft_scroller",[i?i:Math.abs(parseInt(r.css("marginTop")))/(s-o)]))}),e.mousewheel&&e.mousewheel(function(t,i,n,a){var l=Math.abs(parseInt(r.css("marginTop")));return e.trigger("scroll_element.xdsoft_scroller",[(l-20*i)/(s-o)]),t.stopPropagation(),!1}),e.on("touchstart",function(t){c=i(t)}),e.on("touchmove",function(t){if(c){var n=i(t),a=Math.abs(parseInt(r.css("marginTop")));e.trigger("scroll_element.xdsoft_scroller",[(a-(n.y-c.y))/(s-o)]),t.stopPropagation(),t.preventDefault()}}),e.on("touchend touchcancel",function(t){c=!1})}e.trigger("resize_scroll.xdsoft_scroller",[t])})},$.fn.datetimepicker=function(e){var i=48,n=57,r=96,o=105,s=17,a=46,l=13,u=27,c=8,h=37,d=38,f=39,p=40,g=9,m=116,v=65,y=67,b=86,x=90,w=89,_=!1,C=$.isPlainObject(e)||!e?$.extend(!0,{},t,e):$.extend({},t),k=0,S=function(t){t.on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function e(i){t.is(":disabled")||t.is(":hidden")||!t.is(":visible")||t.data("xdsoft_datetimepicker")||(clearTimeout(k),k=setTimeout(function(){t.data("xdsoft_datetimepicker")||D(t),t.off("open.xdsoft focusin.xdsoft mousedown.xdsoft",e).trigger("open.xdsoft")},100))})},D=function(t){function e(){var e=C.value?C.value:t&&t.val&&t.val()?t.val():"";return e&&E.isValidDate(e=Date.parseDate(e,C.format))?k.data("changed",!0):e="",e||C.startDate===!1||(e=E.strToDateTime(C.startDate)),e?e:0}var k=$("<div "+(C.id?'id="'+C.id+'"':"")+" "+(C.style?'style="'+C.style+'"':"")+' class="xdsoft_datetimepicker xdsoft_noselect '+C.className+'"></div>'),S=$('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net</a></div>'),D=$('<div class="xdsoft_datepicker active"></div>'),T=$('<div class="xdsoft_mounthpicker"><button type="button" class="xdsoft_prev"></button><button type="button" class="xdsoft_today_button"></button><div class="xdsoft_label xdsoft_month"><span></span></div><div class="xdsoft_label xdsoft_year"><span></span></div><button type="button" class="xdsoft_next"></button></div>'),L=$('<div class="xdsoft_calendar"></div>'),O=$('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"></button><div class="xdsoft_time_box"></div><button type="button" class="xdsoft_next"></button></div>'),M=O.find(".xdsoft_time_box").eq(0),I=$('<div class="xdsoft_time_variant"></div>'),P=$('<div class="xdsoft_scrollbar"></div>'),A=$('<div class="xdsoft_scroller"></div>'),N=$('<div class="xdsoft_select xdsoft_monthselect"><div></div></div>'),F=$('<div class="xdsoft_select xdsoft_yearselect"><div></div></div>');T.find(".xdsoft_month span").after(N),T.find(".xdsoft_year span").after(F),T.find(".xdsoft_month,.xdsoft_year").on("mousedown.xdsoft",function(t){T.find(".xdsoft_select").hide();var e=$(this).find(".xdsoft_select").eq(0),i=0,n=0;E.currentTime&&(i=E.currentTime[$(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),e.show();for(var r=e.find("div.xdsoft_option"),o=0;o<r.length&&r.eq(o).data("value")!=i;o++)n+=r[0].offsetHeight;return e.xdsoftScroller(n/(e.children()[0].offsetHeight-e[0].clientHeight)),t.stopPropagation(),!1}),T.find(".xdsoft_select").xdsoftScroller().on("mousedown.xdsoft",function(t){t.stopPropagation(),t.preventDefault()}).on("mousedown.xdsoft",".xdsoft_option",function(t){E&&E.currentTime&&E.currentTime[$(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"]($(this).data("value")),$(this).parent().parent().hide(),k.trigger("xchange.xdsoft"),C.onChangeMonth&&C.onChangeMonth.call&&C.onChangeMonth.call(k,E.currentTime,k.data("input"))}),k.setOptions=function(e){if(C=$.extend(!0,{},C,e),e.allowTimes&&$.isArray(e.allowTimes)&&e.allowTimes.length&&(C.allowTimes=$.extend(!0,[],e.allowTimes)),e.weekends&&$.isArray(e.weekends)&&e.weekends.length&&(C.weekends=$.extend(!0,[],e.weekends)),!C.open&&!C.opened||C.inline||t.trigger("open.xdsoft"),C.inline&&(k.addClass("xdsoft_inline"),t.after(k).hide(),k.trigger("afterOpen.xdsoft")),C.inverseButton&&(C.next="xdsoft_prev",C.prev="xdsoft_next"),C.datepicker?D.addClass("active"):D.removeClass("active"),C.timepicker?O.addClass("active"):O.removeClass("active"),C.value&&(t&&t.val&&t.val(C.value),E.setCurrentTime(C.value)),C.dayOfWeekStart=isNaN(C.dayOfWeekStart)||parseInt(C.dayOfWeekStart)<0||parseInt(C.dayOfWeekStart)>6?0:parseInt(C.dayOfWeekStart),C.timepickerScrollbar||P.hide(),C.minDate&&/^-(.*)$/.test(C.minDate)&&(C.minDate=E.strToDateTime(C.minDate).dateFormat(C.formatDate)),C.maxDate&&/^\+(.*)$/.test(C.maxDate)&&(C.maxDate=E.strToDateTime(C.maxDate).dateFormat(C.formatDate)),T.find(".xdsoft_today_button").css("visibility",C.todayButton?"visible":"hidden"),C.mask){var S,L=function(t){try{if(document.selection&&document.selection.createRange){var e=document.selection.createRange();return e.getBookmark().charCodeAt(2)-2}if(t.setSelectionRange)return t.selectionStart}catch(i){return 0}},M=function(t,e){var t="string"==typeof t||t instanceof String?document.getElementById(t):t;if(!t)return!1;if(t.createTextRange){var i=t.createTextRange();return i.collapse(!0),i.moveEnd(e),i.moveStart(e),i.select(),!0}return t.setSelectionRange?(t.setSelectionRange(e,e),!0):!1},I=function(t,e){var i=t.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return RegExp(i).test(e)};switch(t.off("keydown.xdsoft"),!0){case C.mask===!0:C.mask=C.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59");case"string"==$.type(C.mask):I(C.mask,t.val())||t.val(C.mask.replace(/[0-9]/g,"_")),t.on("keydown.xdsoft",function(e){var k=this.value,S=e.which;switch(!0){case S>=i&&n>=S||S>=r&&o>=S||S==c||S==a:var D=L(this),T=S!=c&&S!=a?String.fromCharCode(S>=r&&o>=S?S-i:S):"_";for(S!=c&&S!=a||!D||(D--,T="_");/[^0-9_]/.test(C.mask.substr(D,1))&&D<C.mask.length&&D>0;)D+=S==c||S==a?-1:1;if(k=k.substr(0,D)+T+k.substr(D+1),""==$.trim(k))k=C.mask.replace(/[0-9]/g,"_");else if(D==C.mask.length)break;for(D+=S==c||S==a?0:1;/[^0-9_]/.test(C.mask.substr(D,1))&&D<C.mask.length&&D>0;)D+=S==c||S==a?-1:1;I(C.mask,k)?(this.value=k,M(this,D)):""==$.trim(k)?this.value=C.mask.replace(/[0-9]/g,"_"):t.trigger("error_input.xdsoft");break;case!!~[v,y,b,x,w].indexOf(S)&&_:case!!~[u,d,p,h,f,m,s,g,l].indexOf(S):return!0}return e.preventDefault(),!1})}}C.validateOnBlur&&t.off("blur.xdsoft").on("blur.xdsoft",function(){C.allowBlank&&!$.trim($(this).val()).length?($(this).val(null),k.data("xdsoft_datetime").empty()):Date.parseDate($(this).val(),C.format)?k.data("xdsoft_datetime").setCurrentTime($(this).val()):($(this).val(E.now().dateFormat(C.format)),k.data("xdsoft_datetime").setCurrentTime($(this).val())),k.trigger("changedatetime.xdsoft")}),C.dayOfWeekStartPrev=0==C.dayOfWeekStart?6:C.dayOfWeekStart-1,k.trigger("xchange.xdsoft")},k.data("options",C).on("mousedown.xdsoft",function(t){return t.stopPropagation(),t.preventDefault(),F.hide(),N.hide(),!1});var H=O.find(".xdsoft_time_box");H.append(I),H.xdsoftScroller(),k.on("afterOpen.xdsoft",function(){H.xdsoftScroller()}),k.append(D).append(O),C.withoutCopyright!==!0&&k.append(S),D.append(T).append(L),$("body").append(k);var E=new function(){var t=this;t.now=function(){var t=new Date;return C.yearOffset&&t.setFullYear(t.getFullYear()+C.yearOffset),t},t.currentTime=this.now(),t.isValidDate=function(t){return"[object Date]"!==Object.prototype.toString.call(t)?!1:!isNaN(t.getTime())},t.setCurrentTime=function(e){t.currentTime="string"==typeof e?t.strToDateTime(e):t.isValidDate(e)?e:t.now(),k.trigger("xchange.xdsoft")},t.empty=function(){t.currentTime=null},t.getCurrentTime=function(e){return t.currentTime},t.nextMonth=function(){var e=t.currentTime.getMonth()+1;return 12==e&&(t.currentTime.setFullYear(t.currentTime.getFullYear()+1),e=0),t.currentTime.setDate(Math.min(Date.daysInMonth[e],t.currentTime.getDate())),t.currentTime.setMonth(e),C.onChangeMonth&&C.onChangeMonth.call&&C.onChangeMonth.call(k,E.currentTime,k.data("input")),k.trigger("xchange.xdsoft"),e},t.prevMonth=function(){var e=t.currentTime.getMonth()-1;return-1==e&&(t.currentTime.setFullYear(t.currentTime.getFullYear()-1),e=11),t.currentTime.setDate(Math.min(Date.daysInMonth[e],t.currentTime.getDate())),t.currentTime.setMonth(e),C.onChangeMonth&&C.onChangeMonth.call&&C.onChangeMonth.call(k,E.currentTime,k.data("input")),k.trigger("xchange.xdsoft"),e},t.strToDateTime=function(e){var i=[],n,r;return(i=/^(\+|\-)(.*)$/.exec(e))&&(i[2]=Date.parseDate(i[2],C.formatDate))?(n=i[2].getTime()-1*i[2].getTimezoneOffset()*6e4,r=new Date(E.now().getTime()+parseInt(i[1]+"1")*n)):r=e?Date.parseDate(e,C.format):t.now(),t.isValidDate(r)||(r=t.now()),r},t.strtodate=function(e){var i=e?Date.parseDate(e,C.formatDate):t.now();return t.isValidDate(i)||(i=t.now()),i},t.strtotime=function(e){var i=e?Date.parseDate(e,C.formatTime):t.now();return t.isValidDate(i)||(i=t.now()),i},t.str=function(){return t.currentTime.dateFormat(C.format)}};T.find(".xdsoft_today_button").on("mousedown.xdsoft",function(){k.data("changed",!0),E.setCurrentTime(0),k.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){t.val(E.str()),k.trigger("close.xdsoft")}),T.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var t=$(this),e=0,i=!1;!function n(r){var o=E.currentTime.getMonth();t.hasClass(C.next)?E.nextMonth():t.hasClass(C.prev)&&E.prevMonth(),!i&&(e=setTimeout(n,r?r:100))}(500),$([document.body,window]).on("mouseup.xdsoft",function r(){clearTimeout(e),i=!0,$([document.body,window]).off("mouseup.xdsoft",r)})}),O.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var t=$(this),e=0,i=!1,n=110;!function r(o){var s=M[0].clientHeight,a=I[0].offsetHeight,l=Math.abs(parseInt(I.css("marginTop")));t.hasClass(C.next)&&a-s-C.timeHeightInTimePicker>=l?I.css("marginTop","-"+(l+C.timeHeightInTimePicker)+"px"):t.hasClass(C.prev)&&l-C.timeHeightInTimePicker>=0&&I.css("marginTop","-"+(l-C.timeHeightInTimePicker)+"px"),M.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(I.css("marginTop"))/(a-s))]),n=n>10?10:n-10,!i&&(e=setTimeout(r,o?o:n))}(500),$([document.body,window]).on("mouseup.xdsoft",function o(){clearTimeout(e),i=!0,$([document.body,window]).off("mouseup.xdsoft",o)})});var W=0;k.on("xchange.xdsoft",function(t){clearTimeout(W),W=setTimeout(function(){var t="",e=new Date(E.currentTime.getFullYear(),E.currentTime.getMonth(),1,12,0,0),i=0,n=E.now();for(console.log("fire xchange.xdsoft",E.currentTime);e.getDay()!=C.dayOfWeekStart;)e.setDate(e.getDate()-1);t+="<table><thead><tr>";for(var r=0;7>r;r++)t+="<th>"+C.i18n[C.lang].dayOfWeek[r+C.dayOfWeekStart>6?0:r+C.dayOfWeekStart]+"</th>";t+="</tr></thead>",t+="<tbody><tr>";var o=!1,s=!1;C.maxDate!==!1&&(o=E.strtodate(C.maxDate),o=new Date(o.getFullYear(),o.getMonth(),o.getDate(),23,59,59,999)),C.minDate!==!1&&(s=E.strtodate(C.minDate),s=new Date(s.getFullYear(),s.getMonth(),s.getDate()));for(var a,l,u,c=[];i<E.currentTime.getDaysInMonth()||e.getDay()!=C.dayOfWeekStart||E.currentTime.getMonth()==e.getMonth();)c=[],i++,a=e.getDate(),l=e.getFullYear(),u=e.getMonth(),c.push("xdsoft_date"),(o!==!1&&e>o||s!==!1&&s>e)&&c.push("xdsoft_disabled"),E.currentTime.getMonth()!=u&&c.push("xdsoft_other_month"),(C.defaultSelect||k.data("changed"))&&E.currentTime.dateFormat("d.m.Y")==e.dateFormat("d.m.Y")&&c.push("xdsoft_current"),n.dateFormat("d.m.Y")==e.dateFormat("d.m.Y")&&c.push("xdsoft_today"),(0==e.getDay()||6==e.getDay()||~C.weekends.indexOf(e.dateFormat("d.m.Y")))&&c.push("xdsoft_weekend"),t+='<td data-date="'+a+'" data-month="'+u+'" data-year="'+l+'" class="xdsoft_date xdsoft_day_of_week'+e.getDay()+" "+c.join(" ")+'"><div>'+a+"</div></td>",e.getDay()==C.dayOfWeekStartPrev&&(t+="</tr>"),e.setDate(a+1);t+="</tbody></table>",L.html(t),T.find(".xdsoft_label span").eq(0).text(C.i18n[C.lang].months[E.currentTime.getMonth()]),T.find(".xdsoft_label span").eq(1).text(E.currentTime.getFullYear());var h="",d="",u="",f=function g(t,e){var i=E.now();i.setHours(t),t=parseInt(i.getHours()),i.setMinutes(e),e=parseInt(i.getMinutes()),c=[],(C.maxTime!==!1&&E.strtotime(C.maxTime).getTime()<i.getTime()||C.minTime!==!1&&E.strtotime(C.minTime).getTime()>i.getTime())&&c.push("xdsoft_disabled"),(C.initTime||C.defaultSelect||k.data("changed"))&&parseInt(E.currentTime.getHours())==parseInt(t)&&(C.step>59||Math[C.roundTime](E.currentTime.getMinutes()/C.step)*C.step==parseInt(e))&&(C.defaultSelect||k.data("changed")?c.push("xdsoft_current"):C.initTime&&c.push("xdsoft_init_time")),parseInt(n.getHours())==parseInt(t)&&parseInt(n.getMinutes())==parseInt(e)&&c.push("xdsoft_today"),h+='<div class="xdsoft_time '+c.join(" ")+'" data-hour="'+t+'" data-minute="'+e+'">'+i.dateFormat(C.formatTime)+"</div>"};if(C.allowTimes&&$.isArray(C.allowTimes)&&C.allowTimes.length)for(var i=0;i<C.allowTimes.length;i++)d=E.strtotime(C.allowTimes[i]).getHours(),u=E.strtotime(C.allowTimes[i]).getMinutes(),f(d,u);else for(var i=0,r=0;i<(C.hours12?12:24);i++)for(r=0;60>r;r+=C.step)d=(10>i?"0":"")+i,u=(10>r?"0":"")+r,f(d,u);I.html(h);var p="",i=0;for(i=parseInt(C.yearStart,10)+C.yearOffset;i<=parseInt(C.yearEnd,10)+C.yearOffset;i++)p+='<div class="xdsoft_option '+(E.currentTime.getFullYear()==i?"xdsoft_current":"")+'" data-value="'+i+'">'+i+"</div>";for(F.children().eq(0).html(p),i=0,p="";11>=i;i++)p+='<div class="xdsoft_option '+(E.currentTime.getMonth()==i?"xdsoft_current":"")+'" data-value="'+i+'">'+C.i18n[C.lang].months[i]+"</div>";N.children().eq(0).html(p),$(this).trigger("generate.xdsoft")},10),t.stopPropagation()}).on("afterOpen.xdsoft",function(){if(C.timepicker){var t;if(I.find(".xdsoft_current").length?t=".xdsoft_current":I.find(".xdsoft_init_time").length&&(t=".xdsoft_init_time"),t){var e=M[0].clientHeight,i=I[0].offsetHeight,n=I.find(t).index()*C.timeHeightInTimePicker+1;n>i-e&&(n=i-e),I.css("marginTop","-"+parseInt(n)+"px"),M.trigger("scroll_element.xdsoft_scroller",[parseInt(n)/(i-e)])}}});var z=0;L.on("click.xdsoft","td",function(e){e.stopPropagation(),z++;var i=$(this),n=E.currentTime;return i.hasClass("xdsoft_disabled")?!1:(n.setDate(i.data("date")),n.setMonth(i.data("month")),n.setFullYear(i.data("year")),k.trigger("select.xdsoft",[n]),t.val(E.str()),(z>1||C.closeOnDateSelect===!0||0===C.closeOnDateSelect&&!C.timepicker)&&!C.inline&&k.trigger("close.xdsoft"),C.onSelectDate&&C.onSelectDate.call&&C.onSelectDate.call(k,E.currentTime,k.data("input")),k.data("changed",!0),k.trigger("xchange.xdsoft"),k.trigger("changedatetime.xdsoft"),void setTimeout(function(){z=0},200))}),I.on("click.xdsoft","div",function(t){t.stopPropagation();var e=$(this),i=E.currentTime;return e.hasClass("xdsoft_disabled")?!1:(i.setHours(e.data("hour")),i.setMinutes(e.data("minute")),k.trigger("select.xdsoft",[i]),k.data("input").val(E.str()),!C.inline&&k.trigger("close.xdsoft"),C.onSelectTime&&C.onSelectTime.call&&C.onSelectTime.call(k,E.currentTime,k.data("input")),k.data("changed",!0),k.trigger("xchange.xdsoft"),void k.trigger("changedatetime.xdsoft"))}),k.mousewheel&&D.mousewheel(function(t,e,i,n){return C.scrollMonth?(0>e?E.nextMonth():E.prevMonth(),!1):!0}),k.mousewheel&&M.unmousewheel().mousewheel(function(t,e,i,n){if(!C.scrollTime)return!0;var r=M[0].clientHeight,o=I[0].offsetHeight,s=Math.abs(parseInt(I.css("marginTop"))),a=!0;return 0>e&&o-r-C.timeHeightInTimePicker>=s?(I.css("marginTop","-"+(s+C.timeHeightInTimePicker)+"px"),a=!1):e>0&&s-C.timeHeightInTimePicker>=0&&(I.css("marginTop","-"+(s-C.timeHeightInTimePicker)+"px"),a=!1),M.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(I.css("marginTop"))/(o-r))]),t.stopPropagation(),a}),k.on("changedatetime.xdsoft",function(){if(C.onChangeDateTime&&C.onChangeDateTime.call){var t=k.data("input");C.onChangeDateTime.call(k,E.currentTime,t),t.trigger("change")}}).on("generate.xdsoft",function(){C.onGenerate&&C.onGenerate.call&&C.onGenerate.call(k,E.currentTime,k.data("input"))});var R=0;t.mousewheel&&t.mousewheel(function(e,i,n,r){return C.scrollInput?!C.datepicker&&C.timepicker?(R=I.find(".xdsoft_current").length?I.find(".xdsoft_current").eq(0).index():0,R+i>=0&&R+i<I.children().length&&(R+=i),I.children().eq(R).length&&I.children().eq(R).trigger("mousedown"),!1):C.datepicker&&!C.timepicker?(D.trigger(e,[i,n,r]),t.val&&t.val(E.str()),k.trigger("changedatetime.xdsoft"),!1):void 0:!0});var j=function(){var t=k.data("input").offset(),e=t.top+k.data("input")[0].offsetHeight-1,i=t.left;e+k[0].offsetHeight>$(window).height()+$(window).scrollTop()&&(e=t.top-k[0].offsetHeight+1),0>e&&(e=0),i+k[0].offsetWidth>$(window).width()&&(i=t.left-k[0].offsetWidth+k.data("input")[0].offsetWidth),k.css({left:i,top:e})};k.on("open.xdsoft",function(){var t=!0;C.onShow&&C.onShow.call&&(t=C.onShow.call(k,E.currentTime,k.data("input"))),t!==!1&&(k.show(),k.trigger("afterOpen.xdsoft"),j(),$(window).off("resize.xdsoft",j).on("resize.xdsoft",j),C.closeOnWithoutClick&&$([document.body,window]).on("mousedown.xdsoft",function e(){k.trigger("close.xdsoft"),$([document.body,window]).off("mousedown.xdsoft",e)}))}).on("close.xdsoft",function(t){var e=!0;C.onClose&&C.onClose.call&&(e=C.onClose.call(k,E.currentTime,k.data("input"))),e===!1||C.opened||C.inline||k.hide(),t.stopPropagation()}).data("input",t);var B=0,q=0;k.data("xdsoft_datetime",E),k.setOptions(C),E.setCurrentTime(e()),k.trigger("afterOpen.xdsoft"),t.data("xdsoft_datetimepicker",k).on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function(i){t.is(":disabled")||t.is(":hidden")||!t.is(":visible")||(clearTimeout(B),B=setTimeout(function(){t.is(":disabled")||t.is(":hidden")||!t.is(":visible")||(E.setCurrentTime(e()),k.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(t){var e=this.value,i=t.which;switch(!0){case!!~[l].indexOf(i):var n=$("input:visible,textarea:visible");return k.trigger("close.xdsoft"),n.eq(n.index(this)+1).focus(),!1;case!!~[g].indexOf(i):return k.trigger("close.xdsoft"),!0}})},T=function(t){var e=t.data("xdsoft_datetimepicker");e&&(e.data("xdsoft_datetime",null),e.remove(),t.data("xdsoft_datetimepicker",null).off("open.xdsoft focusin.xdsoft focusout.xdsoft mousedown.xdsoft blur.xdsoft keydown.xdsoft"),$(window).off("resize.xdsoft"),$([window,document.body]).off("mousedown.xdsoft"),t.unmousewheel&&t.unmousewheel())};return $(document).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(t){t.keyCode==s&&(_=!0)}).on("keyup.xdsoftctrl",function(t){t.keyCode==s&&(_=!1)}),this.each(function(){var t;if(t=$(this).data("xdsoft_datetimepicker")){if("string"===$.type(e))switch(e){case"show":$(this).select().focus(),t.trigger("open.xdsoft");break;case"hide":t.trigger("close.xdsoft");break;case"destroy":T($(this));break;case"reset":this.value=this.defaultValue,this.value&&t.data("xdsoft_datetime").isValidDate(Date.parseDate(this.value,C.format))||t.data("changed",!1),t.data("xdsoft_datetime").setCurrentTime(this.value)}else t.setOptions(e);return 0}"string"!==$.type(e)&&(!C.lazyInit||C.open||C.inline?D($(this)):S($(this)))})}}(jQuery),Date.parseFunctions={count:0},Date.parseRegexes=[],Date.formatFunctions={count:0},Date.prototype.dateFormat=function(t){if("unixtime"==t)return parseInt(this.getTime()/1e3);null==Date.formatFunctions[t]&&Date.createNewFormat(t);var e=Date.formatFunctions[t];return this[e]()},Date.createNewFormat=function(a){var b="format"+Date.formatFunctions.count++;Date.formatFunctions[a]=b;for(var c="Date.prototype."+b+" = function() {return ",d=!1,e="",i=0;i<a.length;++i)e=a.charAt(i),d||"\\"!=e?d?(d=!1,c+="'"+String.escape(e)+"' + "):c+=Date.getFormatCode(e):d=!0;eval(c.substring(0,c.length-3)+";}")},Date.getFormatCode=function(t){switch(t){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(t)+"' + "}},Date.parseDate=function(t,e){if("unixtime"==e)return new Date(isNaN(parseInt(t))?0:1e3*parseInt(t));null==Date.parseFunctions[e]&&Date.createParser(e);var i=Date.parseFunctions[e];return Date[i](t)},Date.createParser=function(a){var b="parse"+Date.parseFunctions.count++,c=Date.parseRegexes.length,d=1;Date.parseFunctions[a]=b;for(var e="Date."+b+" = function(input) {\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+c+"]);\nif (results && results.length > 0) {",f="",g=!1,h="",i=0;i<a.length;++i)h=a.charAt(i),g||"\\"!=h?g?(g=!1,f+=String.escape(h)):(obj=Date.formatCodeToRegex(h,d),d+=obj.g,f+=obj.s,obj.g&&obj.c&&(e+=obj.c)):g=!0;e+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}",Date.parseRegexes[c]=new RegExp("^"+f+"$"),eval(e)},Date.formatCodeToRegex=function(t,e){switch(t){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+e+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+e+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+e+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+e+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+e+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+e+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+e+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+e+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+e+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+e+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+e+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(t)}}},Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+String.leftPad(Math.abs(this.getTimezoneOffset())%60,2,"0")},Date.prototype.getDayOfYear=function(){var t=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var e=0;e<this.getMonth();++e)t+=Date.daysInMonth[e];return t+this.getDate()},Date.prototype.getWeekOfYear=function(){var t=this.getDayOfYear()+(4-this.getDay()),e=new Date(this.getFullYear(),0,1),i=7-e.getDay()+4;return String.leftPad(Math.ceil((t-i)/7)+1,2,"0")},Date.prototype.isLeapYear=function(){var t=this.getFullYear();return 0==(3&t)&&(t%100||t%400==0&&t)},Date.prototype.getFirstDayOfMonth=function(){var t=(this.getDay()-(this.getDate()-1))%7;return 0>t?t+7:t},Date.prototype.getLastDayOfMonth=function(){var t=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return 0>t?t+7:t},Date.prototype.getDaysInMonth=function(){return Date.daysInMonth[1]=this.isLeapYear()?29:28,Date.daysInMonth[this.getMonth()]},Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},String.escape=function(t){return t.replace(/('|\\)/g,"\\$1")},String.leftPad=function(t,e,i){var n=new String(t);for(null==i&&(i=" ");n.length<e;)n=i+n;return n},Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.y2kYear=50,Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function($){function t(t){var e=t||window.event,i=[].slice.call(arguments,1),o=0,s=0,a=0,l=0,u=0,c;
return t=$.event.fix(e),t.type="mousewheel",e.wheelDelta&&(o=e.wheelDelta),e.detail&&(o=-1*e.detail),e.deltaY&&(a=-1*e.deltaY,o=a),e.deltaX&&(s=e.deltaX,o=-1*s),void 0!==e.wheelDeltaY&&(a=e.wheelDeltaY),void 0!==e.wheelDeltaX&&(s=-1*e.wheelDeltaX),l=Math.abs(o),(!n||n>l)&&(n=l),u=Math.max(Math.abs(a),Math.abs(s)),(!r||r>u)&&(r=u),c=o>0?"floor":"ceil",o=Math[c](o/n),s=Math[c](s/r),a=Math[c](a/r),i.unshift(t,o,s,a),($.event.dispatch||$.event.handle).apply(this,i)}var e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],i="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],n,r;if($.event.fixHooks)for(var o=e.length;o;)$.event.fixHooks[e[--o]]=$.event.mouseHooks;$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],t,!1);else this.onmousewheel=null}},$.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function($){$.fn.sharp_date=function(t){var e={timepicker:!1,datepicker:!0,step:30,lang:"fr",format:"d/m/Y",dayOfWeekStart:1,mask:!0},i=$.extend(e,t);return this.each(function(){var t=$(this).prev(".sharp-date-timestamp");i.onChangeDateTime=function(e,i){t.val(e)},$(this).datetimepicker(i)})}}(jQuery),$(window).load(function(){$(".sharp-date").each(function(){createSharpDate($(this))})}),$(window).load(function(){$form=$("#sharpform"),$form.on("click",".sharp-embed-update",function(t){t.preventDefault(),$form.prop("action",$(this).prop("href")),$form.submit()}),$form.on("click",".sharp-embed-delete",function(t){t.preventDefault(),fieldName=$(this).data("fieldname"),$field=$(this).parents(".sharp-field-embed"),$field.find(".panel-embed").removeClass("updatable").addClass("creatable"),$field.find(".panel-embed-body").empty(),$input=$field.find("#"+fieldName),$input.val("__DELETE__")})});var toolbar=[{name:"bold",action:toggleBold},{name:"italic",action:toggleItalic},"|",{name:"quote",action:toggleBlockquote},{name:"unordered-list",action:toggleUnOrderedList},{name:"ordered-list",action:toggleOrderedList},"|",{name:"link",action:drawLink},{name:"image",action:drawImage},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:togglePreview},{name:"fullscreen",action:toggleFullScreen}];Editor.toolbar=toolbar,Editor.markdown=function(t){return window.marked?marked(t):void 0},Editor.prototype.render=function(t){if(t||(t=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==t){this.element=t;var e=this.options,i=this,n={};for(var r in shortcuts)!function(t){n[fixShortcut(t)]=function(e){shortcuts[t](i)}}(r);n.Enter="newlineAndIndentContinueMarkdownList",this.codemirror=CodeMirror.fromTextArea(t,{mode:"markdown",theme:"paper",indentWithTabs:!0,lineNumbers:!1,extraKeys:n}),e.toolbar!==!1&&this.createToolbar(),e.status!==!1&&this.createStatusbar(),this._rendered=this.element}},Editor.prototype.createToolbar=function(t){if(t=t||this.options.toolbar,t&&0!==t.length){var e=document.createElement("div");e.className="editor-toolbar";var i=this,n;i.toolbar={};for(var r=0;r<t.length;r++)!function(t){var n;n=t.name?createIcon(t.name,t):"|"===t?createSep():createIcon(t),t.action&&("function"==typeof t.action?n.onclick=function(e){t.action(i)}:"string"==typeof t.action&&(n.href=t.action,n.target="_blank")),i.toolbar[t.name||t]=n,e.appendChild(n)}(t[r]);var o=this.codemirror;o.on("cursorActivity",function(){var t=getState(o);for(var e in i.toolbar)!function(e){var n=i.toolbar[e];t[e]?n.className+=" active":n.className=n.className.replace(/\s*active\s*/g,"")}(e)});var s=o.getWrapperElement();return s.parentNode.insertBefore(e,s),e}},Editor.prototype.createStatusbar=function(t){if(t=t||this.options.status,t&&0!==t.length){var e=document.createElement("div");e.className="editor-statusbar";for(var i,n=this.codemirror,r=0;r<t.length;r++)!function(t){var r=document.createElement("span");r.className=t,"words"===t?(r.innerHTML="0",n.on("update",function(){r.innerHTML=wordCount(n.getValue())})):"lines"===t?(r.innerHTML="0",n.on("update",function(){r.innerHTML=n.lineCount()})):"cursor"===t&&(r.innerHTML="0:0",n.on("cursorActivity",function(){i=n.getCursor(),r.innerHTML=i.line+":"+i.ch})),e.appendChild(r)}(t[r]);var o=this.codemirror.getWrapperElement();return o.parentNode.insertBefore(e,o.nextSibling),e}},Editor.toggleBold=toggleBold,Editor.toggleItalic=toggleItalic,Editor.toggleBlockquote=toggleBlockquote,Editor.toggleUnOrderedList=toggleUnOrderedList,Editor.toggleOrderedList=toggleOrderedList,Editor.drawLink=drawLink,Editor.drawImage=drawImage,Editor.undo=undo,Editor.redo=redo,Editor.toggleFullScreen=toggleFullScreen,Editor.prototype.toggleBold=function(){toggleBold(this)},Editor.prototype.toggleItalic=function(){toggleItalic(this)},Editor.prototype.toggleBlockquote=function(){toggleBlockquote(this)},Editor.prototype.toggleUnOrderedList=function(){toggleUnOrderedList(this)},Editor.prototype.toggleOrderedList=function(){toggleOrderedList(this)},Editor.prototype.drawLink=function(){drawLink(this)},Editor.prototype.drawImage=function(){drawImage(this)},Editor.prototype.undo=function(){undo(this)},Editor.prototype.redo=function(){redo(this)},Editor.prototype.toggleFullScreen=function(){toggleFullScreen(this)};var isMac=/Mac/.test(navigator.platform),shortcuts={"Cmd-B":toggleBold,"Cmd-I":toggleItalic,"Cmd-K":drawLink,"Cmd-Alt-I":drawImage,"Cmd-'":toggleBlockquote,"Cmd-Alt-L":toggleOrderedList,"Cmd-L":toggleUnOrderedList};window.CodeMirror=function(){"use strict";function t(i,n){if(!(this instanceof t))return new t(i,n);this.options=n=n||{};for(var r in ro)!n.hasOwnProperty(r)&&ro.hasOwnProperty(r)&&(n[r]=ro[r]);d(n);var o="string"==typeof n.value?0:n.value.first,s=this.display=e(i,o);s.wrapper.CodeMirror=this,u(this),n.autofocus&&!Er&&pe(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new Yn},a(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");var l=n.value;"string"==typeof l&&(l=new bo(n.value,n.mode)),se(this,hn)(this,l),Sr&&setTimeout(er(fe,this,!0),20),me(this);var c;try{c=document.activeElement==s.input}catch(h){}c||n.autofocus&&!Er?setTimeout(er(Pe,this),20):Ae(this),se(this,function(){for(var t in no)no.propertyIsEnumerable(t)&&no[t](this,n[t],oo);for(var e=0;e<uo.length;++e)uo[e](this)})()}function e(t,e){var i={},n=i.input=rr("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");return Lr?n.style.width="1000px":n.setAttribute("wrap","off"),$r&&(n.style.border="1px solid black"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),n.setAttribute("spellcheck","false"),i.inputDiv=rr("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),i.scrollbarH=rr("div",[rr("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),i.scrollbarV=rr("div",[rr("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),i.scrollbarFiller=rr("div",null,"CodeMirror-scrollbar-filler"),i.gutterFiller=rr("div",null,"CodeMirror-gutter-filler"),i.lineDiv=rr("div",null,"CodeMirror-code"),i.selectionDiv=rr("div",null,null,"position: relative; z-index: 1"),i.cursor=rr("div"," ","CodeMirror-cursor"),i.otherCursor=rr("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"),i.measure=rr("div",null,"CodeMirror-measure"),i.lineSpace=rr("div",[i.measure,i.selectionDiv,i.lineDiv,i.cursor,i.otherCursor],null,"position: relative; outline: none"),i.mover=rr("div",[rr("div",[i.lineSpace],"CodeMirror-lines")],null,"position: relative"),i.sizer=rr("div",[i.mover],"CodeMirror-sizer"),i.heightForcer=rr("div",null,null,"position: absolute; height: "+ko+"px; width: 1px;"),i.gutters=rr("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=rr("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=rr("div",[i.inputDiv,i.scrollbarH,i.scrollbarV,i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),Dr&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),t.appendChild?t.appendChild(i.wrapper):t(i.wrapper),$r&&(n.style.width="0px"),Lr||(i.scroller.draggable=!0),Ar?(i.inputDiv.style.height="1px",i.inputDiv.style.position="absolute"):Dr&&(i.scrollbarH.style.minWidth=i.scrollbarV.style.minWidth="18px"),i.viewOffset=i.lastSizeC=0,i.showingFrom=i.showingTo=e,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.prevInput="",i.alignWidgets=!1,i.pollingFast=!1,i.poll=new Yn,i.cachedCharWidth=i.cachedTextHeight=null,i.measureLineCache=[],i.measureLineCachePos=0,i.inaccurateSelection=!1,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i}function i(e){e.doc.mode=t.getMode(e.options,e.doc.modeOption),e.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),e.doc.frontier=e.doc.first,P(e,100),e.state.modeGen++,e.curOp&&ue(e)}function n(t){t.options.lineWrapping?(t.display.wrapper.className+=" CodeMirror-wrap",t.display.sizer.style.minWidth=""):(t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-wrap",""),h(t)),o(t),ue(t),Y(t),setTimeout(function(){f(t)},100)}function r(t){var e=ie(t.display),i=t.options.lineWrapping,n=i&&Math.max(5,t.display.scroller.clientWidth/ne(t.display)-3);return function(r){return zi(t.doc,r)?0:i?(Math.ceil(r.text.length/n)||1)*e:e}}function o(t){var e=t.doc,i=r(t);e.iter(function(t){var e=i(t);e!=t.height&&gn(t,e)})}function s(t){var e=fo[t.options.keyMap],i=e.style;t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(i?" cm-keymap-"+i:""),t.state.disableInput=e.disableInput}function a(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Y(t)}function l(t){u(t),ue(t),setTimeout(function(){g(t)},20)}function u(t){var e=t.display.gutters,i=t.options.gutters;or(e);for(var n=0;n<i.length;++n){var r=i[n],o=e.appendChild(rr("div",null,"CodeMirror-gutter "+r));"CodeMirror-linenumbers"==r&&(t.display.lineGutter=o,o.style.width=(t.display.lineNumWidth||1)+"px")}e.style.display=n?"":"none"}function c(t,e){if(0==e.height)return 0;for(var i=e.text.length,n,r=e;n=$i(r);){var o=n.find();r=dn(t,o.from.line),i+=o.from.ch-o.to.ch}for(r=e;n=Ei(r);){var o=n.find();i-=r.text.length-o.from.ch,r=dn(t,o.to.line),i+=r.text.length-o.to.ch}return i}function h(t){var e=t.display,i=t.doc;e.maxLine=dn(i,i.first),e.maxLineLength=c(i,e.maxLine),e.maxLineChanged=!0,i.iter(function(t){var n=c(i,t);n>e.maxLineLength&&(e.maxLineLength=n,e.maxLine=t)})}function d(t){for(var e=!1,i=0;i<t.gutters.length;++i)"CodeMirror-linenumbers"==t.gutters[i]&&(t.lineNumbers?e=!0:t.gutters.splice(i--,1));!e&&t.lineNumbers&&t.gutters.push("CodeMirror-linenumbers")}function f(t){var e=t.display,i=t.doc.height,n=i+E(e);e.sizer.style.minHeight=e.heightForcer.style.top=n+"px",e.gutters.style.height=Math.max(n,e.scroller.clientHeight-ko)+"px";var r=Math.max(n,e.scroller.scrollHeight),o=e.scroller.scrollWidth>e.scroller.clientWidth+1,s=r>e.scroller.clientHeight+1;s?(e.scrollbarV.style.display="block",e.scrollbarV.style.bottom=o?cr(e.measure)+"px":"0",e.scrollbarV.firstChild.style.height=r-e.scroller.clientHeight+e.scrollbarV.clientHeight+"px"):e.scrollbarV.style.display="",o?(e.scrollbarH.style.display="block",e.scrollbarH.style.right=s?cr(e.measure)+"px":"0",e.scrollbarH.firstChild.style.width=e.scroller.scrollWidth-e.scroller.clientWidth+e.scrollbarH.clientWidth+"px"):e.scrollbarH.style.display="",o&&s?(e.scrollbarFiller.style.display="block",e.scrollbarFiller.style.height=e.scrollbarFiller.style.width=cr(e.measure)+"px"):e.scrollbarFiller.style.display="",o&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(e.gutterFiller.style.display="block",e.gutterFiller.style.height=cr(e.measure)+"px",e.gutterFiller.style.width=e.gutters.offsetWidth+"px"):e.gutterFiller.style.display="",Nr&&0===cr(e.measure)&&(e.scrollbarV.style.minWidth=e.scrollbarH.style.minHeight=Fr?"18px":"12px")}function p(t,e,i){var n=t.scroller.scrollTop,r=t.wrapper.clientHeight;"number"==typeof i?n=i:i&&(n=i.top,r=i.bottom-i.top),n=Math.floor(n-H(t));var o=Math.ceil(n+r);return{from:vn(e,n),to:vn(e,o)}}function g(t){var e=t.display;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var i=y(e)-e.scroller.scrollLeft+t.doc.scrollLeft,n=e.gutters.offsetWidth,r=i+"px",o=e.lineDiv.firstChild;o;o=o.nextSibling)if(o.alignable)for(var s=0,a=o.alignable;s<a.length;++s)a[s].style.left=r;t.options.fixedGutter&&(e.gutters.style.left=i+n+"px")}}function m(t){if(!t.options.lineNumbers)return!1;var e=t.doc,i=v(t.options,e.first+e.size-1),n=t.display;if(i.length!=n.lineNumChars){var r=n.measure.appendChild(rr("div",[rr("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=r.firstChild.offsetWidth,s=r.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-s),n.lineNumWidth=n.lineNumInnerWidth+s,n.lineNumChars=n.lineNumInnerWidth?i.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",!0}return!1}function v(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function y(t){return lr(t.scroller).left-lr(t.sizer).left}function b(t,e,i,n){for(var r=t.display.showingFrom,o=t.display.showingTo,s,a=p(t.display,t.doc,i);x(t,e,a,n)&&(n=!1,s=!0,L(t),f(t),i&&(i=Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,"number"==typeof i?i:i.top)),a=p(t.display,t.doc,i),!(a.from>=t.display.showingFrom&&a.to<=t.display.showingTo));)e=[];return s&&(Rn(t,"update",t),(t.display.showingFrom!=r||t.display.showingTo!=o)&&Rn(t,"viewportChange",t,t.display.showingFrom,t.display.showingTo)),s}function x(t,e,i,n){var r=t.display,o=t.doc;if(!r.wrapper.clientWidth)return r.showingFrom=r.showingTo=o.first,void(r.viewOffset=0);if(!(!n&&0==e.length&&i.from>r.showingFrom&&i.to<r.showingTo)){m(t)&&(e=[{from:o.first,to:o.first+o.size}]);var s=r.sizer.style.marginLeft=r.gutters.offsetWidth+"px";r.scrollbarH.style.left=t.options.fixedGutter?s:"0";var a=1/0;if(t.options.lineNumbers)for(var l=0;l<e.length;++l)if(e[l].diff){a=e[l].from;break}var u=o.first+o.size,c=Math.max(i.from-t.options.viewportMargin,o.first),h=Math.min(u,i.to+t.options.viewportMargin);if(r.showingFrom<c&&c-r.showingFrom<20&&(c=Math.max(o.first,r.showingFrom)),r.showingTo>h&&r.showingTo-h<20&&(h=Math.min(u,r.showingTo)),Ur)for(c=mn(Wi(o,dn(o,c)));u>h&&zi(o,dn(o,h));)++h;var d=[{from:Math.max(r.showingFrom,o.first),to:Math.min(r.showingTo,u)}];if(d=d[0].from>=d[0].to?[]:C(d,e),Ur)for(var l=0;l<d.length;++l)for(var f=d[l],p;p=Ei(dn(o,f.to-1));){var g=p.find().from.line;if(!(g>f.from)){d.splice(l--,1);break}f.to=g}for(var v=0,l=0;l<d.length;++l){var f=d[l];f.from<c&&(f.from=c),f.to>h&&(f.to=h),f.from>=f.to?d.splice(l--,1):v+=f.to-f.from}if(!n&&v==h-c&&c==r.showingFrom&&h==r.showingTo)return void _(t);d.sort(function(t,e){return t.from-e.from});try{var y=document.activeElement}catch(b){}.7*(h-c)>v&&(r.lineDiv.style.display="none"),S(t,c,h,d,a),r.lineDiv.style.display="",y&&document.activeElement!=y&&y.offsetHeight&&y.focus();var x=c!=r.showingFrom||h!=r.showingTo||r.lastSizeC!=r.wrapper.clientHeight;return x&&(r.lastSizeC=r.wrapper.clientHeight,P(t,400)),r.showingFrom=c,r.showingTo=h,w(t),_(t),!0}}function w(t){for(var e=t.display,i=e.lineDiv.offsetTop,n=e.lineDiv.firstChild,r;n;n=n.nextSibling)if(n.lineObj){if(Dr){var o=n.offsetTop+n.offsetHeight;r=o-i,i=o}else{var s=lr(n);r=s.bottom-s.top}var a=n.lineObj.height-r;if(2>r&&(r=ie(e)),a>.001||-.001>a){gn(n.lineObj,r);var l=n.lineObj.widgets;if(l)for(var u=0;u<l.length;++u)l[u].height=l[u].node.offsetHeight}}}function _(t){var e=t.display.viewOffset=yn(t,dn(t.doc,t.display.showingFrom));t.display.mover.style.top=e+"px"}function C(t,e){for(var i=0,n=e.length||0;n>i;++i){for(var r=e[i],o=[],s=r.diff||0,a=0,l=t.length;l>a;++a){var u=t[a];r.to<=u.from&&r.diff?o.push({from:u.from+s,to:u.to+s}):r.to<=u.from||r.from>=u.to?o.push(u):(r.from>u.from&&o.push({from:u.from,to:r.from}),r.to<u.to&&o.push({from:r.to+s,to:u.to+s}))}t=o}return t}function k(t){for(var e=t.display,i={},n={},r=e.gutters.firstChild,o=0;r;r=r.nextSibling,++o)i[t.options.gutters[o]]=r.offsetLeft,n[t.options.gutters[o]]=r.offsetWidth;return{fixedPos:y(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:e.wrapper.clientWidth}}function S(t,e,i,n,r){function o(e){var i=e.nextSibling;return Lr&&Wr&&t.display.currentWheelTarget==e?(e.style.display="none",e.lineObj=null):e.parentNode.removeChild(e),i}var s=k(t),a=t.display,l=t.options.lineNumbers;n.length||Lr&&t.display.currentWheelTarget||or(a.lineDiv);var u=a.lineDiv,c=u.firstChild,h=n.shift(),d=e;for(t.doc.iter(e,i,function(e){if(h&&h.to==d&&(h=n.shift()),zi(t.doc,e)){if(0!=e.height&&gn(e,0),e.widgets&&c.previousSibling)for(var i=0;i<e.widgets.length;++i){var a=e.widgets[i];if(a.showIfHidden){var f=c.previousSibling;if(/pre/i.test(f.nodeName)){var p=rr("div",null,null,"position: relative");f.parentNode.replaceChild(p,f),p.appendChild(f),f=p}var g=f.appendChild(rr("div",[a.node],"CodeMirror-linewidget"));a.handleMouseEvents||(g.ignoreEvents=!0),T(a,g,f,s)}}}else if(h&&h.from<=d&&h.to>d){for(;c.lineObj!=e;)c=o(c);l&&d>=r&&c.lineNumber&&ar(c.lineNumber,v(t.options,d)),c=c.nextSibling}else{if(e.widgets)for(var m=0,y=c,b;y&&20>m;++m,y=y.nextSibling)if(y.lineObj==e&&/div/i.test(y.nodeName)){b=y;break}var x=D(t,e,d,s,b);if(x!=b)u.insertBefore(x,c);else{for(;c!=b;)c=o(c);c=c.nextSibling}x.lineObj=e}++d});c;)c=o(c)}function D(t,e,i,n,r){var o=tn(t,e),s=e.gutterMarkers,a=t.display,l;if(!(t.options.lineNumbers||s||e.bgClass||e.wrapClass||e.widgets))return o;if(r){r.alignable=null;for(var u=!0,c=0,h=null,d=r.firstChild,f;d;d=f)if(f=d.nextSibling,/\bCodeMirror-linewidget\b/.test(d.className)){for(var p=0;p<e.widgets.length;++p){var g=e.widgets[p];if(g.node==d.firstChild){g.above||h||(h=d),T(g,d,r,n),++c;break}}if(p==e.widgets.length){u=!1;break}}else r.removeChild(d);r.insertBefore(o,h),u&&c==e.widgets.length&&(l=r,r.className=e.wrapClass||"")}if(l||(l=rr("div",null,e.wrapClass,"position: relative"),l.appendChild(o)),e.bgClass&&l.insertBefore(rr("div",null,e.bgClass+" CodeMirror-linebackground"),l.firstChild),t.options.lineNumbers||s){var m=l.insertBefore(rr("div",null,null,"position: absolute; left: "+(t.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px"),l.firstChild);if(t.options.fixedGutter&&(l.alignable||(l.alignable=[])).push(m),!t.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(l.lineNumber=m.appendChild(rr("div",v(t.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.lineNumInnerWidth+"px"))),s)for(var y=0;y<t.options.gutters.length;++y){var b=t.options.gutters[y],x=s.hasOwnProperty(b)&&s[b];x&&m.appendChild(rr("div",[x],"CodeMirror-gutter-elt","left: "+n.gutterLeft[b]+"px; width: "+n.gutterWidth[b]+"px"))}}if(Dr&&(l.style.zIndex=2),e.widgets&&l!=r)for(var p=0,w=e.widgets;p<w.length;++p){var g=w[p],_=rr("div",[g.node],"CodeMirror-linewidget");g.handleMouseEvents||(_.ignoreEvents=!0),T(g,_,l,n),g.above?l.insertBefore(_,t.options.lineNumbers&&0!=e.height?m:o):l.appendChild(_),Rn(g,"redraw")}return l}function T(t,e,i,n){if(t.noHScroll){(i.alignable||(i.alignable=[])).push(e);var r=n.wrapperWidth;e.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,e.style.paddingLeft=n.gutterTotalWidth+"px"),e.style.width=r+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-n.gutterTotalWidth+"px"))}function L(t){var e=t.display,i=Ye(t.doc.sel.from,t.doc.sel.to);if(i||t.options.showCursorWhenSelecting?O(t):e.cursor.style.display=e.otherCursor.style.display="none",i?e.selectionDiv.style.display="none":M(t),t.options.moveInputWithCursor){var n=J(t,t.doc.sel.head,"div"),r=lr(e.wrapper),o=lr(e.lineDiv);e.inputDiv.style.top=Math.max(0,Math.min(e.wrapper.clientHeight-10,n.top+o.top-r.top))+"px",e.inputDiv.style.left=Math.max(0,Math.min(e.wrapper.clientWidth-10,n.left+o.left-r.left))+"px"}}function O(t){var e=t.display,i=J(t,t.doc.sel.head,"div");e.cursor.style.left=i.left+"px",e.cursor.style.top=i.top+"px",e.cursor.style.height=Math.max(0,i.bottom-i.top)*t.options.cursorHeight+"px",e.cursor.style.display="",i.other?(e.otherCursor.style.display="",e.otherCursor.style.left=i.other.left+"px",e.otherCursor.style.top=i.other.top+"px",e.otherCursor.style.height=.85*(i.other.bottom-i.other.top)+"px"):e.otherCursor.style.display="none"}function M(t){function e(t,e,i,n){0>e&&(e=0),s.appendChild(rr("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px; top: "+e+"px; width: "+(null==i?a-t:i)+"px; height: "+(n-e)+"px"))}function i(i,n,o){function s(e,n){return Q(t,Ue(i,e),"div",u,n)}var u=dn(r,i),c=u.text.length,h,d;return dr(bn(u),n||0,null==o?c:o,function(t,i,r){var u=s(t,"left"),f,p,g;if(t==i)f=u,p=g=u.left;else{if(f=s(i-1,"right"),"rtl"==r){var m=u;u=f,f=m}p=u.left,g=f.right}null==n&&0==t&&(p=l),f.top-u.top>3&&(e(p,u.top,null,u.bottom),p=l,u.bottom<f.top&&e(p,u.bottom,null,f.top)),null==o&&i==c&&(g=a),(!h||u.top<h.top||u.top==h.top&&u.left<h.left)&&(h=u),(!d||f.bottom>d.bottom||f.bottom==d.bottom&&f.right>d.right)&&(d=f),l+1>p&&(p=l),e(p,f.top,g-p,f.bottom)}),{start:h,end:d}}var n=t.display,r=t.doc,o=t.doc.sel,s=document.createDocumentFragment(),a=n.lineSpace.offsetWidth,l=W(t.display);if(o.from.line==o.to.line)i(o.from.line,o.from.ch,o.to.ch);else{var u=dn(r,o.from.line),c=dn(r,o.to.line),h=Wi(r,u)==Wi(r,c),d=i(o.from.line,o.from.ch,h?u.text.length:null).end,f=i(o.to.line,h?0:null,o.to.ch).start;h&&(d.top<f.top-2?(e(d.right,d.top,null,d.bottom),e(l,f.top,f.left,f.bottom)):e(d.right,d.top,f.left-d.right,d.bottom)),d.bottom<f.top&&e(l,d.bottom,null,f.top)}sr(n.selectionDiv,s),n.selectionDiv.style.display=""}function I(t){if(t.state.focused){var e=t.display;clearInterval(e.blinker);var i=!0;e.cursor.style.visibility=e.otherCursor.style.visibility="",e.blinker=setInterval(function(){e.cursor.style.visibility=e.otherCursor.style.visibility=(i=!i)?"":"hidden"},t.options.cursorBlinkRate)}}function P(t,e){t.doc.mode.startState&&t.doc.frontier<t.display.showingTo&&t.state.highlight.set(e,er(A,t))}function A(t){var e=t.doc;if(e.frontier<e.first&&(e.frontier=e.first),!(e.frontier>=t.display.showingTo)){var i=+new Date+t.options.workTime,n=vi(e.mode,F(t,e.frontier)),r=[],o;e.iter(e.frontier,Math.min(e.first+e.size,t.display.showingTo+500),function(s){if(e.frontier>=t.display.showingFrom){var a=s.styles;s.styles=Ki(t,s,n);for(var l=!a||a.length!=s.styles.length,u=0;!l&&u<a.length;++u)l=a[u]!=s.styles[u];l&&(o&&o.end==e.frontier?o.end++:r.push(o={start:e.frontier,end:e.frontier+1})),s.stateAfter=vi(e.mode,n)}else Ji(t,s,n),s.stateAfter=e.frontier%5==0?vi(e.mode,n):null;return++e.frontier,+new Date>i?(P(t,t.options.workDelay),!0):void 0}),r.length&&se(t,function(){for(var t=0;t<r.length;++t)ue(this,r[t].start,r[t].end)})()}}function N(t,e,i){for(var n,r,o=t.doc,s=e,a=e-100;s>a;--s){if(s<=o.first)return o.first;var l=dn(o,s-1);if(l.stateAfter&&(!i||s<=o.frontier))return s;var u=Vn(l.text,null,t.options.tabSize);(null==r||n>u)&&(r=s-1,n=u)}return r}function F(t,e,i){var n=t.doc,r=t.display;if(!n.mode.startState)return!0;var o=N(t,e,i),s=o>n.first&&dn(n,o-1).stateAfter;return s=s?vi(n.mode,s):yi(n.mode),n.iter(o,e,function(i){Ji(t,i,s);var a=o==e-1||o%5==0||o>=r.showingFrom&&o<r.showingTo;i.stateAfter=a?vi(n.mode,s):null,++o}),s}function H(t){return t.lineSpace.offsetTop}function E(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function W(t){var e=sr(t.measure,rr("pre",null,null,"text-align: left")).appendChild(rr("span","x"));return e.offsetLeft}function z(t,e,i,n,r){var o=-1;n=n||B(t,e);for(var s=i;;s+=o){var a=n[s];if(a)break;0>o&&0==s&&(o=1)}return r=s>i?"left":i>s?"right":r,"left"==r&&a.leftSide?a=a.leftSide:"right"==r&&a.rightSide&&(a=a.rightSide),{left:i>s?a.right:a.left,right:s>i?a.left:a.right,top:a.top,bottom:a.bottom}}function R(t,e){for(var i=t.display.measureLineCache,n=0;n<i.length;++n){var r=i[n];if(r.text==e.text&&r.markedSpans==e.markedSpans&&t.display.scroller.clientWidth==r.width&&r.classes==e.textClass+"|"+e.bgClass+"|"+e.wrapClass)return r}}function j(t,e){var i=R(t,e);i&&(i.text=i.measure=i.markedSpans=null)}function B(t,e){var i=R(t,e);if(i)return i.measure;var n=q(t,e),r=t.display.measureLineCache,o={text:e.text,width:t.display.scroller.clientWidth,markedSpans:e.markedSpans,measure:n,classes:e.textClass+"|"+e.bgClass+"|"+e.wrapClass};return 16==r.length?r[++t.display.measureLineCachePos%16]=o:r.push(o),n}function q(t,e){function i(t){var e=t.top-p.top,i=t.bottom-p.top;i>v&&(i=v),0>e&&(e=0);for(var n=g.length-2;n>=0;n-=2){var r=g[n],o=g[n+1];if(!(r>i||e>o)&&(e>=r&&o>=i||r>=e&&i>=o||Math.min(i,o)-Math.max(e,r)>=i-e>>1)){g[n]=Math.min(e,r),g[n+1]=Math.max(i,o);break}}return 0>n&&(n=g.length,g.push(e,i)),{left:t.left-p.left,right:t.right-p.left,top:n,bottom:null}}function n(t){t.bottom=g[t.top+1],t.top=g[t.top]}var r=t.display,o=tr(e.text.length),s=tn(t,e,o,!0);if(Sr&&!Dr&&!t.options.lineWrapping&&s.childNodes.length>100){for(var a=document.createDocumentFragment(),l=10,u=s.childNodes.length,c=0,h=Math.ceil(u/l);h>c;++c){for(var d=rr("div",null,null,"display: inline-block"),f=0;l>f&&u;++f)d.appendChild(s.firstChild),--u;a.appendChild(d)}s.appendChild(a)}sr(r.measure,s);var p=lr(r.lineDiv),g=[],m=tr(e.text.length),v=s.offsetHeight;Tr&&r.measure.first!=s&&sr(r.measure,s);for(var c=0,y;c<o.length;++c)if(y=o[c]){var b=y,x=null;if(/\bCodeMirror-widget\b/.test(y.className)&&y.getClientRects){1==y.firstChild.nodeType&&(b=y.firstChild);var w=b.getClientRects();w.length>1&&(x=m[c]=i(w[0]),x.rightSide=i(w[w.length-1]))}x||(x=m[c]=i(lr(b))),y.measureRight&&(x.right=lr(y.measureRight).left),y.leftSide&&(x.leftSide=i(lr(y.leftSide)))}for(var c=0,y;c<m.length;++c)(y=m[c])&&(n(y),y.leftSide&&n(y.leftSide),y.rightSide&&n(y.rightSide));return m}function U(t,e){var i=!1;if(e.markedSpans)for(var n=0;n<e.markedSpans;++n){var r=e.markedSpans[n];!r.collapsed||null!=r.to&&r.to!=e.text.length||(i=!0)}var o=!i&&R(t,e);if(o)return z(t,e,e.text.length,o.measure,"right").right;var s=tn(t,e,null,!0),a=s.appendChild(hr(t.display.measure));return sr(t.display.measure,s),lr(a).right-lr(t.display.lineDiv).left}function Y(t){t.display.measureLineCache.length=t.display.measureLineCachePos=0,t.display.cachedCharWidth=t.display.cachedTextHeight=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function V(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function X(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function G(t,e,i,n){if(e.widgets)for(var r=0;r<e.widgets.length;++r)if(e.widgets[r].above){var o=Ui(e.widgets[r]);i.top+=o,i.bottom+=o}if("line"==n)return i;n||(n="local");var s=yn(t,e);if("local"==n?s+=H(t.display):s-=t.display.viewOffset,"page"==n||"window"==n){var a=lr(t.display.lineSpace);s+=a.top+("window"==n?0:X());var l=a.left+("window"==n?0:V());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function K(t,e,i){if("div"==i)return e;var n=e.left,r=e.top;if("page"==i)n-=V(),r-=X();else if("local"==i||!i){var o=lr(t.display.sizer);n+=o.left,r+=o.top}var s=lr(t.display.lineSpace);return{left:n-s.left,top:r-s.top}}function Q(t,e,i,n,r){return n||(n=dn(t.doc,e.line)),G(t,n,z(t,n,e.ch,null,r),i)}function J(t,e,i,n,r){function o(e,o){var s=z(t,n,e,r,o?"right":"left");return o?s.left=s.right:s.right=s.left,G(t,n,s,i)}function s(t,e){var i=a[e],n=i.level%2;return t==fr(i)&&e&&i.level<a[e-1].level?(i=a[--e],t=pr(i)-(i.level%2?0:1),n=!0):t==pr(i)&&e<a.length-1&&i.level<a[e+1].level&&(i=a[++e],t=fr(i)-i.level%2,n=!1),n&&t==i.to&&t>i.from?o(t-1):o(t,n)}n=n||dn(t.doc,e.line),r||(r=B(t,n));var a=bn(n),l=e.ch;if(!a)return o(l);var u=xr(a,l),c=s(l,u);return null!=Ho&&(c.other=s(l,Ho)),c}function Z(t,e,i,n){var r=new Ue(t,e);return r.xRel=n,i&&(r.outside=!0),r}function te(t,e,i){var n=t.doc;if(i+=t.display.viewOffset,0>i)return Z(n.first,0,!0,-1);var r=vn(n,i),o=n.first+n.size-1;if(r>o)return Z(n.first+n.size-1,dn(n,o).text.length,!0,1);for(0>e&&(e=0);;){var s=dn(n,r),a=ee(t,s,r,e,i),l=Ei(s),u=l&&l.find();if(!l||!(a.ch>u.from.ch||a.ch==u.from.ch&&a.xRel>0))return a;r=u.to.line}}function ee(t,e,i,n,r){function o(n){var r=J(t,Ue(i,n),"line",e,u);return a=!0,s>r.bottom?r.left-l:s<r.top?r.left+l:(a=!1,r.left)}var s=r-yn(t,e),a=!1,l=2*t.display.wrapper.clientWidth,u=B(t,e),c=bn(e),h=e.text.length,d=gr(e),f=mr(e),p=o(d),g=a,m=o(f),v=a;if(n>m)return Z(i,f,v,1);for(;;){if(c?f==d||f==_r(e,d,1):1>=f-d){for(var y=p>n||m-n>=n-p?d:f,b=n-(y==d?p:m);Lo.test(e.text.charAt(y));)++y;var x=Z(i,y,y==d?g:v,0>b?-1:b?1:0);return x}var w=Math.ceil(h/2),_=d+w;if(c){_=d;for(var C=0;w>C;++C)_=_r(e,_,1)}var k=o(_);k>n?(f=_,m=k,(v=a)&&(m+=1e3),h=w):(d=_,p=k,g=a,h-=w)}}function ie(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==Yr){Yr=rr("pre");for(var e=0;49>e;++e)Yr.appendChild(document.createTextNode("x")),Yr.appendChild(rr("br"));Yr.appendChild(document.createTextNode("x"))}sr(t.measure,Yr);var i=Yr.offsetHeight/50;return i>3&&(t.cachedTextHeight=i),or(t.measure),i||1}function ne(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=rr("span","x"),i=rr("pre",[e]);sr(t.measure,i);var n=e.offsetWidth;return n>2&&(t.cachedCharWidth=n),n||10}function re(t){t.curOp={changes:[],forceUpdate:!1,updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Vr},Co++||(_o=[])}function oe(t){var e=t.curOp,i=t.doc,n=t.display;if(t.curOp=null,e.updateMaxLine&&h(t),n.maxLineChanged&&!t.options.lineWrapping&&n.maxLine){var r=U(t,n.maxLine);n.sizer.style.minWidth=Math.max(0,r+3+ko)+"px",n.maxLineChanged=!1;var o=Math.max(0,n.sizer.offsetLeft+n.sizer.offsetWidth-n.scroller.clientWidth);o<i.scrollLeft&&!e.updateScrollPos&&ke(t,Math.min(n.scroller.scrollLeft,o),!0)}var s,a;if(e.updateScrollPos)s=e.updateScrollPos;else if(e.selectionChanged&&n.scroller.clientHeight){var l=J(t,i.sel.head);s=ai(t,l.left,l.top,l.left,l.bottom)}(e.changes.length||e.forceUpdate||s&&null!=s.scrollTop)&&(a=b(t,e.changes,s&&s.scrollTop,e.forceUpdate),t.display.scroller.offsetHeight&&(t.doc.scrollTop=t.display.scroller.scrollTop)),!a&&e.selectionChanged&&L(t),e.updateScrollPos?(n.scroller.scrollTop=n.scrollbarV.scrollTop=i.scrollTop=s.scrollTop,n.scroller.scrollLeft=n.scrollbarH.scrollLeft=i.scrollLeft=s.scrollLeft,g(t),e.scrollToPos&&oi(t,Ke(t.doc,e.scrollToPos),e.scrollToPosMargin)):s&&ri(t),e.selectionChanged&&I(t),t.state.focused&&e.updateInput&&fe(t,e.userSelChange);var u=e.maybeHiddenMarkers,c=e.maybeUnhiddenMarkers;if(u)for(var d=0;d<u.length;++d)u[d].lines.length||zn(u[d],"hide");if(c)for(var d=0;d<c.length;++d)c[d].lines.length&&zn(c[d],"unhide");var f;if(--Co||(f=_o,_o=null),e.textChanged&&zn(t,"change",t,e.textChanged),e.cursorActivity&&zn(t,"cursorActivity",t),f)for(var d=0;d<f.length;++d)f[d]()}function se(t,e){return function(){var i=t||this,n=!i.curOp;n&&re(i);try{var r=e.apply(i,arguments)}finally{n&&oe(i)}return r}}function ae(t){return function(){var e=this.cm&&!this.cm.curOp,i;e&&re(this.cm);try{i=t.apply(this,arguments)}finally{e&&oe(this.cm)}return i}}function le(t,e){var i=!t.curOp,n;i&&re(t);try{n=e()}finally{i&&oe(t)}return n}function ue(t,e,i,n){null==e&&(e=t.doc.first),null==i&&(i=t.doc.first+t.doc.size),t.curOp.changes.push({from:e,to:i,diff:n})}function ce(t){t.display.pollingFast||t.display.poll.set(t.options.pollInterval,function(){de(t),t.state.focused&&ce(t)})}function he(t){function e(){var n=de(t);n||i?(t.display.pollingFast=!1,ce(t)):(i=!0,t.display.poll.set(60,e))
}var i=!1;t.display.pollingFast=!0,t.display.poll.set(20,e)}function de(t){var e=t.display.input,i=t.display.prevInput,n=t.doc,r=n.sel;if(!t.state.focused||Ao(e)||ge(t)||t.state.disableInput)return!1;var o=e.value;if(o==i&&Ye(r.from,r.to))return!1;if(Sr&&!Tr&&t.display.inputHasSelection===o)return fe(t,!0),!1;var s=!t.curOp;s&&re(t),r.shift=!1;for(var a=0,l=Math.min(i.length,o.length);l>a&&i.charCodeAt(a)==o.charCodeAt(a);)++a;var u=r.from,c=r.to;a<i.length?u=Ue(u.line,u.ch-(i.length-a)):t.state.overwrite&&Ye(u,c)&&!t.state.pasteIncoming&&(c=Ue(c.line,Math.min(dn(n,c.line).text.length,c.ch+(o.length-a))));var h=t.curOp.updateInput,d={from:u,to:c,text:Po(o.slice(a)),origin:t.state.pasteIncoming?"paste":"+input"};return Ee(t.doc,d,"end"),t.curOp.updateInput=h,Rn(t,"inputRead",t,d),o.length>1e3||o.indexOf("\n")>-1?e.value=t.display.prevInput="":t.display.prevInput=o,s&&oe(t),t.state.pasteIncoming=!1,!0}function fe(t,e){var i,n,r=t.doc;if(Ye(r.sel.from,r.sel.to))e&&(t.display.prevInput=t.display.input.value="",Sr&&!Tr&&(t.display.inputHasSelection=null));else{t.display.prevInput="",i=No&&(r.sel.to.line-r.sel.from.line>100||(n=t.getSelection()).length>1e3);var o=i?"-":n||t.getSelection();t.display.input.value=o,t.state.focused&&Kn(t.display.input),Sr&&!Tr&&(t.display.inputHasSelection=o)}t.display.inaccurateSelection=i}function pe(t){"nocursor"==t.options.readOnly||Er&&document.activeElement==t.display.input||t.display.input.focus()}function ge(t){return t.options.readOnly||t.doc.cantEdit}function me(t){function e(){t.state.focused&&setTimeout(er(pe,t),0)}function i(){null==a&&(a=setTimeout(function(){a=null,s.cachedCharWidth=s.cachedTextHeight=Mo=null,Y(t),le(t,er(ue,t))},100))}function n(){for(var t=s.wrapper.parentNode;t&&t!=document.body;t=t.parentNode);t?setTimeout(n,5e3):Wn(window,"resize",i)}function r(e){jn(t,e)||t.options.onDragEvent&&t.options.onDragEvent(t,In(e))||Fn(e)}function o(){s.inaccurateSelection&&(s.prevInput="",s.inaccurateSelection=!1,s.input.value=t.getSelection(),Kn(s.input))}var s=t.display;En(s.scroller,"mousedown",se(t,be)),Sr?En(s.scroller,"dblclick",se(t,function(e){if(!jn(t,e)){var i=ye(t,e);if(i&&!xe(t,e)&&!ve(t.display,e)){Pn(e);var n=pi(dn(t.doc,i.line).text,i);Ze(t.doc,n.from,n.to)}}})):En(s.scroller,"dblclick",function(e){jn(t,e)||Pn(e)}),En(s.lineSpace,"selectstart",function(t){ve(s,t)||Pn(t)}),Br||En(s.scroller,"contextmenu",function(e){Ne(t,e)}),En(s.scroller,"scroll",function(){s.scroller.clientHeight&&(Ce(t,s.scroller.scrollTop),ke(t,s.scroller.scrollLeft,!0),zn(t,"scroll",t))}),En(s.scrollbarV,"scroll",function(){s.scroller.clientHeight&&Ce(t,s.scrollbarV.scrollTop)}),En(s.scrollbarH,"scroll",function(){s.scroller.clientHeight&&ke(t,s.scrollbarH.scrollLeft)}),En(s.scroller,"mousewheel",function(e){Se(t,e)}),En(s.scroller,"DOMMouseScroll",function(e){Se(t,e)}),En(s.scrollbarH,"mousedown",e),En(s.scrollbarV,"mousedown",e),En(s.wrapper,"scroll",function(){s.wrapper.scrollTop=s.wrapper.scrollLeft=0});var a;En(window,"resize",i),setTimeout(n,5e3),En(s.input,"keyup",se(t,function(e){jn(t,e)||t.options.onKeyEvent&&t.options.onKeyEvent(t,In(e))||16==e.keyCode&&(t.doc.sel.shift=!1)})),En(s.input,"input",er(he,t)),En(s.input,"keydown",se(t,Me)),En(s.input,"keypress",se(t,Ie)),En(s.input,"focus",er(Pe,t)),En(s.input,"blur",er(Ae,t)),t.options.dragDrop&&(En(s.scroller,"dragstart",function(e){_e(t,e)}),En(s.scroller,"dragenter",r),En(s.scroller,"dragover",r),En(s.scroller,"drop",se(t,we))),En(s.scroller,"paste",function(e){ve(s,e)||(pe(t),he(t))}),En(s.input,"paste",function(){t.state.pasteIncoming=!0,he(t)}),En(s.input,"cut",o),En(s.input,"copy",o),Ar&&En(s.sizer,"mouseup",function(){document.activeElement==s.input&&s.input.blur(),pe(t)})}function ve(t,e){for(var i=Hn(e);i!=t.wrapper;i=i.parentNode)if(!i||i.ignoreEvents||i.parentNode==t.sizer&&i!=t.mover)return!0}function ye(t,e,i){var n=t.display;if(!i){var r=Hn(e);if(r==n.scrollbarH||r==n.scrollbarH.firstChild||r==n.scrollbarV||r==n.scrollbarV.firstChild||r==n.scrollbarFiller||r==n.gutterFiller)return null}var o,s,a=lr(n.lineSpace);try{o=e.clientX,s=e.clientY}catch(e){return null}return te(t,o-a.left,s-a.top)}function be(t){function e(t){if(!Ye(v,t)){if(v=t,"single"==c)return void Ze(r.doc,Ke(s,l),t);if(g=Ke(s,g),m=Ke(s,m),"double"==c){var e=pi(dn(s,t.line).text,t);Ve(t,g)?Ze(r.doc,e.from,m):Ze(r.doc,g,e.to)}else"triple"==c&&(Ve(t,g)?Ze(r.doc,m,Ke(s,Ue(t.line,0))):Ze(r.doc,g,Ke(s,Ue(t.line+1,0))))}}function i(t){var n=++b,a=ye(r,t,!0);if(a)if(Ye(a,d)){var l=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;l&&setTimeout(se(r,function(){b==n&&(o.scroller.scrollTop+=l,i(t))}),50)}else{r.state.focused||Pe(r),d=a,e(a);var u=p(o,s);(a.line>=u.to||a.line<u.from)&&setTimeout(se(r,function(){b==n&&i(t)}),150)}}function n(t){b=1/0,Pn(t),pe(r),Wn(document,"mousemove",x),Wn(document,"mouseup",w)}if(!jn(this,t)){var r=this,o=r.display,s=r.doc,a=s.sel;if(a.shift=t.shiftKey,ve(o,t))return void(Lr||(o.scroller.draggable=!1,setTimeout(function(){o.scroller.draggable=!0},100)));if(!xe(r,t)){var l=ye(r,t);switch($n(t)){case 3:return void(Br&&Ne.call(r,r,t));case 2:return l&&Ze(r.doc,l),setTimeout(er(pe,r),20),void Pn(t)}if(!l)return void(Hn(t)==o.scroller&&Pn(t));r.state.focused||Pe(r);var u=+new Date,c="single";if(Gr&&Gr.time>u-400&&Ye(Gr.pos,l))c="triple",Pn(t),setTimeout(er(pe,r),20),gi(r,l.line);else if(Xr&&Xr.time>u-400&&Ye(Xr.pos,l)){c="double",Gr={time:u,pos:l},Pn(t);var h=pi(dn(s,l.line).text,l);Ze(r.doc,h.from,h.to)}else Xr={time:u,pos:l};var d=l;if(r.options.dragDrop&&Oo&&!ge(r)&&!Ye(a.from,a.to)&&!Ve(l,a.from)&&!Ve(a.to,l)&&"single"==c){var f=se(r,function(e){Lr&&(o.scroller.draggable=!1),r.state.draggingText=!1,Wn(document,"mouseup",f),Wn(o.scroller,"drop",f),Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)<10&&(Pn(e),Ze(r.doc,l),pe(r))});return Lr&&(o.scroller.draggable=!0),r.state.draggingText=f,o.scroller.dragDrop&&o.scroller.dragDrop(),En(document,"mouseup",f),void En(o.scroller,"drop",f)}Pn(t),"single"==c&&Ze(r.doc,Ke(s,l));var g=a.from,m=a.to,v=l,y=lr(o.wrapper),b=0,x=se(r,function(t){Sr||$n(t)?i(t):n(t)}),w=se(r,n);En(document,"mousemove",x),En(document,"mouseup",w)}}}function xe(t,e){var i=t.display;try{var n=e.clientX,r=e.clientY}catch(e){return!1}if(n>=Math.floor(lr(i.gutters).right))return!1;if(Pn(e),!qn(t,"gutterClick"))return!0;var o=lr(i.lineDiv);if(r>o.bottom)return!0;r-=o.top-i.viewOffset;for(var s=0;s<t.options.gutters.length;++s){var a=i.gutters.childNodes[s];if(a&&lr(a).right>=n){var l=vn(t.doc,r),u=t.options.gutters[s];Rn(t,"gutterClick",t,l,u,e);break}}return!0}function we(t){var e=this;if(!(jn(e,t)||ve(e.display,t)||e.options.onDragEvent&&e.options.onDragEvent(e,In(t)))){Pn(t),Sr&&(Kr=+new Date);var i=ye(e,t,!0),n=t.dataTransfer.files;if(i&&!ge(e))if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),s=0,a=function(t,n){var a=new FileReader;a.onload=function(){o[n]=a.result,++s==r&&(i=Ke(e.doc,i),Ee(e.doc,{from:i,to:i,text:Po(o.join("\n")),origin:"paste"},"around"))},a.readAsText(t)},l=0;r>l;++l)a(n[l],l);else{if(e.state.draggingText&&!Ve(i,e.doc.sel.from)&&!Ve(e.doc.sel.to,i))return e.state.draggingText(t),void setTimeout(er(pe,e),20);try{var o=t.dataTransfer.getData("Text");if(o){var u=e.doc.sel.from,c=e.doc.sel.to;ei(e.doc,i,i),e.state.draggingText&&qe(e.doc,"",u,c,"paste"),e.replaceSelection(o,null,"paste"),pe(e),Pe(e)}}catch(t){}}}}function _e(t,e){if(Sr&&(!t.state.draggingText||+new Date-Kr<100))return void Fn(e);if(!jn(t,e)&&!ve(t.display,e)){var i=t.getSelection();if(e.dataTransfer.setData("Text",i),e.dataTransfer.setDragImage&&!Pr){var n=rr("img",null,null,"position: fixed; left: 0; top: 0;");Ir&&(n.width=n.height=1,t.display.wrapper.appendChild(n),n._top=n.offsetTop),e.dataTransfer.setDragImage(n,0,0),Ir&&n.parentNode.removeChild(n)}}}function Ce(t,e){Math.abs(t.doc.scrollTop-e)<2||(t.doc.scrollTop=e,kr||b(t,[],e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e),t.display.scrollbarV.scrollTop!=e&&(t.display.scrollbarV.scrollTop=e),kr&&b(t,[]),P(t,100))}function ke(t,e,i){(i?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)||(e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),t.doc.scrollLeft=e,g(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbarH.scrollLeft!=e&&(t.display.scrollbarH.scrollLeft=e))}function Se(t,e){var i=e.wheelDeltaX,n=e.wheelDeltaY;null==i&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(i=e.detail),null==n&&e.detail&&e.axis==e.VERTICAL_AXIS?n=e.detail:null==n&&(n=e.wheelDelta);var r=t.display,o=r.scroller;if(i&&o.scrollWidth>o.clientWidth||n&&o.scrollHeight>o.clientHeight){if(n&&Wr&&Lr)for(var s=e.target;s!=o;s=s.parentNode)if(s.lineObj){t.display.currentWheelTarget=s;break}if(i&&!kr&&!Ir&&null!=Jr)return n&&Ce(t,Math.max(0,Math.min(o.scrollTop+n*Jr,o.scrollHeight-o.clientHeight))),ke(t,Math.max(0,Math.min(o.scrollLeft+i*Jr,o.scrollWidth-o.clientWidth))),Pn(e),void(r.wheelStartX=null);if(n&&null!=Jr){var a=n*Jr,l=t.doc.scrollTop,u=l+r.wrapper.clientHeight;0>a?l=Math.max(0,l+a-50):u=Math.min(t.doc.height,u+a+50),b(t,[],{top:l,bottom:u})}20>Qr&&(null==r.wheelStartX?(r.wheelStartX=o.scrollLeft,r.wheelStartY=o.scrollTop,r.wheelDX=i,r.wheelDY=n,setTimeout(function(){if(null!=r.wheelStartX){var t=o.scrollLeft-r.wheelStartX,e=o.scrollTop-r.wheelStartY,i=e&&r.wheelDY&&e/r.wheelDY||t&&r.wheelDX&&t/r.wheelDX;r.wheelStartX=r.wheelStartY=null,i&&(Jr=(Jr*Qr+i)/(Qr+1),++Qr)}},200)):(r.wheelDX+=i,r.wheelDY+=n))}}function De(t,e,i){if("string"==typeof e&&(e=ho[e],!e))return!1;t.display.pollingFast&&de(t)&&(t.display.pollingFast=!1);var n=t.doc,r=n.sel.shift,o=!1;try{ge(t)&&(t.state.suppressEdits=!0),i&&(n.sel.shift=!1),o=e(t)!=So}finally{n.sel.shift=r,t.state.suppressEdits=!1}return o}function Te(t){var e=t.state.keyMaps.slice(0);return t.options.extraKeys&&e.push(t.options.extraKeys),e.push(t.options.keyMap),e}function Le(t,e){var i=bi(t.options.keyMap),n=i.auto;clearTimeout(Zr),n&&!wi(e)&&(Zr=setTimeout(function(){bi(t.options.keyMap)==i&&(t.options.keyMap=n.call?n.call(null,t):n,s(t))},50));var r=_i(e,!0),o=!1;if(!r)return!1;var a=Te(t);return o=e.shiftKey?xi("Shift-"+r,a,function(e){return De(t,e,!0)})||xi(r,a,function(e){return("string"==typeof e?/^go[A-Z]/.test(e):e.motion)?De(t,e):void 0}):xi(r,a,function(e){return De(t,e)}),o&&(Pn(e),I(t),Tr&&(e.oldKeyCode=e.keyCode,e.keyCode=0),Rn(t,"keyHandled",t,r,e)),o}function Oe(t,e,i){var n=xi("'"+i+"'",Te(t),function(e){return De(t,e,!0)});return n&&(Pn(e),I(t),Rn(t,"keyHandled",t,"'"+i+"'",e)),n}function Me(t){var e=this;if(e.state.focused||Pe(e),Sr&&27==t.keyCode&&(t.returnValue=!1),!(jn(e,t)||e.options.onKeyEvent&&e.options.onKeyEvent(e,In(t)))){var i=t.keyCode;e.doc.sel.shift=16==i||t.shiftKey;var n=Le(e,t);Ir&&(to=n?i:null,!n&&88==i&&!No&&(Wr?t.metaKey:t.ctrlKey)&&e.replaceSelection(""))}}function Ie(t){var e=this;if(!(jn(e,t)||e.options.onKeyEvent&&e.options.onKeyEvent(e,In(t)))){var i=t.keyCode,n=t.charCode;if(Ir&&i==to)return to=null,void Pn(t);if(!(Ir&&(!t.which||t.which<10)||Ar)||!Le(e,t)){var r=String.fromCharCode(null==n?i:n);this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!ge(this)&&this.doc.mode.electricChars.indexOf(r)>-1&&setTimeout(se(e,function(){ci(e,e.doc.sel.to.line,"smart")}),75),Oe(e,t,r)||(Sr&&!Tr&&(e.display.inputHasSelection=null),he(e))}}}function Pe(t){"nocursor"!=t.options.readOnly&&(t.state.focused||(zn(t,"focus",t),t.state.focused=!0,-1==t.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(t.display.wrapper.className+=" CodeMirror-focused"),fe(t,!0)),ce(t),I(t))}function Ae(t){t.state.focused&&(zn(t,"blur",t),t.state.focused=!1,t.display.wrapper.className=t.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.doc.sel.shift=!1)},150)}function Ne(t,e){function i(){if(null!=r.input.selectionStart){var t=r.input.value=" "+(Ye(o.from,o.to)?"":r.input.value);r.prevInput=" ",r.input.selectionStart=1,r.input.selectionEnd=t.length}}function n(){if(r.inputDiv.style.position="relative",r.input.style.cssText=l,Tr&&(r.scrollbarV.scrollTop=r.scroller.scrollTop=a),ce(t),null!=r.input.selectionStart){(!Sr||Tr)&&i(),clearTimeout(eo);var e=0,n=function(){" "==r.prevInput&&0==r.input.selectionStart?se(t,ho.selectAll)(t):e++<10?eo=setTimeout(n,500):fe(t)};eo=setTimeout(n,200)}}if(!jn(t,e,"contextmenu")){var r=t.display,o=t.doc.sel;if(!ve(r,e)){var s=ye(t,e),a=r.scroller.scrollTop;if(s&&!Ir){(Ye(o.from,o.to)||Ve(s,o.from)||!Ve(s,o.to))&&se(t,ei)(t.doc,s,s);var l=r.input.style.cssText;if(r.inputDiv.style.position="absolute",r.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",pe(t),fe(t,!0),Ye(o.from,o.to)&&(r.input.value=r.prevInput=" "),Sr&&!Tr&&i(),Br){Fn(e);var u=function(){Wn(window,"mouseup",u),setTimeout(n,20)};En(window,"mouseup",u)}else setTimeout(n,50)}}}}function Fe(t,e,i){if(!Ve(e.from,i))return Ke(t,i);var n=e.text.length-1-(e.to.line-e.from.line);if(i.line>e.to.line+n){var r=i.line-n,o=t.first+t.size-1;return r>o?Ue(o,dn(t,o).text.length):Qe(i,dn(t,r).text.length)}if(i.line==e.to.line+n)return Qe(i,Gn(e.text).length+(1==e.text.length?e.from.ch:0)+dn(t,e.to.line).text.length-e.to.ch);var s=i.line-e.from.line;return Qe(i,e.text[s].length+(s?0:e.from.ch))}function He(t,e,i){if(i&&"object"==typeof i)return{anchor:Fe(t,e,i.anchor),head:Fe(t,e,i.head)};if("start"==i)return{anchor:e.from,head:e.from};var n=io(e);if("around"==i)return{anchor:e.from,head:n};if("end"==i)return{anchor:n,head:n};var r=function(t){if(Ve(t,e.from))return t;if(!Ve(e.to,t))return n;var i=t.line+e.text.length-(e.to.line-e.from.line)-1,r=t.ch;return t.line==e.to.line&&(r+=n.ch-e.to.ch),Ue(i,r)};return{anchor:r(t.sel.anchor),head:r(t.sel.head)}}function $e(t,e,i){var n={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){this.canceled=!0}};return i&&(n.update=function(e,i,n,r){e&&(this.from=Ke(t,e)),i&&(this.to=Ke(t,i)),n&&(this.text=n),void 0!==r&&(this.origin=r)}),zn(t,"beforeChange",t,n),t.cm&&zn(t.cm,"beforeChange",t.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Ee(t,e,i,n){if(t.cm){if(!t.cm.curOp)return se(t.cm,Ee)(t,e,i,n);if(t.cm.state.suppressEdits)return}if(!(qn(t,"beforeChange")||t.cm&&qn(t.cm,"beforeChange"))||(e=$e(t,e,!0))){var r=qr&&!n&&Fi(t,e.from,e.to);if(r){for(var o=r.length-1;o>=1;--o)We(t,{from:r[o].from,to:r[o].to,text:[""]});r.length&&We(t,{from:r[0].from,to:r[0].to,text:e.text},i)}else We(t,e,i)}}function We(t,e,i){var n=He(t,e,i);Cn(t,e,n,t.cm?t.cm.curOp.id:0/0),je(t,e,n,Ai(t,e));var r=[];cn(t,function(t,i){i||-1!=Qn(r,t.history)||(On(t.history,e),r.push(t.history)),je(t,e,null,Ai(t,e))})}function ze(t,e){if(!t.cm||!t.cm.state.suppressEdits){var i=t.history,n=("undo"==e?i.done:i.undone).pop();if(n){var r={changes:[],anchorBefore:n.anchorAfter,headBefore:n.headAfter,anchorAfter:n.anchorBefore,headAfter:n.headBefore,generation:i.generation};("undo"==e?i.undone:i.done).push(r),i.generation=n.generation||++i.maxGeneration;for(var o=qn(t,"beforeChange")||t.cm&&qn(t.cm,"beforeChange"),s=n.changes.length-1;s>=0;--s){var a=n.changes[s];if(a.origin=e,o&&!$e(t,a,!1))return void(("undo"==e?i.done:i.undone).length=0);r.changes.push(_n(t,a));var l=s?He(t,a,null):{anchor:n.anchorBefore,head:n.headBefore};je(t,a,l,Ni(t,a));var u=[];cn(t,function(t,e){e||-1!=Qn(u,t.history)||(On(t.history,a),u.push(t.history)),je(t,a,null,Ni(t,a))})}}}}function Re(t,e){function i(t){return Ue(t.line+e,t.ch)}t.first+=e,t.cm&&ue(t.cm,t.first,t.first,e),t.sel.head=i(t.sel.head),t.sel.anchor=i(t.sel.anchor),t.sel.from=i(t.sel.from),t.sel.to=i(t.sel.to)}function je(t,e,i,n){if(t.cm&&!t.cm.curOp)return se(t.cm,je)(t,e,i,n);if(e.to.line<t.first)return void Re(t,e.text.length-1-(e.to.line-e.from.line));if(!(e.from.line>t.lastLine())){if(e.from.line<t.first){var r=e.text.length-1-(t.first-e.from.line);Re(t,r),e={from:Ue(t.first,0),to:Ue(e.to.line+r,e.to.ch),text:[Gn(e.text)],origin:e.origin}}var o=t.lastLine();e.to.line>o&&(e={from:e.from,to:Ue(o,dn(t,o).text.length),text:[e.text[0]],origin:e.origin}),e.removed=fn(t,e.from,e.to),i||(i=He(t,e,null)),t.cm?Be(t.cm,e,n,i):an(t,e,n,i)}}function Be(t,e,i,n){var o=t.doc,s=t.display,a=e.from,l=e.to,u=!1,h=a.line;t.options.lineWrapping||(h=mn(Wi(o,dn(o,a.line))),o.iter(h,l.line+1,function(t){return t==s.maxLine?(u=!0,!0):void 0})),Ve(o.sel.head,e.from)||Ve(e.to,o.sel.head)||(t.curOp.cursorActivity=!0),an(o,e,i,n,r(t)),t.options.lineWrapping||(o.iter(h,a.line+e.text.length,function(t){var e=c(o,t);e>s.maxLineLength&&(s.maxLine=t,s.maxLineLength=e,s.maxLineChanged=!0,u=!1)}),u&&(t.curOp.updateMaxLine=!0)),o.frontier=Math.min(o.frontier,a.line),P(t,400);var d=e.text.length-(l.line-a.line)-1;if(ue(t,a.line,l.line+1,d),qn(t,"change")){var f={from:a,to:l,text:e.text,removed:e.removed,origin:e.origin};if(t.curOp.textChanged){for(var p=t.curOp.textChanged;p.next;p=p.next);p.next=f}else t.curOp.textChanged=f}}function qe(t,e,i,n,r){if(n||(n=i),Ve(n,i)){var o=n;n=i,i=o}"string"==typeof e&&(e=Po(e)),Ee(t,{from:i,to:n,text:e,origin:r},null)}function Ue(t,e){return this instanceof Ue?(this.line=t,void(this.ch=e)):new Ue(t,e)}function Ye(t,e){return t.line==e.line&&t.ch==e.ch}function Ve(t,e){return t.line<e.line||t.line==e.line&&t.ch<e.ch}function Xe(t){return Ue(t.line,t.ch)}function Ge(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function Ke(t,e){if(e.line<t.first)return Ue(t.first,0);var i=t.first+t.size-1;return e.line>i?Ue(i,dn(t,i).text.length):Qe(e,dn(t,e.line).text.length)}function Qe(t,e){var i=t.ch;return null==i||i>e?Ue(t.line,e):0>i?Ue(t.line,0):t}function Je(t,e){return e>=t.first&&e<t.first+t.size}function Ze(t,e,i,n){if(t.sel.shift||t.sel.extend){var r=t.sel.anchor;if(i){var o=Ve(e,r);o!=Ve(i,r)?(r=e,e=i):o!=Ve(e,i)&&(e=i)}ei(t,r,e,n)}else ei(t,e,i||e,n);t.cm&&(t.cm.curOp.userSelChange=!0)}function ti(t,e,i){var n={anchor:e,head:i};return zn(t,"beforeSelectionChange",t,n),t.cm&&zn(t.cm,"beforeSelectionChange",t.cm,n),n.anchor=Ke(t,n.anchor),n.head=Ke(t,n.head),n}function ei(t,e,i,n,r){if(!r&&qn(t,"beforeSelectionChange")||t.cm&&qn(t.cm,"beforeSelectionChange")){var o=ti(t,e,i);i=o.head,e=o.anchor}var s=t.sel;if(s.goalColumn=null,(r||!Ye(e,s.anchor))&&(e=ni(t,e,n,"push"!=r)),(r||!Ye(i,s.head))&&(i=ni(t,i,n,"push"!=r)),!Ye(s.anchor,e)||!Ye(s.head,i)){s.anchor=e,s.head=i;var a=Ve(i,e);s.from=a?i:e,s.to=a?e:i,t.cm&&(t.cm.curOp.updateInput=t.cm.curOp.selectionChanged=t.cm.curOp.cursorActivity=!0),Rn(t,"cursorActivity",t)}}function ii(t){ei(t.doc,t.doc.sel.from,t.doc.sel.to,null,"push")}function ni(t,e,i,n){var r=!1,o=e,s=i||1;t.cantEdit=!1;t:for(;;){var a=dn(t,o.line);if(a.markedSpans)for(var l=0;l<a.markedSpans.length;++l){var u=a.markedSpans[l],c=u.marker;if((null==u.from||(c.inclusiveLeft?u.from<=o.ch:u.from<o.ch))&&(null==u.to||(c.inclusiveRight?u.to>=o.ch:u.to>o.ch))){if(n&&(zn(c,"beforeCursorEnter"),c.explicitlyCleared)){if(a.markedSpans){--l;continue}break}if(!c.atomic)continue;var h=c.find()[0>s?"from":"to"];if(Ye(h,o)&&(h.ch+=s,h.ch<0?h=h.line>t.first?Ke(t,Ue(h.line-1)):null:h.ch>a.text.length&&(h=h.line<t.first+t.size-1?Ue(h.line+1,0):null),!h)){if(r)return n?(t.cantEdit=!0,Ue(t.first,0)):ni(t,e,i,!0);r=!0,h=e,s=-s}o=h;continue t}}return o}}function ri(t){var e=oi(t,t.doc.sel.head,t.options.cursorScrollMargin);if(t.state.focused){var i=t.display,n=lr(i.sizer),r=null;if(e.top+n.top<0?r=!0:e.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!Hr){var o="none"==i.cursor.style.display;o&&(i.cursor.style.display="",i.cursor.style.left=e.left+"px",i.cursor.style.top=e.top-i.viewOffset+"px"),i.cursor.scrollIntoView(r),o&&(i.cursor.style.display="none")}}}function oi(t,e,i){for(null==i&&(i=0);;){var n=!1,r=J(t,e),o=ai(t,r.left,r.top-i,r.left,r.bottom+i),s=t.doc.scrollTop,a=t.doc.scrollLeft;if(null!=o.scrollTop&&(Ce(t,o.scrollTop),Math.abs(t.doc.scrollTop-s)>1&&(n=!0)),null!=o.scrollLeft&&(ke(t,o.scrollLeft),Math.abs(t.doc.scrollLeft-a)>1&&(n=!0)),!n)return r}}function si(t,e,i,n,r){var o=ai(t,e,i,n,r);null!=o.scrollTop&&Ce(t,o.scrollTop),null!=o.scrollLeft&&ke(t,o.scrollLeft)}function ai(t,e,i,n,r){var o=t.display,s=ie(t.display);0>i&&(i=0);var a=o.scroller.clientHeight-ko,l=o.scroller.scrollTop,u={},c=t.doc.height+E(o),h=s>i,d=r>c-s;if(l>i)u.scrollTop=h?0:i;else if(r>l+a){var f=Math.min(i,(d?c:r)-a);f!=l&&(u.scrollTop=f)}var p=o.scroller.clientWidth-ko,g=o.scroller.scrollLeft;e+=o.gutters.offsetWidth,n+=o.gutters.offsetWidth;var m=o.gutters.offsetWidth,v=m+10>e;return g+m>e||v?(v&&(e=0),u.scrollLeft=Math.max(0,e-10-m)):n>p+g-3&&(u.scrollLeft=n+10-p),u}function li(t,e,i){t.curOp.updateScrollPos={scrollLeft:null==e?t.doc.scrollLeft:e,scrollTop:null==i?t.doc.scrollTop:i}}function ui(t,e,i){var n=t.curOp.updateScrollPos||(t.curOp.updateScrollPos={scrollLeft:t.doc.scrollLeft,scrollTop:t.doc.scrollTop}),r=t.display.scroller;n.scrollTop=Math.max(0,Math.min(r.scrollHeight-r.clientHeight,n.scrollTop+i)),n.scrollLeft=Math.max(0,Math.min(r.scrollWidth-r.clientWidth,n.scrollLeft+e))}function ci(t,e,i,n){var r=t.doc;if(null==i&&(i="add"),"smart"==i)if(t.doc.mode.indent)var o=F(t,e);else i="prev";var s=t.options.tabSize,a=dn(r,e),l=Vn(a.text,null,s),u=a.text.match(/^\s*/)[0],c;if("smart"==i&&(c=t.doc.mode.indent(o,a.text.slice(u.length),a.text),c==So)){if(!n)return;i="prev"}"prev"==i?c=e>r.first?Vn(dn(r,e-1).text,null,s):0:"add"==i?c=l+t.options.indentUnit:"subtract"==i?c=l-t.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var h="",d=0;if(t.options.indentWithTabs)for(var f=Math.floor(c/s);f;--f)d+=s,h+="	";c>d&&(h+=Xn(c-d)),h!=u&&qe(t.doc,h,Ue(e,0),Ue(e,u.length),"+input"),a.stateAfter=null}function hi(t,e,i){var n=e,r=e,o=t.doc;return"number"==typeof e?r=dn(o,Ge(o,e)):n=mn(e),null==n?null:i(r,n)?(ue(t,n,n+1),r):null}function di(t,e,i,n,r){function o(){var e=a+i;return e<t.first||e>=t.first+t.size?h=!1:(a=e,c=dn(t,e))}function s(t){var e=(r?_r:Cr)(c,l,i,!0);if(null==e){if(t||!o())return h=!1;l=r?(0>i?mr:gr)(c):0>i?c.text.length:0}else l=e;return!0}var a=e.line,l=e.ch,u=i,c=dn(t,a),h=!0;if("char"==n)s();else if("column"==n)s(!0);else if("word"==n||"group"==n)for(var d=null,f="group"==n,p=!0;!(0>i)||s(!p);p=!1){var g=c.text.charAt(l)||"\n",m=ir(g)?"w":f?/\s/.test(g)?null:"p":null;if(d&&d!=m){0>i&&(i=1,s());break}if(m&&(d=m),i>0&&!s(!p))break}var v=ni(t,Ue(a,l),u,!0);return h||(v.hitSide=!0),v}function fi(t,e,i,n){var r=t.doc,o=e.left,s;if("page"==n){var a=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);s=e.top+i*(a-(0>i?1.5:.5)*ie(t.display))}else"line"==n&&(s=i>0?e.bottom+3:e.top-3);for(;;){var l=te(t,o,s);if(!l.outside)break;if(0>i?0>=s:s>=r.height){l.hitSide=!0;break}s+=5*i}return l}function pi(t,e){var i=e.ch,n=e.ch;if(t){(e.xRel<0||n==t.length)&&i?--i:++n;for(var r=t.charAt(i),o=ir(r)?ir:/\s/.test(r)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!ir(t)};i>0&&o(t.charAt(i-1));)--i;for(;n<t.length&&o(t.charAt(n));)++n}return{from:Ue(e.line,i),to:Ue(e.line,n)}}function gi(t,e){Ze(t.doc,Ue(e,0),Ke(t.doc,Ue(e+1,0)))}function mi(e,i,n,r){t.defaults[e]=i,n&&(no[e]=r?function(t,e,i){i!=oo&&n(t,e,i)}:n)}function vi(t,e){if(e===!0)return e;if(t.copyState)return t.copyState(e);var i={};for(var n in e){var r=e[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function yi(t,e,i){return t.startState?t.startState(e,i):!0}function bi(t){return"string"==typeof t?fo[t]:t}function xi(t,e,i){function n(e){e=bi(e);var r=e[t];if(r===!1)return"stop";if(null!=r&&i(r))return!0;if(e.nofallthrough)return"stop";var o=e.fallthrough;if(null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return n(o);for(var s=0,a=o.length;a>s;++s){var l=n(o[s]);if(l)return l}return!1}for(var r=0;r<e.length;++r){var o=n(e[r]);if(o)return"stop"!=o}}function wi(t){var e=Fo[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function _i(t,e){if(Ir&&34==t.keyCode&&t["char"])return!1;var i=Fo[t.keyCode];return null==i||t.altGraphKey?!1:(t.altKey&&(i="Alt-"+i),(jr?t.metaKey:t.ctrlKey)&&(i="Ctrl-"+i),(jr?t.ctrlKey:t.metaKey)&&(i="Cmd-"+i),!e&&t.shiftKey&&(i="Shift-"+i),i)}function Ci(t,e){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0}function ki(t,e){this.lines=[],this.type=e,this.doc=t}function Si(t,e,i,n,r){if(n&&n.shared)return Ti(t,e,i,n,r);if(t.cm&&!t.cm.curOp)return se(t.cm,Si)(t,e,i,n,r);var o=new ki(t,r);if("range"==r&&!Ve(e,i))return o;n&&Zn(n,o),o.replacedWith&&(o.collapsed=!0,o.replacedWith=rr("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||(o.replacedWith.ignoreEvents=!0)),o.collapsed&&(Ur=!0),o.addToHistory&&Cn(t,{from:e,to:i,origin:"markText"},{head:t.sel.head,anchor:t.sel.anchor},0/0);var s=e.line,a=0,l,u,c=t.cm,h;if(t.iter(s,i.line+1,function(n){c&&o.collapsed&&!c.options.lineWrapping&&Wi(t,n)==c.display.maxLine&&(h=!0);var r={from:null,to:null,marker:o};a+=n.text.length,s==e.line&&(r.from=e.ch,a-=e.ch),s==i.line&&(r.to=i.ch,a-=n.text.length-i.ch),o.collapsed&&(s==i.line&&(u=Hi(n,i.ch)),s==e.line?l=Hi(n,e.ch):gn(n,0)),Mi(n,r),++s}),o.collapsed&&t.iter(e.line,i.line+1,function(e){zi(t,e)&&gn(e,0)}),o.clearOnEnter&&En(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(qr=!0,(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed){if(l!=u)throw new Error("Inserting collapsed marker overlapping an existing one");o.size=a,o.atomic=!0}return c&&(h&&(c.curOp.updateMaxLine=!0),(o.className||o.title||o.startStyle||o.endStyle||o.collapsed)&&ue(c,e.line,i.line+1),o.atomic&&ii(c)),o}function Di(t,e){this.markers=t,this.primary=e;for(var i=0,n=this;i<t.length;++i)t[i].parent=this,En(t[i],"clear",function(){n.clear()})}function Ti(t,e,i,n,r){n=Zn(n),n.shared=!1;var o=[Si(t,e,i,n,r)],s=o[0],a=n.replacedWith;return cn(t,function(t){a&&(n.replacedWith=a.cloneNode(!0)),o.push(Si(t,Ke(t,e),Ke(t,i),n,r));for(var l=0;l<t.linked.length;++l)if(t.linked[l].isParent)return;s=Gn(o)}),new Di(o,s)}function Li(t,e){if(t)for(var i=0;i<t.length;++i){var n=t[i];if(n.marker==e)return n}}function Oi(t,e){for(var i,n=0;n<t.length;++n)t[n]!=e&&(i||(i=[])).push(t[n]);return i}function Mi(t,e){t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.attachLine(t)}function Ii(t,e,i){if(t)for(var n=0,r;n<t.length;++n){var o=t[n],s=o.marker,a=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);if(a||"bookmark"==s.type&&o.from==e&&(!i||!o.marker.insertLeft)){var l=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);(r||(r=[])).push({from:o.from,to:l?null:o.to,marker:s})}}return r}function Pi(t,e,i){if(t)for(var n=0,r;n<t.length;++n){var o=t[n],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);if(a||"bookmark"==s.type&&o.from==e&&(!i||o.marker.insertLeft)){var l=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);(r||(r=[])).push({from:l?null:o.from-e,to:null==o.to?null:o.to-e,marker:s})}}return r}function Ai(t,e){var i=Je(t,e.from.line)&&dn(t,e.from.line).markedSpans,n=Je(t,e.to.line)&&dn(t,e.to.line).markedSpans;if(!i&&!n)return null;var r=e.from.ch,o=e.to.ch,s=Ye(e.from,e.to),a=Ii(i,r,s),l=Pi(n,o,s),u=1==e.text.length,c=Gn(e.text).length+(u?r:0);if(a)for(var h=0;h<a.length;++h){var d=a[h];if(null==d.to){var f=Li(l,d.marker);f?u&&(d.to=null==f.to?null:f.to+c):d.to=r}}if(l)for(var h=0;h<l.length;++h){var d=l[h];if(null!=d.to&&(d.to+=c),null==d.from){var f=Li(a,d.marker);f||(d.from=c,u&&(a||(a=[])).push(d))}else d.from+=c,u&&(a||(a=[])).push(d)}if(u&&a){for(var h=0;h<a.length;++h)null!=a[h].from&&a[h].from==a[h].to&&"bookmark"!=a[h].marker.type&&a.splice(h--,1);a.length||(a=null)}var p=[a];if(!u){var g=e.text.length-2,m;if(g>0&&a)for(var h=0;h<a.length;++h)null==a[h].to&&(m||(m=[])).push({from:null,to:null,marker:a[h].marker});for(var h=0;g>h;++h)p.push(m);p.push(l)}return p}function Ni(t,e){var i=Sn(t,e),n=Ai(t,e);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)t:for(var a=0;a<s.length;++a){for(var l=s[a],u=0;u<o.length;++u)if(o[u].marker==l.marker)continue t;o.push(l)}else s&&(i[r]=s)}return i}function Fi(t,e,i){var n=null;if(t.iter(e.line,i.line+1,function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var i=t.markedSpans[e].marker;!i.readOnly||n&&-1!=Qn(n,i)||(n||(n=[])).push(i)}}),!n)return null;for(var r=[{from:e,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(),l=0;l<r.length;++l){var u=r[l];if(!Ve(u.to,a.from)&&!Ve(a.to,u.from)){var c=[l,1];(Ve(u.from,a.from)||!s.inclusiveLeft&&Ye(u.from,a.from))&&c.push({from:u.from,to:a.from}),(Ve(a.to,u.to)||!s.inclusiveRight&&Ye(u.to,a.to))&&c.push({from:a.to,to:u.to}),r.splice.apply(r,c),l+=c.length-1}}return r}function Hi(t,e){var i=Ur&&t.markedSpans,n;if(i)for(var r,o=0;o<i.length;++o)r=i[o],r.marker.collapsed&&(null==r.from||r.from<e)&&(null==r.to||r.to>e)&&(!n||n.width<r.marker.width)&&(n=r.marker);return n}function $i(t){return Hi(t,-1)}function Ei(t){return Hi(t,t.text.length+1)}function Wi(t,e){for(var i;i=$i(e);)e=dn(t,i.find().from.line);return e}function zi(t,e){var i=Ur&&e.markedSpans;if(i)for(var n,r=0;r<i.length;++r)if(n=i[r],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.replacedWith&&0==n.from&&n.marker.inclusiveLeft&&Ri(t,e,n))return!0}}function Ri(t,e,i){if(null==i.to){var n=i.marker.find().to,r=dn(t,n.line);return Ri(t,r,Li(r.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==e.text.length)return!0;for(var o,s=0;s<e.markedSpans.length;++s)if(o=e.markedSpans[s],o.marker.collapsed&&!o.marker.replacedWith&&o.from==i.to&&(o.marker.inclusiveLeft||i.marker.inclusiveRight)&&Ri(t,e,o))return!0}function ji(t){var e=t.markedSpans;if(e){for(var i=0;i<e.length;++i)e[i].marker.detachLine(t);t.markedSpans=null}}function Bi(t,e){if(e){for(var i=0;i<e.length;++i)e[i].marker.attachLine(t);t.markedSpans=e}}function qi(t){return function(){var e=!this.cm.curOp;e&&re(this.cm);try{var i=t.apply(this,arguments)}finally{e&&oe(this.cm)}return i}}function Ui(t){return null!=t.height?t.height:(t.node.parentNode&&1==t.node.parentNode.nodeType||sr(t.cm.display.measure,rr("div",[t.node],null,"position: relative")),t.height=t.node.offsetHeight)}function Yi(t,e,i,n){var r=new po(t,i,n);return r.noHScroll&&(t.display.alignWidgets=!0),hi(t,e,function(e){var i=e.widgets||(e.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length-1,Math.max(0,r.insertAt)),0,r),r.line=e,!zi(t.doc,e)||r.showIfHidden){var n=yn(t,e)<t.doc.scrollTop;gn(e,e.height+Ui(r)),n&&ui(t,0,r.height)}return!0}),r}function Vi(t,e,i,n){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),ji(t),Bi(t,i);var r=n?n(t):1;r!=t.height&&gn(t,r)}function Xi(t){t.parent=null,ji(t)}function Gi(t,e,i,n,r){var o=i.flattenSpans;null==o&&(o=t.options.flattenSpans);var s=0,a=null,l=new Ci(e,t.options.tabSize),u;for(""==e&&i.blankLine&&i.blankLine(n);!l.eol();)l.pos>t.options.maxHighlightLength?(o=!1,l.pos=Math.min(e.length,l.start+5e4),u=null):u=i.token(l,n),o&&a==u||(s<l.start&&r(l.start,a),s=l.start,a=u),l.start=l.pos;s<l.pos&&r(l.pos,a)}function Ki(t,e,i){var n=[t.state.modeGen];Gi(t,e.text,t.doc.mode,i,function(t,e){n.push(t,e)});for(var r=0;r<t.state.overlays.length;++r){var o=t.state.overlays[r],s=1,a=0;Gi(t,e.text,o.mode,!0,function(t,e){for(var i=s;t>a;){var r=n[s];r>t&&n.splice(s,1,t,n[s+1],r),s+=2,a=Math.min(t,r)}if(e)if(o.opaque)n.splice(i,s-i,t,e),s=i+2;else for(;s>i;i+=2){var l=n[i+1];n[i+1]=l?l+" "+e:e}})}return n}function Qi(t,e){return e.styles&&e.styles[0]==t.state.modeGen||(e.styles=Ki(t,e,e.stateAfter=F(t,mn(e)))),e.styles}function Ji(t,e,i){var n=t.doc.mode,r=new Ci(e.text,t.options.tabSize);for(""==e.text&&n.blankLine&&n.blankLine(i);!r.eol()&&r.pos<=t.options.maxHighlightLength;)n.token(r,i),r.start=r.pos
}function Zi(t){return t?mo[t]||(mo[t]="cm-"+t.replace(/ +/g," cm-")):null}function tn(t,e,i,n){for(var r,o=e,s=!0;r=$i(o);)o=dn(t.doc,r.find().from.line);var a={pre:rr("pre"),col:0,pos:0,measure:null,measuredSomething:!1,cm:t,copyWidgets:n};o.textClass&&(a.pre.className=o.textClass);do{o.text&&(s=!1),a.measure=o==e&&i,a.pos=0,a.addToken=a.measure?nn:en,(Sr||Lr)&&t.getOption("lineWrapping")&&(a.addToken=rn(a.addToken));var l=sn(o,a,Qi(t,o));i&&o==e&&!a.measuredSomething&&(i[0]=a.pre.appendChild(hr(t.display.measure)),a.measuredSomething=!0),l&&(o=dn(t.doc,l.to.line))}while(l);!i||a.measuredSomething||i[0]||(i[0]=a.pre.appendChild(s?rr("span"," "):hr(t.display.measure))),a.pre.firstChild||zi(t.doc,e)||a.pre.appendChild(document.createTextNode(" "));var u;if(i&&Sr&&(u=bn(o))){var c=u.length-1;u[c].from==u[c].to&&--c;var h=u[c],d=u[c-1];if(h.from+1==h.to&&d&&h.level<d.level){var f=i[a.pos-1];f&&f.parentNode.insertBefore(f.measureRight=hr(t.display.measure),f.nextSibling)}}return zn(t,"renderLine",t,e,a.pre),a.pre}function en(t,e,i,n,r,o){if(e){if(vo.test(e))for(var s=document.createDocumentFragment(),a=0;;){vo.lastIndex=a;var l=vo.exec(e),u=l?l.index-a:e.length-a;if(u&&(s.appendChild(document.createTextNode(e.slice(a,a+u))),t.col+=u),!l)break;if(a+=u+1,"	"==l[0]){var c=t.cm.options.tabSize,h=c-t.col%c;s.appendChild(rr("span",Xn(h),"cm-tab")),t.col+=h}else{var d=rr("span","•","cm-invalidchar");d.title="\\u"+l[0].charCodeAt(0).toString(16),s.appendChild(d),t.col+=1}}else{t.col+=e.length;var s=document.createTextNode(e)}if(i||n||r||t.measure){var f=i||"";n&&(f+=n),r&&(f+=r);var d=rr("span",[s],f);return o&&(d.title=o),t.pre.appendChild(d)}t.pre.appendChild(s)}}function nn(t,e,i,n,r){for(var o=t.cm.options.lineWrapping,s=0;s<e.length;++s){var a=e.charAt(s),l=0==s;a>="�"&&"�">a&&s<e.length-1?(a=e.slice(s,s+2),++s):s&&o&&ur(e,s)&&t.pre.appendChild(rr("wbr"));var u=t.measure[t.pos],c=t.measure[t.pos]=en(t,a,i,l&&n,s==e.length-1&&r);u&&(c.leftSide=u.leftSide||u),Sr&&o&&" "==a&&s&&!/\s/.test(e.charAt(s-1))&&s<e.length-1&&!/\s/.test(e.charAt(s+1))&&(c.style.whiteSpace="normal"),t.pos+=a.length}e.length&&(t.measuredSomething=!0)}function rn(t){function e(t){for(var e=" ",i=0;i<t.length-2;++i)e+=i%2?" ":" ";return e+=" "}return function(i,n,r,o,s,a){return t(i,n.replace(/ {3,}/,e),r,o,s,a)}}function on(t,e,i,n){var r=!n&&i.replacedWith;if(r&&(t.copyWidgets&&(r=r.cloneNode(!0)),t.pre.appendChild(r),t.measure)){if(e)t.measure[t.pos]=r;else{var o=t.measure[t.pos]=hr(t.cm.display.measure);"bookmark"!=i.type||i.insertLeft?t.pre.insertBefore(o,r):t.pre.appendChild(o)}t.measuredSomething=!0}t.pos+=e}function sn(t,e,i){var n=t.markedSpans,r=t.text,o=0;if(n)for(var s=r.length,a=0,l=1,u="",c,h=0,d,f,p,g,m;;){if(h==a){d=f=p=g="",m=null,h=1/0;for(var v=null,y=0;y<n.length;++y){var b=n[y],x=b.marker;b.from<=a&&(null==b.to||b.to>a)?(null!=b.to&&h>b.to&&(h=b.to,f=""),x.className&&(d+=" "+x.className),x.startStyle&&b.from==a&&(p+=" "+x.startStyle),x.endStyle&&b.to==h&&(f+=" "+x.endStyle),x.title&&!g&&(g=x.title),x.collapsed&&(!m||m.marker.size<x.size)&&(m=b)):b.from>a&&h>b.from&&(h=b.from),"bookmark"==x.type&&b.from==a&&x.replacedWith&&(v=x)}if(m&&(m.from||0)==a&&(on(e,(null==m.to?s:m.to)-a,m.marker,null==m.from),null==m.to))return m.marker.find();v&&!m&&on(e,0,v)}if(a>=s)break;for(var w=Math.min(s,h);;){if(u){var _=a+u.length;if(!m){var C=_>w?u.slice(0,w-a):u;e.addToken(e,C,c?c+d:d,p,a+C.length==h?f:"",g)}if(_>=w){u=u.slice(w-a),a=w;break}a=_,p=""}u=r.slice(o,o=i[l++]),c=Zi(i[l++])}}else for(var l=1;l<i.length;l+=2)e.addToken(e,r.slice(o,o=i[l]),Zi(i[l+1]))}function an(t,e,i,n,r){function o(t){return i?i[t]:null}function s(t,i,n){Vi(t,i,n,r),Rn(t,"change",t,e)}var a=e.from,l=e.to,u=e.text,c=dn(t,a.line),h=dn(t,l.line),d=Gn(u),f=o(u.length-1),p=l.line-a.line;if(0==a.ch&&0==l.ch&&""==d){for(var g=0,m=u.length-1,v=[];m>g;++g)v.push(new go(u[g],o(g),r));s(h,h.text,f),p&&t.remove(a.line,p),v.length&&t.insert(a.line,v)}else if(c==h)if(1==u.length)s(c,c.text.slice(0,a.ch)+d+c.text.slice(l.ch),f);else{for(var v=[],g=1,m=u.length-1;m>g;++g)v.push(new go(u[g],o(g),r));v.push(new go(d+c.text.slice(l.ch),f,r)),s(c,c.text.slice(0,a.ch)+u[0],o(0)),t.insert(a.line+1,v)}else if(1==u.length)s(c,c.text.slice(0,a.ch)+u[0]+h.text.slice(l.ch),o(0)),t.remove(a.line+1,p);else{s(c,c.text.slice(0,a.ch)+u[0],o(0)),s(h,d+h.text.slice(l.ch),f);for(var g=1,m=u.length-1,v=[];m>g;++g)v.push(new go(u[g],o(g),r));p>1&&t.remove(a.line+1,p-1),t.insert(a.line+1,v)}Rn(t,"change",t,e),ei(t,n.anchor,n.head,null,!0)}function ln(t){this.lines=t,this.parent=null;for(var e=0,i=t.length,n=0;i>e;++e)t[e].parent=this,n+=t[e].height;this.height=n}function un(t){this.children=t;for(var e=0,i=0,n=0,r=t.length;r>n;++n){var o=t[n];e+=o.chunkSize(),i+=o.height,o.parent=this}this.size=e,this.height=i,this.parent=null}function cn(t,e,i){function n(t,r,o){if(t.linked)for(var s=0;s<t.linked.length;++s){var a=t.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;(!i||l)&&(e(a.doc,l),n(a.doc,t,l))}}}n(t,null,!0)}function hn(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,o(t),i(t),t.options.lineWrapping||h(t),t.options.mode=e.modeOption,ue(t)}function dn(t,e){for(e-=t.first;!t.lines;)for(var i=0;;++i){var n=t.children[i],r=n.chunkSize();if(r>e){t=n;break}e-=r}return t.lines[e]}function fn(t,e,i){var n=[],r=e.line;return t.iter(e.line,i.line+1,function(t){var o=t.text;r==i.line&&(o=o.slice(0,i.ch)),r==e.line&&(o=o.slice(e.ch)),n.push(o),++r}),n}function pn(t,e,i){var n=[];return t.iter(e,i,function(t){n.push(t.text)}),n}function gn(t,e){for(var i=e-t.height,n=t;n;n=n.parent)n.height+=i}function mn(t){if(null==t.parent)return null;for(var e=t.parent,i=Qn(e.lines,t),n=e.parent;n;e=n,n=n.parent)for(var r=0;n.children[r]!=e;++r)i+=n.children[r].chunkSize();return i+e.first}function vn(t,e){var i=t.first;t:do{for(var n=0,r=t.children.length;r>n;++n){var o=t.children[n],s=o.height;if(s>e){t=o;continue t}e-=s,i+=o.chunkSize()}return i}while(!t.lines);for(var n=0,r=t.lines.length;r>n;++n){var a=t.lines[n],l=a.height;if(l>e)break;e-=l}return i+n}function yn(t,e){e=Wi(t.doc,e);for(var i=0,n=e.parent,r=0;r<n.lines.length;++r){var o=n.lines[r];if(o==e)break;i+=o.height}for(var s=n.parent;s;n=s,s=n.parent)for(var r=0;r<s.children.length;++r){var a=s.children[r];if(a==n)break;i+=a.height}return i}function bn(t){var e=t.order;return null==e&&(e=t.order=$o(t.text)),e}function xn(t){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,generation:t||1,maxGeneration:t||1}}function wn(t,e,i,n){var r=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,i),Math.min(t.first+t.size,n),function(i){i.markedSpans&&((r||(r=e["spans_"+t.id]={}))[o]=i.markedSpans),++o})}function _n(t,e){var i={line:e.from.line,ch:e.from.ch},n={from:i,to:io(e),text:fn(t,e.from,e.to)};return wn(t,n,e.from.line,e.to.line+1),cn(t,function(t){wn(t,n,e.from.line,e.to.line+1)},!0),n}function Cn(t,e,i,n){var r=t.history;r.undone.length=0;var o=+new Date,s=Gn(r.done);if(s&&(r.lastOp==n||r.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&t.cm&&r.lastTime>o-t.cm.options.historyEventDelay||"*"==e.origin.charAt(0)))){var a=Gn(s.changes);Ye(e.from,e.to)&&Ye(e.from,a.to)?a.to=io(e):s.changes.push(_n(t,e)),s.anchorAfter=i.anchor,s.headAfter=i.head}else for(s={changes:[_n(t,e)],generation:r.generation,anchorBefore:t.sel.anchor,headBefore:t.sel.head,anchorAfter:i.anchor,headAfter:i.head},r.done.push(s),r.generation=++r.maxGeneration;r.done.length>r.undoDepth;)r.done.shift();r.lastTime=o,r.lastOp=n,r.lastOrigin=e.origin}function kn(t){if(!t)return null;for(var e=0,i;e<t.length;++e)t[e].marker.explicitlyCleared?i||(i=t.slice(0,e)):i&&i.push(t[e]);return i?i.length?i:null:t}function Sn(t,e){var i=e["spans_"+t.id];if(!i)return null;for(var n=0,r=[];n<e.text.length;++n)r.push(kn(i[n]));return r}function Dn(t,e){for(var i=0,n=[];i<t.length;++i){var r=t[i],o=r.changes,s=[];n.push({changes:s,anchorBefore:r.anchorBefore,headBefore:r.headBefore,anchorAfter:r.anchorAfter,headAfter:r.headAfter});for(var a=0;a<o.length;++a){var l=o[a],u;if(s.push({from:l.from,to:l.to,text:l.text}),e)for(var c in l)(u=c.match(/^spans_(\d+)$/))&&Qn(e,Number(u[1]))>-1&&(Gn(s)[c]=l[c],delete l[c])}}return n}function Tn(t,e,i,n){i<t.line?t.line+=n:e<t.line&&(t.line=e,t.ch=0)}function Ln(t,e,i,n){for(var r=0;r<t.length;++r){for(var o=t[r],s=!0,a=0;a<o.changes.length;++a){var l=o.changes[a];if(o.copied||(l.from=Xe(l.from),l.to=Xe(l.to)),i<l.from.line)l.from.line+=n,l.to.line+=n;else if(e<=l.to.line){s=!1;break}}o.copied||(o.anchorBefore=Xe(o.anchorBefore),o.headBefore=Xe(o.headBefore),o.anchorAfter=Xe(o.anchorAfter),o.readAfter=Xe(o.headAfter),o.copied=!0),s?(Tn(o.anchorBefore),Tn(o.headBefore),Tn(o.anchorAfter),Tn(o.headAfter)):(t.splice(0,r+1),r=0)}}function On(t,e){var i=e.from.line,n=e.to.line,r=e.text.length-(n-i)-1;Ln(t.done,i,n,r),Ln(t.undone,i,n,r)}function Mn(){Fn(this)}function In(t){return t.stop||(t.stop=Mn),t}function Pn(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function An(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function Nn(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function Fn(t){Pn(t),An(t)}function Hn(t){return t.target||t.srcElement}function $n(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),Wr&&t.ctrlKey&&1==e&&(e=3),e}function En(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent)t.attachEvent("on"+e,i);else{var n=t._handlers||(t._handlers={}),r=n[e]||(n[e]=[]);r.push(i)}}function Wn(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else if(t.detachEvent)t.detachEvent("on"+e,i);else{var n=t._handlers&&t._handlers[e];if(!n)return;for(var r=0;r<n.length;++r)if(n[r]==i){n.splice(r,1);break}}}function zn(t,e){var i=t._handlers&&t._handlers[e];if(i)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)}function Rn(t,e){function i(t){return function(){t.apply(null,r)}}var n=t._handlers&&t._handlers[e];if(n){var r=Array.prototype.slice.call(arguments,2);_o||(++Co,_o=[],setTimeout(Bn,0));for(var o=0;o<n.length;++o)_o.push(i(n[o]))}}function jn(t,e,i){return zn(t,i||e.type,t,e),Nn(e)||e.codemirrorIgnore}function Bn(){--Co;var t=_o;_o=null;for(var e=0;e<t.length;++e)t[e]()}function qn(t,e){var i=t._handlers&&t._handlers[e];return i&&i.length>0}function Un(t){t.prototype.on=function(t,e){En(this,t,e)},t.prototype.off=function(t,e){Wn(this,t,e)}}function Yn(){this.id=null}function Vn(t,e,i,n,r){null==e&&(e=t.search(/[^\s\u00a0]/),-1==e&&(e=t.length));for(var o=n||0,s=r||0;e>o;++o)"	"==t.charAt(o)?s+=i-s%i:++s;return s}function Xn(t){for(;Do.length<=t;)Do.push(Gn(Do)+" ");return Do[t]}function Gn(t){return t[t.length-1]}function Kn(t){if($r)t.selectionStart=0,t.selectionEnd=t.value.length;else try{t.select()}catch(e){}}function Qn(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;n>i;++i)if(t[i]==e)return i;return-1}function Jn(t,e){function i(){}i.prototype=t;var n=new i;return e&&Zn(e,n),n}function Zn(t,e){e||(e={});for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function tr(t){for(var e=[],i=0;t>i;++i)e.push(void 0);return e}function er(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function ir(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||To.test(t))}function nr(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}function rr(t,e,i,n){var r=document.createElement(t);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof e)ar(r,e);else if(e)for(var o=0;o<e.length;++o)r.appendChild(e[o]);return r}function or(t){for(var e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function sr(t,e){return or(t).appendChild(e)}function ar(t,e){Tr?(t.innerHTML="",t.appendChild(document.createTextNode(e))):t.textContent=e}function lr(t){return t.getBoundingClientRect()}function ur(){return!1}function cr(t){if(null!=Mo)return Mo;var e=rr("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return sr(t,e),e.offsetWidth&&(Mo=e.offsetHeight-e.clientHeight),Mo||0}function hr(t){if(null==Io){var e=rr("span","​");sr(t,rr("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Io=e.offsetWidth<=1&&e.offsetHeight>2&&!Dr)}return Io?rr("span","​"):rr("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function dr(t,e,i,n){if(!t)return n(e,i,"ltr");for(var r=!1,o=0;o<t.length;++o){var s=t[o];(s.from<i&&s.to>e||e==i&&s.to==e)&&(n(Math.max(s.from,e),Math.min(s.to,i),1==s.level?"rtl":"ltr"),r=!0)}r||n(e,i,"ltr")}function fr(t){return t.level%2?t.to:t.from}function pr(t){return t.level%2?t.from:t.to}function gr(t){var e=bn(t);return e?fr(e[0]):0}function mr(t){var e=bn(t);return e?pr(Gn(e)):t.text.length}function vr(t,e){var i=dn(t.doc,e),n=Wi(t.doc,i);n!=i&&(e=mn(n));var r=bn(n),o=r?r[0].level%2?mr(n):gr(n):0;return Ue(e,o)}function yr(t,e){for(var i,n;i=Ei(n=dn(t.doc,e));)e=i.find().to.line;var r=bn(n),o=r?r[0].level%2?gr(n):mr(n):n.text.length;return Ue(e,o)}function br(t,e,i){var n=t[0].level;return e==n?!0:i==n?!1:i>e}function xr(t,e){for(var i=0,n;i<t.length;++i){var r=t[i];if(r.from<e&&r.to>e)return Ho=null,i;if(r.from==e||r.to==e){if(null!=n)return br(t,r.level,t[n].level)?(Ho=n,i):(Ho=i,n);n=i}}return Ho=null,n}function wr(t,e,i,n){if(!n)return e+i;do e+=i;while(e>0&&Lo.test(t.text.charAt(e)));return e}function _r(t,e,i,n){var r=bn(t);if(!r)return Cr(t,e,i,n);for(var o=xr(r,e),s=r[o],a=wr(t,e,s.level%2?-i:i,n);;){if(a>s.from&&a<s.to)return a;if(a==s.from||a==s.to)return xr(r,a)==o?a:(s=r[o+=i],i>0==s.level%2?s.to:s.from);if(s=r[o+=i],!s)return null;a=i>0==s.level%2?wr(t,s.to,-1,n):wr(t,s.from,1,n)}}function Cr(t,e,i,n){var r=e+i;if(n)for(;r>0&&Lo.test(t.text.charAt(r));)r+=i;return 0>r||r>t.text.length?null:r}var kr=/gecko\/\d/i.test(navigator.userAgent),Sr=/MSIE \d/.test(navigator.userAgent),Dr=Sr&&(null==document.documentMode||document.documentMode<8),Tr=Sr&&(null==document.documentMode||document.documentMode<9),Lr=/WebKit\//.test(navigator.userAgent),Or=Lr&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Mr=/Chrome\//.test(navigator.userAgent),Ir=/Opera\//.test(navigator.userAgent),Pr=/Apple Computer/.test(navigator.vendor),Ar=/KHTML\//.test(navigator.userAgent),Nr=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Fr=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Hr=/PhantomJS/.test(navigator.userAgent),$r=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Er=$r||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Wr=$r||/Mac/.test(navigator.platform),zr=/windows/i.test(navigator.platform),Rr=Ir&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Rr&&(Rr=Number(Rr[1])),Rr&&Rr>=15&&(Ir=!1,Lr=!0);var jr=Wr&&(Or||Ir&&(null==Rr||12.11>Rr)),Br=kr||Sr&&!Tr,qr=!1,Ur=!1,Yr,Vr=0,Xr,Gr,Kr=0,Qr=0,Jr=null;Sr?Jr=-.53:kr?Jr=15:Mr?Jr=-.7:Pr&&(Jr=-1/3);var Zr,to=null,eo,io=t.changeEnd=function(t){return t.text?Ue(t.from.line+t.text.length-1,Gn(t.text).length+(1==t.text.length?t.from.ch:0)):t.to};t.Pos=Ue,t.prototype={constructor:t,focus:function(){window.focus(),pe(this),Pe(this),he(this)},setOption:function(t,e){var i=this.options,n=i[t];(i[t]!=e||"mode"==t)&&(i[t]=e,no.hasOwnProperty(t)&&se(this,no[t])(this,e,n))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](t)},removeKeyMap:function(t){for(var e=this.state.keyMaps,i=0;i<e.length;++i)if(e[i]==t||"string"!=typeof e[i]&&e[i].name==t)return e.splice(i,1),!0},addOverlay:se(null,function(e,i){var n=e.token?e:t.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:e,opaque:i&&i.opaque}),this.state.modeGen++,ue(this)}),removeOverlay:se(null,function(t){for(var e=this.state.overlays,i=0;i<e.length;++i){var n=e[i].modeSpec;if(n==t||"string"==typeof t&&n.name==t)return e.splice(i,1),this.state.modeGen++,void ue(this)}}),indentLine:se(null,function(t,e,i){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),Je(this.doc,t)&&ci(this,t,e,i)}),indentSelection:se(null,function(t){var e=this.doc.sel;if(Ye(e.from,e.to))return ci(this,e.from.line,t);for(var i=e.to.line-(e.to.ch?0:1),n=e.from.line;i>=n;++n)ci(this,n,t)}),getTokenAt:function(t,e){var i=this.doc;t=Ke(i,t);for(var n=F(this,t.line,e),r=this.doc.mode,o=dn(i,t.line),s=new Ci(o.text,this.options.tabSize);s.pos<t.ch&&!s.eol();){s.start=s.pos;var a=r.token(s,n)}return{start:s.start,end:s.pos,string:s.current(),className:a||null,type:a||null,state:n}},getTokenTypeAt:function(t){t=Ke(this.doc,t);var e=Qi(this,dn(this.doc,t.line)),i=0,n=(e.length-1)/2,r=t.ch;if(0==r)return e[2];for(;;){var o=i+n>>1;if((o?e[2*o-1]:0)>=r)n=o;else{if(!(e[2*o+1]<r))return e[2*o+2];i=o+1}}},getModeAt:function(e){var i=this.doc.mode;return i.innerMode?t.innerMode(i,this.getTokenAt(e).state).mode:i},getHelper:function(t,e){if(co.hasOwnProperty(e)){var i=co[e],n=this.getModeAt(t);return n[e]&&i[n[e]]||n.helperType&&i[n.helperType]||i[n.name]}},getStateAfter:function(t,e){var i=this.doc;return t=Ge(i,null==t?i.first+i.size-1:t),F(this,t+1,e)},cursorCoords:function(t,e){var i,n=this.doc.sel;return i=null==t?n.head:"object"==typeof t?Ke(this.doc,t):t?n.from:n.to,J(this,i,e||"page")},charCoords:function(t,e){return Q(this,Ke(this.doc,t),e||"page")},coordsChar:function(t,e){return t=K(this,t,e||"page"),te(this,t.left,t.top)},lineAtHeight:function(t,e){return t=K(this,{top:t,left:0},e||"page").top,vn(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e){var i=!1,n=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>n&&(t=n,i=!0);var r=dn(this.doc,t);return G(this,dn(this.doc,t),{top:0,left:0},e||"page").top+(i?r.height:0)},defaultTextHeight:function(){return ie(this.display)},defaultCharWidth:function(){return ne(this.display)},setGutterMarker:se(null,function(t,e,i){return hi(this,t,function(t){var n=t.gutterMarkers||(t.gutterMarkers={});return n[e]=i,!i&&nr(n)&&(t.gutterMarkers=null),!0})}),clearGutter:se(null,function(t){var e=this,i=e.doc,n=i.first;i.iter(function(i){i.gutterMarkers&&i.gutterMarkers[t]&&(i.gutterMarkers[t]=null,ue(e,n,n+1),nr(i.gutterMarkers)&&(i.gutterMarkers=null)),++n})}),addLineClass:se(null,function(t,e,i){return hi(this,t,function(t){var n="text"==e?"textClass":"background"==e?"bgClass":"wrapClass";if(t[n]){if(new RegExp("(?:^|\\s)"+i+"(?:$|\\s)").test(t[n]))return!1;t[n]+=" "+i}else t[n]=i;return!0})}),removeLineClass:se(null,function(t,e,i){return hi(this,t,function(t){var n="text"==e?"textClass":"background"==e?"bgClass":"wrapClass",r=t[n];if(!r)return!1;if(null==i)t[n]=null;else{var o=r.match(new RegExp("(?:^|\\s+)"+i+"(?:$|\\s+)"));if(!o)return!1;var s=o.index+o[0].length;t[n]=r.slice(0,o.index)+(o.index&&s!=r.length?" ":"")+r.slice(s)||null}return!0})}),addLineWidget:se(null,function(t,e,i){return Yi(this,t,e,i)}),removeLineWidget:function(t){t.clear()},lineInfo:function(t){if("number"==typeof t){if(!Je(this.doc,t))return null;var e=t;if(t=dn(this.doc,t),!t)return null}else{var e=mn(t);if(null==e)return null}return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(t,e,i,n,r){var o=this.display;t=J(this,Ke(this.doc,t));var s=t.bottom,a=t.left;if(e.style.position="absolute",o.sizer.appendChild(e),"over"==n)s=t.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||t.bottom+e.offsetHeight>l)&&t.top>e.offsetHeight?s=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=l&&(s=t.bottom),a+e.offsetWidth>u&&(a=u-e.offsetWidth)}e.style.top=s+"px",e.style.left=e.style.right="","right"==r?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),i&&si(this,a,s,a+e.offsetWidth,s+e.offsetHeight)},triggerOnKeyDown:se(null,Me),execCommand:function(t){return ho[t](this)},findPosH:function(t,e,i,n){var r=1;0>e&&(r=-1,e=-e);for(var o=0,s=Ke(this.doc,t);e>o&&(s=di(this.doc,s,r,i,n),!s.hitSide);++o);return s},moveH:se(null,function(t,e){var i=this.doc.sel,n;n=i.shift||i.extend||Ye(i.from,i.to)?di(this.doc,i.head,t,e,this.options.rtlMoveVisually):0>t?i.from:i.to,Ze(this.doc,n,n,t)}),deleteH:se(null,function(t,e){var i=this.doc.sel;Ye(i.from,i.to)?qe(this.doc,"",i.from,di(this.doc,i.head,t,e,!1),"+delete"):qe(this.doc,"",i.from,i.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(t,e,i,n){var r=1,o=n;0>e&&(r=-1,e=-e);for(var s=0,a=Ke(this.doc,t);e>s;++s){var l=J(this,a,"div");if(null==o?o=l.left:l.left=o,a=fi(this,l,r,i),a.hitSide)break}return a},moveV:se(null,function(t,e){var i=this.doc.sel,n=J(this,i.head,"div");null!=i.goalColumn&&(n.left=i.goalColumn);var r=fi(this,n,t,e);"page"==e&&ui(this,0,Q(this,r,"div").top-n.top),Ze(this.doc,r,r,t),i.goalColumn=n.left}),toggleOverwrite:function(t){(null==t||t!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite",""))},hasFocus:function(){return this.state.focused},scrollTo:se(null,function(t,e){li(this,t,e)}),getScrollInfo:function(){var t=this.display.scroller,e=ko;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-e,width:t.scrollWidth-e,clientHeight:t.clientHeight-e,clientWidth:t.clientWidth-e}},scrollIntoView:se(null,function(t,e){"number"==typeof t&&(t=Ue(t,0)),e||(e=0);var i=t;t&&null==t.line||(this.curOp.scrollToPos=t?Ke(this.doc,t):this.doc.sel.head,this.curOp.scrollToPosMargin=e,i=J(this,this.curOp.scrollToPos));var n=ai(this,i.left,i.top-e,i.right,i.bottom+e);li(this,n.scrollLeft,n.scrollTop)}),setSize:se(null,function(t,e){function i(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t}null!=t&&(this.display.wrapper.style.width=i(t)),null!=e&&(this.display.wrapper.style.height=i(e)),this.options.lineWrapping&&(this.display.measureLineCache.length=this.display.measureLineCachePos=0),this.curOp.forceUpdate=!0}),operation:function(t){return le(this,t)},refresh:se(null,function(){Y(this),li(this,this.doc.scrollLeft,this.doc.scrollTop),ue(this)}),swapDoc:se(null,function(t){var e=this.doc;return e.cm=null,hn(this,t),Y(this),fe(this,!0),li(this,t.scrollLeft,t.scrollTop),e}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Un(t);var no=t.optionHandlers={},ro=t.defaults={},oo=t.Init={toString:function(){return"CodeMirror.Init"}};mi("value","",function(t,e){t.setValue(e)},!0),mi("mode",null,function(t,e){t.doc.modeOption=e,i(t)},!0),mi("indentUnit",2,i,!0),mi("indentWithTabs",!1),mi("smartIndent",!0),mi("tabSize",4,function(t){i(t),Y(t),ue(t)},!0),mi("electricChars",!0),mi("rtlMoveVisually",!zr),mi("theme","default",function(t){a(t),l(t)},!0),mi("keyMap","default",s),mi("extraKeys",null),mi("onKeyEvent",null),mi("onDragEvent",null),mi("lineWrapping",!1,n,!0),mi("gutters",[],function(t){d(t.options),l(t)},!0),mi("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?y(t.display)+"px":"0",t.refresh()},!0),mi("coverGutterNextToScrollbar",!1,f,!0),mi("lineNumbers",!1,function(t){d(t.options),l(t)},!0),mi("firstLineNumber",1,l,!0),mi("lineNumberFormatter",function(t){return t},l,!0),mi("showCursorWhenSelecting",!1,L,!0),mi("readOnly",!1,function(t,e){"nocursor"==e?(Ae(t),t.display.input.blur()):e||fe(t,!0)}),mi("dragDrop",!0),mi("cursorBlinkRate",530),mi("cursorScrollMargin",0),mi("cursorHeight",1),mi("workTime",100),mi("workDelay",100),mi("flattenSpans",!0),mi("pollInterval",100),mi("undoDepth",40,function(t,e){t.doc.history.undoDepth=e}),mi("historyEventDelay",500),mi("viewportMargin",10,function(t){t.refresh()},!0),mi("maxHighlightLength",1e4,function(t){i(t),t.refresh()},!0),mi("moveInputWithCursor",!0,function(t,e){e||(t.display.inputDiv.style.top=t.display.inputDiv.style.left=0)}),mi("tabindex",null,function(t,e){t.display.input.tabIndex=e||""}),mi("autofocus",null);var so=t.modes={},ao=t.mimeModes={};t.defineMode=function(e,i){if(t.defaults.mode||"null"==e||(t.defaults.mode=e),arguments.length>2){i.dependencies=[];for(var n=2;n<arguments.length;++n)i.dependencies.push(arguments[n])}so[e]=i},t.defineMIME=function(t,e){ao[t]=e},t.resolveMode=function(e){if("string"==typeof e&&ao.hasOwnProperty(e))e=ao[e];else if(e&&"string"==typeof e.name&&ao.hasOwnProperty(e.name)){var i=ao[e.name];e=Jn(i,e),e.name=i.name}else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return t.resolveMode("application/xml");return"string"==typeof e?{name:e}:e||{name:"null"}},t.getMode=function(e,i){var i=t.resolveMode(i),n=so[i.name];if(!n)return t.getMode(e,"text/plain");var r=n(e,i);if(lo.hasOwnProperty(i.name)){var o=lo[i.name];for(var s in o)o.hasOwnProperty(s)&&(r.hasOwnProperty(s)&&(r["_"+s]=r[s]),r[s]=o[s])}return r.name=i.name,r},t.defineMode("null",function(){return{token:function(t){t.skipToEnd()}}}),t.defineMIME("text/plain","null");var lo=t.modeExtensions={};t.extendMode=function(t,e){var i=lo.hasOwnProperty(t)?lo[t]:lo[t]={};Zn(e,i)},t.defineExtension=function(e,i){t.prototype[e]=i},t.defineDocExtension=function(t,e){bo.prototype[t]=e},t.defineOption=mi;var uo=[];t.defineInitHook=function(t){uo.push(t)};var co=t.helpers={};t.registerHelper=function(e,i,n){co.hasOwnProperty(e)||(co[e]=t[e]={}),co[e][i]=n},t.isWordChar=ir,t.copyState=vi,t.startState=yi,t.innerMode=function(t,e){for(;t.innerMode;){var i=t.innerMode(e);if(!i||i.mode==t)break;e=i.state,t=i.mode}return i||{mode:t,state:e}};var ho=t.commands={selectAll:function(t){t.setSelection(Ue(t.firstLine(),0),Ue(t.lastLine()))},killLine:function(t){var e=t.getCursor(!0),i=t.getCursor(!1),n=!Ye(e,i);n||t.getLine(e.line).length!=e.ch?t.replaceRange("",e,n?i:Ue(e.line),"+delete"):t.replaceRange("",e,Ue(e.line+1,0),"+delete")},deleteLine:function(t){var e=t.getCursor().line;t.replaceRange("",Ue(e,0),Ue(e),"+delete")},delLineLeft:function(t){var e=t.getCursor();t.replaceRange("",Ue(e.line,0),e,"+delete")},undo:function(t){t.undo()},redo:function(t){t.redo()},goDocStart:function(t){t.extendSelection(Ue(t.firstLine(),0))},goDocEnd:function(t){t.extendSelection(Ue(t.lastLine()))},goLineStart:function(t){t.extendSelection(vr(t,t.getCursor().line))},goLineStartSmart:function(t){var e=t.getCursor(),i=vr(t,e.line),n=t.getLineHandle(i.line),r=bn(n);if(r&&0!=r[0].level)t.extendSelection(i);else{var o=Math.max(0,n.text.search(/\S/)),s=e.line==i.line&&e.ch<=o&&e.ch;t.extendSelection(Ue(i.line,s?0:o))}},goLineEnd:function(t){t.extendSelection(yr(t,t.getCursor().line))},goLineRight:function(t){var e=t.charCoords(t.getCursor(),"div").top+5;t.extendSelection(t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:e},"div"))},goLineLeft:function(t){var e=t.charCoords(t.getCursor(),"div").top+5;t.extendSelection(t.coordsChar({left:0,top:e},"div"))},goLineUp:function(t){t.moveV(-1,"line")},goLineDown:function(t){t.moveV(1,"line")},goPageUp:function(t){t.moveV(-1,"page")},goPageDown:function(t){t.moveV(1,"page")},goCharLeft:function(t){t.moveH(-1,"char")},goCharRight:function(t){t.moveH(1,"char")},goColumnLeft:function(t){t.moveH(-1,"column")},goColumnRight:function(t){t.moveH(1,"column")},goWordLeft:function(t){t.moveH(-1,"word")},goGroupRight:function(t){t.moveH(1,"group")},goGroupLeft:function(t){t.moveH(-1,"group")},goWordRight:function(t){t.moveH(1,"word")},delCharBefore:function(t){t.deleteH(-1,"char")},delCharAfter:function(t){t.deleteH(1,"char")},delWordBefore:function(t){t.deleteH(-1,"word")},delWordAfter:function(t){t.deleteH(1,"word")},delGroupBefore:function(t){t.deleteH(-1,"group")},delGroupAfter:function(t){t.deleteH(1,"group")},indentAuto:function(t){t.indentSelection("smart")},indentMore:function(t){t.indentSelection("add")},indentLess:function(t){t.indentSelection("subtract")},insertTab:function(t){t.replaceSelection("	","end","+input")},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.replaceSelection("	","end","+input")},transposeChars:function(t){var e=t.getCursor(),i=t.getLine(e.line);e.ch>0&&e.ch<i.length-1&&t.replaceRange(i.charAt(e.ch)+i.charAt(e.ch-1),Ue(e.line,e.ch-1),Ue(e.line,e.ch+1))},newlineAndIndent:function(t){se(t,function(){t.replaceSelection("\n","end","+input"),t.indentLine(t.getCursor().line,null,!0)})()},toggleOverwrite:function(t){t.toggleOverwrite()}},fo=t.keyMap={};fo.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},fo.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},fo.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft",fallthrough:["basic","emacsy"]},fo["default"]=Wr?fo.macDefault:fo.pcDefault,fo.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},t.lookupKey=xi,t.isModifierKey=wi,t.keyName=_i,t.fromTextArea=function(e,i){function n(){e.value=u.getValue()}if(i||(i={}),i.value=e.value,!i.tabindex&&e.tabindex&&(i.tabindex=e.tabindex),!i.placeholder&&e.placeholder&&(i.placeholder=e.placeholder),null==i.autofocus){var r=document.body;try{r=document.activeElement}catch(o){}i.autofocus=r==e||null!=e.getAttribute("autofocus")&&r==document.body}if(e.form&&(En(e.form,"submit",n),!i.leaveSubmitMethodAlone)){var s=e.form,a=s.submit;try{var l=s.submit=function(){n(),s.submit=a,s.submit(),s.submit=l}}catch(o){}}e.style.display="none";var u=t(function(t){e.parentNode.insertBefore(t,e.nextSibling)},i);return u.save=n,u.getTextArea=function(){return e},u.toTextArea=function(){n(),e.parentNode.removeChild(u.getWrapperElement()),e.style.display="",e.form&&(Wn(e.form,"submit",n),"function"==typeof e.form.submit&&(e.form.submit=a))},u},Ci.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(t){var e=this.string.charAt(this.pos);if("string"==typeof t)var i=e==t;else var i=e&&(t.test?t.test(e):t(e));
return i?(++this.pos,e):void 0},eatWhile:function(t){for(var e=this.pos;this.eat(t););return this.pos>e},eatSpace:function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},skipToEnd:function(){this.pos=this.string.length},skipTo:function(t){var e=this.string.indexOf(t,this.pos);return e>-1?(this.pos=e,!0):void 0},backUp:function(t){this.pos-=t},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Vn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return Vn(this.string,null,this.tabSize)},match:function(t,e,i){if("string"!=typeof t){var n=this.string.slice(this.pos).match(t);return n&&n.index>0?null:(n&&e!==!1&&(this.pos+=n[0].length),n)}var r=function(t){return i?t.toLowerCase():t},o=this.string.substr(this.pos,t.length);return r(o)==r(t)?(e!==!1&&(this.pos+=t.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},t.StringStream=Ci,t.TextMarker=ki,Un(ki),ki.prototype.clear=function(){if(!this.explicitlyCleared){var t=this.doc.cm,e=t&&!t.curOp;if(e&&re(t),qn(this,"clear")){var i=this.find();i&&Rn(this,"clear",i.from,i.to)}for(var n=null,r=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Li(s.markedSpans,this);null!=a.to&&(r=mn(s)),s.markedSpans=Oi(s.markedSpans,a),null!=a.from?n=mn(s):this.collapsed&&!zi(this.doc,s)&&t&&gn(s,ie(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var o=0;o<this.lines.length;++o){var l=Wi(t.doc,this.lines[o]),u=c(t.doc,l);u>t.display.maxLineLength&&(t.display.maxLine=l,t.display.maxLineLength=u,t.display.maxLineChanged=!0)}null!=n&&t&&ue(t,n,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&ii(t)),e&&oe(t)}},ki.prototype.find=function(){for(var t,e,i=0;i<this.lines.length;++i){var n=this.lines[i],r=Li(n.markedSpans,this);if(null!=r.from||null!=r.to){var o=mn(n);null!=r.from&&(t=Ue(o,r.from)),null!=r.to&&(e=Ue(o,r.to))}}return"bookmark"==this.type?t:t&&{from:t,to:e}},ki.prototype.changed=function(){var t=this.find(),e=this.doc.cm;if(t&&e){var i=dn(this.doc,t.from.line);if(j(e,i),t.from.line>=e.display.showingFrom&&t.from.line<e.display.showingTo){for(var n=e.display.lineDiv.firstChild;n;n=n.nextSibling)if(n.lineObj==i){n.offsetHeight!=i.height&&gn(i,n.offsetHeight);break}le(e,function(){e.curOp.selectionChanged=e.curOp.forceUpdate=e.curOp.updateMaxLine=!0})}}},ki.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=Qn(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},ki.prototype.detachLine=function(t){if(this.lines.splice(Qn(this.lines,t),1),!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}},t.SharedTextMarker=Di,Un(Di),Di.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();Rn(this,"clear")}},Di.prototype.find=function(){return this.primary.find()};var po=t.LineWidget=function(t,e,i){if(i)for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);this.cm=t,this.node=e};Un(po),po.prototype.clear=qi(function(){var t=this.line.widgets,e=mn(this.line);if(null!=e&&t){for(var i=0;i<t.length;++i)t[i]==this&&t.splice(i--,1);t.length||(this.line.widgets=null);var n=yn(this.cm,this.line)<this.cm.doc.scrollTop;gn(this.line,Math.max(0,this.line.height-Ui(this))),n&&ui(this.cm,0,-this.height),ue(this.cm,e,e+1)}}),po.prototype.changed=qi(function(){var t=this.height;this.height=null;var e=Ui(this)-t;if(e){gn(this.line,this.line.height+e);var i=mn(this.line);ue(this.cm,i,i+1)}});var go=t.Line=function(t,e,i){this.text=t,Bi(this,e),this.height=i?i(this):1};Un(go);var mo={},vo=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;ln.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var i=t,n=t+e;n>i;++i){var r=this.lines[i];this.height-=r.height,Xi(r),Rn(r,"delete")}this.lines.splice(t,e)},collapse:function(t){t.splice.apply(t,[t.length,0].concat(this.lines))},insertInner:function(t,e,i){this.height+=i,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var n=0,r=e.length;r>n;++n)e[n].parent=this},iterN:function(t,e,i){for(var n=t+e;n>t;++t)if(i(this.lines[t]))return!0}},un.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){this.size-=e;for(var i=0;i<this.children.length;++i){var n=this.children[i],r=n.chunkSize();if(r>t){var o=Math.min(e,r-t),s=n.height;if(n.removeInner(t,o),this.height-=s-n.height,r==o&&(this.children.splice(i--,1),n.parent=null),0==(e-=o))break;t=0}else t-=r}if(this.size-e<25){var a=[];this.collapse(a),this.children=[new ln(a)],this.children[0].parent=this}},collapse:function(t){for(var e=0,i=this.children.length;i>e;++e)this.children[e].collapse(t)},insertInner:function(t,e,i){this.size+=e.length,this.height+=i;for(var n=0,r=this.children.length;r>n;++n){var o=this.children[n],s=o.chunkSize();if(s>=t){if(o.insertInner(t,e,i),o.lines&&o.lines.length>50){for(;o.lines.length>50;){var a=o.lines.splice(o.lines.length-25,25),l=new ln(a);o.height-=l.height,this.children.splice(n+1,0,l),l.parent=this}this.maybeSpill()}break}t-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=t.children.splice(t.children.length-5,5),i=new un(e);if(t.parent){t.size-=i.size,t.height-=i.height;var n=Qn(t.parent.children,t);t.parent.children.splice(n+1,0,i)}else{var r=new un(t.children);r.parent=t,t.children=[r,i],t=r}i.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,e,i){for(var n=0,r=this.children.length;r>n;++n){var o=this.children[n],s=o.chunkSize();if(s>t){var a=Math.min(e,s-t);if(o.iterN(t,a,i))return!0;if(0==(e-=a))break;t=0}else t-=s}}};var yo=0,bo=t.Doc=function(t,e,i){if(!(this instanceof bo))return new bo(t,e,i);null==i&&(i=0),un.call(this,[new ln([new go("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=xn(),this.cleanGeneration=1,this.frontier=i;var n=Ue(i,0);this.sel={from:n,to:n,head:n,anchor:n,shift:!1,extend:!1,goalColumn:null},this.id=++yo,this.modeOption=e,"string"==typeof t&&(t=Po(t)),an(this,{from:n,to:n,text:t},null,{head:n,anchor:n})};bo.prototype=Jn(un.prototype,{constructor:bo,iter:function(t,e,i){i?this.iterN(t-this.first,e-t,i):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var i=0,n=0,r=e.length;r>n;++n)i+=e[n].height;this.insertInner(t-this.first,e,i)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=pn(this,this.first,this.first+this.size);return t===!1?e:e.join(t||"\n")},setValue:function(t){var e=Ue(this.first,0),i=this.first+this.size-1;Ee(this,{from:e,to:Ue(i,dn(this,i).text.length),text:Po(t),origin:"setValue"},{head:e,anchor:e},!0)},replaceRange:function(t,e,i,n){e=Ke(this,e),i=i?Ke(this,i):e,qe(this,t,e,i,n)},getRange:function(t,e,i){var n=fn(this,Ke(this,t),Ke(this,e));return i===!1?n:n.join(i||"\n")},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},setLine:function(t,e){Je(this,t)&&qe(this,e,Ue(t,0),Ke(this,Ue(t)))},removeLine:function(t){t?qe(this,"",Ke(this,Ue(t-1)),Ke(this,Ue(t))):qe(this,"",Ue(0,0),Ke(this,Ue(1,0)))},getLineHandle:function(t){return Je(this,t)?dn(this,t):void 0},getLineNumber:function(t){return mn(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=dn(this,t)),Wi(this,t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return Ke(this,t)},getCursor:function(t){var e=this.sel,i;return i=null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||t===!1?e.to:e.from,Xe(i)},somethingSelected:function(){return!Ye(this.sel.head,this.sel.anchor)},setCursor:ae(function(t,e,i){var n=Ke(this,"number"==typeof t?Ue(t,e||0):t);i?Ze(this,n):ei(this,n,n)}),setSelection:ae(function(t,e){ei(this,Ke(this,t),Ke(this,e||t))}),extendSelection:ae(function(t,e){Ze(this,Ke(this,t),e&&Ke(this,e))}),getSelection:function(t){return this.getRange(this.sel.from,this.sel.to,t)},replaceSelection:function(t,e,i){Ee(this,{from:this.sel.from,to:this.sel.to,text:Po(t),origin:i},e||"around")},undo:ae(function(){ze(this,"undo")}),redo:ae(function(){ze(this,"redo")}),setExtending:function(t){this.sel.extend=t},historySize:function(){var t=this.history;return{undo:t.done.length,redo:t.undone.length}},clearHistory:function(){this.history=xn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration()},changeGeneration:function(){return this.history.lastOp=this.history.lastOrigin=null,this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:Dn(this.history.done),undone:Dn(this.history.undone)}},setHistory:function(t){var e=this.history=xn(this.history.maxGeneration);e.done=t.done.slice(0),e.undone=t.undone.slice(0)},markText:function(t,e,i){return Si(this,Ke(this,t),Ke(this,e),i,"range")},setBookmark:function(t,e){var i={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft};return t=Ke(this,t),Si(this,t,t,i,"bookmark")},findMarksAt:function(t){t=Ke(this,t);var e=[],i=dn(this,t.line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=t.ch)&&(null==r.to||r.to>=t.ch)&&e.push(r.marker.parent||r.marker)}return e},getAllMarks:function(){var t=[];return this.iter(function(e){var i=e.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&t.push(i[n].marker)}),t},posFromIndex:function(t){var e,i=this.first;return this.iter(function(n){var r=n.text.length+1;return r>t?(e=t,!0):(t-=r,void++i)}),Ke(this,Ue(i,e))},indexFromPos:function(t){t=Ke(this,t);var e=t.ch;return t.line<this.first||t.ch<0?0:(this.iter(this.first,t.line,function(t){e+=t.text.length+1}),e)},copy:function(t){var e=new bo(pn(this,this.first,this.first+this.size),this.modeOption,this.first);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});var e=this.first,i=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<i&&(i=t.to);var n=new bo(pn(this,e,i),t.mode||this.modeOption,e);return t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],n},unlinkDoc:function(e){if(e instanceof t&&(e=e.doc),this.linked)for(var i=0;i<this.linked.length;++i){var n=this.linked[i];if(n.doc==e){this.linked.splice(i,1),e.unlinkDoc(this);break}}if(e.history==this.history){var r=[e.id];cn(e,function(t){r.push(t.id)},!0),e.history=xn(),e.history.done=Dn(this.history.done,r),e.history.undone=Dn(this.history.undone,r)}},iterLinkedDocs:function(t){cn(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),bo.prototype.eachLine=bo.prototype.iter;var xo="iter insert remove copy getEditor".split(" ");for(var wo in bo.prototype)bo.prototype.hasOwnProperty(wo)&&Qn(xo,wo)<0&&(t.prototype[wo]=function(t){return function(){return t.apply(this.doc,arguments)}}(bo.prototype[wo]));Un(bo),t.e_stop=Fn,t.e_preventDefault=Pn,t.e_stopPropagation=An;var _o,Co=0;t.on=En,t.off=Wn,t.signal=zn;var ko=30,So=t.Pass={toString:function(){return"CodeMirror.Pass"}};Yn.prototype={set:function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)}},t.countColumn=Vn;var Do=[""],To=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Lo=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;t.replaceGetRect=function(t){lr=t};var Oo=function(){if(Tr)return!1;var t=rr("div");return"draggable"in t||"dragDrop"in t}();kr?ur=function(t,e){return 36==t.charCodeAt(e-1)&&39==t.charCodeAt(e)}:Pr&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?ur=function(t,e){return/\-[^ \-?]|\?[^ !\'\"\),.\-\/:;\?\]\}]/.test(t.slice(e-1,e+1))}:Lr&&!/Chrome\/(?:29|[3-9]\d|\d\d\d)\./.test(navigator.userAgent)&&(ur=function(t,e){if(e>1&&45==t.charCodeAt(e-1)){if(/\w/.test(t.charAt(e-2))&&/[^\-?\.]/.test(t.charAt(e)))return!0;if(e>2&&/[\d\.,]/.test(t.charAt(e-2))&&/[\d\.,]/.test(t.charAt(e)))return!1}return/[~!#%&*)=+}\]|\"\.>,:;][({[<]|-[^\-?\.\u2010-\u201f\u2026]|\?[\w~`@#$%\^&*(_=+{[|><]|…[\w~`@#$%\^&*(_=+{[><]/.test(t.slice(e-1,e+1))});var Mo,Io,Po=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,i=[],n=t.length;n>=e;){var r=t.indexOf("\n",e);-1==r&&(r=t.length);var o=t.slice(e,"\r"==t.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),e+=s+1):(i.push(o),e=r+1)}return i}:function(t){return t.split(/\r\n?|\n/)};t.splitLines=Po;var Ao=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(e){return!1}}:function(t){try{var e=t.ownerDocument.selection.createRange()}catch(i){}return e&&e.parentElement()==t?0!=e.compareEndPoints("StartToEnd",e):!1},No=function(){var t=rr("div");return"oncopy"in t?!0:(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)}(),Fo={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};t.keyNames=Fo,function(){for(var t=0;10>t;t++)Fo[t+48]=String(t);for(var t=65;90>=t;t++)Fo[t]=String.fromCharCode(t);for(var t=1;12>=t;t++)Fo[t+111]=Fo[t+63235]="F"+t}();var Ho,$o=function(){function t(t){return 255>=t?e.charAt(t):t>=1424&&1524>=t?"R":t>=1536&&1791>=t?i.charAt(t-1536):t>=1792&&2220>=t?"r":"L"}var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",i="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/,l="L";return function(e){if(!n.test(e))return!1;for(var i=e.length,u=[],c=0,h;i>c;++c)u.push(h=t(e.charCodeAt(c)));for(var c=0,d=l;i>c;++c){var h=u[c];"m"==h?u[c]=d:d=h}for(var c=0,f=l;i>c;++c){var h=u[c];"1"==h&&"r"==f?u[c]="n":o.test(h)&&(f=h,"r"==h&&(u[c]="R"))}for(var c=1,d=u[0];i-1>c;++c){var h=u[c];"+"==h&&"1"==d&&"1"==u[c+1]?u[c]="1":","!=h||d!=u[c+1]||"1"!=d&&"n"!=d||(u[c]=d),d=h}for(var c=0;i>c;++c){var h=u[c];if(","==h)u[c]="N";else if("%"==h){for(var p=c+1;i>p&&"%"==u[p];++p);for(var g=c&&"!"==u[c-1]||i-1>p&&"1"==u[p]?"1":"N",m=c;p>m;++m)u[m]=g;c=p-1}}for(var c=0,f=l;i>c;++c){var h=u[c];"L"==f&&"1"==h?u[c]="L":o.test(h)&&(f=h)}for(var c=0;i>c;++c)if(r.test(u[c])){for(var p=c+1;i>p&&r.test(u[p]);++p);for(var v="L"==(c?u[c-1]:l),y="L"==(i-1>p?u[p]:l),g=v||y?"L":"R",m=c;p>m;++m)u[m]=g;c=p-1}for(var b=[],x,c=0;i>c;)if(s.test(u[c])){var w=c;for(++c;i>c&&s.test(u[c]);++c);b.push({from:w,to:c,level:0})}else{var _=c,C=b.length;for(++c;i>c&&"L"!=u[c];++c);for(var m=_;c>m;)if(a.test(u[m])){m>_&&b.splice(C,0,{from:_,to:m,level:1});var k=m;for(++m;c>m&&a.test(u[m]);++m);b.splice(C,0,{from:k,to:m,level:2}),_=m}else++m;c>_&&b.splice(C,0,{from:_,to:c,level:1})}return 1==b[0].level&&(x=e.match(/^\s+/))&&(b[0].from=x[0].length,b.unshift({from:0,to:x[0].length,level:0})),1==Gn(b).level&&(x=e.match(/\s+$/))&&(Gn(b).to-=x[0].length,b.push({from:i-x[0].length,to:i,level:0})),b[0].level!=Gn(b).level&&b.push({from:i,to:i,level:b[0].level}),b}}();return t.version="3.15.0",t}(),function(){"use strict";var t=/^(\s*)([*+-]|(\d+)\.)(\s*)/,e="*+-";CodeMirror.commands.newlineAndIndentContinueMarkdownList=function(i){var n=i.getCursor(),r=i.getStateAfter(n.line).list,o;if(!r||!(o=i.getLine(n.line).match(t)))return void i.execCommand("newlineAndIndent");var s=o[1],a=o[4],l=e.indexOf(o[2])>=0?o[2]:parseInt(o[3],10)+1+".";i.replaceSelection("\n"+s+l+a,"end")}}(),CodeMirror.defineMode("markdown",function(t,e){function i(t,e,i){return e.f=e.inline=i,i(t,e)}function n(t,e,i){return e.f=e.block=i,i(t,e)}function r(t){return t.linkTitle=!1,t.em=!1,t.strong=!1,t.quote=0,m||t.f!=s||(t.f=c,t.block=o),t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.thisLineHasContent=!1,null}function o(t,r){var o=r.list!==!1;if(r.list!==!1&&r.indentationDiff>=0?(r.indentationDiff<4&&(r.indentation-=r.indentationDiff),r.list=null):r.list!==!1&&r.indentation>0?(r.list=null,r.listDepth=Math.floor(r.indentation/4)):r.list!==!1&&(r.list=!1,r.listDepth=0),r.indentationDiff>=4)return r.indentation-=4,t.skipToEnd(),_;if(t.eatSpace())return null;if("#"===t.peek()||r.prevLineHasContent&&t.match(R))r.header=!0;else if(t.eat(">"))for(r.indentation++,r.quote=1,t.eatSpace();t.eat(">");)t.eatSpace(),r.quote++;else{if("["===t.peek())return i(t,r,d);if(t.match(H,!0))return L;if(r.prevLineHasContent&&!o||!t.match(E,!0)&&!t.match(W,!0)){if(e.fencedCodeBlocks&&t.match(/^```([\w+#]*)/,!0))return r.localMode=b(RegExp.$1),r.localMode&&(r.localState=r.localMode.startState()),n(t,r,a),_}else r.indentation+=4,r.list=!0,r.listDepth++,e.taskLists&&t.match(z,!1)&&(r.taskList=!0)}return i(t,r,r.inline)}function s(t,e){var i=v.token(t,e.htmlState);return m&&"tag"===i&&"openTag"!==e.htmlState.type&&!e.htmlState.context&&(e.f=c,e.block=o),e.md_inside&&-1!=t.current().indexOf(">")&&(e.f=c,e.block=o,e.htmlState.context=void 0),i}function a(t,e){return t.sol()&&t.match(/^```/,!0)?(e.localMode=e.localState=null,e.f=c,e.block=o,_):e.localMode?e.localMode.token(t,e.localState):(t.skipToEnd(),_)}function l(t){var e=[];if(t.taskOpen)return"meta";if(t.taskClosed)return"property";if(t.strong&&e.push(F),t.em&&e.push(N),t.linkText&&e.push(P),t.code&&e.push(_),t.header&&e.push(w),t.quote&&e.push(t.quote%2?C:k),t.list!==!1){var i=(t.listDepth-1)%3;e.push(i?1===i?D:T:S)}return t.trailingSpaceNewLine?e.push("trailing-space-new-line"):t.trailingSpace&&e.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),e.length?e.join(" "):null}function u(t,e){return t.match(j,!0)?l(e):void 0}function c(t,r){var o=r.text(t,r);if("undefined"!=typeof o)return o;if(r.list)return r.list=null,l(r);if(r.taskList){var a="x"!==t.match(z,!0)[1];return a?r.taskOpen=!0:r.taskClosed=!0,r.taskList=!1,l(r)}r.taskOpen=!1,r.taskClosed=!1;var u=t.next();if("\\"===u)return t.next(),l(r);if(r.linkTitle){r.linkTitle=!1;var c=u;"("===u&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var d="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c;if(t.match(new RegExp(d),!0))return A}if("`"===u){var f=l(r),p=t.pos;t.eatWhile("`");var m=1+t.pos-p;return r.code?m===x?(r.code=!1,f):l(r):(x=m,r.code=!0,l(r))}if(r.code)return l(r);if("!"===u&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return t.match(/\[[^\]]*\]/),r.inline=r.f=h,O;if("["===u&&t.match(/.*\](\(| ?\[)/,!1))return r.linkText=!0,l(r);if("]"===u&&r.linkText){var v=l(r);return r.linkText=!1,r.inline=r.f=h,v}if("<"===u&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return i(t,r,g(M,">"));if("<"===u&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return i(t,r,g(I,">"));if("<"===u&&t.match(/^\w/,!1)){if(-1!=t.string.indexOf(">")){var y=t.string.substring(1,t.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(y)&&(r.md_inside=!0)}return t.backUp(1),n(t,r,s)}if("<"===u&&t.match(/^\/\w*?>/))return r.md_inside=!1,"tag";var b=!1;if(!e.underscoresBreakWords&&"_"===u&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var w=t.pos-2;if(w>=0){var _=t.string.charAt(w);"_"!==_&&_.match(/(\w)/,!1)&&(b=!0)}}var f=l(r);if("*"===u||"_"===u&&!b){if(r.strong===u&&t.eat(u))return r.strong=!1,f;if(!r.strong&&t.eat(u))return r.strong=u,l(r);if(r.em===u)return r.em=!1,f;if(!r.em)return r.em=u,l(r)}else if(" "===u&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return l(r);t.backUp(1)}return" "===u&&(t.match(/ +$/,!1)?r.trailingSpace++:r.trailingSpace&&(r.trailingSpaceNewLine=!0)),l(r)}function h(t,e){if(t.eatSpace())return null;var n=t.next();return"("===n||"["===n?i(t,e,g(A,"("===n?")":"]")):"error"}function d(t,e){return t.match(/^[^\]]*\]:/,!0)?(e.f=f,P):i(t,e,c)}function f(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),e.f=e.inline=c,A)}function p(t){return B[t]||(t=(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),B[t]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+t+")")),B[t]}function g(t,e,i){return i=i||c,function(n,r){return n.match(p(e)),r.inline=r.f=i,t}}var m=CodeMirror.modes.hasOwnProperty("xml"),v=CodeMirror.getMode(t,m?{name:"xml",htmlMode:!0}:"text/plain"),y={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},b=function(){var e,i={},n={},r,o=[];for(var s in CodeMirror.modes)CodeMirror.modes.propertyIsEnumerable(s)&&o.push(s);for(e=0;e<o.length;e++)i[o[e]]=o[e];var a=[];for(var s in CodeMirror.mimeModes)CodeMirror.mimeModes.propertyIsEnumerable(s)&&a.push({mime:s,mode:CodeMirror.mimeModes[s]});for(e=0;e<a.length;e++)r=a[e].mime,n[r]=a[e].mime;for(var l in y)(y[l]in i||y[l]in n)&&(i[l]=y[l]);return function(e){return i[e]?CodeMirror.getMode(t,i[e]):null}}();void 0===e.underscoresBreakWords&&(e.underscoresBreakWords=!0),void 0===e.fencedCodeBlocks&&(e.fencedCodeBlocks=!1),void 0===e.taskLists&&(e.taskLists=!1);var x=0,w="header",_="comment",C="atom",k="number",S="variable-2",D="variable-3",T="keyword",L="hr",O="tag",M="link",I="link",P="link",A="string",N="em",F="strong",H=/^([*\-=_])(?:\s*\1){2,}\s*$/,E=/^[*\-+]\s+/,W=/^[0-9]+\.\s+/,z=/^\[(x| )\](?=\s)/,R=/^(?:\={1,}|-{1,})$/,j=/^[^!\[\]*_\\<>` "'(]+/,B=[];return{startState:function(){return{f:o,prevLineHasContent:!1,thisLineHasContent:!1,block:o,htmlState:CodeMirror.startState(v),indentation:0,inline:c,text:u,linkText:!1,linkTitle:!1,em:!1,strong:!1,header:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(t){return{f:t.f,prevLineHasContent:t.prevLineHasContent,thisLineHasContent:t.thisLineHasContent,block:t.block,htmlState:CodeMirror.copyState(v,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?CodeMirror.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,linkTitle:t.linkTitle,em:t.em,strong:t.strong,header:t.header,taskList:t.taskList,list:t.list,listDepth:t.listDepth,quote:t.quote,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside}},token:function(t,e){if(t.sol()){if(t.match(/^\s*$/,!0))return e.prevLineHasContent=!1,r(e);e.prevLineHasContent=e.thisLineHasContent,e.thisLineHasContent=!0,e.header=!1,e.taskList=!1,e.code=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.f=e.block;var i=t.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,n=4*Math.floor((i-e.indentation)/4);n>4&&(n=4);var o=e.indentation+n;if(e.indentationDiff=o-e.indentation,e.indentation=o,i>0)return null}return e.f(t,e)},blankLine:r,getType:l}},"xml"),CodeMirror.defineMIME("text/x-markdown","markdown"),function(){function t(t){this.tokens=[],this.tokens.links={},this.options=t||a.defaults,this.rules=l.normal,this.options.gfm&&(this.rules=this.options.tables?l.tables:l.gfm)}function e(t,e){if(this.options=e||a.defaults,this.links=t,this.rules=u.normal,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?u.breaks:u.gfm:this.options.pedantic&&(this.rules=u.pedantic)}function i(t){this.tokens=[],this.token=null,this.options=t||a.defaults}function n(t,e){return t.replace(e?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function r(t,e){return t=t.source,e=e||"",function i(n,r){return n?(r=r.source||r,r=r.replace(/(^|[^\[])\^/g,"$1"),t=t.replace(n,r),i):new RegExp(t,e)}}function o(){}function s(t){for(var e=1,i,n;e<arguments.length;e++){i=arguments[e];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}function a(e,r,o){if(o||"function"==typeof r){o||(o=r,r=null),r=s({},a.defaults,r||{});var l=r.highlight,u,c,h=0;try{u=t.lex(e,r)}catch(d){return o(d)}c=u.length;var f=function(){var t,e;try{t=i.parse(u,r)}catch(n){e=n}return r.highlight=l,e?o(e):o(null,t)};if(!l||l.length<3)return f();if(delete r.highlight,!c)return f();for(;h<u.length;h++)!function(t){return"code"!==t.type?--c||f():l(t.text,t.lang,function(e,i){return null==i||i===t.text?--c||f():(t.text=i,t.escaped=!0,void(--c||f()))})}(u[h])}else try{return r&&(r=s({},a.defaults,r)),i.parse(t.lex(e,r),r)}catch(d){if(d.message+="\nPlease report this to https://github.com/chjj/marked.",(r||a.defaults).silent)return"<p>An error occured:</p><pre>"+n(d.message+"",!0)+"</pre>";throw d}}var l={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:o,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:o,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:o,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};l.bullet=/(?:[*+-]|\d+\.)/,l.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,l.item=r(l.item,"gm")(/bull/g,l.bullet)(),l.list=r(l.list)(/bull/g,l.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),l._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",l.html=r(l.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,l._tag)(),l.paragraph=r(l.paragraph)("hr",l.hr)("heading",l.heading)("lheading",l.lheading)("blockquote",l.blockquote)("tag","<"+l._tag)("def",l.def)(),l.normal=s({},l),l.gfm=s({},l.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),l.gfm.paragraph=r(l.paragraph)("(?!","(?!"+l.gfm.fences.source.replace("\\1","\\2")+"|"+l.list.source.replace("\\1","\\3")+"|")(),l.tables=s({},l.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),t.rules=l,t.lex=function(e,i){var n=new t(i);return n.lex(e)},t.prototype.lex=function(t){return t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(t,!0)},t.prototype.token=function(t,e){for(var t=t.replace(/^ +$/gm,""),i,n,r,o,s,a,u,c,h;t;)if((r=this.rules.newline.exec(t))&&(t=t.substring(r[0].length),r[0].length>1&&this.tokens.push({type:"space"})),r=this.rules.code.exec(t))t=t.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?r:r.replace(/\n+$/,"")});else if(r=this.rules.fences.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"code",lang:r[2],text:r[3]});else if(r=this.rules.heading.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"heading",depth:r[1].length,text:r[2]});else if(e&&(r=this.rules.nptable.exec(t))){for(t=t.substring(r[0].length),a={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/\n$/,"").split("\n")},c=0;c<a.align.length;c++)a.align[c]=/^ *-+: *$/.test(a.align[c])?"right":/^ *:-+: *$/.test(a.align[c])?"center":/^ *:-+ *$/.test(a.align[c])?"left":null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].split(/ *\| */);this.tokens.push(a)}else if(r=this.rules.lheading.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"heading",depth:"="===r[2]?1:2,text:r[1]});else if(r=this.rules.hr.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"hr"});else if(r=this.rules.blockquote.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"blockquote_start"}),r=r[0].replace(/^ *> ?/gm,""),this.token(r,e),this.tokens.push({type:"blockquote_end"});else if(r=this.rules.list.exec(t)){for(t=t.substring(r[0].length),o=r[2],this.tokens.push({type:"list_start",ordered:o.length>1}),r=r[0].match(this.rules.item),i=!1,h=r.length,c=0;h>c;c++)a=r[c],u=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(u-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+u+"}","gm"),"")),this.options.smartLists&&c!==h-1&&(s=l.bullet.exec(r[c+1])[0],o===s||o.length>1&&s.length>1||(t=r.slice(c+1).join("\n")+t,c=h-1)),n=i||/\n\n(?!\s*$)/.test(a),c!==h-1&&(i="\n"===a.charAt(a.length-1),n||(n=i)),this.tokens.push({type:n?"loose_item_start":"list_item_start"}),this.token(a,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(r=this.rules.html.exec(t))t=t.substring(r[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===r[1]||"script"===r[1]||"style"===r[1],text:r[0]});else if(e&&(r=this.rules.def.exec(t)))t=t.substring(r[0].length),this.tokens.links[r[1].toLowerCase()]={href:r[2],title:r[3]};else if(e&&(r=this.rules.table.exec(t))){for(t=t.substring(r[0].length),a={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<a.align.length;c++)a.align[c]=/^ *-+: *$/.test(a.align[c])?"right":/^ *:-+: *$/.test(a.align[c])?"center":/^ *:-+ *$/.test(a.align[c])?"left":null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(a)}else if(e&&(r=this.rules.paragraph.exec(t)))t=t.substring(r[0].length),this.tokens.push({type:"paragraph",text:"\n"===r[1].charAt(r[1].length-1)?r[1].slice(0,-1):r[1]});else if(r=this.rules.text.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"text",text:r[0]});else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return this.tokens};var u={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:o,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:o,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};u._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,u._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,u.link=r(u.link)("inside",u._inside)("href",u._href)(),u.reflink=r(u.reflink)("inside",u._inside)(),u.normal=s({},u),u.pedantic=s({},u.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),u.gfm=s({},u.normal,{escape:r(u.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:r(u.text)("]|","~]|")("|","|https?://|")()}),u.breaks=s({},u.gfm,{br:r(u.br)("{2,}","*")(),text:r(u.gfm.text)("{2,}","*")()}),e.rules=u,e.output=function(t,i,n){var r=new e(i,n);
return r.output(t)},e.prototype.output=function(t){for(var e="",i,r,o,s;t;)if(s=this.rules.escape.exec(t))t=t.substring(s[0].length),e+=s[1];else if(s=this.rules.autolink.exec(t))t=t.substring(s[0].length),"@"===s[2]?(r=this.mangle(":"===s[1].charAt(6)?s[1].substring(7):s[1]),o=this.mangle("mailto:")+r):(r=n(s[1]),o=r),e+='<a href="'+o+'">'+r+"</a>";else if(s=this.rules.url.exec(t))t=t.substring(s[0].length),r=n(s[1]),o=r,e+='<a href="'+o+'">'+r+"</a>";else if(s=this.rules.tag.exec(t))t=t.substring(s[0].length),e+=this.options.sanitize?n(s[0]):s[0];else if(s=this.rules.link.exec(t))t=t.substring(s[0].length),e+=this.outputLink(s,{href:s[2],title:s[3]});else if((s=this.rules.reflink.exec(t))||(s=this.rules.nolink.exec(t))){if(t=t.substring(s[0].length),i=(s[2]||s[1]).replace(/\s+/g," "),i=this.links[i.toLowerCase()],!i||!i.href){e+=s[0].charAt(0),t=s[0].substring(1)+t;continue}e+=this.outputLink(s,i)}else if(s=this.rules.strong.exec(t))t=t.substring(s[0].length),e+="<strong>"+this.output(s[2]||s[1])+"</strong>";else if(s=this.rules.em.exec(t))t=t.substring(s[0].length),e+="<em>"+this.output(s[2]||s[1])+"</em>";else if(s=this.rules.code.exec(t))t=t.substring(s[0].length),e+="<code>"+n(s[2],!0)+"</code>";else if(s=this.rules.br.exec(t))t=t.substring(s[0].length),e+="<br>";else if(s=this.rules.del.exec(t))t=t.substring(s[0].length),e+="<del>"+this.output(s[1])+"</del>";else if(s=this.rules.text.exec(t))t=t.substring(s[0].length),e+=n(this.smartypants(s[0]));else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return e},e.prototype.outputLink=function(t,e){return"!"!==t[0].charAt(0)?'<a href="'+n(e.href)+'"'+(e.title?' title="'+n(e.title)+'"':"")+">"+this.output(t[1])+"</a>":'<img src="'+n(e.href)+'" alt="'+n(t[1])+'"'+(e.title?' title="'+n(e.title)+'"':"")+">"},e.prototype.smartypants=function(t){return this.options.smartypants?t.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):t},e.prototype.mangle=function(t){for(var e="",i=t.length,n=0,r;i>n;n++)r=t.charCodeAt(n),Math.random()>.5&&(r="x"+r.toString(16)),e+="&#"+r+";";return e},i.parse=function(t,e){var n=new i(e);return n.parse(t)},i.prototype.parse=function(t){this.inline=new e(t.links,this.options),this.tokens=t.reverse();for(var i="";this.next();)i+=this.tok();return i},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var t=this.token.text;"text"===this.peek().type;)t+="\n"+this.next().text;return this.inline.output(t)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+' id="'+this.token.text.toLowerCase().replace(/[^\w]+/g,"-")+'">'+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var t=this.options.highlight(this.token.text,this.token.lang);null!=t&&t!==this.token.text&&(this.token.escaped=!0,this.token.text=t)}return this.token.escaped||(this.token.text=n(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"table":var e="",i,r,o,s,a;for(e+="<thead>\n<tr>\n",r=0;r<this.token.header.length;r++)i=this.inline.output(this.token.header[r]),e+="<th",this.token.align[r]&&(e+=' style="text-align:'+this.token.align[r]+'"'),e+=">"+i+"</th>\n";for(e+="</tr>\n</thead>\n",e+="<tbody>\n",r=0;r<this.token.cells.length;r++){for(o=this.token.cells[r],e+="<tr>\n",a=0;a<o.length;a++)s=this.inline.output(o[a]),e+="<td",this.token.align[a]&&(e+=' style="text-align:'+this.token.align[a]+'"'),e+=">"+s+"</td>\n";e+="</tr>\n"}return e+="</tbody>\n","<table>\n"+e+"</table>\n";case"blockquote_start":for(var e="";"blockquote_end"!==this.next().type;)e+=this.tok();return"<blockquote>\n"+e+"</blockquote>\n";case"list_start":for(var l=this.token.ordered?"ol":"ul",e="";"list_end"!==this.next().type;)e+=this.tok();return"<"+l+">\n"+e+"</"+l+">\n";case"list_item_start":for(var e="";"list_item_end"!==this.next().type;)e+="text"===this.token.type?this.parseText():this.tok();return"<li>"+e+"</li>\n";case"loose_item_start":for(var e="";"list_item_end"!==this.next().type;)e+=this.tok();return"<li>"+e+"</li>\n";case"html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case"paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}},o.exec=o,a.options=a.setOptions=function(t){return s(a.defaults,t),a},a.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1},a.Parser=i,a.parser=i.parse,a.Lexer=t,a.lexer=t.lex,a.InlineLexer=e,a.inlineLexer=e.output,a.parse=a,"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):this.marked=a}.call(function(){return this||("undefined"!=typeof window?window:global)}()),function($,t,e){"use strict";if(typeof t===e)throw new Error("Can't find Editor!");$.fn.sharp_markdown=function(e){var i={},n=$.extend(i,e);return this.each(function(e,i){var r;n.element=i,r=new t(n),$(i).data("editor",r),r.render()})}}(this.jQuery,this.Editor),$(window).load(function(){$("textarea.sharp-markdown").each(function(){createSharpMarkdown($(this))})});var config_to_toolbar={B:["bold",toggleBold],I:["italic",toggleItalic],Q:["quote",toggleBlockquote],U:["unordered-list",toggleUnOrderedList],O:["ordered-list",toggleOrderedList],L:["link",drawLink],G:["image",drawImage],P:["preview",togglePreview],F:["fullscreen",toggleFullScreen]},defaultToolbar="";!function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){var t=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};t.prototype.tokenize=function(t){if(t=n(String(t||"").toLowerCase()),!t||!t.length)return[];var e,i,o,a,l=[],u=t.split(/ +/);for(e=0,i=u.length;i>e;e++){if(o=r(u[e]),this.settings.diacritics)for(a in s)s.hasOwnProperty(a)&&(o=o.replace(new RegExp(a,"g"),s[a]));l.push({string:u[e],regex:new RegExp(o,"i")})}return l},t.prototype.iterator=function(t,e){var i;i=o(t)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;i>e;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)},i.apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var i,n,r,o;i=this,t=i.prepareSearch(t,e),r=t.tokens,n=t.options.fields,o=r.length;var s=function(t,e){var i,n;return t?(t=String(t||""),n=t.search(e.regex),-1===n?0:(i=e.string.length/t.length,0===n&&(i+=.5),i)):0},a=function(){var t=n.length;return t?1===t?function(t,e){return s(e[n[0]],t)}:function(e,i){for(var r=0,o=0;t>r;r++)o+=s(i[n[r]],e);return o/t}:function(){return 0}}();return o?1===o?function(t){return a(r[0],t)}:"and"===t.options.conjunction?function(t){for(var e,i=0,n=0;o>i;i++){if(e=a(r[i],t),0>=e)return 0;n+=e}return n/o}:function(t){for(var e=0,i=0;o>e;e++)i+=a(r[e],t);return i/o}:function(){return 0}},t.prototype.getSortFunction=function(t,i){var n,r,o,s,a,l,u,c,h,d,f;if(o=this,t=o.prepareSearch(t,i),f=!t.query&&i.sort_empty||i.sort,h=function(t,e){return"$score"===t?e.score:o.items[e.id][t]},a=[],f)for(n=0,r=f.length;r>n;n++)(t.query||"$score"!==f[n].field)&&a.push(f[n]);if(t.query){for(d=!0,n=0,r=a.length;r>n;n++)if("$score"===a[n].field){d=!1;break}d&&a.unshift({field:"$score",direction:"desc"})}else for(n=0,r=a.length;r>n;n++)if("$score"===a[n].field){a.splice(n,1);break}for(c=[],n=0,r=a.length;r>n;n++)c.push("desc"===a[n].direction?-1:1);return l=a.length,l?1===l?(s=a[0].field,u=c[0],function(t,i){return u*e(h(s,t),h(s,i))}):function(t,i){var n,r,o,s,u;for(n=0;l>n;n++)if(u=a[n].field,r=c[n]*e(h(u,t),h(u,i)))return r;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;e=i({},e);var n=e.fields,r=e.sort,s=e.sort_empty;return n&&!o(n)&&(e.fields=[n]),r&&!o(r)&&(e.sort=[r]),s&&!o(s)&&(e.sort_empty=[s]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var i=this,n,r,o,s,a,l;return o=this.prepareSearch(t,e),e=o.options,t=o.query,l=e.score||i.getScoreFunction(o),t.length?i.iterator(i.items,function(t,i){r=l(t),(e.filter===!1||r>0)&&o.items.push({score:r,id:i})}):i.iterator(i.items,function(t,e){o.items.push({score:1,id:e})}),a=i.getSortFunction(o,e),a&&o.items.sort(a),o.total=o.items.length,"number"==typeof e.limit&&(o.items=o.items.slice(0,e.limit)),o};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:e>t?-1:0:(t=String(t||"").toLowerCase(),e=String(e||"").toLowerCase(),t>e?1:e>t?-1:0)},i=function(t,e){var i,n,r,o;for(i=1,n=arguments.length;n>i;i++)if(o=arguments[i])for(r in o)o.hasOwnProperty(r)&&(t[r]=o[r]);return t},n=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},r=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},o=Array.isArray||$&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚ]",i:"[iÌÍÎÏìíîï]",n:"[nÑñňŇ]",o:"[oÒÓÔÕÕÖØòóôõöø]",r:"[rřŘ]",s:"[sŠš]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮ]",y:"[yŸÿýÝ]",z:"[zŽž]"};return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={};t.mixin=function(t){t.plugins={},t.prototype.initializePlugins=function(t){var i,n,r,o=this,s=[];if(o.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(i=0,n=t.length;n>i;i++)"string"==typeof t[i]?s.push(t[i]):(o.plugins.settings[t[i].name]=t[i].options,s.push(t[i].name));else if(t)for(r in t)t.hasOwnProperty(r)&&(o.plugins.settings[r]=t[r],s.push(r));for(;s.length;)o.require(s.shift())},t.prototype.loadPlugin=function(e){var i=this,n=i.plugins,r=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=r.fn.apply(i,[i.plugins.settings[e]||{}]),n.names.push(e)},t.prototype.require=function(t){var e=this,i=e.plugins;if(!e.plugins.loaded.hasOwnProperty(t)){if(i.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');e.loadPlugin(t)}return i.loaded[t]},t.define=function(e,i){t.plugins[e]={name:e,fn:i}}};var e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function($,t,e){"use strict";var i=function(t,e){if("string"!=typeof e||e.length){var i="string"==typeof e?new RegExp(e,"i"):e,n=function(t){var e=0;if(3===t.nodeType){var r=t.data.search(i);if(r>=0&&t.data.length>0){var o=t.data.match(i),s=document.createElement("span");s.className="highlight";var a=t.splitText(r),l=a.splitText(o[0].length),u=a.cloneNode(!0);s.appendChild(u),a.parentNode.replaceChild(s,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var c=0;c<t.childNodes.length;++c)c+=n(t.childNodes[c]);return e};return t.each(function(){n(this)})}},n=function(){};n.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(t){for(var e=["on","off","trigger"],i=0;i<e.length;i++)t.prototype[e[i]]=n.prototype[e[i]]};var r=/Mac/.test(navigator.userAgent),o=65,s=188,a=13,l=27,u=37,c=38,h=80,d=39,f=40,p=78,g=8,m=46,v=16,y=r?91:17,b=r?18:17,x=9,w=1,_=2,C=function(t){return"undefined"!=typeof t},k=function(t){return"undefined"==typeof t||null===t?"":"boolean"==typeof t?t?"1":"0":t+""},S=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},D=function(t){return(t+"").replace(/\$/g,"$$$$")},T={};T.before=function(t,e,i){var n=t[e];t[e]=function(){return i.apply(t,arguments),n.apply(t,arguments)}},T.after=function(t,e,i){var n=t[e];t[e]=function(){var e=n.apply(t,arguments);return i.apply(t,arguments),e}};var L=function(t,e){if(!$.isArray(e))return e;var i,n,r={};for(i=0,n=e.length;n>i;i++)e[i].hasOwnProperty(t)&&(r[e[i][t]]=e[i]);return r},O=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},M=function(t,e){var i;return function(){var n=this,r=arguments;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(n,r)},e)}},I=function(t,e,i){var n,r=t.trigger,o={};t.trigger=function(){var i=arguments[0];return-1===e.indexOf(i)?r.apply(t,arguments):void(o[i]=arguments)},i.apply(t,[]),t.trigger=r;for(n in o)o.hasOwnProperty(n)&&r.apply(t,o[n])},P=function(t,e,i,n){t.on(e,i,function(e){for(var i=e.target;i&&i.parentNode!==t[0];)i=i.parentNode;return e.currentTarget=i,n.apply(this,[e])})},A=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var i=document.selection.createRange(),n=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-n,e.length=n}return e},N=function(t,e,i){var n,r,o={};if(i)for(n=0,r=i.length;r>n;n++)o[i[n]]=t.css(i[n]);else o=t.css();e.css(o)},F=function(t,e){if(!t)return 0;var i=$("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body");N(e,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var n=i.width();return i.remove(),n},H=function(t){var e=null,i=function(i,n){var r,o,s,a,l,u,c,h;i=i||window.event||{},n=n||{},i.metaKey||i.altKey||(n.force||t.data("grow")!==!1)&&(r=t.val(),i.type&&"keydown"===i.type.toLowerCase()&&(o=i.keyCode,s=o>=97&&122>=o||o>=65&&90>=o||o>=48&&57>=o||32===o,o===m||o===g?(h=A(t[0]),h.length?r=r.substring(0,h.start)+r.substring(h.start+h.length):o===g&&h.start?r=r.substring(0,h.start-1)+r.substring(h.start+1):o===m&&"undefined"!=typeof h.start&&(r=r.substring(0,h.start)+r.substring(h.start+1))):s&&(u=i.shiftKey,c=String.fromCharCode(i.keyCode),c=u?c.toUpperCase():c.toLowerCase(),r+=c)),a=t.attr("placeholder"),!r&&a&&(r=a),l=F(r,t)+4,l!==e&&(e=l,t.width(l),t.triggerHandler("resize")))};t.on("keydown keyup update blur",i),i()},E=function(e,i){var n,r,o,s,a,l=this;a=e[0],a.selectize=l,s=window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue("direction"):a.currentStyle&&a.currentStyle.direction,s=s||e.parents("[dir]:first").attr("dir")||"",$.extend(l,{settings:i,$input:e,tagType:"select"===a.tagName.toLowerCase()?w:_,rtl:/rtl/i.test(s),eventNS:".selectize"+ ++E.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:e.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===i.loadThrottle?l.onSearchChange:M(l.onSearchChange,i.loadThrottle)}),l.sifter=new t(this.options,{diacritics:i.diacritics}),$.extend(l.options,L(i.valueField,i.options)),delete l.settings.options,$.extend(l.optgroups,L(i.optgroupValueField,i.optgroups)),delete l.settings.optgroups,l.settings.mode=l.settings.mode||(1===l.settings.maxItems?"single":"multi"),"boolean"!=typeof l.settings.hideSelected&&(l.settings.hideSelected="multi"===l.settings.mode),l.initializePlugins(l.settings.plugins),l.setupCallbacks(),l.setupTemplates(),l.setup()};return n.mixin(E),e.mixin(E),$.extend(E.prototype,{setup:function(){var t=this,e=t.settings,i=t.eventNS,n=$(window),o=$(document),s,a,l,u,c,h,d,f,p,g,m,x;d=t.settings.mode,g=t.$input.attr("tabindex")||"",m=t.$input.attr("class")||"",s=$("<div>").addClass(e.wrapperClass).addClass(m).addClass(d),a=$("<div>").addClass(e.inputClass).addClass("items").appendTo(s),l=$('<input type="text" autocomplete="off" />').appendTo(a).attr("tabindex",g),h=$(e.dropdownParent||s),u=$("<div>").addClass(e.dropdownClass).addClass(m).addClass(d).hide().appendTo(h),c=$("<div>").addClass(e.dropdownContentClass).appendTo(u),s.css({width:t.$input[0].style.width}),t.plugins.names.length&&(x="plugin-"+t.plugins.names.join(" plugin-"),s.addClass(x),u.addClass(x)),(null===e.maxItems||e.maxItems>1)&&t.tagType===w&&t.$input.attr("multiple","multiple"),t.settings.placeholder&&l.attr("placeholder",e.placeholder),t.$input.attr("autocorrect")&&l.attr("autocorrect",t.$input.attr("autocorrect")),t.$input.attr("autocapitalize")&&l.attr("autocapitalize",t.$input.attr("autocapitalize")),t.$wrapper=s,t.$control=a,t.$control_input=l,t.$dropdown=u,t.$dropdown_content=c,u.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)}),u.on("mousedown","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)}),P(a,"mousedown","*:not(input)",function(){return t.onItemSelect.apply(t,arguments)}),H(l),a.on({mousedown:function(){return t.onMouseDown.apply(t,arguments)},click:function(){return t.onClick.apply(t,arguments)}}),l.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){return t.onFocus.apply(t,arguments)},paste:function(){return t.onPaste.apply(t,arguments)}}),o.on("keydown"+i,function(e){t.isCmdDown=e[r?"metaKey":"ctrlKey"],t.isCtrlDown=e[r?"altKey":"ctrlKey"],t.isShiftDown=e.shiftKey}),o.on("keyup"+i,function(e){e.keyCode===b&&(t.isCtrlDown=!1),e.keyCode===v&&(t.isShiftDown=!1),e.keyCode===y&&(t.isCmdDown=!1)}),o.on("mousedown"+i,function(e){if(t.isFocused){if(e.target===t.$dropdown[0]||e.target.parentNode===t.$dropdown[0])return!1;t.$control.has(e.target).length||e.target===t.$control[0]||t.blur()}}),n.on(["scroll"+i,"resize"+i].join(" "),function(){t.isOpen&&t.positionDropdown.apply(t,arguments)}),n.on("mousemove"+i,function(){t.ignoreHover=!1}),this.revertSettings={$children:t.$input.children().detach(),tabindex:t.$input.attr("tabindex")},t.$input.attr("tabindex",-1).hide().after(t.$wrapper),$.isArray(e.items)&&(t.setValue(e.items),delete e.items),t.$input[0].validity&&t.$input.on("invalid"+i,function(e){e.preventDefault(),t.isInvalid=!0,t.refreshState()}),t.updateOriginalInput(),t.refreshItems(),t.refreshState(),t.updatePlaceholder(),t.isSetup=!0,t.$input.is(":disabled")&&t.disable(),t.on("change",this.onChange),t.trigger("initialize"),e.preload===!0&&t.onSearchChange("")},setupTemplates:function(){var t=this,e=t.settings.labelField,i=t.settings.optgroupLabelField,n={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(t,i){return'<div class="option">'+i(t[e])+"</div>"},item:function(t,i){return'<div class="item">'+i(t[e])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};t.settings.render=$.extend({},n,t.settings.render)},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]],e&&this.on(t,e))},onClick:function(t){var e=this;e.isFocused||(e.focus(),t.preventDefault())},onMouseDown:function(t){var e=this,i=t.isDefaultPrevented(),n=$(t.target);if(e.isFocused){if(t.target!==e.$control_input[0])return"single"===e.settings.mode?e.isOpen?e.close():e.open():i||e.setActiveItem(null),!1}else i||window.setTimeout(function(){e.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var e=this;(e.isFull()||e.isInputHidden||e.isLocked)&&t.preventDefault()},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){var e=t.target===this.$control_input[0],i=this;if(i.isLocked)return void(t.keyCode!==x&&t.preventDefault());switch(t.keyCode){case o:if(i.isCmdDown)return void i.selectAll();break;case l:return void i.close();case p:if(!t.ctrlKey||t.altKey)break;case f:if(!i.isOpen&&i.hasOptions)i.open();else if(i.$activeOption){i.ignoreHover=!0;var n=i.getAdjacentOption(i.$activeOption,1);n.length&&i.setActiveOption(n,!0,!0)}return void t.preventDefault();case h:if(!t.ctrlKey||t.altKey)break;case c:if(i.$activeOption){i.ignoreHover=!0;var s=i.getAdjacentOption(i.$activeOption,-1);s.length&&i.setActiveOption(s,!0,!0)}return void t.preventDefault();case a:return i.isOpen&&i.$activeOption&&i.onOptionSelect({currentTarget:i.$activeOption}),void t.preventDefault();case u:return void i.advanceSelection(-1,t);case d:return void i.advanceSelection(1,t);case x:return i.settings.selectOnTab&&i.isOpen&&i.$activeOption&&i.onOptionSelect({currentTarget:i.$activeOption}),void(i.settings.create&&i.createItem()&&t.preventDefault());case g:case m:return void i.deleteSelection(t)}return!i.isFull()&&!i.isInputHidden||(r?t.metaKey:t.ctrlKey)?void 0:void t.preventDefault()},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var i=e.$control_input.val()||"";e.lastValue!==i&&(e.lastValue=i,e.onSearchChange(i),e.refreshOptions(),e.trigger("type",i))},onSearchChange:function(t){var e=this,i=e.settings.load;i&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(n){i.apply(e,[t,n])})))},onFocus:function(t){var e=this;return e.isFocused=!0,e.isDisabled?(e.blur(),t&&t.preventDefault(),!1):void(e.ignoreFocus||("focus"===e.settings.preload&&e.onSearchChange(""),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState()))},onBlur:function(t){var e=this;e.isFocused=!1,e.ignoreFocus||(e.settings.create&&e.settings.createOnBlur&&e.createItem(!1),e.close(),e.setTextboxValue(""),e.setActiveItem(null),e.setActiveOption(null),e.setCaret(e.items.length),e.refreshState())},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(t){var e,i,n,r=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),i=$(t.currentTarget),i.hasClass("create")?r.createItem():(e=i.attr("data-value"),e&&(r.lastQuery=null,r.setTextboxValue(""),r.addItem(e),!r.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&r.setActiveOption(r.getOption(e))))},onItemSelect:function(t){var e=this;e.isLocked||"multi"===e.settings.mode&&(t.preventDefault(),e.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,i=e.$wrapper.addClass("loading");e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||i.removeClass("loading"),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input,i=e.val()!==t;i&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return this.tagType===w&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t){I(this,["change"],function(){this.clear(),this.addItems(t)})},setActiveItem:function(t,e){var i=this,n,r,o,s,a,l,u,c;if("single"!==i.settings.mode){if(t=$(t),!t.length)return $(i.$activeItems).removeClass("active"),i.$activeItems=[],void(i.isFocused&&i.showInput());if(n=e&&e.type.toLowerCase(),"mousedown"===n&&i.isShiftDown&&i.$activeItems.length){for(c=i.$control.children(".active:last"),s=Array.prototype.indexOf.apply(i.$control[0].childNodes,[c[0]]),a=Array.prototype.indexOf.apply(i.$control[0].childNodes,[t[0]]),s>a&&(u=s,s=a,a=u),r=s;a>=r;r++)l=i.$control[0].childNodes[r],-1===i.$activeItems.indexOf(l)&&($(l).addClass("active"),i.$activeItems.push(l));e.preventDefault()}else"mousedown"===n&&i.isCtrlDown||"keydown"===n&&this.isShiftDown?t.hasClass("active")?(o=i.$activeItems.indexOf(t[0]),i.$activeItems.splice(o,1),t.removeClass("active")):i.$activeItems.push(t.addClass("active")[0]):($(i.$activeItems).removeClass("active"),i.$activeItems=[t.addClass("active")[0]]);i.hideInput(),this.isFocused||i.focus()}},setActiveOption:function(t,e,i){var n,r,o,s,a,l=this;l.$activeOption&&l.$activeOption.removeClass("active"),l.$activeOption=null,t=$(t),t.length&&(l.$activeOption=t.addClass("active"),(e||!C(e))&&(n=l.$dropdown_content.height(),r=l.$activeOption.outerHeight(!0),e=l.$dropdown_content.scrollTop()||0,o=l.$activeOption.offset().top-l.$dropdown_content.offset().top+e,s=o,a=o-n+r,o+r>n+e?l.$dropdown_content.stop().animate({scrollTop:a},i?l.settings.scrollDuration:0):e>o&&l.$dropdown_content.stop().animate({scrollTop:s},i?l.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){var t=this;t.setTextboxValue(""),t.$control_input.css({opacity:0,position:"absolute",left:t.rtl?1e4:-1e4}),t.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e={field:e}),{fields:t.searchField,conjunction:t.searchConjunction,sort:e}},search:function(t){var e,i,n,r,o,s=this,a=s.settings,l=this.getSearchOptions();if(a.score&&(o=s.settings.score.apply(this,[t]),"function"!=typeof o))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==s.lastQuery?(s.lastQuery=t,r=s.sifter.search(t,$.extend(l,{score:o})),s.currentResults=r):r=$.extend(!0,{},s.currentResults),a.hideSelected)for(e=r.items.length-1;e>=0;e--)-1!==s.items.indexOf(k(r.items[e].id))&&r.items.splice(e,1);return r},refreshOptions:function(t){var e,n,r,o,s,a,l,u,c,h,d,f,p,g,m,v;"undefined"==typeof t&&(t=!0);var y=this,b=y.$control_input.val(),x=y.search(b),w=y.$dropdown_content,_=y.$activeOption&&k(y.$activeOption.attr("data-value"));if(o=x.items.length,"number"==typeof y.settings.maxOptions&&(o=Math.min(o,y.settings.maxOptions)),s={},y.settings.optgroupOrder)for(a=y.settings.optgroupOrder,e=0;e<a.length;e++)s[a[e]]=[];else a=[];for(e=0;o>e;e++)for(l=y.options[x.items[e].id],u=y.render("option",l),c=l[y.settings.optgroupField]||"",h=$.isArray(c)?c:[c],n=0,r=h&&h.length;r>n;n++)c=h[n],y.optgroups.hasOwnProperty(c)||(c=""),s.hasOwnProperty(c)||(s[c]=[],a.push(c)),s[c].push(u);for(d=[],e=0,o=a.length;o>e;e++)c=a[e],y.optgroups.hasOwnProperty(c)&&s[c].length?(f=y.render("optgroup_header",y.optgroups[c])||"",f+=s[c].join(""),d.push(y.render("optgroup",$.extend({},y.optgroups[c],{html:f})))):d.push(s[c].join(""));if(w.html(d.join("")),y.settings.highlight&&x.query.length&&x.tokens.length)for(e=0,o=x.tokens.length;o>e;e++)i(w,x.tokens[e].regex);if(!y.settings.hideSelected)for(e=0,o=y.items.length;o>e;e++)y.getOption(y.items[e]).addClass("selected");p=y.settings.create&&x.query.length,p&&(w.prepend(y.render("option_create",{input:b})),v=$(w[0].childNodes[0])),y.hasOptions=x.items.length>0||p,y.hasOptions?(x.items.length>0?(m=_&&y.getOption(_),m&&m.length?g=m:"single"===y.settings.mode&&y.items.length&&(g=y.getOption(y.items[0])),g&&g.length||(g=v&&!y.settings.addPrecedence?y.getAdjacentOption(v,1):w.find("[data-selectable]:first"))):g=v,y.setActiveOption(g),t&&!y.isOpen&&y.open()):(y.setActiveOption(null),t&&y.isOpen&&y.close())},addOption:function(t){var e,i,n,r,o=this;if($.isArray(t))for(e=0,i=t.length;i>e;e++)o.addOption(t[e]);else r=k(t[o.settings.valueField]),r&&!o.options.hasOwnProperty(r)&&(o.userOptions[r]=!0,o.options[r]=t,o.lastQuery=null,o.trigger("option_add",r,t))},addOptionGroup:function(t,e){this.optgroups[t]=e,this.trigger("optgroup_add",t,e)},updateOption:function(t,e){var i=this,n,r,o,s,a,l;if(t=k(t),o=k(e[i.settings.valueField]),i.options.hasOwnProperty(t)){if(!o)throw new Error("Value must be set in option data");o!==t&&(delete i.options[t],s=i.items.indexOf(t),-1!==s&&i.items.splice(s,1,o)),i.options[o]=e,a=i.renderCache.item,l=i.renderCache.option,a&&(delete a[t],delete a[o]),l&&(delete l[t],delete l[o]),-1!==i.items.indexOf(o)&&(n=i.getItem(t),r=$(i.render("item",e)),n.hasClass("active")&&r.addClass("active"),n.replaceWith(r)),i.isOpen&&i.refreshOptions(!1)}},removeOption:function(t){var e=this;t=k(t);var i=e.renderCache.item,n=e.renderCache.option;i&&delete i[t],n&&delete n[t],delete e.userOptions[t],delete e.options[t],e.lastQuery=null,e.trigger("option_remove",t),e.removeItem(t)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.renderCache={},t.options=t.sifter.items={},t.lastQuery=null,t.trigger("option_clear"),t.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,e){var i=this.$dropdown.find("[data-selectable]"),n=i.index(t)+e;return n>=0&&n<i.length?i.eq(n):$()},getElementWithValue:function(t,e){if(t=k(t))for(var i=0,n=e.length;n>i;i++)if(e[i].getAttribute("data-value")===t)return $(e[i]);return $()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(t){for(var e=$.isArray(t)?t:[t],i=0,n=e.length;n>i;i++)this.isPending=n-1>i,this.addItem(e[i])},addItem:function(t){I(this,["change"],function(){var e,i,n,r=this,o=r.settings.mode,s,a,l;return t=k(t),-1!==r.items.indexOf(t)?void("single"===o&&r.close()):void(r.options.hasOwnProperty(t)&&("single"===o&&r.clear(),"multi"===o&&r.isFull()||(e=$(r.render("item",r.options[t])),r.items.splice(r.caretPos,0,t),r.insertAtCaret(e),r.refreshState(),r.isSetup&&(n=r.$dropdown_content.find("[data-selectable]"),this.isPending||(i=r.getOption(t),l=r.getAdjacentOption(i,1).attr("data-value"),r.refreshOptions(r.isFocused&&"single"!==o),l&&r.setActiveOption(r.getOption(l))),!n.length||null!==r.settings.maxItems&&r.items.length>=r.settings.maxItems?r.close():r.positionDropdown(),r.updatePlaceholder(),r.trigger("item_add",t,e),r.updateOriginalInput()))))})},removeItem:function(t){var e=this,i,n,r;i="object"==typeof t?t:e.getItem(t),t=k(i.attr("data-value")),n=e.items.indexOf(t),-1!==n&&(i.remove(),i.hasClass("active")&&(r=e.$activeItems.indexOf(i[0]),e.$activeItems.splice(r,1)),e.items.splice(n,1),e.lastQuery=null,!e.settings.persist&&e.userOptions.hasOwnProperty(t)&&e.removeOption(t),n<e.caretPos&&e.setCaret(e.caretPos-1),e.refreshState(),e.updatePlaceholder(),e.updateOriginalInput(),e.positionDropdown(),e.trigger("item_remove",t))},createItem:function(t){var e=this,i=$.trim(e.$control_input.val()||""),n=e.caretPos;if(!i.length)return!1;
e.lock(),"undefined"==typeof t&&(t=!0);var r="function"==typeof e.settings.create?this.settings.create:function(t){var i={};return i[e.settings.labelField]=t,i[e.settings.valueField]=t,i},o=O(function(i){if(e.unlock(),i&&"object"==typeof i){var r=k(i[e.settings.valueField]);r&&(e.setTextboxValue(""),e.addOption(i),e.setCaret(n),e.addItem(r),e.refreshOptions(t&&"single"!==e.settings.mode))}}),s=r.apply(this,[i,o]);return"undefined"!=typeof s&&o(s),!0},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var t=0;t<this.items.length;t++)this.addItem(this.items);this.refreshState(),this.updateOriginalInput()},refreshState:function(){var t=this,e=t.isRequired&&!t.items.length;e||(t.isInvalid=!1),t.$control_input.prop("required",e),t.refreshClasses()},refreshClasses:function(){var t=this,e=t.isFull(),i=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",i).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!$.isEmptyObject(t.options)).toggleClass("has-items",t.items.length>0),t.$control_input.data("grow",!e&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var t,e,i,n=this;if("select"===n.$input[0].tagName.toLowerCase()){for(i=[],t=0,e=n.items.length;e>t;t++)i.push('<option value="'+S(n.items[t])+'" selected="selected"></option>');i.length||this.$input.attr("multiple")||i.push('<option value="" selected="selected"></option>'),n.$input.html(i.join(""))}else n.$input.val(n.getValue());n.isSetup&&n.trigger("change",n.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this,e=t.isOpen;"single"===t.settings.mode&&t.items.length&&t.hideInput(),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.setCaret(0),t.updatePlaceholder(),t.updateOriginalInput(),t.refreshState(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(t){var e=Math.min(this.caretPos,this.items.length);0===e?this.$control.prepend(t):$(this.$control[0].childNodes[e]).before(t),this.setCaret(e+1)},deleteSelection:function(t){var e,i,n,r,o,s,a,l,u,c=this;if(n=t&&t.keyCode===g?-1:1,r=A(c.$control_input[0]),c.$activeOption&&!c.settings.hideSelected&&(a=c.getAdjacentOption(c.$activeOption,-1).attr("data-value")),o=[],c.$activeItems.length){for(u=c.$control.children(".active:"+(n>0?"last":"first")),s=c.$control.children(":not(input)").index(u),n>0&&s++,e=0,i=c.$activeItems.length;i>e;e++)o.push($(c.$activeItems[e]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(c.isFocused||"single"===c.settings.mode)&&c.items.length&&(0>n&&0===r.start&&0===r.length?o.push(c.items[c.caretPos-1]):n>0&&r.start===c.$control_input.val().length&&o.push(c.items[c.caretPos]));if(!o.length||"function"==typeof c.settings.onDelete&&c.settings.onDelete.apply(c,[o])===!1)return!1;for("undefined"!=typeof s&&c.setCaret(s);o.length;)c.removeItem(o.pop());return c.showInput(),c.positionDropdown(),c.refreshOptions(!0),a&&(l=c.getOption(a),l.length&&c.setActiveOption(l)),!0},advanceSelection:function(t,e){var i,n,r,o,s,a,l=this;0!==t&&(l.rtl&&(t*=-1),i=t>0?"last":"first",n=A(l.$control_input[0]),l.isFocused&&!l.isInputHidden?(o=l.$control_input.val().length,s=0>t?0===n.start&&0===n.length:n.start===o,s&&!o&&l.advanceCaret(t,e)):(a=l.$control.children(".active:"+i),a.length&&(r=l.$control.children(":not(input)").index(a),l.setActiveItem(null),l.setCaret(t>0?r+1:r))))},advanceCaret:function(t,e){var i=this,n,r;0!==t&&(n=t>0?"next":"prev",i.isShiftDown?(r=i.$control_input[n](),r.length&&(i.hideInput(),i.setActiveItem(r),e&&e.preventDefault())):i.setCaret(i.caretPos+t))},setCaret:function(t){var e=this;t="single"===e.settings.mode?e.items.length:Math.max(0,Math.min(e.items.length,t));var i,n,r,o,s;for(o=e.$control.children(":not(input)"),i=0,n=o.length;n>i;i++)s=$(o[i]).detach(),t>i?e.$control_input.before(s):e.$control.append(s);e.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var t=this;t.$input.prop("disabled",!0),t.isDisabled=!0,t.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.isDisabled=!1,t.unlock()},destroy:function(){var t=this,e=t.eventNS,i=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(i.$children).removeAttr("tabindex").attr({tabindex:i.tabindex}).show(),$(window).off(e),$(document).off(e),$(document.body).off(e),delete t.$input[0].selectize},render:function(t,e){var i,n,r,o="",s=!1,a=this,l=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===t||"item"===t)&&(i=k(e[a.settings.valueField]),s=!!i),s&&(C(a.renderCache[t])||(a.renderCache[t]={}),a.renderCache[t].hasOwnProperty(i))?a.renderCache[t][i]:(o=a.settings.render[t].apply(this,[e,S]),("option"===t||"option_create"===t)&&(o=o.replace(l,"<$1 data-selectable")),"optgroup"===t&&(n=e[a.settings.optgroupValueField]||"",o=o.replace(l,'<$1 data-group="'+D(S(n))+'"')),("option"===t||"item"===t)&&(o=o.replace(l,'<$1 data-value="'+D(S(i||""))+'"')),s&&(a.renderCache[t][i]=o),o)}}),E.count=0,E.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,createOnBlur:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},$.fn.selectize=function(t){var e=$.fn.selectize.defaults,i=$.extend({},e,t),n=i.dataAttr,r=i.labelField,o=i.valueField,s=i.optgroupField,a=i.optgroupLabelField,l=i.optgroupValueField,u=function(t,e){var n,s,a,l,u=$.trim(t.val()||"");if(u.length){for(a=u.split(i.delimiter),n=0,s=a.length;s>n;n++)l={},l[r]=a[n],l[o]=a[n],e.options[a[n]]=l;e.items=a}},c=function(t,e){var i,u,c,h,d=0,f=e.options,p=function(t){var e=n&&t.attr(n);return"string"==typeof e&&e.length?JSON.parse(e):null},g=function(t,i){var n,a;if(t=$(t),n=t.attr("value")||"",n.length){if(f.hasOwnProperty(n))return void(i&&(f[n].optgroup?$.isArray(f[n].optgroup)?f[n].optgroup.push(i):f[n].optgroup=[f[n].optgroup,i]:f[n].optgroup=i));a=p(t)||{},a[r]=a[r]||t.text(),a[o]=a[o]||n,a[s]=a[s]||i,a.$order=++d,f[n]=a,t.is(":selected")&&e.items.push(n)}},m=function(t){var i,n,r,o,s;for(t=$(t),r=t.attr("label"),r&&(o=p(t)||{},o[a]=r,o[l]=r,e.optgroups[r]=o),s=$("option",t),i=0,n=s.length;n>i;i++)g(s[i],r)};for(e.maxItems=t.attr("multiple")?null:1,h=t.children(),i=0,u=h.length;u>i;i++)c=h[i].tagName.toLowerCase(),"optgroup"===c?m(h[i]):"option"===c&&g(h[i])};return this.each(function(){if(!this.selectize){var i,n=$(this),r=this.tagName.toLowerCase(),o={placeholder:n.children('option[value=""]').text()||n.attr("placeholder"),options:{},optgroups:{},items:[]};"select"===r?c(n,o):u(n,o),i=new E(n,$.extend(!0,{},e,o,t)),n.data("selectize",i),n.addClass("selectized")}})},$.fn.selectize.defaults=E.defaults,E.define("drag_drop",function(t){if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var e=this;e.lock=function(){var t=e.lock;return function(){var i=e.$control.data("sortable");return i&&i.disable(),t.apply(e,arguments)}}(),e.unlock=function(){var t=e.unlock;return function(){var i=e.$control.data("sortable");return i&&i.enable(),t.apply(e,arguments)}}(),e.setup=function(){var t=e.setup;return function(){t.apply(this,arguments);var i=e.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:e.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var t=e.$activeItems?e.$activeItems.slice():null,n=[];i.children("[data-value]").each(function(){n.push($(this).attr("data-value"))}),e.setValue(n),e.setActiveItem(t)}})}}()}}),E.define("dropdown_header",function(t){var e=this;t=$.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},t),e.setup=function(){var i=e.setup;return function(){i.apply(e,arguments),e.$dropdown_header=$(t.html(t)),e.$dropdown.prepend(e.$dropdown_header)}}()}),E.define("optgroup_columns",function(t){var e=this;t=$.extend({equalizeWidth:!0,equalizeHeight:!0},t),this.getAdjacentOption=function(t,e){var i=t.closest("[data-group]").find("[data-selectable]"),n=i.index(t)+e;return n>=0&&n<i.length?i.eq(n):$()},this.onKeyDown=function(){var t=e.onKeyDown;return function(i){var n,r,o,s;return!this.isOpen||i.keyCode!==u&&i.keyCode!==d?t.apply(this,arguments):(e.ignoreHover=!0,s=this.$activeOption.closest("[data-group]"),n=s.find("[data-selectable]").index(this.$activeOption),s=i.keyCode===u?s.prev("[data-group]"):s.next("[data-group]"),o=s.find("[data-selectable]"),r=o.eq(Math.min(o.length-1,n)),void(r.length&&this.setActiveOption(r)))}}();var i=function(){var i,n,r,o,s,a,l;if(l=$("[data-group]",e.$dropdown_content),n=l.length,n&&e.$dropdown_content.width()){if(t.equalizeHeight){for(r=0,i=0;n>i;i++)r=Math.max(r,l.eq(i).height());l.css({height:r})}t.equalizeWidth&&(a=e.$dropdown_content.innerWidth(),o=Math.round(a/n),l.css({width:o}),n>1&&(s=a-o*(n-1),l.eq(n-1).css({width:s})))}};(t.equalizeHeight||t.equalizeWidth)&&(T.after(this,"positionDropdown",i),T.after(this,"refreshOptions",i))}),E.define("remove_button",function(t){if("single"!==this.settings.mode){t=$.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var e=this,i='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+S(t.title)+'">'+t.label+"</a>",n=function(t,e){var i=t.search(/(<\/[^>]+>\s*)$/);return t.substring(0,i)+e+t.substring(i)};this.setup=function(){var r=e.setup;return function(){if(t.append){var o=e.settings.render.item;e.settings.render.item=function(t){return n(o.apply(this,arguments),i)}}r.apply(this,arguments),this.$control.on("click","."+t.className,function(t){if(t.preventDefault(),!e.isLocked){var i=$(t.currentTarget).parent();e.setActiveItem(i),e.deleteSelection()&&e.setCaret(e.items.length)}})}}()}}),E.define("restore_on_backspace",function(t){var e=this;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=function(i){var n=e.onKeyDown;return function(e){var i,r;return e.keyCode===g&&""===this.$control_input.val()&&!this.$activeItems.length&&(i=this.caretPos-1,i>=0&&i<this.items.length)?(r=this.options[this.items[i]],this.deleteSelection(e)&&(this.setTextboxValue(t.text.apply(this,[r])),this.refreshOptions(!0)),void e.preventDefault()):n.apply(this,arguments)}}()}),E}),function($){$.fn.sharp_ref=function(t){var e={create:!1,selectOnTab:!0,render:{option_create:function(t,e){return'<div class="create">Ajouter <strong>'+e(t.input)+"</strong>&hellip;</div>"}}},i=$.extend(e,t);return this.each(function(){$(this).selectize(i)})}}(jQuery),$(window).load(function(){$(".sharp-ref").each(function(){createSharpRef($(this))})}),function($){$.fn.sharp_tags=function(t){var e={create:!1,selectOnTab:!1,persist:!1,maxItems:null,sortField:null},i=$.extend(e,t);return this.each(function(){$(this).selectize(i)})}}(jQuery),$(window).load(function(){$(".sharp-tags").each(function(){createSharpTags($(this))})}),function($){$.fn.sharp_refSublistItem=function(t){function e(t,e,i){baseRefValue=t.find("option:selected").val(),e.disable(),e.clearOptions(),i.find("optgroup").each(function(){return $(this).attr("label")==baseRefValue?(e.enable(),$(this).find("option").each(function(){e.addOption({value:$(this).val(),text:$(this).text()}),e.addItem($(this).val())}),!1):void 0})}var i={},n=$.extend(i,t);return this.each(function(){$(this).selectize(n),$datastore=$(this).prev("select[name="+$(this).attr("id")+"_values]"),$refSublistField=$(this)[0].selectize,$baseRefField=$("#"+n.linked_ref_field),$baseRefField.on("change",function(){e($baseRefField,$refSublistField,$datastore)}),e($baseRefField,$refSublistField,$datastore),n.initial_value&&$refSublistField.setValue(n.initial_value)})}}(jQuery),$(window).load(function(){$(".sharp-refSublistItem").each(function(){createSharpRefSublistItem($(this))})}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function($,t){var e=0,i=Array.prototype.slice,n=$.cleanData;$.cleanData=function(t){for(var e=0,i;null!=(i=t[e]);e++)try{$(i).triggerHandler("remove")}catch(r){}n(t)},$.widget=function(t,e,i){var n,r,o,s,a={},l=t.split(".")[0];t=t.split(".")[1],n=l+"-"+t,i||(i=e,e=$.Widget),$.expr[":"][n.toLowerCase()]=function(t){return!!$.data(t,n)},$[l]=$[l]||{},r=$[l][t],o=$[l][t]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new o(t,e)},$.extend(o,r,{version:i.version,_proto:$.extend({},i),_childConstructors:[]}),s=new e,s.options=$.widget.extend({},s.options),$.each(i,function(t,i){return $.isFunction(i)?void(a[t]=function(){var n=function(){return e.prototype[t].apply(this,arguments)},r=function(i){return e.prototype[t].apply(this,i)};return function(){var t=this._super,e=this._superApply,o;return this._super=n,this._superApply=r,o=i.apply(this,arguments),this._super=t,this._superApply=e,o}}()):void(a[t]=i)}),o.prototype=$.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix||t:t},a,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),r?($.each(r._childConstructors,function(t,e){var i=e.prototype;$.widget(i.namespace+"."+i.widgetName,o,e._proto)}),delete r._childConstructors):e._childConstructors.push(o),$.widget.bridge(t,o)},$.widget.extend=function(e){for(var n=i.call(arguments,1),r=0,o=n.length,s,a;o>r;r++)for(s in n[r])a=n[r][s],n[r].hasOwnProperty(s)&&a!==t&&(e[s]=$.isPlainObject(a)?$.isPlainObject(e[s])?$.widget.extend({},e[s],a):$.widget.extend({},a):a);return e},$.widget.bridge=function(e,n){var r=n.prototype.widgetFullName||e;$.fn[e]=function(o){var s="string"==typeof o,a=i.call(arguments,1),l=this;return o=!s&&a.length?$.widget.extend.apply(null,[o].concat(a)):o,this.each(s?function(){var i,n=$.data(this,r);return n?$.isFunction(n[o])&&"_"!==o.charAt(0)?(i=n[o].apply(n,a),i!==n&&i!==t?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):$.error("no such method '"+o+"' for "+e+" widget instance"):$.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+o+"'")}:function(){var t=$.data(this,r);t?t.option(o||{})._init():$.data(this,r,new n(o,this))}),l}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=$(i||this.defaultElement||this)[0],this.element=$(i),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=$.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=$(),this.hoverable=$(),this.focusable=$(),i!==this&&($.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=$(i.style?i.ownerDocument:i.document||i),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(e,i){var n=e,r,o,s;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof e)if(n={},r=e.split("."),e=r.shift(),r.length){for(o=n[e]=$.widget.extend({},this.options[e]),s=0;s<r.length-1;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(e=r.pop(),1===arguments.length)return o[e]===t?null:o[e];o[e]=i}else{if(1===arguments.length)return this.options[e]===t?null:this.options[e];n[e]=i}return this._setOptions(n),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,e,i){var n,r=this;"boolean"!=typeof t&&(i=e,e=t,t=!1),i?(e=n=$(e),this.bindings=this.bindings.add(e)):(i=e,e=this.element,n=this.widget()),$.each(i,function(i,o){function s(){return t||r.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||$.guid++);var a=i.match(/^(\w+)\s*(.*)$/),l=a[1]+r.eventNamespace,u=a[2];u?n.delegate(u,l,s):e.bind(l,s)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){$(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){$(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){$(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){$(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,e,i){var n,r,o=this.options[t];if(i=i||{},e=$.Event(e),e.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),e.target=this.element[0],r=e.originalEvent)for(n in r)n in e||(e[n]=r[n]);return this.element.trigger(e,i),!($.isFunction(o)&&o.apply(this.element[0],[e].concat(i))===!1||e.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(t,e){$.Widget.prototype["_"+t]=function(i,n,r){"string"==typeof n&&(n={effect:n});var o,s=n?n===!0||"number"==typeof n?e:n.effect||e:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!$.isEmptyObject(n),n.complete=r,n.delay&&i.delay(n.delay),o&&$.effects&&$.effects.effect[s]?i[t](n):s!==t&&i[s]?i[s](n.duration,n.easing,r):i.queue(function(e){$(this)[t](),r&&r.call(i[0]),e()})}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function($){"use strict";var t=0;$.ajaxTransport("iframe",function(e){if(e.async){var i=e.initialIframeSrc||"javascript:false;",n,r,o;return{send:function(s,a){n=$('<form style="display:none;"></form>'),n.attr("accept-charset",e.formAcceptCharset),o=/\?/.test(e.url)?"&":"?","DELETE"===e.type?(e.url=e.url+o+"_method=DELETE",e.type="POST"):"PUT"===e.type?(e.url=e.url+o+"_method=PUT",e.type="POST"):"PATCH"===e.type&&(e.url=e.url+o+"_method=PATCH",e.type="POST"),t+=1,r=$('<iframe src="'+i+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=$.isArray(e.paramName)?e.paramName:[e.paramName];r.unbind("load").bind("load",function(){var t;try{if(t=r.contents(),!t.length||!t[0].firstChild)throw new Error}catch(e){t=void 0}a(200,"success",{iframe:t}),$('<iframe src="'+i+'"></iframe>').appendTo(n),window.setTimeout(function(){n.remove()},0)}),n.prop("target",r.prop("name")).prop("action",e.url).prop("method",e.type),e.formData&&$.each(e.formData,function(t,e){$('<input type="hidden"/>').prop("name",e.name).val(e.value).appendTo(n)}),e.fileInput&&e.fileInput.length&&"POST"===e.type&&(t=e.fileInput.clone(),e.fileInput.after(function(e){return t[e]}),e.paramName&&e.fileInput.each(function(t){$(this).prop("name",o[t]||e.paramName)}),n.append(e.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),e.fileInput.removeAttr("form")),n.submit(),t&&t.length&&e.fileInput.each(function(e,i){var n=$(t[e]);$(i).prop("name",n.prop("name")).attr("form",n.attr("form")),n.replaceWith(i)})}),n.append(r).appendTo(document.body)},abort:function(){r&&r.unbind("load").prop("src",i),n&&n.remove()}}}}),$.ajaxSetup({converters:{"iframe text":function(t){return t&&$(t[0].body).text()},"iframe json":function(t){return t&&$.parseJSON($(t[0].body).text())},"iframe html":function(t){return t&&$(t[0].body).html()},"iframe xml":function(t){var e=t&&t[0];return e&&$.isXMLDoc(e)?e:$.parseXML(e.XMLDocument&&e.XMLDocument.xml||$(e.body).html())},"iframe script":function(t){return t&&$.globalEval($(t[0].body).text())}}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):t(window.jQuery)}(function($){"use strict";$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$('<input type="file">').prop("disabled")),$.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),$.support.xhrFormDataFileUpload=!!window.FormData,$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:$(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,e){return t=this.messages[t]||t.toString(),e&&$.each(e,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(t){return t.serializeArray()},add:function(t,e){return t.isDefaultPrevented()?!1:void((e.autoUpload||e.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&e.process().done(function(){e.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,i){var n=t-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=(e-this.loaded)*(1e3/n)*8,this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(t){var e;return"function"===$.type(t.formData)?t.formData(t.form):$.isArray(t.formData)?t.formData:"object"===$.type(t.formData)?(e=[],$.each(t.formData,function(t,i){e.push({name:t,value:i})}),e):[]},_getTotal:function(t){var e=0;return $.each(t,function(t,i){e+=i.size||1}),e},_initProgressObject:function(t){var e={loaded:0,total:0,bitrate:0};t._progress?$.extend(t._progress,e):t._progress=e},_initResponseObject:function(t){var e;if(t._response)for(e in t._response)t._response.hasOwnProperty(e)&&delete t._response[e];else t._response={}},_onProgress:function(t,e){if(t.lengthComputable){var i=Date.now?Date.now():(new Date).getTime(),n;if(e._time&&e.progressInterval&&i-e._time<e.progressInterval&&t.loaded!==t.total)return;e._time=i,n=Math.floor(t.loaded/t.total*(e.chunkSize||e._progress.total))+(e.uploadedBytes||0),this._progress.loaded+=n-e._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(i,this._progress.loaded,e.bitrateInterval),e._progress.loaded=e.loaded=n,e._progress.bitrate=e.bitrate=e._bitrateTimer.getBitrate(i,n,e.bitrateInterval),this._trigger("progress",$.Event("progress",{delegatedEvent:t}),e),this._trigger("progressall",$.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var e=this,i=t.xhr?t.xhr():$.ajaxSettings.xhr();i.upload&&($(i.upload).bind("progress",function(i){var n=i.originalEvent;i.lengthComputable=n.lengthComputable,i.loaded=n.loaded,i.total=n.total,e._onProgress(i,t)}),t.xhr=function(){return i})},_isInstanceOf:function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},_initXHRData:function(t){var e=this,i,n=t.files[0],r=t.multipart||!$.support.xhrFileUpload,o="array"===$.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=$.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",n)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"'),r?$.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:o,value:t.blob}):$.each(t.files,function(e,n){i.push({name:"array"===$.type(t.paramName)&&t.paramName[e]||o,value:n})})):(e._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,$.each(this._getFormData(t),function(t,e){i.append(e.name,e.value)})),t.blob?i.append(o,t.blob,n.name):$.each(t.files,function(n,r){(e._isInstanceOf("File",r)||e._isInstanceOf("Blob",r))&&i.append("array"===$.type(t.paramName)&&t.paramName[n]||o,r,r.uploadName||r.name)})),t.data=i):(t.contentType=n.type||"application/octet-stream",t.data=t.blob||n),t.blob=null},_initIframeSettings:function(t){var e=$("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e&&e!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t)},_getParamName:function(t){var e=$(t.fileInput),i=t.paramName;return i?$.isArray(i)||(i=[i]):(i=[],e.each(function(){for(var t=$(this),e=t.prop("name")||"files[]",n=(t.prop("files")||[1]).length;n;)i.push(e),n-=1}),i.length||(i=[e.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=$(t.fileInput.prop("form")),t.form.length||(t.form=$(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===$.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var e=$.extend({},this.options,t);return this._initFormSettings(e),this._initDataSettings(e),e},_getDeferredState:function(t){return t.state?t.state():t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(t,e,i){var n=$.Deferred(),r=n.promise();return e=e||this.options.context||r,t===!0?n.resolveWith(e,i):t===!1&&n.rejectWith(e,i),r.abort=n.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,e){var i=this,n=function(t){return $.Deferred().resolveWith(i,t).promise()};e.process=function(t,r){return(t||r)&&(e._processQueue=this._processQueue=(this._processQueue||n([this])).pipe(function(){return e.errorThrown?$.Deferred().rejectWith(i,[e]).promise():n(arguments)}).pipe(t,r)),this._processQueue||n([this])},e.submit=function(){return"pending"!==this.state()&&(e.jqXHR=this.jqXHR=i._trigger("submit",$.Event("submit",{delegatedEvent:t}),this)!==!1&&i._onSend(t,this)),this.jqXHR||i._getXHRPromise()},e.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},e.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},e.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},e.progress=function(){return this._progress},e.response=function(){return this._response}},_getUploadedBytes:function(t){var e=t.getResponseHeader("Range"),i=e&&e.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(t,e){t.uploadedBytes=t.uploadedBytes||0;var i=this,n=t.files[0],r=n.size,o=t.uploadedBytes,s=t.maxChunkSize||r,a=this._blobSlice,l=$.Deferred(),u=l.promise(),c,h;return this._isXHRUpload(t)&&a&&(o||r>s)&&!t.data?e?!0:o>=r?(n.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",n.error])):(h=function(){var e=$.extend({},t),u=e._progress.loaded;e.blob=a.call(n,o,o+s,n.type),e.chunkSize=e.blob.size,e.contentRange="bytes "+o+"-"+(o+e.chunkSize-1)+"/"+r,i._initXHRData(e),i._initProgressListener(e),c=(i._trigger("chunksend",null,e)!==!1&&$.ajax(e)||i._getXHRPromise(!1,e.context)).done(function(n,s,a){o=i._getUploadedBytes(a)||o+e.chunkSize,u+e.chunkSize-e._progress.loaded&&i._onProgress($.Event("progress",{lengthComputable:!0,loaded:o-e.uploadedBytes,total:o-e.uploadedBytes}),e),t.uploadedBytes=e.uploadedBytes=o,e.result=n,e.textStatus=s,e.jqXHR=a,i._trigger("chunkdone",null,e),i._trigger("chunkalways",null,e),r>o?h():l.resolveWith(e.context,[n,s,a])}).fail(function(t,n,r){e.jqXHR=t,e.textStatus=n,e.errorThrown=r,i._trigger("chunkfail",null,e),i._trigger("chunkalways",null,e),l.rejectWith(e.context,[t,n,r])})},this._enhancePromise(u),u.abort=function(){return c.abort()},h(),u):!1},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(e),this._initProgressObject(e),e._progress.loaded=e.loaded=e.uploadedBytes||0,e._progress.total=e.total=this._getTotal(e.files)||1,e._progress.bitrate=e.bitrate=0,this._active+=1,this._progress.loaded+=e.loaded,this._progress.total+=e.total},_onDone:function(t,e,i,n){var r=n._progress.total,o=n._response;n._progress.loaded<r&&this._onProgress($.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n),o.result=n.result=t,o.textStatus=n.textStatus=e,o.jqXHR=n.jqXHR=i,this._trigger("done",null,n)
},_onFail:function(t,e,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=t,r.textStatus=n.textStatus=e,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(t,e,i,n){this._trigger("always",null,n)},_onSend:function(t,e){e.submit||this._addConvenienceMethods(t,e);var i=this,n,r,o,s,a=i._getAJAXSettings(e),l=function(){return i._sending+=1,a._bitrateTimer=new i._BitrateTimer,n=n||((r||i._trigger("send",$.Event("send",{delegatedEvent:t}),a)===!1)&&i._getXHRPromise(!1,a.context,r)||i._chunkedUpload(a)||$.ajax(a)).done(function(t,e,n){i._onDone(t,e,n,a)}).fail(function(t,e,n){i._onFail(t,e,n,a)}).always(function(t,e,n){if(i._onAlways(t,e,n,a),i._sending-=1,i._active-=1,a.limitConcurrentUploads&&a.limitConcurrentUploads>i._sending)for(var r=i._slots.shift();r;){if("pending"===i._getDeferredState(r)){r.resolve();break}r=i._slots.shift()}0===i._active&&i._trigger("stop")})};return this._beforeSend(t,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=$.Deferred(),this._slots.push(o),s=o.pipe(l)):(this._sequence=this._sequence.pipe(l,l),s=this._sequence),s.abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(o&&o.rejectWith(a.context,r),l())},this._enhancePromise(s)):l()},_onAdd:function(t,e){var i=this,n=!0,r=$.extend({},this.options,e),o=e.files,s=o.length,a=r.limitMultiFileUploads,l=r.limitMultiFileUploadSize,u=r.limitMultiFileUploadSizeOverhead,c=0,h=this._getParamName(r),d,f,p,g,m=0;if(!l||s&&void 0!==o[0].size||(l=void 0),(r.singleFileUploads||a||l)&&this._isXHRUpload(r))if(r.singleFileUploads||l||!a)if(!r.singleFileUploads&&l)for(p=[],d=[],g=0;s>g;g+=1)c+=o[g].size+u,(g+1===s||c+o[g+1].size+u>l||a&&g+1-m>=a)&&(p.push(o.slice(m,g+1)),f=h.slice(m,g+1),f.length||(f=h),d.push(f),m=g+1,c=0);else d=h;else for(p=[],d=[],g=0;s>g;g+=a)p.push(o.slice(g,g+a)),f=h.slice(g,g+a),f.length||(f=h),d.push(f);else p=[o],d=[h];return e.originalFiles=o,$.each(p||o,function(r,o){var s=$.extend({},e);return s.files=p?o:[o],s.paramName=d[r],i._initResponseObject(s),i._initProgressObject(s),i._addConvenienceMethods(t,s),n=i._trigger("add",$.Event("add",{delegatedEvent:t}),s)}),n},_replaceFileInput:function(t){var e=t.clone(!0);$("<form></form>").append(e)[0].reset(),t.after(e).detach(),$.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(i,n){return n===t[0]?e[0]:n}),t[0]===this.element[0]&&(this.element=e)},_handleFileTreeEntry:function(t,e){var i=this,n=$.Deferred(),r=function(e){e&&!e.entry&&(e.entry=t),n.resolve([e])},o;return e=e||"",t.isFile?t._file?(t._file.relativePath=e,n.resolve(t._file)):t.file(function(t){t.relativePath=e,n.resolve(t)},r):t.isDirectory?(o=t.createReader(),o.readEntries(function(o){i._handleFileTreeEntries(o,e+t.name+"/").done(function(t){n.resolve(t)}).fail(r)},r)):n.resolve([]),n.promise()},_handleFileTreeEntries:function(t,e){var i=this;return $.when.apply($,$.map(t,function(t){return i._handleFileTreeEntry(t,e)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var e=t.items;return e&&e.length&&(e[0].webkitGetAsEntry||e[0].getAsEntry)?this._handleFileTreeEntries($.map(e,function(t){var e;return t.webkitGetAsEntry?(e=t.webkitGetAsEntry(),e&&(e._file=t.getAsFile()),e):t.getAsEntry()})):$.Deferred().resolve($.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=$(t);var e=t.prop("webkitEntries")||t.prop("entries"),i,n;if(e&&e.length)return this._handleFileTreeEntries(e);if(i=$.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&$.each(i,function(t,e){e.name=e.fileName,e.size=e.fileSize});else{if(n=t.prop("value"),!n)return $.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return $.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof $&&1!==t.length?$.when.apply($,$.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var e=this,i={fileInput:$(t.target),form:$(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(n){i.files=n,e.options.replaceFileInput&&e._replaceFileInput(i.fileInput),e._trigger("change",$.Event("change",{delegatedEvent:t}),i)!==!1&&e._onAdd(t,i)})},_onPaste:function(t){var e=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,i={files:[]};e&&e.length&&($.each(e,function(t,e){var n=e.getAsFile&&e.getAsFile();n&&i.files.push(n)}),this._trigger("paste",$.Event("paste",{delegatedEvent:t}),i)!==!1&&this._onAdd(t,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var e=this,i=t.dataTransfer,n={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){n.files=i,e._trigger("drop",$.Event("drop",{delegatedEvent:t}),n)!==!1&&e._onAdd(t,n)}))},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var e=t.dataTransfer;e&&-1!==$.inArray("Files",e.types)&&this._trigger("dragover",$.Event("dragover",{delegatedEvent:t}))!==!1&&(t.preventDefault(),e.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),$.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,e){var i=-1!==$.inArray(t,this._specialOptions);i&&this._destroyEventHandlers(),this._super(t,e),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof $||(t.fileInput=$(t.fileInput)),t.dropZone instanceof $||(t.dropZone=$(t.dropZone)),t.pasteZone instanceof $||(t.pasteZone=$(t.pasteZone))},_getRegExp:function(t){var e=t.split("/"),i=e.pop();return e.shift(),new RegExp(e.join("/"),i)},_isRegExpOption:function(t,e){return"url"!==t&&"string"===$.type(e)&&/^\/.*\/[igm]{0,3}$/.test(e)},_initDataAttributes:function(){var t=this,e=this.options,i=$(this.element[0].cloneNode(!1));$.each(i.data(),function(n,r){var o="data-"+n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();i.attr(o)&&(t._isRegExpOption(n,r)&&(r=t._getRegExp(r)),e[n]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var e=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(i){t.files=i,e._onAdd(null,t)}):(t.files=$.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var e=this,i=$.Deferred(),n=i.promise(),r,o;return n.abort=function(){return o=!0,r?r.abort():(i.reject(null,"abort","abort"),n)},this._getFileInputFiles(t.fileInput).always(function(n){if(!o){if(!n.length)return void i.reject();t.files=n,r=e._onSend(null,t).then(function(t,e,n){i.resolve(t,e,n)},function(t,e,n){i.reject(t,e,n)})}}),this._enhancePromise(n)}if(t.files=$.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function($){$.fn.sharp_file=function(t){var e={image:!1,progress:!1,url:null,thumbnail:!1,browseButton:{text:"browse",className:"btn"},deleteButton:{text:"&times; remove",className:"btn"},file_filter:"",file_filter_alert:"",file_label_pattern:'<div class="type"><i class="fa fa-file-o"></i><span>%type%</span></div><span class="mime">(%mime%)</span><span class="size">%size%</span>',done:function(t){return!0},submit:function(t){return!0}},i=$.extend(e,t);return this.each(function(){var t=$(this),e="_"+Math.random().toString(36).substr(2,9),n=$("<input/>").attr("type","file").attr("name","file").attr("id",e);n.css({display:"block",visibility:"hidden",width:"0",height:"0"}),$(this).append(n);var r=$("<a/>").addClass(i.browseButton.className).addClass("sharp-file-browse").html(i.browseButton.text);$(this).append(r);var o=null;i.progress&&(o=$("<div/>").addClass("sharp-file-progress").css({width:"0"}),$(this).prepend(o));var s=null;i.thumbnail&&(s=$(this).find(".sharp-file-thumbnail"),0==s.length&&(s=$("<img/>").addClass("sharp-file-thumbnail"),$(this).prepend(s)));var a=$(this).find(".sharp-file-label");0==a.length&&(a=$("<div/>").addClass("sharp-file-label"),$(this).append(a));var l=$(this).find(".sharp-file-id"),u=$(this).find(".sharp-file-path"),c=$("<a/>").addClass(i.deleteButton.className).addClass("sharp-file-delete").html(i.deleteButton.text);$(this).append(c),n.fileupload({dataType:"json",url:i.url,add:function(t,e){if(i.file_filter){var n=new RegExp("(\\.|\\/)("+i.file_filter.replace(/,/g,"|")+")$","i");if(e.originalFiles[0].type.length&&!n.test(e.originalFiles[0].type))return alert(i.file_filter_alert?i.file_filter_alert:i.file_filter),!1}e.submit()},submit:function(t,e){return r.css("visibility","hidden"),i.submit(e)},done:function(e,n){if(i.progress&&o.css("width","0%"),r.css("visibility","visible"),i.done(n)){t.addClass("valuated");var c=i.file_label_pattern.replace(/%type%/i,n.originalFiles[0].name.split(".").pop());c=c.replace(/%mime%/i,n.originalFiles[0].type),c=c.replace(/%size%/i,getReadableFileSizeString(n.originalFiles[0].size)),a.html(c),i.thumbnail&&n.result.file.thumbnail?(s.attr("src",n.result.file.thumbnail).show(),t.addClass("with_thumbnail")):t.removeClass("with_thumbnail"),l.val(n.result.file.name),u.val(n.result.file.path)}},progressall:function(t,e){if(i.progress){var n=parseInt(e.loaded/e.total*100,10);o.css("width",n+"%")}}}),r.on("click",function(){$("#"+e).click()}),c.on("click",function(){t.removeClass("valuated"),l.val("")}),$(this).bind("fileuploadsubmit",function(t,e){var n={};i.thumbnail&&$.each(i.thumbnail,function(t,e){var i="thumbnail_"+t;n[i]=e}),e.formData=n})})}}(jQuery),$(window).load(function(){$(".sharp-file").each(function(){createSharpFile($(this))})}),function($){$.fn.sharp_list=function(t){var e={sortable:!1,addable:!1,removable:!1,sortableItems:".sharp-list-item",addButton:{className:"btn",text:"add item"},onDeleteItem:function(t){return!0},itemDeleted:function(){},itemCreated:function(){},itemsSorted:function(t){}},i=$.extend(e,t);return this.each(function(){var t=$(this);if(i.addable){var e=$(this).find(".sharp-list-item.template");e.find("input, select, textarea").attr("disabled","disabled");var n=$("<a/>").addClass(i.addButton.className).addClass("sharp-list-add").html(i.addButton.text),r=$("<li/>").addClass("list-group-item sharp-list-item-add").append(n);e.before(r),n.click(function(t){t.preventDefault();var n=e.clone();n.addClass("sharp-list-item");var o="N_"+Math.random().toString(36).substr(2,9);n.find("input, select, textarea").each(function(){$(this).removeAttr("disabled");var t=$(this).attr("name");t=t.replace(/(--N--)/i,o),$(this).attr("name",t)}),n.find(".sharp-list-item-id").val(o),r.before(n),n.fadeIn("fast"),i.itemCreated(n)})}i.removable&&$(this).on("click",".sharp-list-remove",function(t){t.preventDefault(),$item=$(this).parents(".sharp-list-item"),i.onDeleteItem($item)&&$item.fadeOut("fast",function(){i.itemDeleted($item)})}),i.sortable&&$(this).sortable({items:i.sortableItems,axis:"y",handle:".sort-handle",helper:function(t,e){var i=e.children(),n=e.clone();return n.children().each(function(t){$(this).width(i.eq(t).width())}),n},update:function(e,n){i.itemsSorted(t)}})})}}(jQuery),$(window).load(function(){$(".sharp-list").each(function(){var t={};void 0!=$(this).data("sortable")&&(t.sortable=1==$(this).data("sortable")),void 0!=$(this).data("removable")&&(t.removable=1==$(this).data("removable")),void 0!=$(this).data("addable")&&(t.addable=1==$(this).data("addable")),void 0!=$(this).data("add_button_text")&&(t.addButton={text:'<i class="fa fa-plus"></i> '+$(this).data("add_button_text"),className:"btn"}),$(this).sharp_list($.extend(t,{itemCreated:function(t){t.removeClass("template"),t.find(".sharp-file-template").each(function(){$(this).removeClass("sharp-file-template").addClass("sharp-file"),createSharpFile($(this))}),t.find(".sharp-markdown-template").each(function(){$(this).removeClass("sharp-markdown-template").addClass("sharp-markdown"),createSharpMarkdown($(this))}),t.find(".sharp-date-template").each(function(){$(this).removeClass("sharp-date-template").addClass("sharp-date"),createSharpDate($(this))}),t.find(".sharp-ref-template").each(function(){$(this).removeClass("sharp-ref-template").addClass("sharp-ref"),createSharpRef($(this))}),t.find(".sharp-tags-template").each(function(){$(this).removeClass("sharp-tags-template").addClass("sharp-tags"),createSharpTags($(this))}),t.find(".sharp-field-embed").each(function(){key=t.find(".sharp-list-item-id").val(),$(this).find(".sharp-embed-update").each(function(){href=$(this).prop("href"),href=href.replace(/(--N--)/i,key),$(this).prop("href",href)}),$(this).find(".sharp-embed-delete").each(function(){fieldname=$(this).data("fieldname"),fieldname=fieldname.replace(/(--N--)/i,key),$(this).data("fieldname",fieldname)})}),t.find(".sharp-field[data-conditional_display]").each(function(){manageConditionalDisplay($(this))})},itemDeleted:function(t){t.remove()}}))})});