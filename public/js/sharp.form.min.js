function createSharpDate(e){var t={};e.data("lang")&&(t.lang=e.data("lang")),e.data("has_date")&&(t.datepicker=e.data("has_date")),e.data("has_time")&&(t.timepicker=e.data("has_time")),e.data("step_time")&&(t.step=e.data("step_time")),e.data("max_date")&&(t.maxDate=e.data("max_date")),e.data("min_date")&&(t.minDate=e.data("min_date")),e.data("max_time")&&(t.maxTime=e.data("max_time")),e.data("min_time")&&(t.minTime=e.data("min_time")),e.data("start_date")&&(t.startDate=e.data("start_date")),e.data("format")&&(t.format=e.data("format")),e.data("start_on_sunday")&&(t.dayOfWeekStart=0),e.sharp_date(t)}function Editor(e){e=e||{},e.element&&(this.element=e.element),e.toolbar=e.toolbar||Editor.toolbar,e.hasOwnProperty("status")||(e.status=["lines","words","cursor"]),this.options=e,this.element&&this.render()}function fixShortcut(e){return e=isMac?e.replace("Ctrl","Cmd"):e.replace("Cmd","Ctrl")}function createIcon(e,t){t=t||{};var n=document.createElement("a"),r=t.shortcut||shortcuts[e];return r&&(r=fixShortcut(r),n.title=r,n.title=n.title.replace("Cmd","⌘"),isMac&&(n.title=n.title.replace("Alt","⌥"))),n.className=t.className||"icon-"+e,n}function createSep(){return el=document.createElement("i"),el.className="separator",el.innerHTML="|",el}function getState(e,t){t=t||e.getCursor("start");var n=e.getTokenAt(t);if(!n.type)return{};for(var r=n.type.split(" "),i={},o,s,a=0;a<r.length;a++)o=r[a],"strong"===o?i.bold=!0:"variable-2"===o?(s=e.getLine(t.line),/^\s*\d+\.\s/.test(s)?i["ordered-list"]=!0:i["unordered-list"]=!0):"atom"===o?i.quote=!0:"em"===o&&(i.italic=!0);return i}function toggleFullScreen(e){var t=e.codemirror.getWrapperElement(),n=document,r=n.fullScreen||n.mozFullScreen||n.webkitFullScreen,i=function(){t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},o=function(){n.cancelFullScreen?n.cancelFullScreen():n.mozCancelFullScreen?n.mozCancelFullScreen():n.webkitCancelFullScreen&&n.webkitCancelFullScreen()};r?o&&o():i()}function toggleBold(e){var t=e.codemirror,n=getState(t),r,i="**",o="**",s=t.getCursor("start"),a=t.getCursor("end");n.bold?(r=t.getLine(s.line),i=r.slice(0,s.ch),o=r.slice(s.ch),i=i.replace(/^(.*)?(\*|\_){2}(\S+.*)?$/,"$1$3"),o=o.replace(/^(.*\S+)?(\*|\_){2}(\s+.*)?$/,"$1$3"),s.ch-=2,a.ch-=2,t.setLine(s.line,i+o)):(r=t.getSelection(),t.replaceSelection(i+r+o),s.ch+=2,a.ch+=2),t.setSelection(s,a),t.focus()}function toggleItalic(e){var t=e.codemirror,n=getState(t),r,i="*",o="*",s=t.getCursor("start"),a=t.getCursor("end");n.italic?(r=t.getLine(s.line),i=r.slice(0,s.ch),o=r.slice(s.ch),i=i.replace(/^(.*)?(\*|\_)(\S+.*)?$/,"$1$3"),o=o.replace(/^(.*\S+)?(\*|\_)(\s+.*)?$/,"$1$3"),s.ch-=1,a.ch-=1,t.setLine(s.line,i+o)):(r=t.getSelection(),t.replaceSelection(i+r+o),s.ch+=1,a.ch+=1),t.setSelection(s,a),t.focus()}function toggleBlockquote(e){var t=e.codemirror;_toggleLine(t,"quote")}function toggleUnOrderedList(e){var t=e.codemirror;_toggleLine(t,"unordered-list")}function toggleOrderedList(e){var t=e.codemirror;_toggleLine(t,"ordered-list")}function drawLink(e){var t=e.codemirror,n=getState(t);_replaceSelection(t,n.link,"[","](http://)")}function drawImage(e){var t=e.codemirror,n=getState(t);_replaceSelection(t,n.image,"![","](http://)")}function undo(e){var t=e.codemirror;t.undo(),t.focus()}function redo(e){var t=e.codemirror;t.redo(),t.focus()}function togglePreview(e){var t=e.toolbar.preview,n=e.constructor.markdown,r=e.codemirror,i=r.getWrapperElement(),o=i.lastChild;/editor-preview/.test(o.className)||(o=document.createElement("div"),o.className="editor-preview",i.appendChild(o)),/editor-preview-active/.test(o.className)?(o.className=o.className.replace(/\s*editor-preview-active\s*/g,""),t.className=t.className.replace(/\s*active\s*/g,"")):(setTimeout(function(){o.className+=" editor-preview-active"},1),t.className+=" active");var s=r.getValue();o.innerHTML=n(s)}function _replaceSelection(e,t,n,r){var i,o=e.getCursor("start"),s=e.getCursor("end");t?(i=e.getLine(o.line),n=i.slice(0,o.ch),r=i.slice(o.ch),e.setLine(o.line,n+r)):(i=e.getSelection(),e.replaceSelection(n+i+r),o.ch+=n.length,s.ch+=n.length),e.setSelection(o,s),e.focus()}function _toggleLine(e,t){for(var n=getState(e),r=e.getCursor("start"),i=e.getCursor("end"),o={quote:/^(\s*)\>\s+/,"unordered-list":/^(\s*)(\*|\-|\+)\s+/,"ordered-list":/^(\s*)\d+\.\s+/},s={quote:"> ","unordered-list":"* ","ordered-list":"1. "},a=r.line;a<=i.line;a++)!function(r){var i=e.getLine(r);i=n[t]?i.replace(o[t],"$1"):s[t]+i,e.setLine(r,i)}(a);e.focus()}function wordCount(e){var t=/[a-zA-Z0-9_\u0392-\u03c9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g,n=e.match(t),r=0;if(null===n)return r;for(var i=0;i<n.length;i++)r+=n[i].charCodeAt(0)>=19968?n[i].length:1;return r}function createSharpMarkdown(e){for(var t=e.data("toolbar")?e.data("toolbar"):defaultToolbar,n=[],r=0,i=t.length;i>r;r++){var o=t[r];n.push(" "==o?"|":{name:config_to_toolbar[o][0],action:config_to_toolbar[o][1]})}e.sharp_markdown({toolbar:n}),void 0!=e.data("height")&&e.parents(".sharp-field-markdown").find(".CodeMirror").css("height",e.data("height"))}function createSharpRef(e){var t={};if(e.data("create")&&(t.create=e.data("create")),e.sharp_ref(t),e.data("to_add")){var n=e.data("to_add");e[0].selectize.addOption({value:n,text:n}),e[0].selectize.addItem(n)}}function createSharpTags(e){var t={render:{option_create:function(t,n){return'<div class="create">'+e.data("add_text")+" <strong>"+n(t.input)+"</strong>&hellip;</div>"}}};if(e.data("addable")&&(t.create=function(e,t){t({value:"#"+e,text:e})}),e.sharp_tags(t),e.data("to_add")){var n=e.data("to_add").split(",");for(k=0;k<n.length;k++)e[0].selectize.addOption({value:n[k],text:n[k]}),e[0].selectize.addItem(n[k])}}function createSharpRefSublistItem(e){var t={linked_ref_field:e.data("linked_ref_field"),initial_value:e.data("initial_value")};e.sharp_refSublistItem(t)}function createSharpFile(e){var t=null,n=e.data("thumbnail");if(n){var r=n.split("x");2==r.length&&(t={width:r[0],height:r[1]})}var i=e.data("file_filter"),o=e.data("file_filter_alert");e.sharp_file({url:t?"/admin/uploadWithThumbnail":"/admin/upload",thumbnail:t,progress:!0,file_filter:i,file_filter_alert:o,done:function(e){return e.result.err?(alert(e.result.err),!1):!0},browseButton:{text:'<i class="fa fa-upload"></i> '+e.data("browse_text"),className:"btn"},deleteButton:{text:'<i class="fa fa-times"></i>',className:"btn"}})}function getReadableFileSizeString(e){var t=-1,n=[" Ko"," Mo"," Go"," To","Po","Eo","Zo","Yo"];do e/=1024,t++;while(e>1024);return Math.max(e,.1).toFixed(1)+n[t]}$(function(){var e=window.location.hash;e&&$('ul.entity-tabs a[href="'+e+'"]').tab("show"),$(".entity-tabs a").click(function(e){e.preventDefault(),$(this).tab("show"),history.pushState?history.pushState(null,null,this.hash):location.hash=this.hash})}),/**
 * @preserve jQuery DateTimePicker plugin v2.2.5
 * @homepage http://xdsoft.net/jqplugins/datetimepicker/
 * (c) 2014, Chupurnov Valeriy.
 */
function($){"use strict";var e={i18n:{ru:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayOfWeek:["Вск","Пн","Вт","Ср","Чт","Пт","Сб"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeek:["zo","ma","di","wo","do","vr","za"]},tr:{months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],dayOfWeek:["Paz","Pts","Sal","Çar","Per","Cum","Cts"]},fr:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayOfWeek:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeek:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"]},th:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],dayOfWeek:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."]},pl:{months:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],dayOfWeek:["nd","pn","wt","śr","cz","pt","sb"]},pt:{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"]},ch:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeek:["日","一","二","三","四","五","六"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeek:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"]},kr:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeek:["일","월","화","수","목","금","토"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeek:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"]},da:{months:["January","Februar","Marts","April","Maj","Juni","July","August","September","Oktober","November","December"],dayOfWeek:["Søn","Man","Tir","ons","Tor","Fre","lør"]},ja:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeek:["日","月","火","水","木","金","土"]}},value:"",lang:"en",format:"Y/m/d H:i",formatTime:"H:i",formatDate:"Y/m/d",startDate:!1,step:60,closeOnDateSelect:!1,closeOnWithoutClick:!0,timepicker:!0,datepicker:!0,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,lazyInit:!1,mask:!1,validateOnBlur:!0,allowBlank:!0,yearStart:1950,yearEnd:2050,style:"",id:"",roundTime:"round",className:"",weekends:[],yearOffset:0};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;r>n;n++)if(this[n]===e)return n;return-1}),$.fn.xdsoftScroller=function(e){return this.each(function(){var t=$(this);if(!$(this).hasClass("xdsoft_scroller_box")){var n=function(e){var t={x:0,y:0};if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.x=n.pageX,t.y=n.pageY}else("mousedown"==e.type||"mouseup"==e.type||"mousemove"==e.type||"mouseover"==e.type||"mouseout"==e.type||"mouseenter"==e.type||"mouseleave"==e.type)&&(t.x=e.pageX,t.y=e.pageY);return t},r=0,i=t.children().eq(0),o=t[0].clientHeight,s=i[0].offsetHeight,a=$('<div class="xdsoft_scrollbar"></div>'),l=$('<div class="xdsoft_scroller"></div>'),u=100,c=!1;a.append(l),t.addClass("xdsoft_scroller_box").append(a),l.on("mousedown.xdsoft_scroller",function(n){o||t.trigger("resize_scroll.xdsoft_scroller",[e]);var i=n.pageY,s=parseInt(l.css("margin-top")),c=a[0].offsetHeight;$(document.body).addClass("xdsoft_noselect"),$([document.body,window]).on("mouseup.xdsoft_scroller",function d(){$([document.body,window]).off("mouseup.xdsoft_scroller",d).off("mousemove.xdsoft_scroller",r).removeClass("xdsoft_noselect")}),$(document.body).on("mousemove.xdsoft_scroller",r=function(e){var n=e.pageY-i+s;0>n&&(n=0),n+l[0].offsetHeight>c&&(n=c-l[0].offsetHeight),t.trigger("scroll_element.xdsoft_scroller",[u?n/u:0])})}),t.on("scroll_element.xdsoft_scroller",function(e,n){o||t.trigger("resize_scroll.xdsoft_scroller",[n,!0]),n=n>1?1:0>n||isNaN(n)?0:n,l.css("margin-top",u*n),i.css("marginTop",-parseInt((s-o)*n))}).on("resize_scroll.xdsoft_scroller",function(e,n,r){o=t[0].clientHeight,s=i[0].offsetHeight;var c=o/s,d=c*a[0].offsetHeight;c>1?l.hide():(l.show(),l.css("height",parseInt(d>10?d:10)),u=a[0].offsetHeight-l[0].offsetHeight,r!==!0&&t.trigger("scroll_element.xdsoft_scroller",[n?n:Math.abs(parseInt(i.css("marginTop")))/(s-o)]))}),t.mousewheel&&t.mousewheel(function(e,n,r,a){var l=Math.abs(parseInt(i.css("marginTop")));return t.trigger("scroll_element.xdsoft_scroller",[(l-20*n)/(s-o)]),e.stopPropagation(),!1}),t.on("touchstart",function(e){c=n(e)}),t.on("touchmove",function(e){if(c){var r=n(e),a=Math.abs(parseInt(i.css("marginTop")));t.trigger("scroll_element.xdsoft_scroller",[(a-(r.y-c.y))/(s-o)]),e.stopPropagation(),e.preventDefault()}}),t.on("touchend touchcancel",function(e){c=!1})}t.trigger("resize_scroll.xdsoft_scroller",[e])})},$.fn.datetimepicker=function(t){var n=48,r=57,i=96,o=105,s=17,a=46,l=13,u=27,c=8,d=37,f=38,h=39,p=40,g=9,m=116,v=65,y=67,b=86,x=90,w=89,k=!1,C=$.isPlainObject(t)||!t?$.extend(!0,{},e,t):$.extend({},e),_=0,S=function(e){e.on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function t(n){e.is(":disabled")||e.is(":hidden")||!e.is(":visible")||e.data("xdsoft_datetimepicker")||(clearTimeout(_),_=setTimeout(function(){e.data("xdsoft_datetimepicker")||T(e),e.off("open.xdsoft focusin.xdsoft mousedown.xdsoft",t).trigger("open.xdsoft")},100))})},T=function(e){function t(){var t=C.value?C.value:e&&e.val&&e.val()?e.val():"";return t&&P.isValidDate(t=Date.parseDate(t,C.format))?_.data("changed",!0):t="",t||C.startDate===!1||(t=P.strToDateTime(C.startDate)),t?t:0}var _=$("<div "+(C.id?'id="'+C.id+'"':"")+" "+(C.style?'style="'+C.style+'"':"")+' class="xdsoft_datetimepicker xdsoft_noselect '+C.className+'"></div>'),S=$('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net</a></div>'),T=$('<div class="xdsoft_datepicker active"></div>'),D=$('<div class="xdsoft_mounthpicker"><button type="button" class="xdsoft_prev"></button><button type="button" class="xdsoft_today_button"></button><div class="xdsoft_label xdsoft_month"><span></span></div><div class="xdsoft_label xdsoft_year"><span></span></div><button type="button" class="xdsoft_next"></button></div>'),L=$('<div class="xdsoft_calendar"></div>'),O=$('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"></button><div class="xdsoft_time_box"></div><button type="button" class="xdsoft_next"></button></div>'),M=O.find(".xdsoft_time_box").eq(0),A=$('<div class="xdsoft_time_variant"></div>'),I=$('<div class="xdsoft_scrollbar"></div>'),F=$('<div class="xdsoft_scroller"></div>'),N=$('<div class="xdsoft_select xdsoft_monthselect"><div></div></div>'),H=$('<div class="xdsoft_select xdsoft_yearselect"><div></div></div>');D.find(".xdsoft_month span").after(N),D.find(".xdsoft_year span").after(H),D.find(".xdsoft_month,.xdsoft_year").on("mousedown.xdsoft",function(e){D.find(".xdsoft_select").hide();var t=$(this).find(".xdsoft_select").eq(0),n=0,r=0;P.currentTime&&(n=P.currentTime[$(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),t.show();for(var i=t.find("div.xdsoft_option"),o=0;o<i.length&&i.eq(o).data("value")!=n;o++)r+=i[0].offsetHeight;return t.xdsoftScroller(r/(t.children()[0].offsetHeight-t[0].clientHeight)),e.stopPropagation(),!1}),D.find(".xdsoft_select").xdsoftScroller().on("mousedown.xdsoft",function(e){e.stopPropagation(),e.preventDefault()}).on("mousedown.xdsoft",".xdsoft_option",function(e){P&&P.currentTime&&P.currentTime[$(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"]($(this).data("value")),$(this).parent().parent().hide(),_.trigger("xchange.xdsoft"),C.onChangeMonth&&C.onChangeMonth.call&&C.onChangeMonth.call(_,P.currentTime,_.data("input"))}),_.setOptions=function(t){if(C=$.extend(!0,{},C,t),t.allowTimes&&$.isArray(t.allowTimes)&&t.allowTimes.length&&(C.allowTimes=$.extend(!0,[],t.allowTimes)),t.weekends&&$.isArray(t.weekends)&&t.weekends.length&&(C.weekends=$.extend(!0,[],t.weekends)),!C.open&&!C.opened||C.inline||e.trigger("open.xdsoft"),C.inline&&(_.addClass("xdsoft_inline"),e.after(_).hide(),_.trigger("afterOpen.xdsoft")),C.inverseButton&&(C.next="xdsoft_prev",C.prev="xdsoft_next"),C.datepicker?T.addClass("active"):T.removeClass("active"),C.timepicker?O.addClass("active"):O.removeClass("active"),C.value&&(e&&e.val&&e.val(C.value),P.setCurrentTime(C.value)),C.dayOfWeekStart=isNaN(C.dayOfWeekStart)||parseInt(C.dayOfWeekStart)<0||parseInt(C.dayOfWeekStart)>6?0:parseInt(C.dayOfWeekStart),C.timepickerScrollbar||I.hide(),C.minDate&&/^-(.*)$/.test(C.minDate)&&(C.minDate=P.strToDateTime(C.minDate).dateFormat(C.formatDate)),C.maxDate&&/^\+(.*)$/.test(C.maxDate)&&(C.maxDate=P.strToDateTime(C.maxDate).dateFormat(C.formatDate)),D.find(".xdsoft_today_button").css("visibility",C.todayButton?"visible":"hidden"),C.mask){var S,L=function(e){try{if(document.selection&&document.selection.createRange){var t=document.selection.createRange();return t.getBookmark().charCodeAt(2)-2}if(e.setSelectionRange)return e.selectionStart}catch(n){return 0}},M=function(e,t){var e="string"==typeof e||e instanceof String?document.getElementById(e):e;if(!e)return!1;if(e.createTextRange){var n=e.createTextRange();return n.collapse(!0),n.moveEnd(t),n.moveStart(t),n.select(),!0}return e.setSelectionRange?(e.setSelectionRange(t,t),!0):!1},A=function(e,t){var n=e.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return RegExp(n).test(t)};switch(e.off("keydown.xdsoft"),!0){case C.mask===!0:C.mask=C.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59");case"string"==$.type(C.mask):A(C.mask,e.val())||e.val(C.mask.replace(/[0-9]/g,"_")),e.on("keydown.xdsoft",function(t){var _=this.value,S=t.which;switch(!0){case S>=n&&r>=S||S>=i&&o>=S||S==c||S==a:var T=L(this),D=S!=c&&S!=a?String.fromCharCode(S>=i&&o>=S?S-n:S):"_";for(S!=c&&S!=a||!T||(T--,D="_");/[^0-9_]/.test(C.mask.substr(T,1))&&T<C.mask.length&&T>0;)T+=S==c||S==a?-1:1;if(_=_.substr(0,T)+D+_.substr(T+1),""==$.trim(_))_=C.mask.replace(/[0-9]/g,"_");else if(T==C.mask.length)break;for(T+=S==c||S==a?0:1;/[^0-9_]/.test(C.mask.substr(T,1))&&T<C.mask.length&&T>0;)T+=S==c||S==a?-1:1;A(C.mask,_)?(this.value=_,M(this,T)):""==$.trim(_)?this.value=C.mask.replace(/[0-9]/g,"_"):e.trigger("error_input.xdsoft");break;case!!~[v,y,b,x,w].indexOf(S)&&k:case!!~[u,f,p,d,h,m,s,g,l].indexOf(S):return!0}return t.preventDefault(),!1})}}C.validateOnBlur&&e.off("blur.xdsoft").on("blur.xdsoft",function(){C.allowBlank&&!$.trim($(this).val()).length?($(this).val(null),_.data("xdsoft_datetime").empty()):Date.parseDate($(this).val(),C.format)?_.data("xdsoft_datetime").setCurrentTime($(this).val()):($(this).val(P.now().dateFormat(C.format)),_.data("xdsoft_datetime").setCurrentTime($(this).val())),_.trigger("changedatetime.xdsoft")}),C.dayOfWeekStartPrev=0==C.dayOfWeekStart?6:C.dayOfWeekStart-1,_.trigger("xchange.xdsoft")},_.data("options",C).on("mousedown.xdsoft",function(e){return e.stopPropagation(),e.preventDefault(),H.hide(),N.hide(),!1});var E=O.find(".xdsoft_time_box");E.append(A),E.xdsoftScroller(),_.on("afterOpen.xdsoft",function(){E.xdsoftScroller()}),_.append(T).append(O),C.withoutCopyright!==!0&&_.append(S),T.append(D).append(L),$("body").append(_);var P=new function(){var e=this;e.now=function(){var e=new Date;return C.yearOffset&&e.setFullYear(e.getFullYear()+C.yearOffset),e},e.currentTime=this.now(),e.isValidDate=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())},e.setCurrentTime=function(t){e.currentTime="string"==typeof t?e.strToDateTime(t):e.isValidDate(t)?t:e.now(),_.trigger("xchange.xdsoft")},e.empty=function(){e.currentTime=null},e.getCurrentTime=function(t){return e.currentTime},e.nextMonth=function(){var t=e.currentTime.getMonth()+1;return 12==t&&(e.currentTime.setFullYear(e.currentTime.getFullYear()+1),t=0),e.currentTime.setDate(Math.min(Date.daysInMonth[t],e.currentTime.getDate())),e.currentTime.setMonth(t),C.onChangeMonth&&C.onChangeMonth.call&&C.onChangeMonth.call(_,P.currentTime,_.data("input")),_.trigger("xchange.xdsoft"),t},e.prevMonth=function(){var t=e.currentTime.getMonth()-1;return-1==t&&(e.currentTime.setFullYear(e.currentTime.getFullYear()-1),t=11),e.currentTime.setDate(Math.min(Date.daysInMonth[t],e.currentTime.getDate())),e.currentTime.setMonth(t),C.onChangeMonth&&C.onChangeMonth.call&&C.onChangeMonth.call(_,P.currentTime,_.data("input")),_.trigger("xchange.xdsoft"),t},e.strToDateTime=function(t){var n=[],r,i;return(n=/^(\+|\-)(.*)$/.exec(t))&&(n[2]=Date.parseDate(n[2],C.formatDate))?(r=n[2].getTime()-1*n[2].getTimezoneOffset()*6e4,i=new Date(P.now().getTime()+parseInt(n[1]+"1")*r)):i=t?Date.parseDate(t,C.format):e.now(),e.isValidDate(i)||(i=e.now()),i},e.strtodate=function(t){var n=t?Date.parseDate(t,C.formatDate):e.now();return e.isValidDate(n)||(n=e.now()),n},e.strtotime=function(t){var n=t?Date.parseDate(t,C.formatTime):e.now();return e.isValidDate(n)||(n=e.now()),n},e.str=function(){return e.currentTime.dateFormat(C.format)}};D.find(".xdsoft_today_button").on("mousedown.xdsoft",function(){_.data("changed",!0),P.setCurrentTime(0),_.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){e.val(P.str()),_.trigger("close.xdsoft")}),D.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var e=$(this),t=0,n=!1;!function r(i){var o=P.currentTime.getMonth();e.hasClass(C.next)?P.nextMonth():e.hasClass(C.prev)&&P.prevMonth(),!n&&(t=setTimeout(r,i?i:100))}(500),$([document.body,window]).on("mouseup.xdsoft",function i(){clearTimeout(t),n=!0,$([document.body,window]).off("mouseup.xdsoft",i)})}),O.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var e=$(this),t=0,n=!1,r=110;!function i(o){var s=M[0].clientHeight,a=A[0].offsetHeight,l=Math.abs(parseInt(A.css("marginTop")));e.hasClass(C.next)&&a-s-C.timeHeightInTimePicker>=l?A.css("marginTop","-"+(l+C.timeHeightInTimePicker)+"px"):e.hasClass(C.prev)&&l-C.timeHeightInTimePicker>=0&&A.css("marginTop","-"+(l-C.timeHeightInTimePicker)+"px"),M.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(A.css("marginTop"))/(a-s))]),r=r>10?10:r-10,!n&&(t=setTimeout(i,o?o:r))}(500),$([document.body,window]).on("mouseup.xdsoft",function o(){clearTimeout(t),n=!0,$([document.body,window]).off("mouseup.xdsoft",o)})});var W=0;_.on("xchange.xdsoft",function(e){clearTimeout(W),W=setTimeout(function(){var e="",t=new Date(P.currentTime.getFullYear(),P.currentTime.getMonth(),1,12,0,0),n=0,r=P.now();for(console.log("fire xchange.xdsoft",P.currentTime);t.getDay()!=C.dayOfWeekStart;)t.setDate(t.getDate()-1);e+="<table><thead><tr>";for(var i=0;7>i;i++)e+="<th>"+C.i18n[C.lang].dayOfWeek[i+C.dayOfWeekStart>6?0:i+C.dayOfWeekStart]+"</th>";e+="</tr></thead>",e+="<tbody><tr>";var o=!1,s=!1;C.maxDate!==!1&&(o=P.strtodate(C.maxDate),o=new Date(o.getFullYear(),o.getMonth(),o.getDate(),23,59,59,999)),C.minDate!==!1&&(s=P.strtodate(C.minDate),s=new Date(s.getFullYear(),s.getMonth(),s.getDate()));for(var a,l,u,c=[];n<P.currentTime.getDaysInMonth()||t.getDay()!=C.dayOfWeekStart||P.currentTime.getMonth()==t.getMonth();)c=[],n++,a=t.getDate(),l=t.getFullYear(),u=t.getMonth(),c.push("xdsoft_date"),(o!==!1&&t>o||s!==!1&&s>t)&&c.push("xdsoft_disabled"),P.currentTime.getMonth()!=u&&c.push("xdsoft_other_month"),(C.defaultSelect||_.data("changed"))&&P.currentTime.dateFormat("d.m.Y")==t.dateFormat("d.m.Y")&&c.push("xdsoft_current"),r.dateFormat("d.m.Y")==t.dateFormat("d.m.Y")&&c.push("xdsoft_today"),(0==t.getDay()||6==t.getDay()||~C.weekends.indexOf(t.dateFormat("d.m.Y")))&&c.push("xdsoft_weekend"),e+='<td data-date="'+a+'" data-month="'+u+'" data-year="'+l+'" class="xdsoft_date xdsoft_day_of_week'+t.getDay()+" "+c.join(" ")+'"><div>'+a+"</div></td>",t.getDay()==C.dayOfWeekStartPrev&&(e+="</tr>"),t.setDate(a+1);e+="</tbody></table>",L.html(e),D.find(".xdsoft_label span").eq(0).text(C.i18n[C.lang].months[P.currentTime.getMonth()]),D.find(".xdsoft_label span").eq(1).text(P.currentTime.getFullYear());var d="",f="",u="",h=function g(e,t){var n=P.now();n.setHours(e),e=parseInt(n.getHours()),n.setMinutes(t),t=parseInt(n.getMinutes()),c=[],(C.maxTime!==!1&&P.strtotime(C.maxTime).getTime()<n.getTime()||C.minTime!==!1&&P.strtotime(C.minTime).getTime()>n.getTime())&&c.push("xdsoft_disabled"),(C.initTime||C.defaultSelect||_.data("changed"))&&parseInt(P.currentTime.getHours())==parseInt(e)&&(C.step>59||Math[C.roundTime](P.currentTime.getMinutes()/C.step)*C.step==parseInt(t))&&(C.defaultSelect||_.data("changed")?c.push("xdsoft_current"):C.initTime&&c.push("xdsoft_init_time")),parseInt(r.getHours())==parseInt(e)&&parseInt(r.getMinutes())==parseInt(t)&&c.push("xdsoft_today"),d+='<div class="xdsoft_time '+c.join(" ")+'" data-hour="'+e+'" data-minute="'+t+'">'+n.dateFormat(C.formatTime)+"</div>"};if(C.allowTimes&&$.isArray(C.allowTimes)&&C.allowTimes.length)for(var n=0;n<C.allowTimes.length;n++)f=P.strtotime(C.allowTimes[n]).getHours(),u=P.strtotime(C.allowTimes[n]).getMinutes(),h(f,u);else for(var n=0,i=0;n<(C.hours12?12:24);n++)for(i=0;60>i;i+=C.step)f=(10>n?"0":"")+n,u=(10>i?"0":"")+i,h(f,u);A.html(d);var p="",n=0;for(n=parseInt(C.yearStart,10)+C.yearOffset;n<=parseInt(C.yearEnd,10)+C.yearOffset;n++)p+='<div class="xdsoft_option '+(P.currentTime.getFullYear()==n?"xdsoft_current":"")+'" data-value="'+n+'">'+n+"</div>";for(H.children().eq(0).html(p),n=0,p="";11>=n;n++)p+='<div class="xdsoft_option '+(P.currentTime.getMonth()==n?"xdsoft_current":"")+'" data-value="'+n+'">'+C.i18n[C.lang].months[n]+"</div>";N.children().eq(0).html(p),$(this).trigger("generate.xdsoft")},10),e.stopPropagation()}).on("afterOpen.xdsoft",function(){if(C.timepicker){var e;if(A.find(".xdsoft_current").length?e=".xdsoft_current":A.find(".xdsoft_init_time").length&&(e=".xdsoft_init_time"),e){var t=M[0].clientHeight,n=A[0].offsetHeight,r=A.find(e).index()*C.timeHeightInTimePicker+1;r>n-t&&(r=n-t),A.css("marginTop","-"+parseInt(r)+"px"),M.trigger("scroll_element.xdsoft_scroller",[parseInt(r)/(n-t)])}}});var z=0;L.on("click.xdsoft","td",function(t){t.stopPropagation(),z++;var n=$(this),r=P.currentTime;return n.hasClass("xdsoft_disabled")?!1:(r.setDate(n.data("date")),r.setMonth(n.data("month")),r.setFullYear(n.data("year")),_.trigger("select.xdsoft",[r]),e.val(P.str()),(z>1||C.closeOnDateSelect===!0||0===C.closeOnDateSelect&&!C.timepicker)&&!C.inline&&_.trigger("close.xdsoft"),C.onSelectDate&&C.onSelectDate.call&&C.onSelectDate.call(_,P.currentTime,_.data("input")),_.data("changed",!0),_.trigger("xchange.xdsoft"),_.trigger("changedatetime.xdsoft"),void setTimeout(function(){z=0},200))}),A.on("click.xdsoft","div",function(e){e.stopPropagation();var t=$(this),n=P.currentTime;return t.hasClass("xdsoft_disabled")?!1:(n.setHours(t.data("hour")),n.setMinutes(t.data("minute")),_.trigger("select.xdsoft",[n]),_.data("input").val(P.str()),!C.inline&&_.trigger("close.xdsoft"),C.onSelectTime&&C.onSelectTime.call&&C.onSelectTime.call(_,P.currentTime,_.data("input")),_.data("changed",!0),_.trigger("xchange.xdsoft"),void _.trigger("changedatetime.xdsoft"))}),_.mousewheel&&T.mousewheel(function(e,t,n,r){return C.scrollMonth?(0>t?P.nextMonth():P.prevMonth(),!1):!0}),_.mousewheel&&M.unmousewheel().mousewheel(function(e,t,n,r){if(!C.scrollTime)return!0;var i=M[0].clientHeight,o=A[0].offsetHeight,s=Math.abs(parseInt(A.css("marginTop"))),a=!0;return 0>t&&o-i-C.timeHeightInTimePicker>=s?(A.css("marginTop","-"+(s+C.timeHeightInTimePicker)+"px"),a=!1):t>0&&s-C.timeHeightInTimePicker>=0&&(A.css("marginTop","-"+(s-C.timeHeightInTimePicker)+"px"),a=!1),M.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(A.css("marginTop"))/(o-i))]),e.stopPropagation(),a}),_.on("changedatetime.xdsoft",function(){if(C.onChangeDateTime&&C.onChangeDateTime.call){var e=_.data("input");C.onChangeDateTime.call(_,P.currentTime,e),e.trigger("change")}}).on("generate.xdsoft",function(){C.onGenerate&&C.onGenerate.call&&C.onGenerate.call(_,P.currentTime,_.data("input"))});var R=0;e.mousewheel&&e.mousewheel(function(t,n,r,i){return C.scrollInput?!C.datepicker&&C.timepicker?(R=A.find(".xdsoft_current").length?A.find(".xdsoft_current").eq(0).index():0,R+n>=0&&R+n<A.children().length&&(R+=n),A.children().eq(R).length&&A.children().eq(R).trigger("mousedown"),!1):C.datepicker&&!C.timepicker?(T.trigger(t,[n,r,i]),e.val&&e.val(P.str()),_.trigger("changedatetime.xdsoft"),!1):void 0:!0});var j=function(){var e=_.data("input").offset(),t=e.top+_.data("input")[0].offsetHeight-1,n=e.left;t+_[0].offsetHeight>$(window).height()+$(window).scrollTop()&&(t=e.top-_[0].offsetHeight+1),0>t&&(t=0),n+_[0].offsetWidth>$(window).width()&&(n=e.left-_[0].offsetWidth+_.data("input")[0].offsetWidth),_.css({left:n,top:t})};_.on("open.xdsoft",function(){var e=!0;C.onShow&&C.onShow.call&&(e=C.onShow.call(_,P.currentTime,_.data("input"))),e!==!1&&(_.show(),_.trigger("afterOpen.xdsoft"),j(),$(window).off("resize.xdsoft",j).on("resize.xdsoft",j),C.closeOnWithoutClick&&$([document.body,window]).on("mousedown.xdsoft",function t(){_.trigger("close.xdsoft"),$([document.body,window]).off("mousedown.xdsoft",t)}))}).on("close.xdsoft",function(e){var t=!0;C.onClose&&C.onClose.call&&(t=C.onClose.call(_,P.currentTime,_.data("input"))),t===!1||C.opened||C.inline||_.hide(),e.stopPropagation()}).data("input",e);var B=0,q=0;_.data("xdsoft_datetime",P),_.setOptions(C),P.setCurrentTime(t()),_.trigger("afterOpen.xdsoft"),e.data("xdsoft_datetimepicker",_).on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function(n){e.is(":disabled")||e.is(":hidden")||!e.is(":visible")||(clearTimeout(B),B=setTimeout(function(){e.is(":disabled")||e.is(":hidden")||!e.is(":visible")||(P.setCurrentTime(t()),_.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(e){var t=this.value,n=e.which;switch(!0){case!!~[l].indexOf(n):var r=$("input:visible,textarea:visible");return _.trigger("close.xdsoft"),r.eq(r.index(this)+1).focus(),!1;case!!~[g].indexOf(n):return _.trigger("close.xdsoft"),!0}})},D=function(e){var t=e.data("xdsoft_datetimepicker");t&&(t.data("xdsoft_datetime",null),t.remove(),e.data("xdsoft_datetimepicker",null).off("open.xdsoft focusin.xdsoft focusout.xdsoft mousedown.xdsoft blur.xdsoft keydown.xdsoft"),$(window).off("resize.xdsoft"),$([window,document.body]).off("mousedown.xdsoft"),e.unmousewheel&&e.unmousewheel())};return $(document).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(e){e.keyCode==s&&(k=!0)}).on("keyup.xdsoftctrl",function(e){e.keyCode==s&&(k=!1)}),this.each(function(){var e;if(e=$(this).data("xdsoft_datetimepicker")){if("string"===$.type(t))switch(t){case"show":$(this).select().focus(),e.trigger("open.xdsoft");break;case"hide":e.trigger("close.xdsoft");break;case"destroy":D($(this));break;case"reset":this.value=this.defaultValue,this.value&&e.data("xdsoft_datetime").isValidDate(Date.parseDate(this.value,C.format))||e.data("changed",!1),e.data("xdsoft_datetime").setCurrentTime(this.value)}else e.setOptions(t);return 0}"string"!==$.type(t)&&(!C.lazyInit||C.open||C.inline?T($(this)):S($(this)))})}}(jQuery),Date.parseFunctions={count:0},Date.parseRegexes=[],Date.formatFunctions={count:0},Date.prototype.dateFormat=function(e){if("unixtime"==e)return parseInt(this.getTime()/1e3);null==Date.formatFunctions[e]&&Date.createNewFormat(e);var t=Date.formatFunctions[e];return this[t]()},Date.createNewFormat=function(a){var b="format"+Date.formatFunctions.count++;Date.formatFunctions[a]=b;for(var c="Date.prototype."+b+" = function() {return ",d=!1,e="",i=0;i<a.length;++i)e=a.charAt(i),d||"\\"!=e?d?(d=!1,c+="'"+String.escape(e)+"' + "):c+=Date.getFormatCode(e):d=!0;eval(c.substring(0,c.length-3)+";}")},Date.getFormatCode=function(e){switch(e){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(e)+"' + "}},Date.parseDate=function(e,t){if("unixtime"==t)return new Date(isNaN(parseInt(e))?0:1e3*parseInt(e));null==Date.parseFunctions[t]&&Date.createParser(t);var n=Date.parseFunctions[t];return Date[n](e)},Date.createParser=function(a){var b="parse"+Date.parseFunctions.count++,c=Date.parseRegexes.length,d=1;Date.parseFunctions[a]=b;for(var e="Date."+b+" = function(input) {\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+c+"]);\nif (results && results.length > 0) {",f="",g=!1,h="",i=0;i<a.length;++i)h=a.charAt(i),g||"\\"!=h?g?(g=!1,f+=String.escape(h)):(obj=Date.formatCodeToRegex(h,d),d+=obj.g,f+=obj.s,obj.g&&obj.c&&(e+=obj.c)):g=!0;e+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}",Date.parseRegexes[c]=new RegExp("^"+f+"$"),eval(e)},Date.formatCodeToRegex=function(e,t){switch(e){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+t+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+t+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+t+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+t+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+t+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+t+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+t+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+t+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+t+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+t+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+t+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(e)}}},Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+String.leftPad(Math.abs(this.getTimezoneOffset())%60,2,"0")},Date.prototype.getDayOfYear=function(){var e=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var t=0;t<this.getMonth();++t)e+=Date.daysInMonth[t];return e+this.getDate()},Date.prototype.getWeekOfYear=function(){var e=this.getDayOfYear()+(4-this.getDay()),t=new Date(this.getFullYear(),0,1),n=7-t.getDay()+4;return String.leftPad(Math.ceil((e-n)/7)+1,2,"0")},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return 0==(3&e)&&(e%100||e%400==0&&e)},Date.prototype.getFirstDayOfMonth=function(){var e=(this.getDay()-(this.getDate()-1))%7;return 0>e?e+7:e},Date.prototype.getLastDayOfMonth=function(){var e=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return 0>e?e+7:e},Date.prototype.getDaysInMonth=function(){return Date.daysInMonth[1]=this.isLeapYear()?29:28,Date.daysInMonth[this.getMonth()]},Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},String.escape=function(e){return e.replace(/('|\\)/g,"\\$1")},String.leftPad=function(e,t,n){var r=new String(e);for(null==n&&(n=" ");r.length<t;)r=n+r;return r},Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.y2kYear=50,Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function($){function e(e){var t=e||window.event,n=[].slice.call(arguments,1),o=0,s=0,a=0,l=0,u=0,c;
return e=$.event.fix(t),e.type="mousewheel",t.wheelDelta&&(o=t.wheelDelta),t.detail&&(o=-1*t.detail),t.deltaY&&(a=-1*t.deltaY,o=a),t.deltaX&&(s=t.deltaX,o=-1*s),void 0!==t.wheelDeltaY&&(a=t.wheelDeltaY),void 0!==t.wheelDeltaX&&(s=-1*t.wheelDeltaX),l=Math.abs(o),(!r||r>l)&&(r=l),u=Math.max(Math.abs(a),Math.abs(s)),(!i||i>u)&&(i=u),c=o>0?"floor":"ceil",o=Math[c](o/r),s=Math[c](s/i),a=Math[c](a/i),n.unshift(e,o,s,a),($.event.dispatch||$.event.handle).apply(this,n)}var t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r,i;if($.event.fixHooks)for(var o=t.length;o;)$.event.fixHooks[t[--o]]=$.event.mouseHooks;$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=n.length;t;)this.addEventListener(n[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=n.length;t;)this.removeEventListener(n[--t],e,!1);else this.onmousewheel=null}},$.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function($){$.fn.sharp_date=function(e){var t={timepicker:!1,datepicker:!0,step:30,lang:"fr",format:"d/m/Y",dayOfWeekStart:1,mask:!0},n=$.extend(t,e);return this.each(function(){var e=$(this).prev(".sharp-date-timestamp");n.onChangeDateTime=function(t,n){e.val(t)},$(this).datetimepicker(n)})}}(jQuery),$(window).load(function(){$(".sharp-date").each(function(){createSharpDate($(this))})}),$(window).load(function(){$form=$("#sharpform"),$form.on("click",".sharp-embed-update",function(e){e.preventDefault(),$form.prop("action",$(this).prop("href")),$form.submit()}),$form.on("click",".sharp-embed-delete",function(e){e.preventDefault(),fieldName=$(this).data("fieldname"),$field=$(this).parents(".sharp-field-embed"),$field.find(".panel-embed").removeClass("updatable").addClass("creatable"),$field.find(".panel-embed-body").empty(),$input=$field.find("#"+fieldName),$input.val("__DELETE__")})});var toolbar=[{name:"bold",action:toggleBold},{name:"italic",action:toggleItalic},"|",{name:"quote",action:toggleBlockquote},{name:"unordered-list",action:toggleUnOrderedList},{name:"ordered-list",action:toggleOrderedList},"|",{name:"link",action:drawLink},{name:"image",action:drawImage},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:togglePreview},{name:"fullscreen",action:toggleFullScreen}];Editor.toolbar=toolbar,Editor.markdown=function(e){return window.marked?marked(e):void 0},Editor.prototype.render=function(e){if(e||(e=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==e){this.element=e;var t=this.options,n=this,r={};for(var i in shortcuts)!function(e){r[fixShortcut(e)]=function(t){shortcuts[e](n)}}(i);r.Enter="newlineAndIndentContinueMarkdownList",this.codemirror=CodeMirror.fromTextArea(e,{mode:"markdown",theme:"paper",indentWithTabs:!0,lineNumbers:!1,extraKeys:r}),t.toolbar!==!1&&this.createToolbar(),t.status!==!1&&this.createStatusbar(),this._rendered=this.element}},Editor.prototype.createToolbar=function(e){if(e=e||this.options.toolbar,e&&0!==e.length){var t=document.createElement("div");t.className="editor-toolbar";var n=this,r;n.toolbar={};for(var i=0;i<e.length;i++)!function(e){var r;r=e.name?createIcon(e.name,e):"|"===e?createSep():createIcon(e),e.action&&("function"==typeof e.action?r.onclick=function(t){e.action(n)}:"string"==typeof e.action&&(r.href=e.action,r.target="_blank")),n.toolbar[e.name||e]=r,t.appendChild(r)}(e[i]);var o=this.codemirror;o.on("cursorActivity",function(){var e=getState(o);for(var t in n.toolbar)!function(t){var r=n.toolbar[t];e[t]?r.className+=" active":r.className=r.className.replace(/\s*active\s*/g,"")}(t)});var s=o.getWrapperElement();return s.parentNode.insertBefore(t,s),t}},Editor.prototype.createStatusbar=function(e){if(e=e||this.options.status,e&&0!==e.length){var t=document.createElement("div");t.className="editor-statusbar";for(var n,r=this.codemirror,i=0;i<e.length;i++)!function(e){var i=document.createElement("span");i.className=e,"words"===e?(i.innerHTML="0",r.on("update",function(){i.innerHTML=wordCount(r.getValue())})):"lines"===e?(i.innerHTML="0",r.on("update",function(){i.innerHTML=r.lineCount()})):"cursor"===e&&(i.innerHTML="0:0",r.on("cursorActivity",function(){n=r.getCursor(),i.innerHTML=n.line+":"+n.ch})),t.appendChild(i)}(e[i]);var o=this.codemirror.getWrapperElement();return o.parentNode.insertBefore(t,o.nextSibling),t}},Editor.toggleBold=toggleBold,Editor.toggleItalic=toggleItalic,Editor.toggleBlockquote=toggleBlockquote,Editor.toggleUnOrderedList=toggleUnOrderedList,Editor.toggleOrderedList=toggleOrderedList,Editor.drawLink=drawLink,Editor.drawImage=drawImage,Editor.undo=undo,Editor.redo=redo,Editor.toggleFullScreen=toggleFullScreen,Editor.prototype.toggleBold=function(){toggleBold(this)},Editor.prototype.toggleItalic=function(){toggleItalic(this)},Editor.prototype.toggleBlockquote=function(){toggleBlockquote(this)},Editor.prototype.toggleUnOrderedList=function(){toggleUnOrderedList(this)},Editor.prototype.toggleOrderedList=function(){toggleOrderedList(this)},Editor.prototype.drawLink=function(){drawLink(this)},Editor.prototype.drawImage=function(){drawImage(this)},Editor.prototype.undo=function(){undo(this)},Editor.prototype.redo=function(){redo(this)},Editor.prototype.toggleFullScreen=function(){toggleFullScreen(this)};var isMac=/Mac/.test(navigator.platform),shortcuts={"Cmd-B":toggleBold,"Cmd-I":toggleItalic,"Cmd-K":drawLink,"Cmd-Alt-I":drawImage,"Cmd-'":toggleBlockquote,"Cmd-Alt-L":toggleOrderedList,"Cmd-L":toggleUnOrderedList};window.CodeMirror=function(){"use strict";function e(n,r){if(!(this instanceof e))return new e(n,r);this.options=r=r||{};for(var i in io)!r.hasOwnProperty(i)&&io.hasOwnProperty(i)&&(r[i]=io[i]);f(r);var o="string"==typeof r.value?0:r.value.first,s=this.display=t(n,o);s.wrapper.CodeMirror=this,u(this),r.autofocus&&!Pi&&pt(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new Vr},a(this),r.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");var l=r.value;"string"==typeof l&&(l=new bo(r.value,r.mode)),st(this,dr)(this,l),Si&&setTimeout(ti(ht,this,!0),20),mt(this);var c;try{c=document.activeElement==s.input}catch(d){}c||r.autofocus&&!Pi?setTimeout(ti(It,this),20):Ft(this),st(this,function(){for(var e in ro)ro.propertyIsEnumerable(e)&&ro[e](this,r[e],oo);for(var t=0;t<uo.length;++t)uo[t](this)})()}function t(e,t){var n={},r=n.input=ii("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");return Li?r.style.width="1000px":r.setAttribute("wrap","off"),Ei&&(r.style.border="1px solid black"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false"),n.inputDiv=ii("div",[r],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),n.scrollbarH=ii("div",[ii("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),n.scrollbarV=ii("div",[ii("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),n.scrollbarFiller=ii("div",null,"CodeMirror-scrollbar-filler"),n.gutterFiller=ii("div",null,"CodeMirror-gutter-filler"),n.lineDiv=ii("div",null,"CodeMirror-code"),n.selectionDiv=ii("div",null,null,"position: relative; z-index: 1"),n.cursor=ii("div"," ","CodeMirror-cursor"),n.otherCursor=ii("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"),n.measure=ii("div",null,"CodeMirror-measure"),n.lineSpace=ii("div",[n.measure,n.selectionDiv,n.lineDiv,n.cursor,n.otherCursor],null,"position: relative; outline: none"),n.mover=ii("div",[ii("div",[n.lineSpace],"CodeMirror-lines")],null,"position: relative"),n.sizer=ii("div",[n.mover],"CodeMirror-sizer"),n.heightForcer=ii("div",null,null,"position: absolute; height: "+_o+"px; width: 1px;"),n.gutters=ii("div",null,"CodeMirror-gutters"),n.lineGutter=null,n.scroller=ii("div",[n.sizer,n.heightForcer,n.gutters],"CodeMirror-scroll"),n.scroller.setAttribute("tabIndex","-1"),n.wrapper=ii("div",[n.inputDiv,n.scrollbarH,n.scrollbarV,n.scrollbarFiller,n.gutterFiller,n.scroller],"CodeMirror"),Ti&&(n.gutters.style.zIndex=-1,n.scroller.style.paddingRight=0),e.appendChild?e.appendChild(n.wrapper):e(n.wrapper),Ei&&(r.style.width="0px"),Li||(n.scroller.draggable=!0),Fi?(n.inputDiv.style.height="1px",n.inputDiv.style.position="absolute"):Ti&&(n.scrollbarH.style.minWidth=n.scrollbarV.style.minWidth="18px"),n.viewOffset=n.lastSizeC=0,n.showingFrom=n.showingTo=t,n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null,n.prevInput="",n.alignWidgets=!1,n.pollingFast=!1,n.poll=new Vr,n.cachedCharWidth=n.cachedTextHeight=null,n.measureLineCache=[],n.measureLineCachePos=0,n.inaccurateSelection=!1,n.maxLine=null,n.maxLineLength=0,n.maxLineChanged=!1,n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null,n}function n(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),t.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),t.doc.frontier=t.doc.first,I(t,100),t.state.modeGen++,t.curOp&&ut(t)}function r(e){e.options.lineWrapping?(e.display.wrapper.className+=" CodeMirror-wrap",e.display.sizer.style.minWidth=""):(e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),d(e)),o(e),ut(e),V(e),setTimeout(function(){h(e)},100)}function i(e){var t=nt(e.display),n=e.options.lineWrapping,r=n&&Math.max(5,e.display.scroller.clientWidth/rt(e.display)-3);return function(i){return Rn(e.doc,i)?0:n?(Math.ceil(i.text.length/r)||1)*t:t}}function o(e){var t=e.doc,n=i(e);t.iter(function(e){var t=n(e);t!=e.height&&gr(e,t)})}function s(e){var t=ho[e.options.keyMap],n=t.style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(n?" cm-keymap-"+n:""),e.state.disableInput=t.disableInput}function a(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),V(e)}function l(e){u(e),ut(e),setTimeout(function(){g(e)},20)}function u(e){var t=e.display.gutters,n=e.options.gutters;oi(t);for(var r=0;r<n.length;++r){var i=n[r],o=t.appendChild(ii("div",null,"CodeMirror-gutter "+i));"CodeMirror-linenumbers"==i&&(e.display.lineGutter=o,o.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none"}function c(e,t){if(0==t.height)return 0;for(var n=t.text.length,r,i=t;r=Pn(i);){var o=r.find();i=fr(e,o.from.line),n+=o.from.ch-o.to.ch}for(i=t;r=Wn(i);){var o=r.find();n-=i.text.length-o.from.ch,i=fr(e,o.to.line),n+=i.text.length-o.to.ch}return n}function d(e){var t=e.display,n=e.doc;t.maxLine=fr(n,n.first),t.maxLineLength=c(n,t.maxLine),t.maxLineChanged=!0,n.iter(function(e){var r=c(n,e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function f(e){for(var t=!1,n=0;n<e.gutters.length;++n)"CodeMirror-linenumbers"==e.gutters[n]&&(e.lineNumbers?t=!0:e.gutters.splice(n--,1));!t&&e.lineNumbers&&e.gutters.push("CodeMirror-linenumbers")}function h(e){var t=e.display,n=e.doc.height,r=n+P(t);t.sizer.style.minHeight=t.heightForcer.style.top=r+"px",t.gutters.style.height=Math.max(r,t.scroller.clientHeight-_o)+"px";var i=Math.max(r,t.scroller.scrollHeight),o=t.scroller.scrollWidth>t.scroller.clientWidth+1,s=i>t.scroller.clientHeight+1;s?(t.scrollbarV.style.display="block",t.scrollbarV.style.bottom=o?ci(t.measure)+"px":"0",t.scrollbarV.firstChild.style.height=i-t.scroller.clientHeight+t.scrollbarV.clientHeight+"px"):t.scrollbarV.style.display="",o?(t.scrollbarH.style.display="block",t.scrollbarH.style.right=s?ci(t.measure)+"px":"0",t.scrollbarH.firstChild.style.width=t.scroller.scrollWidth-t.scroller.clientWidth+t.scrollbarH.clientWidth+"px"):t.scrollbarH.style.display="",o&&s?(t.scrollbarFiller.style.display="block",t.scrollbarFiller.style.height=t.scrollbarFiller.style.width=ci(t.measure)+"px"):t.scrollbarFiller.style.display="",o&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(t.gutterFiller.style.display="block",t.gutterFiller.style.height=ci(t.measure)+"px",t.gutterFiller.style.width=t.gutters.offsetWidth+"px"):t.gutterFiller.style.display="",$i&&0===ci(t.measure)&&(t.scrollbarV.style.minWidth=t.scrollbarH.style.minHeight=Ni?"18px":"12px")}function p(e,t,n){var r=e.scroller.scrollTop,i=e.wrapper.clientHeight;"number"==typeof n?r=n:n&&(r=n.top,i=n.bottom-n.top),r=Math.floor(r-E(e));var o=Math.ceil(r+i);return{from:vr(t,r),to:vr(t,o)}}function g(e){var t=e.display;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=y(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,i=n+"px",o=t.lineDiv.firstChild;o;o=o.nextSibling)if(o.alignable)for(var s=0,a=o.alignable;s<a.length;++s)a[s].style.left=i;e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}}function m(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=v(e.options,t.first+t.size-1),r=e.display;if(n.length!=r.lineNumChars){var i=r.measure.appendChild(ii("div",[ii("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=i.firstChild.offsetWidth,s=i.offsetWidth-o;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(o,r.lineGutter.offsetWidth-s),r.lineNumWidth=r.lineNumInnerWidth+s,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",!0}return!1}function v(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function y(e){return li(e.scroller).left-li(e.sizer).left}function b(e,t,n,r){for(var i=e.display.showingFrom,o=e.display.showingTo,s,a=p(e.display,e.doc,n);x(e,t,a,r)&&(r=!1,s=!0,L(e),h(e),n&&(n=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,"number"==typeof n?n:n.top)),a=p(e.display,e.doc,n),!(a.from>=e.display.showingFrom&&a.to<=e.display.showingTo));)t=[];return s&&(Rr(e,"update",e),(e.display.showingFrom!=i||e.display.showingTo!=o)&&Rr(e,"viewportChange",e,e.display.showingFrom,e.display.showingTo)),s}function x(e,t,n,r){var i=e.display,o=e.doc;if(!i.wrapper.clientWidth)return i.showingFrom=i.showingTo=o.first,void(i.viewOffset=0);if(!(!r&&0==t.length&&n.from>i.showingFrom&&n.to<i.showingTo)){m(e)&&(t=[{from:o.first,to:o.first+o.size}]);var s=i.sizer.style.marginLeft=i.gutters.offsetWidth+"px";i.scrollbarH.style.left=e.options.fixedGutter?s:"0";var a=1/0;if(e.options.lineNumbers)for(var l=0;l<t.length;++l)if(t[l].diff){a=t[l].from;break}var u=o.first+o.size,c=Math.max(n.from-e.options.viewportMargin,o.first),d=Math.min(u,n.to+e.options.viewportMargin);if(i.showingFrom<c&&c-i.showingFrom<20&&(c=Math.max(o.first,i.showingFrom)),i.showingTo>d&&i.showingTo-d<20&&(d=Math.min(u,i.showingTo)),Ui)for(c=mr(zn(o,fr(o,c)));u>d&&Rn(o,fr(o,d));)++d;var f=[{from:Math.max(i.showingFrom,o.first),to:Math.min(i.showingTo,u)}];if(f=f[0].from>=f[0].to?[]:C(f,t),Ui)for(var l=0;l<f.length;++l)for(var h=f[l],p;p=Wn(fr(o,h.to-1));){var g=p.find().from.line;if(!(g>h.from)){f.splice(l--,1);break}h.to=g}for(var v=0,l=0;l<f.length;++l){var h=f[l];h.from<c&&(h.from=c),h.to>d&&(h.to=d),h.from>=h.to?f.splice(l--,1):v+=h.to-h.from}if(!r&&v==d-c&&c==i.showingFrom&&d==i.showingTo)return void k(e);f.sort(function(e,t){return e.from-t.from});try{var y=document.activeElement}catch(b){}.7*(d-c)>v&&(i.lineDiv.style.display="none"),S(e,c,d,f,a),i.lineDiv.style.display="",y&&document.activeElement!=y&&y.offsetHeight&&y.focus();var x=c!=i.showingFrom||d!=i.showingTo||i.lastSizeC!=i.wrapper.clientHeight;return x&&(i.lastSizeC=i.wrapper.clientHeight,I(e,400)),i.showingFrom=c,i.showingTo=d,w(e),k(e),!0}}function w(e){for(var t=e.display,n=t.lineDiv.offsetTop,r=t.lineDiv.firstChild,i;r;r=r.nextSibling)if(r.lineObj){if(Ti){var o=r.offsetTop+r.offsetHeight;i=o-n,n=o}else{var s=li(r);i=s.bottom-s.top}var a=r.lineObj.height-i;if(2>i&&(i=nt(t)),a>.001||-.001>a){gr(r.lineObj,i);var l=r.lineObj.widgets;if(l)for(var u=0;u<l.length;++u)l[u].height=l[u].node.offsetHeight}}}function k(e){var t=e.display.viewOffset=yr(e,fr(e.doc,e.display.showingFrom));e.display.mover.style.top=t+"px"}function C(e,t){for(var n=0,r=t.length||0;r>n;++n){for(var i=t[n],o=[],s=i.diff||0,a=0,l=e.length;l>a;++a){var u=e[a];i.to<=u.from&&i.diff?o.push({from:u.from+s,to:u.to+s}):i.to<=u.from||i.from>=u.to?o.push(u):(i.from>u.from&&o.push({from:u.from,to:i.from}),i.to<u.to&&o.push({from:i.to+s,to:u.to+s}))}e=o}return e}function _(e){for(var t=e.display,n={},r={},i=t.gutters.firstChild,o=0;i;i=i.nextSibling,++o)n[e.options.gutters[o]]=i.offsetLeft,r[e.options.gutters[o]]=i.offsetWidth;return{fixedPos:y(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function S(e,t,n,r,i){function o(t){var n=t.nextSibling;return Li&&Wi&&e.display.currentWheelTarget==t?(t.style.display="none",t.lineObj=null):t.parentNode.removeChild(t),n}var s=_(e),a=e.display,l=e.options.lineNumbers;r.length||Li&&e.display.currentWheelTarget||oi(a.lineDiv);var u=a.lineDiv,c=u.firstChild,d=r.shift(),f=t;for(e.doc.iter(t,n,function(t){if(d&&d.to==f&&(d=r.shift()),Rn(e.doc,t)){if(0!=t.height&&gr(t,0),t.widgets&&c.previousSibling)for(var n=0;n<t.widgets.length;++n){var a=t.widgets[n];if(a.showIfHidden){var h=c.previousSibling;if(/pre/i.test(h.nodeName)){var p=ii("div",null,null,"position: relative");h.parentNode.replaceChild(p,h),p.appendChild(h),h=p}var g=h.appendChild(ii("div",[a.node],"CodeMirror-linewidget"));a.handleMouseEvents||(g.ignoreEvents=!0),D(a,g,h,s)}}}else if(d&&d.from<=f&&d.to>f){for(;c.lineObj!=t;)c=o(c);l&&f>=i&&c.lineNumber&&ai(c.lineNumber,v(e.options,f)),c=c.nextSibling}else{if(t.widgets)for(var m=0,y=c,b;y&&20>m;++m,y=y.nextSibling)if(y.lineObj==t&&/div/i.test(y.nodeName)){b=y;break}var x=T(e,t,f,s,b);if(x!=b)u.insertBefore(x,c);else{for(;c!=b;)c=o(c);c=c.nextSibling}x.lineObj=t}++f});c;)c=o(c)}function T(e,t,n,r,i){var o=tr(e,t),s=t.gutterMarkers,a=e.display,l;if(!(e.options.lineNumbers||s||t.bgClass||t.wrapClass||t.widgets))return o;if(i){i.alignable=null;for(var u=!0,c=0,d=null,f=i.firstChild,h;f;f=h)if(h=f.nextSibling,/\bCodeMirror-linewidget\b/.test(f.className)){for(var p=0;p<t.widgets.length;++p){var g=t.widgets[p];if(g.node==f.firstChild){g.above||d||(d=f),D(g,f,i,r),++c;break}}if(p==t.widgets.length){u=!1;break}}else i.removeChild(f);i.insertBefore(o,d),u&&c==t.widgets.length&&(l=i,i.className=t.wrapClass||"")}if(l||(l=ii("div",null,t.wrapClass,"position: relative"),l.appendChild(o)),t.bgClass&&l.insertBefore(ii("div",null,t.bgClass+" CodeMirror-linebackground"),l.firstChild),e.options.lineNumbers||s){var m=l.insertBefore(ii("div",null,null,"position: absolute; left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px"),l.firstChild);if(e.options.fixedGutter&&(l.alignable||(l.alignable=[])).push(m),!e.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(l.lineNumber=m.appendChild(ii("div",v(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.lineNumInnerWidth+"px"))),s)for(var y=0;y<e.options.gutters.length;++y){var b=e.options.gutters[y],x=s.hasOwnProperty(b)&&s[b];x&&m.appendChild(ii("div",[x],"CodeMirror-gutter-elt","left: "+r.gutterLeft[b]+"px; width: "+r.gutterWidth[b]+"px"))}}if(Ti&&(l.style.zIndex=2),t.widgets&&l!=i)for(var p=0,w=t.widgets;p<w.length;++p){var g=w[p],k=ii("div",[g.node],"CodeMirror-linewidget");g.handleMouseEvents||(k.ignoreEvents=!0),D(g,k,l,r),g.above?l.insertBefore(k,e.options.lineNumbers&&0!=t.height?m:o):l.appendChild(k),Rr(g,"redraw")}return l}function D(e,t,n,r){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var i=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(i-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function L(e){var t=e.display,n=Vt(e.doc.sel.from,e.doc.sel.to);if(n||e.options.showCursorWhenSelecting?O(e):t.cursor.style.display=t.otherCursor.style.display="none",n?t.selectionDiv.style.display="none":M(e),e.options.moveInputWithCursor){var r=Q(e,e.doc.sel.head,"div"),i=li(t.wrapper),o=li(t.lineDiv);t.inputDiv.style.top=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+o.top-i.top))+"px",t.inputDiv.style.left=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+o.left-i.left))+"px"}}function O(e){var t=e.display,n=Q(e,e.doc.sel.head,"div");t.cursor.style.left=n.left+"px",t.cursor.style.top=n.top+"px",t.cursor.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",t.cursor.style.display="",n.other?(t.otherCursor.style.display="",t.otherCursor.style.left=n.other.left+"px",t.otherCursor.style.top=n.other.top+"px",t.otherCursor.style.height=.85*(n.other.bottom-n.other.top)+"px"):t.otherCursor.style.display="none"}function M(e){function t(e,t,n,r){0>t&&(t=0),s.appendChild(ii("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==n?a-e:n)+"px; height: "+(r-t)+"px"))}function n(n,r,o){function s(t,r){return J(e,Ut(n,t),"div",u,r)}var u=fr(i,n),c=u.text.length,d,f;return fi(br(u),r||0,null==o?c:o,function(e,n,i){var u=s(e,"left"),h,p,g;if(e==n)h=u,p=g=u.left;else{if(h=s(n-1,"right"),"rtl"==i){var m=u;u=h,h=m}p=u.left,g=h.right}null==r&&0==e&&(p=l),h.top-u.top>3&&(t(p,u.top,null,u.bottom),p=l,u.bottom<h.top&&t(p,u.bottom,null,h.top)),null==o&&n==c&&(g=a),(!d||u.top<d.top||u.top==d.top&&u.left<d.left)&&(d=u),(!f||h.bottom>f.bottom||h.bottom==f.bottom&&h.right>f.right)&&(f=h),l+1>p&&(p=l),t(p,h.top,g-p,h.bottom)}),{start:d,end:f}}var r=e.display,i=e.doc,o=e.doc.sel,s=document.createDocumentFragment(),a=r.lineSpace.offsetWidth,l=W(e.display);if(o.from.line==o.to.line)n(o.from.line,o.from.ch,o.to.ch);else{var u=fr(i,o.from.line),c=fr(i,o.to.line),d=zn(i,u)==zn(i,c),f=n(o.from.line,o.from.ch,d?u.text.length:null).end,h=n(o.to.line,d?0:null,o.to.ch).start;d&&(f.top<h.top-2?(t(f.right,f.top,null,f.bottom),t(l,h.top,h.left,h.bottom)):t(f.right,f.top,h.left-f.right,f.bottom)),f.bottom<h.top&&t(l,f.bottom,null,h.top)}si(r.selectionDiv,s),r.selectionDiv.style.display=""}function A(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursor.style.visibility=t.otherCursor.style.visibility="",t.blinker=setInterval(function(){t.cursor.style.visibility=t.otherCursor.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate)}}function I(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.showingTo&&e.state.highlight.set(t,ti(F,e))}function F(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.showingTo)){var n=+new Date+e.options.workTime,r=yn(t.mode,H(e,t.frontier)),i=[],o;t.iter(t.frontier,Math.min(t.first+t.size,e.display.showingTo+500),function(s){if(t.frontier>=e.display.showingFrom){var a=s.styles;s.styles=Jn(e,s,r);for(var l=!a||a.length!=s.styles.length,u=0;!l&&u<a.length;++u)l=a[u]!=s.styles[u];l&&(o&&o.end==t.frontier?o.end++:i.push(o={start:t.frontier,end:t.frontier+1})),s.stateAfter=yn(t.mode,r)}else Zn(e,s,r),s.stateAfter=t.frontier%5==0?yn(t.mode,r):null;return++t.frontier,+new Date>n?(I(e,e.options.workDelay),!0):void 0}),i.length&&st(e,function(){for(var e=0;e<i.length;++e)ut(this,i[e].start,i[e].end)})()}}function N(e,t,n){for(var r,i,o=e.doc,s=t,a=t-100;s>a;--s){if(s<=o.first)return o.first;var l=fr(o,s-1);if(l.stateAfter&&(!n||s<=o.frontier))return s;var u=Yr(l.text,null,e.options.tabSize);(null==i||r>u)&&(i=s-1,r=u)}return i}function H(e,t,n){var r=e.doc,i=e.display;if(!r.mode.startState)return!0;var o=N(e,t,n),s=o>r.first&&fr(r,o-1).stateAfter;return s=s?yn(r.mode,s):bn(r.mode),r.iter(o,t,function(n){Zn(e,n,s);var a=o==t-1||o%5==0||o>=i.showingFrom&&o<i.showingTo;n.stateAfter=a?yn(r.mode,s):null,++o}),s}function E(e){return e.lineSpace.offsetTop}function P(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function W(e){var t=si(e.measure,ii("pre",null,null,"text-align: left")).appendChild(ii("span","x"));return t.offsetLeft}function z(e,t,n,r,i){var o=-1;r=r||B(e,t);for(var s=n;;s+=o){var a=r[s];if(a)break;0>o&&0==s&&(o=1)}return i=s>n?"left":n>s?"right":i,"left"==i&&a.leftSide?a=a.leftSide:"right"==i&&a.rightSide&&(a=a.rightSide),{left:n>s?a.right:a.left,right:s>n?a.left:a.right,top:a.top,bottom:a.bottom}}function R(e,t){for(var n=e.display.measureLineCache,r=0;r<n.length;++r){var i=n[r];if(i.text==t.text&&i.markedSpans==t.markedSpans&&e.display.scroller.clientWidth==i.width&&i.classes==t.textClass+"|"+t.bgClass+"|"+t.wrapClass)return i}}function j(e,t){var n=R(e,t);n&&(n.text=n.measure=n.markedSpans=null)}function B(e,t){var n=R(e,t);if(n)return n.measure;var r=q(e,t),i=e.display.measureLineCache,o={text:t.text,width:e.display.scroller.clientWidth,markedSpans:t.markedSpans,measure:r,classes:t.textClass+"|"+t.bgClass+"|"+t.wrapClass};return 16==i.length?i[++e.display.measureLineCachePos%16]=o:i.push(o),r}function q(e,t){function n(e){var t=e.top-p.top,n=e.bottom-p.top;n>v&&(n=v),0>t&&(t=0);for(var r=g.length-2;r>=0;r-=2){var i=g[r],o=g[r+1];if(!(i>n||t>o)&&(t>=i&&o>=n||i>=t&&n>=o||Math.min(n,o)-Math.max(t,i)>=n-t>>1)){g[r]=Math.min(t,i),g[r+1]=Math.max(n,o);break}}return 0>r&&(r=g.length,g.push(t,n)),{left:e.left-p.left,right:e.right-p.left,top:r,bottom:null}}function r(e){e.bottom=g[e.top+1],e.top=g[e.top]}var i=e.display,o=ei(t.text.length),s=tr(e,t,o,!0);if(Si&&!Ti&&!e.options.lineWrapping&&s.childNodes.length>100){for(var a=document.createDocumentFragment(),l=10,u=s.childNodes.length,c=0,d=Math.ceil(u/l);d>c;++c){for(var f=ii("div",null,null,"display: inline-block"),h=0;l>h&&u;++h)f.appendChild(s.firstChild),--u;a.appendChild(f)}s.appendChild(a)}si(i.measure,s);var p=li(i.lineDiv),g=[],m=ei(t.text.length),v=s.offsetHeight;Di&&i.measure.first!=s&&si(i.measure,s);for(var c=0,y;c<o.length;++c)if(y=o[c]){var b=y,x=null;if(/\bCodeMirror-widget\b/.test(y.className)&&y.getClientRects){1==y.firstChild.nodeType&&(b=y.firstChild);var w=b.getClientRects();w.length>1&&(x=m[c]=n(w[0]),x.rightSide=n(w[w.length-1]))}x||(x=m[c]=n(li(b))),y.measureRight&&(x.right=li(y.measureRight).left),y.leftSide&&(x.leftSide=n(li(y.leftSide)))}for(var c=0,y;c<m.length;++c)(y=m[c])&&(r(y),y.leftSide&&r(y.leftSide),y.rightSide&&r(y.rightSide));return m}function U(e,t){var n=!1;if(t.markedSpans)for(var r=0;r<t.markedSpans;++r){var i=t.markedSpans[r];!i.collapsed||null!=i.to&&i.to!=t.text.length||(n=!0)}var o=!n&&R(e,t);if(o)return z(e,t,t.text.length,o.measure,"right").right;var s=tr(e,t,null,!0),a=s.appendChild(di(e.display.measure));return si(e.display.measure,s),li(a).right-li(e.display.lineDiv).left}function V(e){e.display.measureLineCache.length=e.display.measureLineCachePos=0,e.display.cachedCharWidth=e.display.cachedTextHeight=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Y(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function G(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function X(e,t,n,r){if(t.widgets)for(var i=0;i<t.widgets.length;++i)if(t.widgets[i].above){var o=Vn(t.widgets[i]);n.top+=o,n.bottom+=o}if("line"==r)return n;r||(r="local");var s=yr(e,t);if("local"==r?s+=E(e.display):s-=e.display.viewOffset,"page"==r||"window"==r){var a=li(e.display.lineSpace);s+=a.top+("window"==r?0:G());var l=a.left+("window"==r?0:Y());n.left+=l,n.right+=l}return n.top+=s,n.bottom+=s,n}function K(e,t,n){if("div"==n)return t;var r=t.left,i=t.top;if("page"==n)r-=Y(),i-=G();else if("local"==n||!n){var o=li(e.display.sizer);r+=o.left,i+=o.top}var s=li(e.display.lineSpace);return{left:r-s.left,top:i-s.top}}function J(e,t,n,r,i){return r||(r=fr(e.doc,t.line)),X(e,r,z(e,r,t.ch,null,i),n)}function Q(e,t,n,r,i){function o(t,o){var s=z(e,r,t,i,o?"right":"left");return o?s.left=s.right:s.right=s.left,X(e,r,s,n)}function s(e,t){var n=a[t],r=n.level%2;return e==hi(n)&&t&&n.level<a[t-1].level?(n=a[--t],e=pi(n)-(n.level%2?0:1),r=!0):e==pi(n)&&t<a.length-1&&n.level<a[t+1].level&&(n=a[++t],e=hi(n)-n.level%2,r=!1),r&&e==n.to&&e>n.from?o(e-1):o(e,r)}r=r||fr(e.doc,t.line),i||(i=B(e,r));var a=br(r),l=t.ch;if(!a)return o(l);var u=xi(a,l),c=s(l,u);return null!=Ho&&(c.other=s(l,Ho)),c}function Z(e,t,n,r){var i=new Ut(e,t);return i.xRel=r,n&&(i.outside=!0),i}function et(e,t,n){var r=e.doc;if(n+=e.display.viewOffset,0>n)return Z(r.first,0,!0,-1);var i=vr(r,n),o=r.first+r.size-1;if(i>o)return Z(r.first+r.size-1,fr(r,o).text.length,!0,1);for(0>t&&(t=0);;){var s=fr(r,i),a=tt(e,s,i,t,n),l=Wn(s),u=l&&l.find();if(!l||!(a.ch>u.from.ch||a.ch==u.from.ch&&a.xRel>0))return a;i=u.to.line}}function tt(e,t,n,r,i){function o(r){var i=Q(e,Ut(n,r),"line",t,u);return a=!0,s>i.bottom?i.left-l:s<i.top?i.left+l:(a=!1,i.left)}var s=i-yr(e,t),a=!1,l=2*e.display.wrapper.clientWidth,u=B(e,t),c=br(t),d=t.text.length,f=gi(t),h=mi(t),p=o(f),g=a,m=o(h),v=a;if(r>m)return Z(n,h,v,1);for(;;){if(c?h==f||h==ki(t,f,1):1>=h-f){for(var y=p>r||m-r>=r-p?f:h,b=r-(y==f?p:m);Lo.test(t.text.charAt(y));)++y;var x=Z(n,y,y==f?g:v,0>b?-1:b?1:0);return x}var w=Math.ceil(d/2),k=f+w;if(c){k=f;for(var C=0;w>C;++C)k=ki(t,k,1)}var _=o(k);_>r?(h=k,m=_,(v=a)&&(m+=1e3),d=w):(f=k,p=_,g=a,d-=w)}}function nt(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Vi){Vi=ii("pre");for(var t=0;49>t;++t)Vi.appendChild(document.createTextNode("x")),Vi.appendChild(ii("br"));Vi.appendChild(document.createTextNode("x"))}si(e.measure,Vi);var n=Vi.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),oi(e.measure),n||1}function rt(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=ii("span","x"),n=ii("pre",[t]);si(e.measure,n);var r=t.offsetWidth;return r>2&&(e.cachedCharWidth=r),r||10}function it(e){e.curOp={changes:[],forceUpdate:!1,updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Yi},Co++||(ko=[])}function ot(e){var t=e.curOp,n=e.doc,r=e.display;if(e.curOp=null,t.updateMaxLine&&d(e),r.maxLineChanged&&!e.options.lineWrapping&&r.maxLine){var i=U(e,r.maxLine);r.sizer.style.minWidth=Math.max(0,i+3+_o)+"px",r.maxLineChanged=!1;var o=Math.max(0,r.sizer.offsetLeft+r.sizer.offsetWidth-r.scroller.clientWidth);o<n.scrollLeft&&!t.updateScrollPos&&_t(e,Math.min(r.scroller.scrollLeft,o),!0)}var s,a;if(t.updateScrollPos)s=t.updateScrollPos;else if(t.selectionChanged&&r.scroller.clientHeight){var l=Q(e,n.sel.head);s=ln(e,l.left,l.top,l.left,l.bottom)}(t.changes.length||t.forceUpdate||s&&null!=s.scrollTop)&&(a=b(e,t.changes,s&&s.scrollTop,t.forceUpdate),e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)),!a&&t.selectionChanged&&L(e),t.updateScrollPos?(r.scroller.scrollTop=r.scrollbarV.scrollTop=n.scrollTop=s.scrollTop,r.scroller.scrollLeft=r.scrollbarH.scrollLeft=n.scrollLeft=s.scrollLeft,g(e),t.scrollToPos&&sn(e,Kt(e.doc,t.scrollToPos),t.scrollToPosMargin)):s&&on(e),t.selectionChanged&&A(e),e.state.focused&&t.updateInput&&ht(e,t.userSelChange);var u=t.maybeHiddenMarkers,c=t.maybeUnhiddenMarkers;if(u)for(var f=0;f<u.length;++f)u[f].lines.length||zr(u[f],"hide");if(c)for(var f=0;f<c.length;++f)c[f].lines.length&&zr(c[f],"unhide");var h;if(--Co||(h=ko,ko=null),t.textChanged&&zr(e,"change",e,t.textChanged),t.cursorActivity&&zr(e,"cursorActivity",e),h)for(var f=0;f<h.length;++f)h[f]()}function st(e,t){return function(){var n=e||this,r=!n.curOp;r&&it(n);try{var i=t.apply(n,arguments)}finally{r&&ot(n)}return i}}function at(e){return function(){var t=this.cm&&!this.cm.curOp,n;t&&it(this.cm);try{n=e.apply(this,arguments)}finally{t&&ot(this.cm)}return n}}function lt(e,t){var n=!e.curOp,r;n&&it(e);try{r=t()}finally{n&&ot(e)}return r}function ut(e,t,n,r){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),e.curOp.changes.push({from:t,to:n,diff:r})}function ct(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){ft(e),e.state.focused&&ct(e)})}function dt(e){function t(){var r=ft(e);r||n?(e.display.pollingFast=!1,ct(e)):(n=!0,e.display.poll.set(60,t))
}var n=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function ft(e){var t=e.display.input,n=e.display.prevInput,r=e.doc,i=r.sel;if(!e.state.focused||Fo(t)||gt(e)||e.state.disableInput)return!1;var o=t.value;if(o==n&&Vt(i.from,i.to))return!1;if(Si&&!Di&&e.display.inputHasSelection===o)return ht(e,!0),!1;var s=!e.curOp;s&&it(e),i.shift=!1;for(var a=0,l=Math.min(n.length,o.length);l>a&&n.charCodeAt(a)==o.charCodeAt(a);)++a;var u=i.from,c=i.to;a<n.length?u=Ut(u.line,u.ch-(n.length-a)):e.state.overwrite&&Vt(u,c)&&!e.state.pasteIncoming&&(c=Ut(c.line,Math.min(fr(r,c.line).text.length,c.ch+(o.length-a))));var d=e.curOp.updateInput,f={from:u,to:c,text:Io(o.slice(a)),origin:e.state.pasteIncoming?"paste":"+input"};return Pt(e.doc,f,"end"),e.curOp.updateInput=d,Rr(e,"inputRead",e,f),o.length>1e3||o.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=o,s&&ot(e),e.state.pasteIncoming=!1,!0}function ht(e,t){var n,r,i=e.doc;if(Vt(i.sel.from,i.sel.to))t&&(e.display.prevInput=e.display.input.value="",Si&&!Di&&(e.display.inputHasSelection=null));else{e.display.prevInput="",n=$o&&(i.sel.to.line-i.sel.from.line>100||(r=e.getSelection()).length>1e3);var o=n?"-":r||e.getSelection();e.display.input.value=o,e.state.focused&&Kr(e.display.input),Si&&!Di&&(e.display.inputHasSelection=o)}e.display.inaccurateSelection=n}function pt(e){"nocursor"==e.options.readOnly||Pi&&document.activeElement==e.display.input||e.display.input.focus()}function gt(e){return e.options.readOnly||e.doc.cantEdit}function mt(e){function t(){e.state.focused&&setTimeout(ti(pt,e),0)}function n(){null==a&&(a=setTimeout(function(){a=null,s.cachedCharWidth=s.cachedTextHeight=Mo=null,V(e),lt(e,ti(ut,e))},100))}function r(){for(var e=s.wrapper.parentNode;e&&e!=document.body;e=e.parentNode);e?setTimeout(r,5e3):Wr(window,"resize",n)}function i(t){jr(e,t)||e.options.onDragEvent&&e.options.onDragEvent(e,Ar(t))||Nr(t)}function o(){s.inaccurateSelection&&(s.prevInput="",s.inaccurateSelection=!1,s.input.value=e.getSelection(),Kr(s.input))}var s=e.display;Pr(s.scroller,"mousedown",st(e,bt)),Si?Pr(s.scroller,"dblclick",st(e,function(t){if(!jr(e,t)){var n=yt(e,t);if(n&&!xt(e,t)&&!vt(e.display,t)){Ir(t);var r=gn(fr(e.doc,n.line).text,n);Zt(e.doc,r.from,r.to)}}})):Pr(s.scroller,"dblclick",function(t){jr(e,t)||Ir(t)}),Pr(s.lineSpace,"selectstart",function(e){vt(s,e)||Ir(e)}),Bi||Pr(s.scroller,"contextmenu",function(t){$t(e,t)}),Pr(s.scroller,"scroll",function(){s.scroller.clientHeight&&(Ct(e,s.scroller.scrollTop),_t(e,s.scroller.scrollLeft,!0),zr(e,"scroll",e))}),Pr(s.scrollbarV,"scroll",function(){s.scroller.clientHeight&&Ct(e,s.scrollbarV.scrollTop)}),Pr(s.scrollbarH,"scroll",function(){s.scroller.clientHeight&&_t(e,s.scrollbarH.scrollLeft)}),Pr(s.scroller,"mousewheel",function(t){St(e,t)}),Pr(s.scroller,"DOMMouseScroll",function(t){St(e,t)}),Pr(s.scrollbarH,"mousedown",t),Pr(s.scrollbarV,"mousedown",t),Pr(s.wrapper,"scroll",function(){s.wrapper.scrollTop=s.wrapper.scrollLeft=0});var a;Pr(window,"resize",n),setTimeout(r,5e3),Pr(s.input,"keyup",st(e,function(t){jr(e,t)||e.options.onKeyEvent&&e.options.onKeyEvent(e,Ar(t))||16==t.keyCode&&(e.doc.sel.shift=!1)})),Pr(s.input,"input",ti(dt,e)),Pr(s.input,"keydown",st(e,Mt)),Pr(s.input,"keypress",st(e,At)),Pr(s.input,"focus",ti(It,e)),Pr(s.input,"blur",ti(Ft,e)),e.options.dragDrop&&(Pr(s.scroller,"dragstart",function(t){kt(e,t)}),Pr(s.scroller,"dragenter",i),Pr(s.scroller,"dragover",i),Pr(s.scroller,"drop",st(e,wt))),Pr(s.scroller,"paste",function(t){vt(s,t)||(pt(e),dt(e))}),Pr(s.input,"paste",function(){e.state.pasteIncoming=!0,dt(e)}),Pr(s.input,"cut",o),Pr(s.input,"copy",o),Fi&&Pr(s.sizer,"mouseup",function(){document.activeElement==s.input&&s.input.blur(),pt(e)})}function vt(e,t){for(var n=Hr(t);n!=e.wrapper;n=n.parentNode)if(!n||n.ignoreEvents||n.parentNode==e.sizer&&n!=e.mover)return!0}function yt(e,t,n){var r=e.display;if(!n){var i=Hr(t);if(i==r.scrollbarH||i==r.scrollbarH.firstChild||i==r.scrollbarV||i==r.scrollbarV.firstChild||i==r.scrollbarFiller||i==r.gutterFiller)return null}var o,s,a=li(r.lineSpace);try{o=t.clientX,s=t.clientY}catch(t){return null}return et(e,o-a.left,s-a.top)}function bt(e){function t(e){if(!Vt(v,e)){if(v=e,"single"==c)return void Zt(i.doc,Kt(s,l),e);if(g=Kt(s,g),m=Kt(s,m),"double"==c){var t=gn(fr(s,e.line).text,e);Yt(e,g)?Zt(i.doc,t.from,m):Zt(i.doc,g,t.to)}else"triple"==c&&(Yt(e,g)?Zt(i.doc,m,Kt(s,Ut(e.line,0))):Zt(i.doc,g,Kt(s,Ut(e.line+1,0))))}}function n(e){var r=++b,a=yt(i,e,!0);if(a)if(Vt(a,f)){var l=e.clientY<y.top?-20:e.clientY>y.bottom?20:0;l&&setTimeout(st(i,function(){b==r&&(o.scroller.scrollTop+=l,n(e))}),50)}else{i.state.focused||It(i),f=a,t(a);var u=p(o,s);(a.line>=u.to||a.line<u.from)&&setTimeout(st(i,function(){b==r&&n(e)}),150)}}function r(e){b=1/0,Ir(e),pt(i),Wr(document,"mousemove",x),Wr(document,"mouseup",w)}if(!jr(this,e)){var i=this,o=i.display,s=i.doc,a=s.sel;if(a.shift=e.shiftKey,vt(o,e))return void(Li||(o.scroller.draggable=!1,setTimeout(function(){o.scroller.draggable=!0},100)));if(!xt(i,e)){var l=yt(i,e);switch(Er(e)){case 3:return void(Bi&&$t.call(i,i,e));case 2:return l&&Zt(i.doc,l),setTimeout(ti(pt,i),20),void Ir(e)}if(!l)return void(Hr(e)==o.scroller&&Ir(e));i.state.focused||It(i);var u=+new Date,c="single";if(Xi&&Xi.time>u-400&&Vt(Xi.pos,l))c="triple",Ir(e),setTimeout(ti(pt,i),20),mn(i,l.line);else if(Gi&&Gi.time>u-400&&Vt(Gi.pos,l)){c="double",Xi={time:u,pos:l},Ir(e);var d=gn(fr(s,l.line).text,l);Zt(i.doc,d.from,d.to)}else Gi={time:u,pos:l};var f=l;if(i.options.dragDrop&&Oo&&!gt(i)&&!Vt(a.from,a.to)&&!Yt(l,a.from)&&!Yt(a.to,l)&&"single"==c){var h=st(i,function(t){Li&&(o.scroller.draggable=!1),i.state.draggingText=!1,Wr(document,"mouseup",h),Wr(o.scroller,"drop",h),Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)<10&&(Ir(t),Zt(i.doc,l),pt(i))});return Li&&(o.scroller.draggable=!0),i.state.draggingText=h,o.scroller.dragDrop&&o.scroller.dragDrop(),Pr(document,"mouseup",h),void Pr(o.scroller,"drop",h)}Ir(e),"single"==c&&Zt(i.doc,Kt(s,l));var g=a.from,m=a.to,v=l,y=li(o.wrapper),b=0,x=st(i,function(e){Si||Er(e)?n(e):r(e)}),w=st(i,r);Pr(document,"mousemove",x),Pr(document,"mouseup",w)}}}function xt(e,t){var n=e.display;try{var r=t.clientX,i=t.clientY}catch(t){return!1}if(r>=Math.floor(li(n.gutters).right))return!1;if(Ir(t),!qr(e,"gutterClick"))return!0;var o=li(n.lineDiv);if(i>o.bottom)return!0;i-=o.top-n.viewOffset;for(var s=0;s<e.options.gutters.length;++s){var a=n.gutters.childNodes[s];if(a&&li(a).right>=r){var l=vr(e.doc,i),u=e.options.gutters[s];Rr(e,"gutterClick",e,l,u,t);break}}return!0}function wt(e){var t=this;if(!(jr(t,e)||vt(t.display,e)||t.options.onDragEvent&&t.options.onDragEvent(t,Ar(e)))){Ir(e),Si&&(Ki=+new Date);var n=yt(t,e,!0),r=e.dataTransfer.files;if(n&&!gt(t))if(r&&r.length&&window.FileReader&&window.File)for(var i=r.length,o=Array(i),s=0,a=function(e,r){var a=new FileReader;a.onload=function(){o[r]=a.result,++s==i&&(n=Kt(t.doc,n),Pt(t.doc,{from:n,to:n,text:Io(o.join("\n")),origin:"paste"},"around"))},a.readAsText(e)},l=0;i>l;++l)a(r[l],l);else{if(t.state.draggingText&&!Yt(n,t.doc.sel.from)&&!Yt(t.doc.sel.to,n))return t.state.draggingText(e),void setTimeout(ti(pt,t),20);try{var o=e.dataTransfer.getData("Text");if(o){var u=t.doc.sel.from,c=t.doc.sel.to;tn(t.doc,n,n),t.state.draggingText&&qt(t.doc,"",u,c,"paste"),t.replaceSelection(o,null,"paste"),pt(t),It(t)}}catch(e){}}}}function kt(e,t){if(Si&&(!e.state.draggingText||+new Date-Ki<100))return void Nr(t);if(!jr(e,t)&&!vt(e.display,t)){var n=e.getSelection();if(t.dataTransfer.setData("Text",n),t.dataTransfer.setDragImage&&!Ii){var r=ii("img",null,null,"position: fixed; left: 0; top: 0;");Ai&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),Ai&&r.parentNode.removeChild(r)}}}function Ct(e,t){Math.abs(e.doc.scrollTop-t)<2||(e.doc.scrollTop=t,_i||b(e,[],t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),_i&&b(e,[]),I(e,100))}function _t(e,t,n){(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,g(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function St(e,t){var n=t.wheelDeltaX,r=t.wheelDeltaY;null==n&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(n=t.detail),null==r&&t.detail&&t.axis==t.VERTICAL_AXIS?r=t.detail:null==r&&(r=t.wheelDelta);var i=e.display,o=i.scroller;if(n&&o.scrollWidth>o.clientWidth||r&&o.scrollHeight>o.clientHeight){if(r&&Wi&&Li)for(var s=t.target;s!=o;s=s.parentNode)if(s.lineObj){e.display.currentWheelTarget=s;break}if(n&&!_i&&!Ai&&null!=Qi)return r&&Ct(e,Math.max(0,Math.min(o.scrollTop+r*Qi,o.scrollHeight-o.clientHeight))),_t(e,Math.max(0,Math.min(o.scrollLeft+n*Qi,o.scrollWidth-o.clientWidth))),Ir(t),void(i.wheelStartX=null);if(r&&null!=Qi){var a=r*Qi,l=e.doc.scrollTop,u=l+i.wrapper.clientHeight;0>a?l=Math.max(0,l+a-50):u=Math.min(e.doc.height,u+a+50),b(e,[],{top:l,bottom:u})}20>Ji&&(null==i.wheelStartX?(i.wheelStartX=o.scrollLeft,i.wheelStartY=o.scrollTop,i.wheelDX=n,i.wheelDY=r,setTimeout(function(){if(null!=i.wheelStartX){var e=o.scrollLeft-i.wheelStartX,t=o.scrollTop-i.wheelStartY,n=t&&i.wheelDY&&t/i.wheelDY||e&&i.wheelDX&&e/i.wheelDX;i.wheelStartX=i.wheelStartY=null,n&&(Qi=(Qi*Ji+n)/(Ji+1),++Ji)}},200)):(i.wheelDX+=n,i.wheelDY+=r))}}function Tt(e,t,n){if("string"==typeof t&&(t=fo[t],!t))return!1;e.display.pollingFast&&ft(e)&&(e.display.pollingFast=!1);var r=e.doc,i=r.sel.shift,o=!1;try{gt(e)&&(e.state.suppressEdits=!0),n&&(r.sel.shift=!1),o=t(e)!=So}finally{r.sel.shift=i,e.state.suppressEdits=!1}return o}function Dt(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Lt(e,t){var n=xn(e.options.keyMap),r=n.auto;clearTimeout(Zi),r&&!kn(t)&&(Zi=setTimeout(function(){xn(e.options.keyMap)==n&&(e.options.keyMap=r.call?r.call(null,e):r,s(e))},50));var i=Cn(t,!0),o=!1;if(!i)return!1;var a=Dt(e);return o=t.shiftKey?wn("Shift-"+i,a,function(t){return Tt(e,t,!0)})||wn(i,a,function(t){return("string"==typeof t?/^go[A-Z]/.test(t):t.motion)?Tt(e,t):void 0}):wn(i,a,function(t){return Tt(e,t)}),o&&(Ir(t),A(e),Di&&(t.oldKeyCode=t.keyCode,t.keyCode=0),Rr(e,"keyHandled",e,i,t)),o}function Ot(e,t,n){var r=wn("'"+n+"'",Dt(e),function(t){return Tt(e,t,!0)});return r&&(Ir(t),A(e),Rr(e,"keyHandled",e,"'"+n+"'",t)),r}function Mt(e){var t=this;if(t.state.focused||It(t),Si&&27==e.keyCode&&(e.returnValue=!1),!(jr(t,e)||t.options.onKeyEvent&&t.options.onKeyEvent(t,Ar(e)))){var n=e.keyCode;t.doc.sel.shift=16==n||e.shiftKey;var r=Lt(t,e);Ai&&(eo=r?n:null,!r&&88==n&&!$o&&(Wi?e.metaKey:e.ctrlKey)&&t.replaceSelection(""))}}function At(e){var t=this;if(!(jr(t,e)||t.options.onKeyEvent&&t.options.onKeyEvent(t,Ar(e)))){var n=e.keyCode,r=e.charCode;if(Ai&&n==eo)return eo=null,void Ir(e);if(!(Ai&&(!e.which||e.which<10)||Fi)||!Lt(t,e)){var i=String.fromCharCode(null==r?n:r);this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!gt(this)&&this.doc.mode.electricChars.indexOf(i)>-1&&setTimeout(st(t,function(){dn(t,t.doc.sel.to.line,"smart")}),75),Ot(t,e,i)||(Si&&!Di&&(t.display.inputHasSelection=null),dt(t))}}}function It(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(zr(e,"focus",e),e.state.focused=!0,-1==e.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(e.display.wrapper.className+=" CodeMirror-focused"),ht(e,!0)),ct(e),A(e))}function Ft(e){e.state.focused&&(zr(e,"blur",e),e.state.focused=!1,e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.doc.sel.shift=!1)},150)}function $t(e,t){function n(){if(null!=i.input.selectionStart){var e=i.input.value=" "+(Vt(o.from,o.to)?"":i.input.value);i.prevInput=" ",i.input.selectionStart=1,i.input.selectionEnd=e.length}}function r(){if(i.inputDiv.style.position="relative",i.input.style.cssText=l,Di&&(i.scrollbarV.scrollTop=i.scroller.scrollTop=a),ct(e),null!=i.input.selectionStart){(!Si||Di)&&n(),clearTimeout(to);var t=0,r=function(){" "==i.prevInput&&0==i.input.selectionStart?st(e,fo.selectAll)(e):t++<10?to=setTimeout(r,500):ht(e)};to=setTimeout(r,200)}}if(!jr(e,t,"contextmenu")){var i=e.display,o=e.doc.sel;if(!vt(i,t)){var s=yt(e,t),a=i.scroller.scrollTop;if(s&&!Ai){(Vt(o.from,o.to)||Yt(s,o.from)||!Yt(s,o.to))&&st(e,tn)(e.doc,s,s);var l=i.input.style.cssText;if(i.inputDiv.style.position="absolute",i.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",pt(e),ht(e,!0),Vt(o.from,o.to)&&(i.input.value=i.prevInput=" "),Si&&!Di&&n(),Bi){Nr(t);var u=function(){Wr(window,"mouseup",u),setTimeout(r,20)};Pr(window,"mouseup",u)}else setTimeout(r,50)}}}}function Nt(e,t,n){if(!Yt(t.from,n))return Kt(e,n);var r=t.text.length-1-(t.to.line-t.from.line);if(n.line>t.to.line+r){var i=n.line-r,o=e.first+e.size-1;return i>o?Ut(o,fr(e,o).text.length):Jt(n,fr(e,i).text.length)}if(n.line==t.to.line+r)return Jt(n,Xr(t.text).length+(1==t.text.length?t.from.ch:0)+fr(e,t.to.line).text.length-t.to.ch);var s=n.line-t.from.line;return Jt(n,t.text[s].length+(s?0:t.from.ch))}function Ht(e,t,n){if(n&&"object"==typeof n)return{anchor:Nt(e,t,n.anchor),head:Nt(e,t,n.head)};if("start"==n)return{anchor:t.from,head:t.from};var r=no(t);if("around"==n)return{anchor:t.from,head:r};if("end"==n)return{anchor:r,head:r};var i=function(e){if(Yt(e,t.from))return e;if(!Yt(t.to,e))return r;var n=e.line+t.text.length-(t.to.line-t.from.line)-1,i=e.ch;return e.line==t.to.line&&(i+=r.ch-t.to.ch),Ut(n,i)};return{anchor:i(e.sel.anchor),head:i(e.sel.head)}}function Et(e,t,n){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return n&&(r.update=function(t,n,r,i){t&&(this.from=Kt(e,t)),n&&(this.to=Kt(e,n)),r&&(this.text=r),void 0!==i&&(this.origin=i)}),zr(e,"beforeChange",e,r),e.cm&&zr(e.cm,"beforeChange",e.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function Pt(e,t,n,r){if(e.cm){if(!e.cm.curOp)return st(e.cm,Pt)(e,t,n,r);if(e.cm.state.suppressEdits)return}if(!(qr(e,"beforeChange")||e.cm&&qr(e.cm,"beforeChange"))||(t=Et(e,t,!0))){var i=qi&&!r&&Hn(e,t.from,t.to);if(i){for(var o=i.length-1;o>=1;--o)Wt(e,{from:i[o].from,to:i[o].to,text:[""]});i.length&&Wt(e,{from:i[0].from,to:i[0].to,text:t.text},n)}else Wt(e,t,n)}}function Wt(e,t,n){var r=Ht(e,t,n);Cr(e,t,r,e.cm?e.cm.curOp.id:0/0),jt(e,t,r,$n(e,t));var i=[];cr(e,function(e,n){n||-1!=Jr(i,e.history)||(Or(e.history,t),i.push(e.history)),jt(e,t,null,$n(e,t))})}function zt(e,t){if(!e.cm||!e.cm.state.suppressEdits){var n=e.history,r=("undo"==t?n.done:n.undone).pop();if(r){var i={changes:[],anchorBefore:r.anchorAfter,headBefore:r.headAfter,anchorAfter:r.anchorBefore,headAfter:r.headBefore,generation:n.generation};("undo"==t?n.undone:n.done).push(i),n.generation=r.generation||++n.maxGeneration;for(var o=qr(e,"beforeChange")||e.cm&&qr(e.cm,"beforeChange"),s=r.changes.length-1;s>=0;--s){var a=r.changes[s];if(a.origin=t,o&&!Et(e,a,!1))return void(("undo"==t?n.done:n.undone).length=0);i.changes.push(kr(e,a));var l=s?Ht(e,a,null):{anchor:r.anchorBefore,head:r.headBefore};jt(e,a,l,Nn(e,a));var u=[];cr(e,function(e,t){t||-1!=Jr(u,e.history)||(Or(e.history,a),u.push(e.history)),jt(e,a,null,Nn(e,a))})}}}}function Rt(e,t){function n(e){return Ut(e.line+t,e.ch)}e.first+=t,e.cm&&ut(e.cm,e.first,e.first,t),e.sel.head=n(e.sel.head),e.sel.anchor=n(e.sel.anchor),e.sel.from=n(e.sel.from),e.sel.to=n(e.sel.to)}function jt(e,t,n,r){if(e.cm&&!e.cm.curOp)return st(e.cm,jt)(e,t,n,r);if(t.to.line<e.first)return void Rt(e,t.text.length-1-(t.to.line-t.from.line));if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Rt(e,i),t={from:Ut(e.first,0),to:Ut(t.to.line+i,t.to.ch),text:[Xr(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:Ut(o,fr(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=hr(e,t.from,t.to),n||(n=Ht(e,t,null)),e.cm?Bt(e.cm,t,r,n):ar(e,t,r,n)}}function Bt(e,t,n,r){var o=e.doc,s=e.display,a=t.from,l=t.to,u=!1,d=a.line;e.options.lineWrapping||(d=mr(zn(o,fr(o,a.line))),o.iter(d,l.line+1,function(e){return e==s.maxLine?(u=!0,!0):void 0})),Yt(o.sel.head,t.from)||Yt(t.to,o.sel.head)||(e.curOp.cursorActivity=!0),ar(o,t,n,r,i(e)),e.options.lineWrapping||(o.iter(d,a.line+t.text.length,function(e){var t=c(o,e);t>s.maxLineLength&&(s.maxLine=e,s.maxLineLength=t,s.maxLineChanged=!0,u=!1)}),u&&(e.curOp.updateMaxLine=!0)),o.frontier=Math.min(o.frontier,a.line),I(e,400);var f=t.text.length-(l.line-a.line)-1;if(ut(e,a.line,l.line+1,f),qr(e,"change")){var h={from:a,to:l,text:t.text,removed:t.removed,origin:t.origin};if(e.curOp.textChanged){for(var p=e.curOp.textChanged;p.next;p=p.next);p.next=h}else e.curOp.textChanged=h}}function qt(e,t,n,r,i){if(r||(r=n),Yt(r,n)){var o=r;r=n,n=o}"string"==typeof t&&(t=Io(t)),Pt(e,{from:n,to:r,text:t,origin:i},null)}function Ut(e,t){return this instanceof Ut?(this.line=e,void(this.ch=t)):new Ut(e,t)}function Vt(e,t){return e.line==t.line&&e.ch==t.ch}function Yt(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function Gt(e){return Ut(e.line,e.ch)}function Xt(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function Kt(e,t){if(t.line<e.first)return Ut(e.first,0);var n=e.first+e.size-1;return t.line>n?Ut(n,fr(e,n).text.length):Jt(t,fr(e,t.line).text.length)}function Jt(e,t){var n=e.ch;return null==n||n>t?Ut(e.line,t):0>n?Ut(e.line,0):e}function Qt(e,t){return t>=e.first&&t<e.first+e.size}function Zt(e,t,n,r){if(e.sel.shift||e.sel.extend){var i=e.sel.anchor;if(n){var o=Yt(t,i);o!=Yt(n,i)?(i=t,t=n):o!=Yt(t,n)&&(t=n)}tn(e,i,t,r)}else tn(e,t,n||t,r);e.cm&&(e.cm.curOp.userSelChange=!0)}function en(e,t,n){var r={anchor:t,head:n};return zr(e,"beforeSelectionChange",e,r),e.cm&&zr(e.cm,"beforeSelectionChange",e.cm,r),r.anchor=Kt(e,r.anchor),r.head=Kt(e,r.head),r}function tn(e,t,n,r,i){if(!i&&qr(e,"beforeSelectionChange")||e.cm&&qr(e.cm,"beforeSelectionChange")){var o=en(e,t,n);n=o.head,t=o.anchor}var s=e.sel;if(s.goalColumn=null,(i||!Vt(t,s.anchor))&&(t=rn(e,t,r,"push"!=i)),(i||!Vt(n,s.head))&&(n=rn(e,n,r,"push"!=i)),!Vt(s.anchor,t)||!Vt(s.head,n)){s.anchor=t,s.head=n;var a=Yt(n,t);s.from=a?n:t,s.to=a?t:n,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=e.cm.curOp.cursorActivity=!0),Rr(e,"cursorActivity",e)}}function nn(e){tn(e.doc,e.doc.sel.from,e.doc.sel.to,null,"push")}function rn(e,t,n,r){var i=!1,o=t,s=n||1;e.cantEdit=!1;e:for(;;){var a=fr(e,o.line);if(a.markedSpans)for(var l=0;l<a.markedSpans.length;++l){var u=a.markedSpans[l],c=u.marker;if((null==u.from||(c.inclusiveLeft?u.from<=o.ch:u.from<o.ch))&&(null==u.to||(c.inclusiveRight?u.to>=o.ch:u.to>o.ch))){if(r&&(zr(c,"beforeCursorEnter"),c.explicitlyCleared)){if(a.markedSpans){--l;continue}break}if(!c.atomic)continue;var d=c.find()[0>s?"from":"to"];if(Vt(d,o)&&(d.ch+=s,d.ch<0?d=d.line>e.first?Kt(e,Ut(d.line-1)):null:d.ch>a.text.length&&(d=d.line<e.first+e.size-1?Ut(d.line+1,0):null),!d)){if(i)return r?(e.cantEdit=!0,Ut(e.first,0)):rn(e,t,n,!0);i=!0,d=t,s=-s}o=d;continue e}}return o}}function on(e){var t=sn(e,e.doc.sel.head,e.options.cursorScrollMargin);if(e.state.focused){var n=e.display,r=li(n.sizer),i=null;if(t.top+r.top<0?i=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(i=!1),null!=i&&!Hi){var o="none"==n.cursor.style.display;o&&(n.cursor.style.display="",n.cursor.style.left=t.left+"px",n.cursor.style.top=t.top-n.viewOffset+"px"),n.cursor.scrollIntoView(i),o&&(n.cursor.style.display="none")}}}function sn(e,t,n){for(null==n&&(n=0);;){var r=!1,i=Q(e,t),o=ln(e,i.left,i.top-n,i.left,i.bottom+n),s=e.doc.scrollTop,a=e.doc.scrollLeft;if(null!=o.scrollTop&&(Ct(e,o.scrollTop),Math.abs(e.doc.scrollTop-s)>1&&(r=!0)),null!=o.scrollLeft&&(_t(e,o.scrollLeft),Math.abs(e.doc.scrollLeft-a)>1&&(r=!0)),!r)return i}}function an(e,t,n,r,i){var o=ln(e,t,n,r,i);null!=o.scrollTop&&Ct(e,o.scrollTop),null!=o.scrollLeft&&_t(e,o.scrollLeft)}function ln(e,t,n,r,i){var o=e.display,s=nt(e.display);0>n&&(n=0);var a=o.scroller.clientHeight-_o,l=o.scroller.scrollTop,u={},c=e.doc.height+P(o),d=s>n,f=i>c-s;if(l>n)u.scrollTop=d?0:n;else if(i>l+a){var h=Math.min(n,(f?c:i)-a);h!=l&&(u.scrollTop=h)}var p=o.scroller.clientWidth-_o,g=o.scroller.scrollLeft;t+=o.gutters.offsetWidth,r+=o.gutters.offsetWidth;var m=o.gutters.offsetWidth,v=m+10>t;return g+m>t||v?(v&&(t=0),u.scrollLeft=Math.max(0,t-10-m)):r>p+g-3&&(u.scrollLeft=r+10-p),u}function un(e,t,n){e.curOp.updateScrollPos={scrollLeft:null==t?e.doc.scrollLeft:t,scrollTop:null==n?e.doc.scrollTop:n}}function cn(e,t,n){var r=e.curOp.updateScrollPos||(e.curOp.updateScrollPos={scrollLeft:e.doc.scrollLeft,scrollTop:e.doc.scrollTop}),i=e.display.scroller;r.scrollTop=Math.max(0,Math.min(i.scrollHeight-i.clientHeight,r.scrollTop+n)),r.scrollLeft=Math.max(0,Math.min(i.scrollWidth-i.clientWidth,r.scrollLeft+t))}function dn(e,t,n,r){var i=e.doc;if(null==n&&(n="add"),"smart"==n)if(e.doc.mode.indent)var o=H(e,t);else n="prev";var s=e.options.tabSize,a=fr(i,t),l=Yr(a.text,null,s),u=a.text.match(/^\s*/)[0],c;if("smart"==n&&(c=e.doc.mode.indent(o,a.text.slice(u.length),a.text),c==So)){if(!r)return;n="prev"}"prev"==n?c=t>i.first?Yr(fr(i,t-1).text,null,s):0:"add"==n?c=l+e.options.indentUnit:"subtract"==n?c=l-e.options.indentUnit:"number"==typeof n&&(c=l+n),c=Math.max(0,c);var d="",f=0;if(e.options.indentWithTabs)for(var h=Math.floor(c/s);h;--h)f+=s,d+="	";c>f&&(d+=Gr(c-f)),d!=u&&qt(e.doc,d,Ut(t,0),Ut(t,u.length),"+input"),a.stateAfter=null}function fn(e,t,n){var r=t,i=t,o=e.doc;return"number"==typeof t?i=fr(o,Xt(o,t)):r=mr(t),null==r?null:n(i,r)?(ut(e,r,r+1),i):null}function hn(e,t,n,r,i){function o(){var t=a+n;return t<e.first||t>=e.first+e.size?d=!1:(a=t,c=fr(e,t))}function s(e){var t=(i?ki:Ci)(c,l,n,!0);if(null==t){if(e||!o())return d=!1;l=i?(0>n?mi:gi)(c):0>n?c.text.length:0}else l=t;return!0}var a=t.line,l=t.ch,u=n,c=fr(e,a),d=!0;if("char"==r)s();else if("column"==r)s(!0);else if("word"==r||"group"==r)for(var f=null,h="group"==r,p=!0;!(0>n)||s(!p);p=!1){var g=c.text.charAt(l)||"\n",m=ni(g)?"w":h?/\s/.test(g)?null:"p":null;if(f&&f!=m){0>n&&(n=1,s());break}if(m&&(f=m),n>0&&!s(!p))break}var v=rn(e,Ut(a,l),u,!0);return d||(v.hitSide=!0),v}function pn(e,t,n,r){var i=e.doc,o=t.left,s;if("page"==r){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);s=t.top+n*(a-(0>n?1.5:.5)*nt(e.display))}else"line"==r&&(s=n>0?t.bottom+3:t.top-3);for(;;){var l=et(e,o,s);if(!l.outside)break;if(0>n?0>=s:s>=i.height){l.hitSide=!0;break}s+=5*n}return l}function gn(e,t){var n=t.ch,r=t.ch;if(e){(t.xRel<0||r==e.length)&&n?--n:++r;for(var i=e.charAt(n),o=ni(i)?ni:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!ni(e)};n>0&&o(e.charAt(n-1));)--n;for(;r<e.length&&o(e.charAt(r));)++r}return{from:Ut(t.line,n),to:Ut(t.line,r)}}function mn(e,t){Zt(e.doc,Ut(t,0),Kt(e.doc,Ut(t+1,0)))}function vn(t,n,r,i){e.defaults[t]=n,r&&(ro[t]=i?function(e,t,n){n!=oo&&r(e,t,n)}:r)}function yn(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var i=t[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function bn(e,t,n){return e.startState?e.startState(t,n):!0}function xn(e){return"string"==typeof e?ho[e]:e}function wn(e,t,n){function r(t){t=xn(t);var i=t[e];if(i===!1)return"stop";if(null!=i&&n(i))return!0;if(t.nofallthrough)return"stop";var o=t.fallthrough;if(null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return r(o);for(var s=0,a=o.length;a>s;++s){var l=r(o[s]);if(l)return l}return!1}for(var i=0;i<t.length;++i){var o=r(t[i]);if(o)return"stop"!=o}}function kn(e){var t=No[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Cn(e,t){if(Ai&&34==e.keyCode&&e["char"])return!1;var n=No[e.keyCode];return null==n||e.altGraphKey?!1:(e.altKey&&(n="Alt-"+n),(ji?e.metaKey:e.ctrlKey)&&(n="Ctrl-"+n),(ji?e.ctrlKey:e.metaKey)&&(n="Cmd-"+n),!t&&e.shiftKey&&(n="Shift-"+n),n)}function _n(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0}function Sn(e,t){this.lines=[],this.type=t,this.doc=e}function Tn(e,t,n,r,i){if(r&&r.shared)return Ln(e,t,n,r,i);if(e.cm&&!e.cm.curOp)return st(e.cm,Tn)(e,t,n,r,i);var o=new Sn(e,i);if("range"==i&&!Yt(t,n))return o;r&&Zr(r,o),o.replacedWith&&(o.collapsed=!0,o.replacedWith=ii("span",[o.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||(o.replacedWith.ignoreEvents=!0)),o.collapsed&&(Ui=!0),o.addToHistory&&Cr(e,{from:t,to:n,origin:"markText"},{head:e.sel.head,anchor:e.sel.anchor},0/0);var s=t.line,a=0,l,u,c=e.cm,d;if(e.iter(s,n.line+1,function(r){c&&o.collapsed&&!c.options.lineWrapping&&zn(e,r)==c.display.maxLine&&(d=!0);var i={from:null,to:null,marker:o};a+=r.text.length,s==t.line&&(i.from=t.ch,a-=t.ch),s==n.line&&(i.to=n.ch,a-=r.text.length-n.ch),o.collapsed&&(s==n.line&&(u=En(r,n.ch)),s==t.line?l=En(r,t.ch):gr(r,0)),An(r,i),++s}),o.collapsed&&e.iter(t.line,n.line+1,function(t){Rn(e,t)&&gr(t,0)}),o.clearOnEnter&&Pr(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(qi=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed){if(l!=u)throw new Error("Inserting collapsed marker overlapping an existing one");o.size=a,o.atomic=!0}return c&&(d&&(c.curOp.updateMaxLine=!0),(o.className||o.title||o.startStyle||o.endStyle||o.collapsed)&&ut(c,t.line,n.line+1),o.atomic&&nn(c)),o}function Dn(e,t){this.markers=e,this.primary=t;for(var n=0,r=this;n<e.length;++n)e[n].parent=this,Pr(e[n],"clear",function(){r.clear()})}function Ln(e,t,n,r,i){r=Zr(r),r.shared=!1;var o=[Tn(e,t,n,r,i)],s=o[0],a=r.replacedWith;return cr(e,function(e){a&&(r.replacedWith=a.cloneNode(!0)),o.push(Tn(e,Kt(e,t),Kt(e,n),r,i));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=Xr(o)}),new Dn(o,s)}function On(e,t){if(e)for(var n=0;n<e.length;++n){var r=e[n];if(r.marker==t)return r}}function Mn(e,t){for(var n,r=0;r<e.length;++r)e[r]!=t&&(n||(n=[])).push(e[r]);return n}function An(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function In(e,t,n){if(e)for(var r=0,i;r<e.length;++r){var o=e[r],s=o.marker,a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);if(a||"bookmark"==s.type&&o.from==t&&(!n||!o.marker.insertLeft)){var l=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(i||(i=[])).push({from:o.from,to:l?null:o.to,marker:s})}}return i}function Fn(e,t,n){if(e)for(var r=0,i;r<e.length;++r){var o=e[r],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);if(a||"bookmark"==s.type&&o.from==t&&(!n||o.marker.insertLeft)){var l=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(i||(i=[])).push({from:l?null:o.from-t,to:null==o.to?null:o.to-t,marker:s})}}return i}function $n(e,t){var n=Qt(e,t.from.line)&&fr(e,t.from.line).markedSpans,r=Qt(e,t.to.line)&&fr(e,t.to.line).markedSpans;if(!n&&!r)return null;var i=t.from.ch,o=t.to.ch,s=Vt(t.from,t.to),a=In(n,i,s),l=Fn(r,o,s),u=1==t.text.length,c=Xr(t.text).length+(u?i:0);if(a)for(var d=0;d<a.length;++d){var f=a[d];if(null==f.to){var h=On(l,f.marker);h?u&&(f.to=null==h.to?null:h.to+c):f.to=i}}if(l)for(var d=0;d<l.length;++d){var f=l[d];if(null!=f.to&&(f.to+=c),null==f.from){var h=On(a,f.marker);h||(f.from=c,u&&(a||(a=[])).push(f))}else f.from+=c,u&&(a||(a=[])).push(f)}if(u&&a){for(var d=0;d<a.length;++d)null!=a[d].from&&a[d].from==a[d].to&&"bookmark"!=a[d].marker.type&&a.splice(d--,1);a.length||(a=null)}var p=[a];if(!u){var g=t.text.length-2,m;if(g>0&&a)for(var d=0;d<a.length;++d)null==a[d].to&&(m||(m=[])).push({from:null,to:null,marker:a[d].marker});for(var d=0;g>d;++d)p.push(m);p.push(l)}return p}function Nn(e,t){var n=Sr(e,t),r=$n(e,t);if(!n)return r;if(!r)return n;for(var i=0;i<n.length;++i){var o=n[i],s=r[i];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],u=0;u<o.length;++u)if(o[u].marker==l.marker)continue e;o.push(l)}else s&&(n[i]=s)}return n}function Hn(e,t,n){var r=null;if(e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||r&&-1!=Jr(r,n)||(r||(r=[])).push(n)}}),!r)return null;for(var i=[{from:t,to:n}],o=0;o<r.length;++o)for(var s=r[o],a=s.find(),l=0;l<i.length;++l){var u=i[l];if(!Yt(u.to,a.from)&&!Yt(a.to,u.from)){var c=[l,1];(Yt(u.from,a.from)||!s.inclusiveLeft&&Vt(u.from,a.from))&&c.push({from:u.from,to:a.from}),(Yt(a.to,u.to)||!s.inclusiveRight&&Vt(u.to,a.to))&&c.push({from:a.to,to:u.to}),i.splice.apply(i,c),l+=c.length-1}}return i}function En(e,t){var n=Ui&&e.markedSpans,r;if(n)for(var i,o=0;o<n.length;++o)i=n[o],i.marker.collapsed&&(null==i.from||i.from<t)&&(null==i.to||i.to>t)&&(!r||r.width<i.marker.width)&&(r=i.marker);return r}function Pn(e){return En(e,-1)}function Wn(e){return En(e,e.text.length+1)}function zn(e,t){for(var n;n=Pn(t);)t=fr(e,n.find().from.line);return t}function Rn(e,t){var n=Ui&&t.markedSpans;if(n)for(var r,i=0;i<n.length;++i)if(r=n[i],r.marker.collapsed){if(null==r.from)return!0;if(!r.marker.replacedWith&&0==r.from&&r.marker.inclusiveLeft&&jn(e,t,r))return!0}}function jn(e,t,n){if(null==n.to){var r=n.marker.find().to,i=fr(e,r.line);return jn(e,i,On(i.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var o,s=0;s<t.markedSpans.length;++s)if(o=t.markedSpans[s],o.marker.collapsed&&!o.marker.replacedWith&&o.from==n.to&&(o.marker.inclusiveLeft||n.marker.inclusiveRight)&&jn(e,t,o))return!0}function Bn(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function qn(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function Un(e){return function(){var t=!this.cm.curOp;t&&it(this.cm);try{var n=e.apply(this,arguments)}finally{t&&ot(this.cm)}return n}}function Vn(e){return null!=e.height?e.height:(e.node.parentNode&&1==e.node.parentNode.nodeType||si(e.cm.display.measure,ii("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function Yn(e,t,n,r){var i=new po(e,n,r);return i.noHScroll&&(e.display.alignWidgets=!0),fn(e,t,function(t){var n=t.widgets||(t.widgets=[]);if(null==i.insertAt?n.push(i):n.splice(Math.min(n.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,!Rn(e.doc,t)||i.showIfHidden){var r=yr(e,t)<e.doc.scrollTop;gr(t,t.height+Vn(i)),r&&cn(e,0,i.height)}return!0}),i}function Gn(e,t,n,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Bn(e),qn(e,n);var i=r?r(e):1;i!=e.height&&gr(e,i)}function Xn(e){e.parent=null,Bn(e)}function Kn(e,t,n,r,i){var o=n.flattenSpans;null==o&&(o=e.options.flattenSpans);var s=0,a=null,l=new _n(t,e.options.tabSize),u;for(""==t&&n.blankLine&&n.blankLine(r);!l.eol();)l.pos>e.options.maxHighlightLength?(o=!1,l.pos=Math.min(t.length,l.start+5e4),u=null):u=n.token(l,r),o&&a==u||(s<l.start&&i(l.start,a),s=l.start,a=u),l.start=l.pos;s<l.pos&&i(l.pos,a)}function Jn(e,t,n){var r=[e.state.modeGen];Kn(e,t.text,e.doc.mode,n,function(e,t){r.push(e,t)});for(var i=0;i<e.state.overlays.length;++i){var o=e.state.overlays[i],s=1,a=0;Kn(e,t.text,o.mode,!0,function(e,t){for(var n=s;e>a;){var i=r[s];i>e&&r.splice(s,1,e,r[s+1],i),s+=2,a=Math.min(e,i)}if(t)if(o.opaque)r.splice(n,s-n,e,t),s=n+2;else for(;s>n;n+=2){var l=r[n+1];r[n+1]=l?l+" "+t:t}})}return r}function Qn(e,t){return t.styles&&t.styles[0]==e.state.modeGen||(t.styles=Jn(e,t,t.stateAfter=H(e,mr(t)))),t.styles}function Zn(e,t,n){var r=e.doc.mode,i=new _n(t.text,e.options.tabSize);for(""==t.text&&r.blankLine&&r.blankLine(n);!i.eol()&&i.pos<=e.options.maxHighlightLength;)r.token(i,n),i.start=i.pos
}function er(e){return e?mo[e]||(mo[e]="cm-"+e.replace(/ +/g," cm-")):null}function tr(e,t,n,r){for(var i,o=t,s=!0;i=Pn(o);)o=fr(e.doc,i.find().from.line);var a={pre:ii("pre"),col:0,pos:0,measure:null,measuredSomething:!1,cm:e,copyWidgets:r};o.textClass&&(a.pre.className=o.textClass);do{o.text&&(s=!1),a.measure=o==t&&n,a.pos=0,a.addToken=a.measure?rr:nr,(Si||Li)&&e.getOption("lineWrapping")&&(a.addToken=ir(a.addToken));var l=sr(o,a,Qn(e,o));n&&o==t&&!a.measuredSomething&&(n[0]=a.pre.appendChild(di(e.display.measure)),a.measuredSomething=!0),l&&(o=fr(e.doc,l.to.line))}while(l);!n||a.measuredSomething||n[0]||(n[0]=a.pre.appendChild(s?ii("span"," "):di(e.display.measure))),a.pre.firstChild||Rn(e.doc,t)||a.pre.appendChild(document.createTextNode(" "));var u;if(n&&Si&&(u=br(o))){var c=u.length-1;u[c].from==u[c].to&&--c;var d=u[c],f=u[c-1];if(d.from+1==d.to&&f&&d.level<f.level){var h=n[a.pos-1];h&&h.parentNode.insertBefore(h.measureRight=di(e.display.measure),h.nextSibling)}}return zr(e,"renderLine",e,t,a.pre),a.pre}function nr(e,t,n,r,i,o){if(t){if(vo.test(t))for(var s=document.createDocumentFragment(),a=0;;){vo.lastIndex=a;var l=vo.exec(t),u=l?l.index-a:t.length-a;if(u&&(s.appendChild(document.createTextNode(t.slice(a,a+u))),e.col+=u),!l)break;if(a+=u+1,"	"==l[0]){var c=e.cm.options.tabSize,d=c-e.col%c;s.appendChild(ii("span",Gr(d),"cm-tab")),e.col+=d}else{var f=ii("span","•","cm-invalidchar");f.title="\\u"+l[0].charCodeAt(0).toString(16),s.appendChild(f),e.col+=1}}else{e.col+=t.length;var s=document.createTextNode(t)}if(n||r||i||e.measure){var h=n||"";r&&(h+=r),i&&(h+=i);var f=ii("span",[s],h);return o&&(f.title=o),e.pre.appendChild(f)}e.pre.appendChild(s)}}function rr(e,t,n,r,i){for(var o=e.cm.options.lineWrapping,s=0;s<t.length;++s){var a=t.charAt(s),l=0==s;a>="�"&&"�">a&&s<t.length-1?(a=t.slice(s,s+2),++s):s&&o&&ui(t,s)&&e.pre.appendChild(ii("wbr"));var u=e.measure[e.pos],c=e.measure[e.pos]=nr(e,a,n,l&&r,s==t.length-1&&i);u&&(c.leftSide=u.leftSide||u),Si&&o&&" "==a&&s&&!/\s/.test(t.charAt(s-1))&&s<t.length-1&&!/\s/.test(t.charAt(s+1))&&(c.style.whiteSpace="normal"),e.pos+=a.length}t.length&&(e.measuredSomething=!0)}function ir(e){function t(e){for(var t=" ",n=0;n<e.length-2;++n)t+=n%2?" ":" ";return t+=" "}return function(n,r,i,o,s,a){return e(n,r.replace(/ {3,}/,t),i,o,s,a)}}function or(e,t,n,r){var i=!r&&n.replacedWith;if(i&&(e.copyWidgets&&(i=i.cloneNode(!0)),e.pre.appendChild(i),e.measure)){if(t)e.measure[e.pos]=i;else{var o=e.measure[e.pos]=di(e.cm.display.measure);"bookmark"!=n.type||n.insertLeft?e.pre.insertBefore(o,i):e.pre.appendChild(o)}e.measuredSomething=!0}e.pos+=t}function sr(e,t,n){var r=e.markedSpans,i=e.text,o=0;if(r)for(var s=i.length,a=0,l=1,u="",c,d=0,f,h,p,g,m;;){if(d==a){f=h=p=g="",m=null,d=1/0;for(var v=null,y=0;y<r.length;++y){var b=r[y],x=b.marker;b.from<=a&&(null==b.to||b.to>a)?(null!=b.to&&d>b.to&&(d=b.to,h=""),x.className&&(f+=" "+x.className),x.startStyle&&b.from==a&&(p+=" "+x.startStyle),x.endStyle&&b.to==d&&(h+=" "+x.endStyle),x.title&&!g&&(g=x.title),x.collapsed&&(!m||m.marker.size<x.size)&&(m=b)):b.from>a&&d>b.from&&(d=b.from),"bookmark"==x.type&&b.from==a&&x.replacedWith&&(v=x)}if(m&&(m.from||0)==a&&(or(t,(null==m.to?s:m.to)-a,m.marker,null==m.from),null==m.to))return m.marker.find();v&&!m&&or(t,0,v)}if(a>=s)break;for(var w=Math.min(s,d);;){if(u){var k=a+u.length;if(!m){var C=k>w?u.slice(0,w-a):u;t.addToken(t,C,c?c+f:f,p,a+C.length==d?h:"",g)}if(k>=w){u=u.slice(w-a),a=w;break}a=k,p=""}u=i.slice(o,o=n[l++]),c=er(n[l++])}}else for(var l=1;l<n.length;l+=2)t.addToken(t,i.slice(o,o=n[l]),er(n[l+1]))}function ar(e,t,n,r,i){function o(e){return n?n[e]:null}function s(e,n,r){Gn(e,n,r,i),Rr(e,"change",e,t)}var a=t.from,l=t.to,u=t.text,c=fr(e,a.line),d=fr(e,l.line),f=Xr(u),h=o(u.length-1),p=l.line-a.line;if(0==a.ch&&0==l.ch&&""==f){for(var g=0,m=u.length-1,v=[];m>g;++g)v.push(new go(u[g],o(g),i));s(d,d.text,h),p&&e.remove(a.line,p),v.length&&e.insert(a.line,v)}else if(c==d)if(1==u.length)s(c,c.text.slice(0,a.ch)+f+c.text.slice(l.ch),h);else{for(var v=[],g=1,m=u.length-1;m>g;++g)v.push(new go(u[g],o(g),i));v.push(new go(f+c.text.slice(l.ch),h,i)),s(c,c.text.slice(0,a.ch)+u[0],o(0)),e.insert(a.line+1,v)}else if(1==u.length)s(c,c.text.slice(0,a.ch)+u[0]+d.text.slice(l.ch),o(0)),e.remove(a.line+1,p);else{s(c,c.text.slice(0,a.ch)+u[0],o(0)),s(d,f+d.text.slice(l.ch),h);for(var g=1,m=u.length-1,v=[];m>g;++g)v.push(new go(u[g],o(g),i));p>1&&e.remove(a.line+1,p-1),e.insert(a.line+1,v)}Rr(e,"change",e,t),tn(e,r.anchor,r.head,null,!0)}function lr(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;n>t;++t)e[t].parent=this,r+=e[t].height;this.height=r}function ur(e){this.children=e;for(var t=0,n=0,r=0,i=e.length;i>r;++r){var o=e[r];t+=o.chunkSize(),n+=o.height,o.parent=this}this.size=t,this.height=n,this.parent=null}function cr(e,t,n){function r(e,i,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=i){var l=o&&a.sharedHist;(!n||l)&&(t(a.doc,l),r(a.doc,e,l))}}}r(e,null,!0)}function dr(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,o(e),n(e),e.options.lineWrapping||d(e),e.options.mode=t.modeOption,ut(e)}function fr(e,t){for(t-=e.first;!e.lines;)for(var n=0;;++n){var r=e.children[n],i=r.chunkSize();if(i>t){e=r;break}t-=i}return e.lines[t]}function hr(e,t,n){var r=[],i=t.line;return e.iter(t.line,n.line+1,function(e){var o=e.text;i==n.line&&(o=o.slice(0,n.ch)),i==t.line&&(o=o.slice(t.ch)),r.push(o),++i}),r}function pr(e,t,n){var r=[];return e.iter(t,n,function(e){r.push(e.text)}),r}function gr(e,t){for(var n=t-e.height,r=e;r;r=r.parent)r.height+=n}function mr(e){if(null==e.parent)return null;for(var t=e.parent,n=Jr(t.lines,e),r=t.parent;r;t=r,r=r.parent)for(var i=0;r.children[i]!=t;++i)n+=r.children[i].chunkSize();return n+t.first}function vr(e,t){var n=e.first;e:do{for(var r=0,i=e.children.length;i>r;++r){var o=e.children[r],s=o.height;if(s>t){e=o;continue e}t-=s,n+=o.chunkSize()}return n}while(!e.lines);for(var r=0,i=e.lines.length;i>r;++r){var a=e.lines[r],l=a.height;if(l>t)break;t-=l}return n+r}function yr(e,t){t=zn(e.doc,t);for(var n=0,r=t.parent,i=0;i<r.lines.length;++i){var o=r.lines[i];if(o==t)break;n+=o.height}for(var s=r.parent;s;r=s,s=r.parent)for(var i=0;i<s.children.length;++i){var a=s.children[i];if(a==r)break;n+=a.height}return n}function br(e){var t=e.order;return null==t&&(t=e.order=Eo(e.text)),t}function xr(e){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,generation:e||1,maxGeneration:e||1}}function wr(e,t,n,r){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,r),function(n){n.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=n.markedSpans),++o})}function kr(e,t){var n={line:t.from.line,ch:t.from.ch},r={from:n,to:no(t),text:hr(e,t.from,t.to)};return wr(e,r,t.from.line,t.to.line+1),cr(e,function(e){wr(e,r,t.from.line,t.to.line+1)},!0),r}function Cr(e,t,n,r){var i=e.history;i.undone.length=0;var o=+new Date,s=Xr(i.done);if(s&&(i.lastOp==r||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&i.lastTime>o-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))){var a=Xr(s.changes);Vt(t.from,t.to)&&Vt(t.from,a.to)?a.to=no(t):s.changes.push(kr(e,t)),s.anchorAfter=n.anchor,s.headAfter=n.head}else for(s={changes:[kr(e,t)],generation:i.generation,anchorBefore:e.sel.anchor,headBefore:e.sel.head,anchorAfter:n.anchor,headAfter:n.head},i.done.push(s),i.generation=++i.maxGeneration;i.done.length>i.undoDepth;)i.done.shift();i.lastTime=o,i.lastOp=r,i.lastOrigin=t.origin}function _r(e){if(!e)return null;for(var t=0,n;t<e.length;++t)e[t].marker.explicitlyCleared?n||(n=e.slice(0,t)):n&&n.push(e[t]);return n?n.length?n:null:e}function Sr(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var r=0,i=[];r<t.text.length;++r)i.push(_r(n[r]));return i}function Tr(e,t){for(var n=0,r=[];n<e.length;++n){var i=e[n],o=i.changes,s=[];r.push({changes:s,anchorBefore:i.anchorBefore,headBefore:i.headBefore,anchorAfter:i.anchorAfter,headAfter:i.headAfter});for(var a=0;a<o.length;++a){var l=o[a],u;if(s.push({from:l.from,to:l.to,text:l.text}),t)for(var c in l)(u=c.match(/^spans_(\d+)$/))&&Jr(t,Number(u[1]))>-1&&(Xr(s)[c]=l[c],delete l[c])}}return r}function Dr(e,t,n,r){n<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function Lr(e,t,n,r){for(var i=0;i<e.length;++i){for(var o=e[i],s=!0,a=0;a<o.changes.length;++a){var l=o.changes[a];if(o.copied||(l.from=Gt(l.from),l.to=Gt(l.to)),n<l.from.line)l.from.line+=r,l.to.line+=r;else if(t<=l.to.line){s=!1;break}}o.copied||(o.anchorBefore=Gt(o.anchorBefore),o.headBefore=Gt(o.headBefore),o.anchorAfter=Gt(o.anchorAfter),o.readAfter=Gt(o.headAfter),o.copied=!0),s?(Dr(o.anchorBefore),Dr(o.headBefore),Dr(o.anchorAfter),Dr(o.headAfter)):(e.splice(0,i+1),i=0)}}function Or(e,t){var n=t.from.line,r=t.to.line,i=t.text.length-(r-n)-1;Lr(e.done,n,r,i),Lr(e.undone,n,r,i)}function Mr(){Nr(this)}function Ar(e){return e.stop||(e.stop=Mr),e}function Ir(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Fr(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function $r(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Nr(e){Ir(e),Fr(e)}function Hr(e){return e.target||e.srcElement}function Er(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Wi&&e.ctrlKey&&1==t&&(t=3),t}function Pr(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var r=e._handlers||(e._handlers={}),i=r[t]||(r[t]=[]);i.push(n)}}function Wr(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var i=0;i<r.length;++i)if(r[i]==n){r.splice(i,1);break}}}function zr(e,t){var n=e._handlers&&e._handlers[t];if(n)for(var r=Array.prototype.slice.call(arguments,2),i=0;i<n.length;++i)n[i].apply(null,r)}function Rr(e,t){function n(e){return function(){e.apply(null,i)}}var r=e._handlers&&e._handlers[t];if(r){var i=Array.prototype.slice.call(arguments,2);ko||(++Co,ko=[],setTimeout(Br,0));for(var o=0;o<r.length;++o)ko.push(n(r[o]))}}function jr(e,t,n){return zr(e,n||t.type,e,t),$r(t)||t.codemirrorIgnore}function Br(){--Co;var e=ko;ko=null;for(var t=0;t<e.length;++t)e[t]()}function qr(e,t){var n=e._handlers&&e._handlers[t];return n&&n.length>0}function Ur(e){e.prototype.on=function(e,t){Pr(this,e,t)},e.prototype.off=function(e,t){Wr(this,e,t)}}function Vr(){this.id=null}function Yr(e,t,n,r,i){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var o=r||0,s=i||0;t>o;++o)"	"==e.charAt(o)?s+=n-s%n:++s;return s}function Gr(e){for(;To.length<=e;)To.push(Xr(To)+" ");return To[e]}function Xr(e){return e[e.length-1]}function Kr(e){if(Ei)e.selectionStart=0,e.selectionEnd=e.value.length;else try{e.select()}catch(t){}}function Jr(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;++n)if(e[n]==t)return n;return-1}function Qr(e,t){function n(){}n.prototype=e;var r=new n;return t&&Zr(t,r),r}function Zr(e,t){t||(t={});for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function ei(e){for(var t=[],n=0;e>n;++n)t.push(void 0);return t}function ti(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function ni(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Do.test(e))}function ri(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function ii(e,t,n,r){var i=document.createElement(e);if(n&&(i.className=n),r&&(i.style.cssText=r),"string"==typeof t)ai(i,t);else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function oi(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function si(e,t){return oi(e).appendChild(t)}function ai(e,t){Di?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function li(e){return e.getBoundingClientRect()}function ui(){return!1}function ci(e){if(null!=Mo)return Mo;var t=ii("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return si(e,t),t.offsetWidth&&(Mo=t.offsetHeight-t.clientHeight),Mo||0}function di(e){if(null==Ao){var t=ii("span","​");si(e,ii("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Ao=t.offsetWidth<=1&&t.offsetHeight>2&&!Ti)}return Ao?ii("span","​"):ii("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function fi(e,t,n,r){if(!e)return r(t,n,"ltr");for(var i=!1,o=0;o<e.length;++o){var s=e[o];(s.from<n&&s.to>t||t==n&&s.to==t)&&(r(Math.max(s.from,t),Math.min(s.to,n),1==s.level?"rtl":"ltr"),i=!0)}i||r(t,n,"ltr")}function hi(e){return e.level%2?e.to:e.from}function pi(e){return e.level%2?e.from:e.to}function gi(e){var t=br(e);return t?hi(t[0]):0}function mi(e){var t=br(e);return t?pi(Xr(t)):e.text.length}function vi(e,t){var n=fr(e.doc,t),r=zn(e.doc,n);r!=n&&(t=mr(r));var i=br(r),o=i?i[0].level%2?mi(r):gi(r):0;return Ut(t,o)}function yi(e,t){for(var n,r;n=Wn(r=fr(e.doc,t));)t=n.find().to.line;var i=br(r),o=i?i[0].level%2?gi(r):mi(r):r.text.length;return Ut(t,o)}function bi(e,t,n){var r=e[0].level;return t==r?!0:n==r?!1:n>t}function xi(e,t){for(var n=0,r;n<e.length;++n){var i=e[n];if(i.from<t&&i.to>t)return Ho=null,n;if(i.from==t||i.to==t){if(null!=r)return bi(e,i.level,e[r].level)?(Ho=r,n):(Ho=n,r);r=n}}return Ho=null,r}function wi(e,t,n,r){if(!r)return t+n;do t+=n;while(t>0&&Lo.test(e.text.charAt(t)));return t}function ki(e,t,n,r){var i=br(e);if(!i)return Ci(e,t,n,r);for(var o=xi(i,t),s=i[o],a=wi(e,t,s.level%2?-n:n,r);;){if(a>s.from&&a<s.to)return a;if(a==s.from||a==s.to)return xi(i,a)==o?a:(s=i[o+=n],n>0==s.level%2?s.to:s.from);if(s=i[o+=n],!s)return null;a=n>0==s.level%2?wi(e,s.to,-1,r):wi(e,s.from,1,r)}}function Ci(e,t,n,r){var i=t+n;if(r)for(;i>0&&Lo.test(e.text.charAt(i));)i+=n;return 0>i||i>e.text.length?null:i}var _i=/gecko\/\d/i.test(navigator.userAgent),Si=/MSIE \d/.test(navigator.userAgent),Ti=Si&&(null==document.documentMode||document.documentMode<8),Di=Si&&(null==document.documentMode||document.documentMode<9),Li=/WebKit\//.test(navigator.userAgent),Oi=Li&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Mi=/Chrome\//.test(navigator.userAgent),Ai=/Opera\//.test(navigator.userAgent),Ii=/Apple Computer/.test(navigator.vendor),Fi=/KHTML\//.test(navigator.userAgent),$i=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Ni=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Hi=/PhantomJS/.test(navigator.userAgent),Ei=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Pi=Ei||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Wi=Ei||/Mac/.test(navigator.platform),zi=/windows/i.test(navigator.platform),Ri=Ai&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Ri&&(Ri=Number(Ri[1])),Ri&&Ri>=15&&(Ai=!1,Li=!0);var ji=Wi&&(Oi||Ai&&(null==Ri||12.11>Ri)),Bi=_i||Si&&!Di,qi=!1,Ui=!1,Vi,Yi=0,Gi,Xi,Ki=0,Ji=0,Qi=null;Si?Qi=-.53:_i?Qi=15:Mi?Qi=-.7:Ii&&(Qi=-1/3);var Zi,eo=null,to,no=e.changeEnd=function(e){return e.text?Ut(e.from.line+e.text.length-1,Xr(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};e.Pos=Ut,e.prototype={constructor:e,focus:function(){window.focus(),pt(this),It(this),dt(this)},setOption:function(e,t){var n=this.options,r=n[e];(n[e]!=t||"mode"==e)&&(n[e]=t,ro.hasOwnProperty(e)&&st(this,ro[e])(this,t,r))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||"string"!=typeof t[n]&&t[n].name==e)return t.splice(n,1),!0},addOverlay:st(null,function(t,n){var r=t.token?t:e.getMode(this.options,t);if(r.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:r,modeSpec:t,opaque:n&&n.opaque}),this.state.modeGen++,ut(this)}),removeOverlay:st(null,function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var r=t[n].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(n,1),this.state.modeGen++,void ut(this)}}),indentLine:st(null,function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Qt(this.doc,e)&&dn(this,e,t,n)}),indentSelection:st(null,function(e){var t=this.doc.sel;if(Vt(t.from,t.to))return dn(this,t.from.line,e);for(var n=t.to.line-(t.to.ch?0:1),r=t.from.line;n>=r;++r)dn(this,r,e)}),getTokenAt:function(e,t){var n=this.doc;e=Kt(n,e);for(var r=H(this,e.line,t),i=this.doc.mode,o=fr(n,e.line),s=new _n(o.text,this.options.tabSize);s.pos<e.ch&&!s.eol();){s.start=s.pos;var a=i.token(s,r)}return{start:s.start,end:s.pos,string:s.current(),className:a||null,type:a||null,state:r}},getTokenTypeAt:function(e){e=Kt(this.doc,e);var t=Qn(this,fr(this.doc,e.line)),n=0,r=(t.length-1)/2,i=e.ch;if(0==i)return t[2];for(;;){var o=n+r>>1;if((o?t[2*o-1]:0)>=i)r=o;else{if(!(t[2*o+1]<i))return t[2*o+2];n=o+1}}},getModeAt:function(t){var n=this.doc.mode;return n.innerMode?e.innerMode(n,this.getTokenAt(t).state).mode:n},getHelper:function(e,t){if(co.hasOwnProperty(t)){var n=co[t],r=this.getModeAt(e);return r[t]&&n[r[t]]||r.helperType&&n[r.helperType]||n[r.name]}},getStateAfter:function(e,t){var n=this.doc;return e=Xt(n,null==e?n.first+n.size-1:e),H(this,e+1,t)},cursorCoords:function(e,t){var n,r=this.doc.sel;return n=null==e?r.head:"object"==typeof e?Kt(this.doc,e):e?r.from:r.to,Q(this,n,t||"page")},charCoords:function(e,t){return J(this,Kt(this.doc,e),t||"page")},coordsChar:function(e,t){return e=K(this,e,t||"page"),et(this,e.left,e.top)},lineAtHeight:function(e,t){return e=K(this,{top:e,left:0},t||"page").top,vr(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var n=!1,r=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>r&&(e=r,n=!0);var i=fr(this.doc,e);return X(this,fr(this.doc,e),{top:0,left:0},t||"page").top+(n?i.height:0)},defaultTextHeight:function(){return nt(this.display)},defaultCharWidth:function(){return rt(this.display)},setGutterMarker:st(null,function(e,t,n){return fn(this,e,function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=n,!n&&ri(r)&&(e.gutterMarkers=null),!0})}),clearGutter:st(null,function(e){var t=this,n=t.doc,r=n.first;n.iter(function(n){n.gutterMarkers&&n.gutterMarkers[e]&&(n.gutterMarkers[e]=null,ut(t,r,r+1),ri(n.gutterMarkers)&&(n.gutterMarkers=null)),++r})}),addLineClass:st(null,function(e,t,n){return fn(this,e,function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[r]){if(new RegExp("(?:^|\\s)"+n+"(?:$|\\s)").test(e[r]))return!1;e[r]+=" "+n}else e[r]=n;return!0})}),removeLineClass:st(null,function(e,t,n){return fn(this,e,function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",i=e[r];if(!i)return!1;if(null==n)e[r]=null;else{var o=i.match(new RegExp("(?:^|\\s+)"+n+"(?:$|\\s+)"));if(!o)return!1;var s=o.index+o[0].length;e[r]=i.slice(0,o.index)+(o.index&&s!=i.length?" ":"")+i.slice(s)||null}return!0})}),addLineWidget:st(null,function(e,t,n){return Yn(this,e,t,n)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!Qt(this.doc,e))return null;var t=e;if(e=fr(this.doc,e),!e)return null}else{var t=mr(e);if(null==t)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(e,t,n,r,i){var o=this.display;e=Q(this,Kt(this.doc,e));var s=e.bottom,a=e.left;if(t.style.position="absolute",o.sizer.appendChild(t),"over"==r)s=e.top;else if("above"==r||"near"==r){var l=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>u&&(a=u-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==i?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?a=0:"middle"==i&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),n&&an(this,a,s,a+t.offsetWidth,s+t.offsetHeight)},triggerOnKeyDown:st(null,Mt),execCommand:function(e){return fo[e](this)},findPosH:function(e,t,n,r){var i=1;0>t&&(i=-1,t=-t);for(var o=0,s=Kt(this.doc,e);t>o&&(s=hn(this.doc,s,i,n,r),!s.hitSide);++o);return s},moveH:st(null,function(e,t){var n=this.doc.sel,r;r=n.shift||n.extend||Vt(n.from,n.to)?hn(this.doc,n.head,e,t,this.options.rtlMoveVisually):0>e?n.from:n.to,Zt(this.doc,r,r,e)}),deleteH:st(null,function(e,t){var n=this.doc.sel;Vt(n.from,n.to)?qt(this.doc,"",n.from,hn(this.doc,n.head,e,t,!1),"+delete"):qt(this.doc,"",n.from,n.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(e,t,n,r){var i=1,o=r;0>t&&(i=-1,t=-t);for(var s=0,a=Kt(this.doc,e);t>s;++s){var l=Q(this,a,"div");if(null==o?o=l.left:l.left=o,a=pn(this,l,i,n),a.hitSide)break}return a},moveV:st(null,function(e,t){var n=this.doc.sel,r=Q(this,n.head,"div");null!=n.goalColumn&&(r.left=n.goalColumn);var i=pn(this,r,e,t);"page"==t&&cn(this,0,J(this,i,"div").top-r.top),Zt(this.doc,i,i,e),n.goalColumn=r.left}),toggleOverwrite:function(e){(null==e||e!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite",""))},hasFocus:function(){return this.state.focused},scrollTo:st(null,function(e,t){un(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller,t=_o;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:st(null,function(e,t){"number"==typeof e&&(e=Ut(e,0)),t||(t=0);var n=e;e&&null==e.line||(this.curOp.scrollToPos=e?Kt(this.doc,e):this.doc.sel.head,this.curOp.scrollToPosMargin=t,n=Q(this,this.curOp.scrollToPos));var r=ln(this,n.left,n.top-t,n.right,n.bottom+t);un(this,r.scrollLeft,r.scrollTop)}),setSize:st(null,function(e,t){function n(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&(this.display.measureLineCache.length=this.display.measureLineCachePos=0),this.curOp.forceUpdate=!0}),operation:function(e){return lt(this,e)},refresh:st(null,function(){V(this),un(this,this.doc.scrollLeft,this.doc.scrollTop),ut(this)}),swapDoc:st(null,function(e){var t=this.doc;return t.cm=null,dr(this,e),V(this),ht(this,!0),un(this,e.scrollLeft,e.scrollTop),t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ur(e);var ro=e.optionHandlers={},io=e.defaults={},oo=e.Init={toString:function(){return"CodeMirror.Init"}};vn("value","",function(e,t){e.setValue(t)},!0),vn("mode",null,function(e,t){e.doc.modeOption=t,n(e)},!0),vn("indentUnit",2,n,!0),vn("indentWithTabs",!1),vn("smartIndent",!0),vn("tabSize",4,function(e){n(e),V(e),ut(e)},!0),vn("electricChars",!0),vn("rtlMoveVisually",!zi),vn("theme","default",function(e){a(e),l(e)},!0),vn("keyMap","default",s),vn("extraKeys",null),vn("onKeyEvent",null),vn("onDragEvent",null),vn("lineWrapping",!1,r,!0),vn("gutters",[],function(e){f(e.options),l(e)},!0),vn("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?y(e.display)+"px":"0",e.refresh()},!0),vn("coverGutterNextToScrollbar",!1,h,!0),vn("lineNumbers",!1,function(e){f(e.options),l(e)},!0),vn("firstLineNumber",1,l,!0),vn("lineNumberFormatter",function(e){return e},l,!0),vn("showCursorWhenSelecting",!1,L,!0),vn("readOnly",!1,function(e,t){"nocursor"==t?(Ft(e),e.display.input.blur()):t||ht(e,!0)}),vn("dragDrop",!0),vn("cursorBlinkRate",530),vn("cursorScrollMargin",0),vn("cursorHeight",1),vn("workTime",100),vn("workDelay",100),vn("flattenSpans",!0),vn("pollInterval",100),vn("undoDepth",40,function(e,t){e.doc.history.undoDepth=t}),vn("historyEventDelay",500),vn("viewportMargin",10,function(e){e.refresh()},!0),vn("maxHighlightLength",1e4,function(e){n(e),e.refresh()},!0),vn("moveInputWithCursor",!0,function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)}),vn("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),vn("autofocus",null);var so=e.modes={},ao=e.mimeModes={};e.defineMode=function(t,n){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),arguments.length>2){n.dependencies=[];for(var r=2;r<arguments.length;++r)n.dependencies.push(arguments[r])}so[t]=n},e.defineMIME=function(e,t){ao[e]=t},e.resolveMode=function(t){if("string"==typeof t&&ao.hasOwnProperty(t))t=ao[t];else if(t&&"string"==typeof t.name&&ao.hasOwnProperty(t.name)){var n=ao[t.name];t=Qr(n,t),t.name=n.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,n){var n=e.resolveMode(n),r=so[n.name];if(!r)return e.getMode(t,"text/plain");var i=r(t,n);if(lo.hasOwnProperty(n.name)){var o=lo[n.name];for(var s in o)o.hasOwnProperty(s)&&(i.hasOwnProperty(s)&&(i["_"+s]=i[s]),i[s]=o[s])}return i.name=n.name,i},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var lo=e.modeExtensions={};e.extendMode=function(e,t){var n=lo.hasOwnProperty(e)?lo[e]:lo[e]={};Zr(t,n)},e.defineExtension=function(t,n){e.prototype[t]=n},e.defineDocExtension=function(e,t){bo.prototype[e]=t},e.defineOption=vn;var uo=[];e.defineInitHook=function(e){uo.push(e)};var co=e.helpers={};e.registerHelper=function(t,n,r){co.hasOwnProperty(t)||(co[t]=e[t]={}),co[t][n]=r},e.isWordChar=ni,e.copyState=yn,e.startState=bn,e.innerMode=function(e,t){for(;e.innerMode;){var n=e.innerMode(t);if(!n||n.mode==e)break;t=n.state,e=n.mode}return n||{mode:e,state:t}};var fo=e.commands={selectAll:function(e){e.setSelection(Ut(e.firstLine(),0),Ut(e.lastLine()))},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!Vt(t,n);r||e.getLine(t.line).length!=t.ch?e.replaceRange("",t,r?n:Ut(t.line),"+delete"):e.replaceRange("",t,Ut(t.line+1,0),"+delete")},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",Ut(t,0),Ut(t),"+delete")},delLineLeft:function(e){var t=e.getCursor();e.replaceRange("",Ut(t.line,0),t,"+delete")},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.extendSelection(Ut(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(Ut(e.lastLine()))},goLineStart:function(e){e.extendSelection(vi(e,e.getCursor().line))},goLineStartSmart:function(e){var t=e.getCursor(),n=vi(e,t.line),r=e.getLineHandle(n.line),i=br(r);if(i&&0!=i[0].level)e.extendSelection(n);else{var o=Math.max(0,r.text.search(/\S/)),s=t.line==n.line&&t.ch<=o&&t.ch;e.extendSelection(Ut(n.line,s?0:o))}},goLineEnd:function(e){e.extendSelection(yi(e,e.getCursor().line))},goLineRight:function(e){var t=e.charCoords(e.getCursor(),"div").top+5;e.extendSelection(e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:t},"div"))},goLineLeft:function(e){var t=e.charCoords(e.getCursor(),"div").top+5;e.extendSelection(e.coordsChar({left:0,top:t},"div"))},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end","+input")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end","+input")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),Ut(t.line,t.ch-1),Ut(t.line,t.ch+1))},newlineAndIndent:function(e){st(e,function(){e.replaceSelection("\n","end","+input"),e.indentLine(e.getCursor().line,null,!0)})()},toggleOverwrite:function(e){e.toggleOverwrite()}},ho=e.keyMap={};ho.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},ho.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},ho.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft",fallthrough:["basic","emacsy"]},ho["default"]=Wi?ho.macDefault:ho.pcDefault,ho.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},e.lookupKey=wn,e.isModifierKey=kn,e.keyName=Cn,e.fromTextArea=function(t,n){function r(){t.value=u.getValue()}if(n||(n={}),n.value=t.value,!n.tabindex&&t.tabindex&&(n.tabindex=t.tabindex),!n.placeholder&&t.placeholder&&(n.placeholder=t.placeholder),null==n.autofocus){var i=document.body;try{i=document.activeElement}catch(o){}n.autofocus=i==t||null!=t.getAttribute("autofocus")&&i==document.body}if(t.form&&(Pr(t.form,"submit",r),!n.leaveSubmitMethodAlone)){var s=t.form,a=s.submit;try{var l=s.submit=function(){r(),s.submit=a,s.submit(),s.submit=l}}catch(o){}}t.style.display="none";var u=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},n);return u.save=r,u.getTextArea=function(){return t},u.toTextArea=function(){r(),t.parentNode.removeChild(u.getWrapperElement()),t.style.display="",t.form&&(Wr(t.form,"submit",r),"function"==typeof t.form.submit&&(t.form.submit=a))},u},_n.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var n=t==e;else var n=t&&(e.test?e.test(t):e(t));
return n?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Yr(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return Yr(this.string,null,this.tabSize)},match:function(e,t,n){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}var i=function(e){return n?e.toLowerCase():e},o=this.string.substr(this.pos,e.length);return i(o)==i(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},e.StringStream=_n,e.TextMarker=Sn,Ur(Sn),Sn.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&it(e),qr(this,"clear")){var n=this.find();n&&Rr(this,"clear",n.from,n.to)}for(var r=null,i=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=On(s.markedSpans,this);null!=a.to&&(i=mr(s)),s.markedSpans=Mn(s.markedSpans,a),null!=a.from?r=mr(s):this.collapsed&&!Rn(this.doc,s)&&e&&gr(s,nt(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var o=0;o<this.lines.length;++o){var l=zn(e.doc,this.lines[o]),u=c(e.doc,l);u>e.display.maxLineLength&&(e.display.maxLine=l,e.display.maxLineLength=u,e.display.maxLineChanged=!0)}null!=r&&e&&ut(e,r,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&nn(e)),t&&ot(e)}},Sn.prototype.find=function(){for(var e,t,n=0;n<this.lines.length;++n){var r=this.lines[n],i=On(r.markedSpans,this);if(null!=i.from||null!=i.to){var o=mr(r);null!=i.from&&(e=Ut(o,i.from)),null!=i.to&&(t=Ut(o,i.to))}}return"bookmark"==this.type?e:e&&{from:e,to:t}},Sn.prototype.changed=function(){var e=this.find(),t=this.doc.cm;if(e&&t){var n=fr(this.doc,e.from.line);if(j(t,n),e.from.line>=t.display.showingFrom&&e.from.line<t.display.showingTo){for(var r=t.display.lineDiv.firstChild;r;r=r.nextSibling)if(r.lineObj==n){r.offsetHeight!=n.height&&gr(n,r.offsetHeight);break}lt(t,function(){t.curOp.selectionChanged=t.curOp.forceUpdate=t.curOp.updateMaxLine=!0})}}},Sn.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=Jr(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Sn.prototype.detachLine=function(e){if(this.lines.splice(Jr(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},e.SharedTextMarker=Dn,Ur(Dn),Dn.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();Rr(this,"clear")}},Dn.prototype.find=function(){return this.primary.find()};var po=e.LineWidget=function(e,t,n){if(n)for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.cm=e,this.node=t};Ur(po),po.prototype.clear=Un(function(){var e=this.line.widgets,t=mr(this.line);if(null!=t&&e){for(var n=0;n<e.length;++n)e[n]==this&&e.splice(n--,1);e.length||(this.line.widgets=null);var r=yr(this.cm,this.line)<this.cm.doc.scrollTop;gr(this.line,Math.max(0,this.line.height-Vn(this))),r&&cn(this.cm,0,-this.height),ut(this.cm,t,t+1)}}),po.prototype.changed=Un(function(){var e=this.height;this.height=null;var t=Vn(this)-e;if(t){gr(this.line,this.line.height+t);var n=mr(this.line);ut(this.cm,n,n+1)}});var go=e.Line=function(e,t,n){this.text=e,qn(this,t),this.height=n?n(this):1};Ur(go);var mo={},vo=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;lr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=e,r=e+t;r>n;++n){var i=this.lines[n];this.height-=i.height,Xn(i),Rr(i,"delete")}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertInner:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,i=t.length;i>r;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;r>e;++e)if(n(this.lines[e]))return!0}},ur.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var n=0;n<this.children.length;++n){var r=this.children[n],i=r.chunkSize();if(i>e){var o=Math.min(t,i-e),s=r.height;if(r.removeInner(e,o),this.height-=s-r.height,i==o&&(this.children.splice(n--,1),r.parent=null),0==(t-=o))break;e=0}else e-=i}if(this.size-t<25){var a=[];this.collapse(a),this.children=[new lr(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;n>t;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,i=this.children.length;i>r;++r){var o=this.children[r],s=o.chunkSize();if(s>=e){if(o.insertInner(e,t,n),o.lines&&o.lines.length>50){for(;o.lines.length>50;){var a=o.lines.splice(o.lines.length-25,25),l=new lr(a);o.height-=l.height,this.children.splice(r+1,0,l),l.parent=this}this.maybeSpill()}break}e-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new ur(t);if(e.parent){e.size-=n.size,e.height-=n.height;var r=Jr(e.parent.children,e);e.parent.children.splice(r+1,0,n)}else{var i=new ur(e.children);i.parent=e,e.children=[i,n],e=i}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var r=0,i=this.children.length;i>r;++r){var o=this.children[r],s=o.chunkSize();if(s>e){var a=Math.min(t,s-e);if(o.iterN(e,a,n))return!0;if(0==(t-=a))break;e=0}else e-=s}}};var yo=0,bo=e.Doc=function(e,t,n){if(!(this instanceof bo))return new bo(e,t,n);null==n&&(n=0),ur.call(this,[new lr([new go("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=xr(),this.cleanGeneration=1,this.frontier=n;var r=Ut(n,0);this.sel={from:r,to:r,head:r,anchor:r,shift:!1,extend:!1,goalColumn:null},this.id=++yo,this.modeOption=t,"string"==typeof e&&(e=Io(e)),ar(this,{from:r,to:r,text:e},null,{head:r,anchor:r})};bo.prototype=Qr(ur.prototype,{constructor:bo,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,r=0,i=t.length;i>r;++r)n+=t[r].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=pr(this,this.first,this.first+this.size);return e===!1?t:t.join(e||"\n")},setValue:function(e){var t=Ut(this.first,0),n=this.first+this.size-1;Pt(this,{from:t,to:Ut(n,fr(this,n).text.length),text:Io(e),origin:"setValue"},{head:t,anchor:t},!0)},replaceRange:function(e,t,n,r){t=Kt(this,t),n=n?Kt(this,n):t,qt(this,e,t,n,r)},getRange:function(e,t,n){var r=hr(this,Kt(this,e),Kt(this,t));return n===!1?r:r.join(n||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},setLine:function(e,t){Qt(this,e)&&qt(this,t,Ut(e,0),Kt(this,Ut(e)))},removeLine:function(e){e?qt(this,"",Kt(this,Ut(e-1)),Kt(this,Ut(e))):qt(this,"",Ut(0,0),Kt(this,Ut(1,0)))},getLineHandle:function(e){return Qt(this,e)?fr(this,e):void 0},getLineNumber:function(e){return mr(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=fr(this,e)),zn(this,e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return Kt(this,e)},getCursor:function(e){var t=this.sel,n;return n=null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||e===!1?t.to:t.from,Gt(n)},somethingSelected:function(){return!Vt(this.sel.head,this.sel.anchor)},setCursor:at(function(e,t,n){var r=Kt(this,"number"==typeof e?Ut(e,t||0):e);n?Zt(this,r):tn(this,r,r)}),setSelection:at(function(e,t){tn(this,Kt(this,e),Kt(this,t||e))}),extendSelection:at(function(e,t){Zt(this,Kt(this,e),t&&Kt(this,t))}),getSelection:function(e){return this.getRange(this.sel.from,this.sel.to,e)},replaceSelection:function(e,t,n){Pt(this,{from:this.sel.from,to:this.sel.to,text:Io(e),origin:n},t||"around")},undo:at(function(){zt(this,"undo")}),redo:at(function(){zt(this,"redo")}),setExtending:function(e){this.sel.extend=e},historySize:function(){var e=this.history;return{undo:e.done.length,redo:e.undone.length}},clearHistory:function(){this.history=xr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration()},changeGeneration:function(){return this.history.lastOp=this.history.lastOrigin=null,this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Tr(this.history.done),undone:Tr(this.history.undone)}},setHistory:function(e){var t=this.history=xr(this.history.maxGeneration);t.done=e.done.slice(0),t.undone=e.undone.slice(0)},markText:function(e,t,n){return Tn(this,Kt(this,e),Kt(this,t),n,"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft};return e=Kt(this,e),Tn(this,e,e,n,"bookmark")},findMarksAt:function(e){e=Kt(this,e);var t=[],n=fr(this,e.line).markedSpans;if(n)for(var r=0;r<n.length;++r){var i=n[r];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},getAllMarks:function(){var e=[];return this.iter(function(t){var n=t.markedSpans;if(n)for(var r=0;r<n.length;++r)null!=n[r].from&&e.push(n[r].marker)}),e},posFromIndex:function(e){var t,n=this.first;return this.iter(function(r){var i=r.text.length+1;return i>e?(t=e,!0):(e-=i,void++n)}),Kt(this,Ut(n,t))},indexFromPos:function(e){e=Kt(this,e);var t=e.ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new bo(pr(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var r=new bo(pr(this,t,n),e.mode||this.modeOption,t);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],r},unlinkDoc:function(t){if(t instanceof e&&(t=t.doc),this.linked)for(var n=0;n<this.linked.length;++n){var r=this.linked[n];if(r.doc==t){this.linked.splice(n,1),t.unlinkDoc(this);break}}if(t.history==this.history){var i=[t.id];cr(t,function(e){i.push(e.id)},!0),t.history=xr(),t.history.done=Tr(this.history.done,i),t.history.undone=Tr(this.history.undone,i)}},iterLinkedDocs:function(e){cr(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),bo.prototype.eachLine=bo.prototype.iter;var xo="iter insert remove copy getEditor".split(" ");for(var wo in bo.prototype)bo.prototype.hasOwnProperty(wo)&&Jr(xo,wo)<0&&(e.prototype[wo]=function(e){return function(){return e.apply(this.doc,arguments)}}(bo.prototype[wo]));Ur(bo),e.e_stop=Nr,e.e_preventDefault=Ir,e.e_stopPropagation=Fr;var ko,Co=0;e.on=Pr,e.off=Wr,e.signal=zr;var _o=30,So=e.Pass={toString:function(){return"CodeMirror.Pass"}};Vr.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}},e.countColumn=Yr;var To=[""],Do=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Lo=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;e.replaceGetRect=function(e){li=e};var Oo=function(){if(Di)return!1;var e=ii("div");return"draggable"in e||"dragDrop"in e}();_i?ui=function(e,t){return 36==e.charCodeAt(t-1)&&39==e.charCodeAt(t)}:Ii&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?ui=function(e,t){return/\-[^ \-?]|\?[^ !\'\"\),.\-\/:;\?\]\}]/.test(e.slice(t-1,t+1))}:Li&&!/Chrome\/(?:29|[3-9]\d|\d\d\d)\./.test(navigator.userAgent)&&(ui=function(e,t){if(t>1&&45==e.charCodeAt(t-1)){if(/\w/.test(e.charAt(t-2))&&/[^\-?\.]/.test(e.charAt(t)))return!0;if(t>2&&/[\d\.,]/.test(e.charAt(t-2))&&/[\d\.,]/.test(e.charAt(t)))return!1}return/[~!#%&*)=+}\]|\"\.>,:;][({[<]|-[^\-?\.\u2010-\u201f\u2026]|\?[\w~`@#$%\^&*(_=+{[|><]|…[\w~`@#$%\^&*(_=+{[><]/.test(e.slice(t-1,t+1))});var Mo,Ao,Io=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],r=e.length;r>=t;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),s=o.indexOf("\r");-1!=s?(n.push(o.slice(0,s)),t+=s+1):(n.push(o),t=i+1)}return n}:function(e){return e.split(/\r\n?|\n/)};e.splitLines=Io;var Fo=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},$o=function(){var e=ii("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),No={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};e.keyNames=No,function(){for(var e=0;10>e;e++)No[e+48]=String(e);for(var e=65;90>=e;e++)No[e]=String.fromCharCode(e);for(var e=1;12>=e;e++)No[e+111]=No[e+63235]="F"+e}();var Ho,Eo=function(){function e(e){return 255>=e?t.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1791>=e?n.charAt(e-1536):e>=1792&&2220>=e?"r":"L"}var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/,l="L";return function(t){if(!r.test(t))return!1;for(var n=t.length,u=[],c=0,d;n>c;++c)u.push(d=e(t.charCodeAt(c)));for(var c=0,f=l;n>c;++c){var d=u[c];"m"==d?u[c]=f:f=d}for(var c=0,h=l;n>c;++c){var d=u[c];"1"==d&&"r"==h?u[c]="n":o.test(d)&&(h=d,"r"==d&&(u[c]="R"))}for(var c=1,f=u[0];n-1>c;++c){var d=u[c];"+"==d&&"1"==f&&"1"==u[c+1]?u[c]="1":","!=d||f!=u[c+1]||"1"!=f&&"n"!=f||(u[c]=f),f=d}for(var c=0;n>c;++c){var d=u[c];if(","==d)u[c]="N";else if("%"==d){for(var p=c+1;n>p&&"%"==u[p];++p);for(var g=c&&"!"==u[c-1]||n-1>p&&"1"==u[p]?"1":"N",m=c;p>m;++m)u[m]=g;c=p-1}}for(var c=0,h=l;n>c;++c){var d=u[c];"L"==h&&"1"==d?u[c]="L":o.test(d)&&(h=d)}for(var c=0;n>c;++c)if(i.test(u[c])){for(var p=c+1;n>p&&i.test(u[p]);++p);for(var v="L"==(c?u[c-1]:l),y="L"==(n-1>p?u[p]:l),g=v||y?"L":"R",m=c;p>m;++m)u[m]=g;c=p-1}for(var b=[],x,c=0;n>c;)if(s.test(u[c])){var w=c;for(++c;n>c&&s.test(u[c]);++c);b.push({from:w,to:c,level:0})}else{var k=c,C=b.length;for(++c;n>c&&"L"!=u[c];++c);for(var m=k;c>m;)if(a.test(u[m])){m>k&&b.splice(C,0,{from:k,to:m,level:1});var _=m;for(++m;c>m&&a.test(u[m]);++m);b.splice(C,0,{from:_,to:m,level:2}),k=m}else++m;c>k&&b.splice(C,0,{from:k,to:c,level:1})}return 1==b[0].level&&(x=t.match(/^\s+/))&&(b[0].from=x[0].length,b.unshift({from:0,to:x[0].length,level:0})),1==Xr(b).level&&(x=t.match(/\s+$/))&&(Xr(b).to-=x[0].length,b.push({from:n-x[0].length,to:n,level:0})),b[0].level!=Xr(b).level&&b.push({from:n,to:n,level:b[0].level}),b}}();return e.version="3.15.0",e}(),function(){"use strict";var e=/^(\s*)([*+-]|(\d+)\.)(\s*)/,t="*+-";CodeMirror.commands.newlineAndIndentContinueMarkdownList=function(n){var r=n.getCursor(),i=n.getStateAfter(r.line).list,o;if(!i||!(o=n.getLine(r.line).match(e)))return void n.execCommand("newlineAndIndent");var s=o[1],a=o[4],l=t.indexOf(o[2])>=0?o[2]:parseInt(o[3],10)+1+".";n.replaceSelection("\n"+s+l+a,"end")}}(),CodeMirror.defineMode("markdown",function(e,t){function n(e,t,n){return t.f=t.inline=n,n(e,t)}function r(e,t,n){return t.f=t.block=n,n(e,t)}function i(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.quote=0,m||e.f!=s||(e.f=c,e.block=o),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.thisLineHasContent=!1,null}function o(e,i){var o=i.list!==!1;if(i.list!==!1&&i.indentationDiff>=0?(i.indentationDiff<4&&(i.indentation-=i.indentationDiff),i.list=null):i.list!==!1&&i.indentation>0?(i.list=null,i.listDepth=Math.floor(i.indentation/4)):i.list!==!1&&(i.list=!1,i.listDepth=0),i.indentationDiff>=4)return i.indentation-=4,e.skipToEnd(),k;if(e.eatSpace())return null;if("#"===e.peek()||i.prevLineHasContent&&e.match(R))i.header=!0;else if(e.eat(">"))for(i.indentation++,i.quote=1,e.eatSpace();e.eat(">");)e.eatSpace(),i.quote++;else{if("["===e.peek())return n(e,i,f);if(e.match(E,!0))return L;if(i.prevLineHasContent&&!o||!e.match(P,!0)&&!e.match(W,!0)){if(t.fencedCodeBlocks&&e.match(/^```([\w+#]*)/,!0))return i.localMode=b(RegExp.$1),i.localMode&&(i.localState=i.localMode.startState()),r(e,i,a),k}else i.indentation+=4,i.list=!0,i.listDepth++,t.taskLists&&e.match(z,!1)&&(i.taskList=!0)}return n(e,i,i.inline)}function s(e,t){var n=v.token(e,t.htmlState);return m&&"tag"===n&&"openTag"!==t.htmlState.type&&!t.htmlState.context&&(t.f=c,t.block=o),t.md_inside&&-1!=e.current().indexOf(">")&&(t.f=c,t.block=o,t.htmlState.context=void 0),n}function a(e,t){return e.sol()&&e.match(/^```/,!0)?(t.localMode=t.localState=null,t.f=c,t.block=o,k):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),k)}function l(e){var t=[];if(e.taskOpen)return"meta";if(e.taskClosed)return"property";if(e.strong&&t.push(H),e.em&&t.push(N),e.linkText&&t.push(I),e.code&&t.push(k),e.header&&t.push(w),e.quote&&t.push(e.quote%2?C:_),e.list!==!1){var n=(e.listDepth-1)%3;t.push(n?1===n?T:D:S)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function u(e,t){return e.match(j,!0)?l(t):void 0}function c(e,i){var o=i.text(e,i);if("undefined"!=typeof o)return o;if(i.list)return i.list=null,l(i);if(i.taskList){var a="x"!==e.match(z,!0)[1];return a?i.taskOpen=!0:i.taskClosed=!0,i.taskList=!1,l(i)}i.taskOpen=!1,i.taskClosed=!1;var u=e.next();if("\\"===u)return e.next(),l(i);if(i.linkTitle){i.linkTitle=!1;var c=u;"("===u&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var f="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c;if(e.match(new RegExp(f),!0))return F}if("`"===u){var h=l(i),p=e.pos;e.eatWhile("`");var m=1+e.pos-p;return i.code?m===x?(i.code=!1,h):l(i):(x=m,i.code=!0,l(i))}if(i.code)return l(i);if("!"===u&&e.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return e.match(/\[[^\]]*\]/),i.inline=i.f=d,O;if("["===u&&e.match(/.*\](\(| ?\[)/,!1))return i.linkText=!0,l(i);if("]"===u&&i.linkText){var v=l(i);return i.linkText=!1,i.inline=i.f=d,v}if("<"===u&&e.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return n(e,i,g(M,">"));if("<"===u&&e.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return n(e,i,g(A,">"));if("<"===u&&e.match(/^\w/,!1)){if(-1!=e.string.indexOf(">")){var y=e.string.substring(1,e.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(y)&&(i.md_inside=!0)}return e.backUp(1),r(e,i,s)}if("<"===u&&e.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var b=!1;if(!t.underscoresBreakWords&&"_"===u&&"_"!==e.peek()&&e.match(/(\w)/,!1)){var w=e.pos-2;if(w>=0){var k=e.string.charAt(w);"_"!==k&&k.match(/(\w)/,!1)&&(b=!0)}}var h=l(i);if("*"===u||"_"===u&&!b){if(i.strong===u&&e.eat(u))return i.strong=!1,h;if(!i.strong&&e.eat(u))return i.strong=u,l(i);if(i.em===u)return i.em=!1,h;if(!i.em)return i.em=u,l(i)}else if(" "===u&&(e.eat("*")||e.eat("_"))){if(" "===e.peek())return l(i);e.backUp(1)}return" "===u&&(e.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),l(i)}function d(e,t){if(e.eatSpace())return null;var r=e.next();return"("===r||"["===r?n(e,t,g(F,"("===r?")":"]")):"error"}function f(e,t){return e.match(/^[^\]]*\]:/,!0)?(t.f=h,I):n(e,t,c)}function h(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=c,F)}function p(e){return B[e]||(e=(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),B[e]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+e+")")),B[e]}function g(e,t,n){return n=n||c,function(r,i){return r.match(p(t)),i.inline=i.f=n,e}}var m=CodeMirror.modes.hasOwnProperty("xml"),v=CodeMirror.getMode(e,m?{name:"xml",htmlMode:!0}:"text/plain"),y={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},b=function(){var t,n={},r={},i,o=[];for(var s in CodeMirror.modes)CodeMirror.modes.propertyIsEnumerable(s)&&o.push(s);for(t=0;t<o.length;t++)n[o[t]]=o[t];var a=[];for(var s in CodeMirror.mimeModes)CodeMirror.mimeModes.propertyIsEnumerable(s)&&a.push({mime:s,mode:CodeMirror.mimeModes[s]});for(t=0;t<a.length;t++)i=a[t].mime,r[i]=a[t].mime;for(var l in y)(y[l]in n||y[l]in r)&&(n[l]=y[l]);return function(t){return n[t]?CodeMirror.getMode(e,n[t]):null}}();void 0===t.underscoresBreakWords&&(t.underscoresBreakWords=!0),void 0===t.fencedCodeBlocks&&(t.fencedCodeBlocks=!1),void 0===t.taskLists&&(t.taskLists=!1);var x=0,w="header",k="comment",C="atom",_="number",S="variable-2",T="variable-3",D="keyword",L="hr",O="tag",M="link",A="link",I="link",F="string",N="em",H="strong",E=/^([*\-=_])(?:\s*\1){2,}\s*$/,P=/^[*\-+]\s+/,W=/^[0-9]+\.\s+/,z=/^\[(x| )\](?=\s)/,R=/^(?:\={1,}|-{1,})$/,j=/^[^!\[\]*_\\<>` "'(]+/,B=[];return{startState:function(){return{f:o,prevLineHasContent:!1,thisLineHasContent:!1,block:o,htmlState:CodeMirror.startState(v),indentation:0,inline:c,text:u,linkText:!1,linkTitle:!1,em:!1,strong:!1,header:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(e){return{f:e.f,prevLineHasContent:e.prevLineHasContent,thisLineHasContent:e.thisLineHasContent,block:e.block,htmlState:CodeMirror.copyState(v,e.htmlState),indentation:e.indentation,localMode:e.localMode,localState:e.localMode?CodeMirror.copyState(e.localMode,e.localState):null,inline:e.inline,text:e.text,linkTitle:e.linkTitle,em:e.em,strong:e.strong,header:e.header,taskList:e.taskList,list:e.list,listDepth:e.listDepth,quote:e.quote,trailingSpace:e.trailingSpace,trailingSpaceNewLine:e.trailingSpaceNewLine,md_inside:e.md_inside}},token:function(e,t){if(e.sol()){if(e.match(/^\s*$/,!0))return t.prevLineHasContent=!1,i(t);t.prevLineHasContent=t.thisLineHasContent,t.thisLineHasContent=!0,t.header=!1,t.taskList=!1,t.code=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var n=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,r=4*Math.floor((n-t.indentation)/4);r>4&&(r=4);var o=t.indentation+r;if(t.indentationDiff=o-t.indentation,t.indentation=o,n>0)return null}return t.f(e,t)},blankLine:i,getType:l}},"xml"),CodeMirror.defineMIME("text/x-markdown","markdown"),function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||a.defaults,this.rules=l.normal,this.options.gfm&&(this.rules=this.options.tables?l.tables:l.gfm)}function t(e,t){if(this.options=t||a.defaults,this.links=e,this.rules=u.normal,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?u.breaks:u.gfm:this.options.pedantic&&(this.rules=u.pedantic)}function n(e){this.tokens=[],this.token=null,this.options=e||a.defaults}function r(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function i(e,t){return e=e.source,t=t||"",function n(r,i){return r?(i=i.source||i,i=i.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(r,i),n):new RegExp(e,t)}}function o(){}function s(e){for(var t=1,n,r;t<arguments.length;t++){n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}function a(t,i,o){if(o||"function"==typeof i){o||(o=i,i=null),i=s({},a.defaults,i||{});var l=i.highlight,u,c,d=0;try{u=e.lex(t,i)}catch(f){return o(f)}c=u.length;var h=function(){var e,t;try{e=n.parse(u,i)}catch(r){t=r}return i.highlight=l,t?o(t):o(null,e)};if(!l||l.length<3)return h();if(delete i.highlight,!c)return h();for(;d<u.length;d++)!function(e){return"code"!==e.type?--c||h():l(e.text,e.lang,function(t,n){return null==n||n===e.text?--c||h():(e.text=n,e.escaped=!0,void(--c||h()))})}(u[d])}else try{return i&&(i=s({},a.defaults,i)),n.parse(e.lex(t,i),i)}catch(f){if(f.message+="\nPlease report this to https://github.com/chjj/marked.",(i||a.defaults).silent)return"<p>An error occured:</p><pre>"+r(f.message+"",!0)+"</pre>";throw f}}var l={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:o,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:o,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:o,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};l.bullet=/(?:[*+-]|\d+\.)/,l.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,l.item=i(l.item,"gm")(/bull/g,l.bullet)(),l.list=i(l.list)(/bull/g,l.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),l._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",l.html=i(l.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,l._tag)(),l.paragraph=i(l.paragraph)("hr",l.hr)("heading",l.heading)("lheading",l.lheading)("blockquote",l.blockquote)("tag","<"+l._tag)("def",l.def)(),l.normal=s({},l),l.gfm=s({},l.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),l.gfm.paragraph=i(l.paragraph)("(?!","(?!"+l.gfm.fences.source.replace("\\1","\\2")+"|"+l.list.source.replace("\\1","\\3")+"|")(),l.tables=s({},l.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=l,e.lex=function(t,n){var r=new e(n);return r.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t){for(var e=e.replace(/^ +$/gm,""),n,r,i,o,s,a,u,c,d;e;)if((i=this.rules.newline.exec(e))&&(e=e.substring(i[0].length),i[0].length>1&&this.tokens.push({type:"space"})),i=this.rules.code.exec(e))e=e.substring(i[0].length),i=i[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?i:i.replace(/\n+$/,"")});else if(i=this.rules.fences.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"code",lang:i[2],text:i[3]});else if(i=this.rules.heading.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"heading",depth:i[1].length,text:i[2]});else if(t&&(i=this.rules.nptable.exec(e))){for(e=e.substring(i[0].length),a={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/\n$/,"").split("\n")},c=0;c<a.align.length;c++)a.align[c]=/^ *-+: *$/.test(a.align[c])?"right":/^ *:-+: *$/.test(a.align[c])?"center":/^ *:-+ *$/.test(a.align[c])?"left":null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].split(/ *\| */);this.tokens.push(a)}else if(i=this.rules.lheading.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"heading",depth:"="===i[2]?1:2,text:i[1]});else if(i=this.rules.hr.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"hr"});else if(i=this.rules.blockquote.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"blockquote_start"}),i=i[0].replace(/^ *> ?/gm,""),this.token(i,t),this.tokens.push({type:"blockquote_end"});else if(i=this.rules.list.exec(e)){for(e=e.substring(i[0].length),o=i[2],this.tokens.push({type:"list_start",ordered:o.length>1}),i=i[0].match(this.rules.item),n=!1,d=i.length,c=0;d>c;c++)a=i[c],u=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(u-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+u+"}","gm"),"")),this.options.smartLists&&c!==d-1&&(s=l.bullet.exec(i[c+1])[0],o===s||o.length>1&&s.length>1||(e=i.slice(c+1).join("\n")+e,c=d-1)),r=n||/\n\n(?!\s*$)/.test(a),c!==d-1&&(n="\n"===a.charAt(a.length-1),r||(r=n)),this.tokens.push({type:r?"loose_item_start":"list_item_start"}),this.token(a,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(i=this.rules.html.exec(e))e=e.substring(i[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===i[1]||"script"===i[1]||"style"===i[1],text:i[0]});else if(t&&(i=this.rules.def.exec(e)))e=e.substring(i[0].length),this.tokens.links[i[1].toLowerCase()]={href:i[2],title:i[3]};else if(t&&(i=this.rules.table.exec(e))){for(e=e.substring(i[0].length),a={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<a.align.length;c++)a.align[c]=/^ *-+: *$/.test(a.align[c])?"right":/^ *:-+: *$/.test(a.align[c])?"center":/^ *:-+ *$/.test(a.align[c])?"left":null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(a)}else if(t&&(i=this.rules.paragraph.exec(e)))e=e.substring(i[0].length),this.tokens.push({type:"paragraph",text:"\n"===i[1].charAt(i[1].length-1)?i[1].slice(0,-1):i[1]});else if(i=this.rules.text.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"text",text:i[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var u={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:o,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:o,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};u._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,u._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,u.link=i(u.link)("inside",u._inside)("href",u._href)(),u.reflink=i(u.reflink)("inside",u._inside)(),u.normal=s({},u),u.pedantic=s({},u.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),u.gfm=s({},u.normal,{escape:i(u.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:i(u.text)("]|","~]|")("|","|https?://|")()}),u.breaks=s({},u.gfm,{br:i(u.br)("{2,}","*")(),text:i(u.gfm.text)("{2,}","*")()}),t.rules=u,t.output=function(e,n,r){var i=new t(n,r);
return i.output(e)},t.prototype.output=function(e){for(var t="",n,i,o,s;e;)if(s=this.rules.escape.exec(e))e=e.substring(s[0].length),t+=s[1];else if(s=this.rules.autolink.exec(e))e=e.substring(s[0].length),"@"===s[2]?(i=this.mangle(":"===s[1].charAt(6)?s[1].substring(7):s[1]),o=this.mangle("mailto:")+i):(i=r(s[1]),o=i),t+='<a href="'+o+'">'+i+"</a>";else if(s=this.rules.url.exec(e))e=e.substring(s[0].length),i=r(s[1]),o=i,t+='<a href="'+o+'">'+i+"</a>";else if(s=this.rules.tag.exec(e))e=e.substring(s[0].length),t+=this.options.sanitize?r(s[0]):s[0];else if(s=this.rules.link.exec(e))e=e.substring(s[0].length),t+=this.outputLink(s,{href:s[2],title:s[3]});else if((s=this.rules.reflink.exec(e))||(s=this.rules.nolink.exec(e))){if(e=e.substring(s[0].length),n=(s[2]||s[1]).replace(/\s+/g," "),n=this.links[n.toLowerCase()],!n||!n.href){t+=s[0].charAt(0),e=s[0].substring(1)+e;continue}t+=this.outputLink(s,n)}else if(s=this.rules.strong.exec(e))e=e.substring(s[0].length),t+="<strong>"+this.output(s[2]||s[1])+"</strong>";else if(s=this.rules.em.exec(e))e=e.substring(s[0].length),t+="<em>"+this.output(s[2]||s[1])+"</em>";else if(s=this.rules.code.exec(e))e=e.substring(s[0].length),t+="<code>"+r(s[2],!0)+"</code>";else if(s=this.rules.br.exec(e))e=e.substring(s[0].length),t+="<br>";else if(s=this.rules.del.exec(e))e=e.substring(s[0].length),t+="<del>"+this.output(s[1])+"</del>";else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),t+=r(this.smartypants(s[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return t},t.prototype.outputLink=function(e,t){return"!"!==e[0].charAt(0)?'<a href="'+r(t.href)+'"'+(t.title?' title="'+r(t.title)+'"':"")+">"+this.output(e[1])+"</a>":'<img src="'+r(t.href)+'" alt="'+r(e[1])+'"'+(t.title?' title="'+r(t.title)+'"':"")+">"},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},t.prototype.mangle=function(e){for(var t="",n=e.length,r=0,i;n>r;r++)i=e.charCodeAt(r),Math.random()>.5&&(i="x"+i.toString(16)),t+="&#"+i+";";return t},n.parse=function(e,t){var r=new n(t);return r.parse(e)},n.prototype.parse=function(e){this.inline=new t(e.links,this.options),this.tokens=e.reverse();for(var n="";this.next();)n+=this.tok();return n},n.prototype.next=function(){return this.token=this.tokens.pop()},n.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},n.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},n.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+' id="'+this.token.text.toLowerCase().replace(/[^\w]+/g,"-")+'">'+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var e=this.options.highlight(this.token.text,this.token.lang);null!=e&&e!==this.token.text&&(this.token.escaped=!0,this.token.text=e)}return this.token.escaped||(this.token.text=r(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"table":var t="",n,i,o,s,a;for(t+="<thead>\n<tr>\n",i=0;i<this.token.header.length;i++)n=this.inline.output(this.token.header[i]),t+="<th",this.token.align[i]&&(t+=' style="text-align:'+this.token.align[i]+'"'),t+=">"+n+"</th>\n";for(t+="</tr>\n</thead>\n",t+="<tbody>\n",i=0;i<this.token.cells.length;i++){for(o=this.token.cells[i],t+="<tr>\n",a=0;a<o.length;a++)s=this.inline.output(o[a]),t+="<td",this.token.align[a]&&(t+=' style="text-align:'+this.token.align[a]+'"'),t+=">"+s+"</td>\n";t+="</tr>\n"}return t+="</tbody>\n","<table>\n"+t+"</table>\n";case"blockquote_start":for(var t="";"blockquote_end"!==this.next().type;)t+=this.tok();return"<blockquote>\n"+t+"</blockquote>\n";case"list_start":for(var l=this.token.ordered?"ol":"ul",t="";"list_end"!==this.next().type;)t+=this.tok();return"<"+l+">\n"+t+"</"+l+">\n";case"list_item_start":for(var t="";"list_item_end"!==this.next().type;)t+="text"===this.token.type?this.parseText():this.tok();return"<li>"+t+"</li>\n";case"loose_item_start":for(var t="";"list_item_end"!==this.next().type;)t+=this.tok();return"<li>"+t+"</li>\n";case"html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case"paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}},o.exec=o,a.options=a.setOptions=function(e){return s(a.defaults,e),a},a.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1},a.Parser=n,a.parser=n.parse,a.Lexer=e,a.lexer=e.lex,a.InlineLexer=t,a.inlineLexer=t.output,a.parse=a,"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):this.marked=a}.call(function(){return this||("undefined"!=typeof window?window:global)}()),function($,e,t){"use strict";if(typeof e===t)throw new Error("Can't find Editor!");$.fn.sharp_markdown=function(t){var n={},r=$.extend(n,t);return this.each(function(t,n){var i;r.element=n,i=new e(r),$(n).data("editor",i),i.render()})}}(this.jQuery,this.Editor),$(window).load(function(){$("textarea.sharp-markdown").each(function(){createSharpMarkdown($(this))})});var config_to_toolbar={B:["bold",toggleBold],I:["italic",toggleItalic],Q:["quote",toggleBlockquote],U:["unordered-list",toggleUnOrderedList],O:["ordered-list",toggleOrderedList],L:["link",drawLink],G:["image",drawImage],P:["preview",togglePreview],F:["fullscreen",toggleFullScreen]},defaultToolbar="";!function(e,t){"function"==typeof define&&define.amd?define("sifter",t):"object"==typeof exports?module.exports=t():e.Sifter=t()}(this,function(){var e=function(e,t){this.items=e,this.settings=t||{diacritics:!0}};e.prototype.tokenize=function(e){if(e=r(String(e||"").toLowerCase()),!e||!e.length)return[];var t,n,o,a,l=[],u=e.split(/ +/);for(t=0,n=u.length;n>t;t++){if(o=i(u[t]),this.settings.diacritics)for(a in s)s.hasOwnProperty(a)&&(o=o.replace(new RegExp(a,"g"),s[a]));l.push({string:u[t],regex:new RegExp(o,"i")})}return l},e.prototype.iterator=function(e,t){var n;n=o(e)?Array.prototype.forEach||function(e){for(var t=0,n=this.length;n>t;t++)e(this[t],t,this)}:function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t,this)},n.apply(e,[t])},e.prototype.getScoreFunction=function(e,t){var n,r,i,o;n=this,e=n.prepareSearch(e,t),i=e.tokens,r=e.options.fields,o=i.length;var s=function(e,t){var n,r;return e?(e=String(e||""),r=e.search(t.regex),-1===r?0:(n=t.string.length/e.length,0===r&&(n+=.5),n)):0},a=function(){var e=r.length;return e?1===e?function(e,t){return s(t[r[0]],e)}:function(t,n){for(var i=0,o=0;e>i;i++)o+=s(n[r[i]],t);return o/e}:function(){return 0}}();return o?1===o?function(e){return a(i[0],e)}:"and"===e.options.conjunction?function(e){for(var t,n=0,r=0;o>n;n++){if(t=a(i[n],e),0>=t)return 0;r+=t}return r/o}:function(e){for(var t=0,n=0;o>t;t++)n+=a(i[t],e);return n/o}:function(){return 0}},e.prototype.getSortFunction=function(e,n){var r,i,o,s,a,l,u,c,d,f,h;if(o=this,e=o.prepareSearch(e,n),h=!e.query&&n.sort_empty||n.sort,d=function(e,t){return"$score"===e?t.score:o.items[t.id][e]},a=[],h)for(r=0,i=h.length;i>r;r++)(e.query||"$score"!==h[r].field)&&a.push(h[r]);if(e.query){for(f=!0,r=0,i=a.length;i>r;r++)if("$score"===a[r].field){f=!1;break}f&&a.unshift({field:"$score",direction:"desc"})}else for(r=0,i=a.length;i>r;r++)if("$score"===a[r].field){a.splice(r,1);break}for(c=[],r=0,i=a.length;i>r;r++)c.push("desc"===a[r].direction?-1:1);return l=a.length,l?1===l?(s=a[0].field,u=c[0],function(e,n){return u*t(d(s,e),d(s,n))}):function(e,n){var r,i,o,s,u;for(r=0;l>r;r++)if(u=a[r].field,i=c[r]*t(d(u,e),d(u,n)))return i;return 0}:null},e.prototype.prepareSearch=function(e,t){if("object"==typeof e)return e;t=n({},t);var r=t.fields,i=t.sort,s=t.sort_empty;return r&&!o(r)&&(t.fields=[r]),i&&!o(i)&&(t.sort=[i]),s&&!o(s)&&(t.sort_empty=[s]),{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}},e.prototype.search=function(e,t){var n=this,r,i,o,s,a,l;return o=this.prepareSearch(e,t),t=o.options,e=o.query,l=t.score||n.getScoreFunction(o),e.length?n.iterator(n.items,function(e,n){i=l(e),(t.filter===!1||i>0)&&o.items.push({score:i,id:n})}):n.iterator(n.items,function(e,t){o.items.push({score:1,id:t})}),a=n.getSortFunction(o,t),a&&o.items.sort(a),o.total=o.items.length,"number"==typeof t.limit&&(o.items=o.items.slice(0,t.limit)),o};var t=function(e,t){return"number"==typeof e&&"number"==typeof t?e>t?1:t>e?-1:0:(e=String(e||"").toLowerCase(),t=String(t||"").toLowerCase(),e>t?1:t>e?-1:0)},n=function(e,t){var n,r,i,o;for(n=1,r=arguments.length;r>n;n++)if(o=arguments[n])for(i in o)o.hasOwnProperty(i)&&(e[i]=o[i]);return e},r=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")},i=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},o=Array.isArray||$&&$.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚ]",i:"[iÌÍÎÏìíîï]",n:"[nÑñňŇ]",o:"[oÒÓÔÕÕÖØòóôõöø]",r:"[rřŘ]",s:"[sŠš]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮ]",y:"[yŸÿýÝ]",z:"[zŽž]"};return e}),function(e,t){"function"==typeof define&&define.amd?define("microplugin",t):"object"==typeof exports?module.exports=t():e.MicroPlugin=t()}(this,function(){var e={};e.mixin=function(e){e.plugins={},e.prototype.initializePlugins=function(e){var n,r,i,o=this,s=[];if(o.plugins={names:[],settings:{},requested:{},loaded:{}},t.isArray(e))for(n=0,r=e.length;r>n;n++)"string"==typeof e[n]?s.push(e[n]):(o.plugins.settings[e[n].name]=e[n].options,s.push(e[n].name));else if(e)for(i in e)e.hasOwnProperty(i)&&(o.plugins.settings[i]=e[i],s.push(i));for(;s.length;)o.require(s.shift())},e.prototype.loadPlugin=function(t){var n=this,r=n.plugins,i=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');r.requested[t]=!0,r.loaded[t]=i.fn.apply(n,[n.plugins.settings[t]||{}]),r.names.push(t)},e.prototype.require=function(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]},e.define=function(t,n){e.plugins[t]={name:t,fn:n}}};var t={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}};return e}),function(e,t){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("sifter"),require("microplugin")):e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}(this,function($,e,t){"use strict";var n=function(e,t){if("string"!=typeof t||t.length){var n="string"==typeof t?new RegExp(t,"i"):t,r=function(e){var t=0;if(3===e.nodeType){var i=e.data.search(n);if(i>=0&&e.data.length>0){var o=e.data.match(n),s=document.createElement("span");s.className="highlight";var a=e.splitText(i),l=a.splitText(o[0].length),u=a.cloneNode(!0);s.appendChild(u),a.parentNode.replaceChild(s,a),t=1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var c=0;c<e.childNodes.length;++c)c+=r(e.childNodes[c]);return t};return e.each(function(){r(this)})}},r=function(){};r.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[e]:(this._events=this._events||{},void(e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)))},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},r.mixin=function(e){for(var t=["on","off","trigger"],n=0;n<t.length;n++)e.prototype[t[n]]=r.prototype[t[n]]};var i=/Mac/.test(navigator.userAgent),o=65,s=188,a=13,l=27,u=37,c=38,d=80,f=39,h=40,p=78,g=8,m=46,v=16,y=i?91:17,b=i?18:17,x=9,w=1,k=2,C=function(e){return"undefined"!=typeof e},_=function(e){return"undefined"==typeof e||null===e?"":"boolean"==typeof e?e?"1":"0":e+""},S=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},T=function(e){return(e+"").replace(/\$/g,"$$$$")},D={};D.before=function(e,t,n){var r=e[t];e[t]=function(){return n.apply(e,arguments),r.apply(e,arguments)}},D.after=function(e,t,n){var r=e[t];e[t]=function(){var t=r.apply(e,arguments);return n.apply(e,arguments),t}};var L=function(e,t){if(!$.isArray(t))return t;var n,r,i={};for(n=0,r=t.length;r>n;n++)t[n].hasOwnProperty(e)&&(i[t[n][e]]=t[n]);return i},O=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},M=function(e,t){var n;return function(){var r=this,i=arguments;window.clearTimeout(n),n=window.setTimeout(function(){e.apply(r,i)},t)}},A=function(e,t,n){var r,i=e.trigger,o={};e.trigger=function(){var n=arguments[0];return-1===t.indexOf(n)?i.apply(e,arguments):void(o[n]=arguments)},n.apply(e,[]),e.trigger=i;for(r in o)o.hasOwnProperty(r)&&i.apply(e,o[r])},I=function(e,t,n,r){e.on(t,n,function(t){for(var n=t.target;n&&n.parentNode!==e[0];)n=n.parentNode;return t.currentTarget=n,r.apply(this,[t])})},F=function(e){var t={};if("selectionStart"in e)t.start=e.selectionStart,t.length=e.selectionEnd-t.start;else if(document.selection){e.focus();var n=document.selection.createRange(),r=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),t.start=n.text.length-r,t.length=r}return t},N=function(e,t,n){var r,i,o={};if(n)for(r=0,i=n.length;i>r;r++)o[n[r]]=e.css(n[r]);else o=e.css();t.css(o)},H=function(e,t){if(!e)return 0;var n=$("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(e).appendTo("body");N(t,n,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var r=n.width();return n.remove(),r},E=function(e){var t=null,n=function(n,r){var i,o,s,a,l,u,c,d;n=n||window.event||{},r=r||{},n.metaKey||n.altKey||(r.force||e.data("grow")!==!1)&&(i=e.val(),n.type&&"keydown"===n.type.toLowerCase()&&(o=n.keyCode,s=o>=97&&122>=o||o>=65&&90>=o||o>=48&&57>=o||32===o,o===m||o===g?(d=F(e[0]),d.length?i=i.substring(0,d.start)+i.substring(d.start+d.length):o===g&&d.start?i=i.substring(0,d.start-1)+i.substring(d.start+1):o===m&&"undefined"!=typeof d.start&&(i=i.substring(0,d.start)+i.substring(d.start+1))):s&&(u=n.shiftKey,c=String.fromCharCode(n.keyCode),c=u?c.toUpperCase():c.toLowerCase(),i+=c)),a=e.attr("placeholder"),!i&&a&&(i=a),l=H(i,e)+4,l!==t&&(t=l,e.width(l),e.triggerHandler("resize")))};e.on("keydown keyup update blur",n),n()},P=function(t,n){var r,i,o,s,a,l=this;a=t[0],a.selectize=l,s=window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue("direction"):a.currentStyle&&a.currentStyle.direction,s=s||t.parents("[dir]:first").attr("dir")||"",$.extend(l,{settings:n,$input:t,tagType:"select"===a.tagName.toLowerCase()?w:k,rtl:/rtl/i.test(s),eventNS:".selectize"+ ++P.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:t.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===n.loadThrottle?l.onSearchChange:M(l.onSearchChange,n.loadThrottle)}),l.sifter=new e(this.options,{diacritics:n.diacritics}),$.extend(l.options,L(n.valueField,n.options)),delete l.settings.options,$.extend(l.optgroups,L(n.optgroupValueField,n.optgroups)),delete l.settings.optgroups,l.settings.mode=l.settings.mode||(1===l.settings.maxItems?"single":"multi"),"boolean"!=typeof l.settings.hideSelected&&(l.settings.hideSelected="multi"===l.settings.mode),l.initializePlugins(l.settings.plugins),l.setupCallbacks(),l.setupTemplates(),l.setup()};return r.mixin(P),t.mixin(P),$.extend(P.prototype,{setup:function(){var e=this,t=e.settings,n=e.eventNS,r=$(window),o=$(document),s,a,l,u,c,d,f,h,p,g,m,x;f=e.settings.mode,g=e.$input.attr("tabindex")||"",m=e.$input.attr("class")||"",s=$("<div>").addClass(t.wrapperClass).addClass(m).addClass(f),a=$("<div>").addClass(t.inputClass).addClass("items").appendTo(s),l=$('<input type="text" autocomplete="off" />').appendTo(a).attr("tabindex",g),d=$(t.dropdownParent||s),u=$("<div>").addClass(t.dropdownClass).addClass(m).addClass(f).hide().appendTo(d),c=$("<div>").addClass(t.dropdownContentClass).appendTo(u),s.css({width:e.$input[0].style.width}),e.plugins.names.length&&(x="plugin-"+e.plugins.names.join(" plugin-"),s.addClass(x),u.addClass(x)),(null===t.maxItems||t.maxItems>1)&&e.tagType===w&&e.$input.attr("multiple","multiple"),e.settings.placeholder&&l.attr("placeholder",t.placeholder),e.$input.attr("autocorrect")&&l.attr("autocorrect",e.$input.attr("autocorrect")),e.$input.attr("autocapitalize")&&l.attr("autocapitalize",e.$input.attr("autocapitalize")),e.$wrapper=s,e.$control=a,e.$control_input=l,e.$dropdown=u,e.$dropdown_content=c,u.on("mouseenter","[data-selectable]",function(){return e.onOptionHover.apply(e,arguments)}),u.on("mousedown","[data-selectable]",function(){return e.onOptionSelect.apply(e,arguments)}),I(a,"mousedown","*:not(input)",function(){return e.onItemSelect.apply(e,arguments)}),E(l),a.on({mousedown:function(){return e.onMouseDown.apply(e,arguments)},click:function(){return e.onClick.apply(e,arguments)}}),l.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return e.onKeyDown.apply(e,arguments)},keyup:function(){return e.onKeyUp.apply(e,arguments)},keypress:function(){return e.onKeyPress.apply(e,arguments)},resize:function(){e.positionDropdown.apply(e,[])},blur:function(){return e.onBlur.apply(e,arguments)},focus:function(){return e.onFocus.apply(e,arguments)},paste:function(){return e.onPaste.apply(e,arguments)}}),o.on("keydown"+n,function(t){e.isCmdDown=t[i?"metaKey":"ctrlKey"],e.isCtrlDown=t[i?"altKey":"ctrlKey"],e.isShiftDown=t.shiftKey}),o.on("keyup"+n,function(t){t.keyCode===b&&(e.isCtrlDown=!1),t.keyCode===v&&(e.isShiftDown=!1),t.keyCode===y&&(e.isCmdDown=!1)}),o.on("mousedown"+n,function(t){if(e.isFocused){if(t.target===e.$dropdown[0]||t.target.parentNode===e.$dropdown[0])return!1;e.$control.has(t.target).length||t.target===e.$control[0]||e.blur()}}),r.on(["scroll"+n,"resize"+n].join(" "),function(){e.isOpen&&e.positionDropdown.apply(e,arguments)}),r.on("mousemove"+n,function(){e.ignoreHover=!1}),this.revertSettings={$children:e.$input.children().detach(),tabindex:e.$input.attr("tabindex")},e.$input.attr("tabindex",-1).hide().after(e.$wrapper),$.isArray(t.items)&&(e.setValue(t.items),delete t.items),e.$input[0].validity&&e.$input.on("invalid"+n,function(t){t.preventDefault(),e.isInvalid=!0,e.refreshState()}),e.updateOriginalInput(),e.refreshItems(),e.refreshState(),e.updatePlaceholder(),e.isSetup=!0,e.$input.is(":disabled")&&e.disable(),e.on("change",this.onChange),e.trigger("initialize"),t.preload===!0&&e.onSearchChange("")},setupTemplates:function(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,r={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[n])+"</div>"},option:function(e,n){return'<div class="option">'+n(e[t])+"</div>"},item:function(e,n){return'<div class="item">'+n(e[t])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};e.settings.render=$.extend({},r,e.settings.render)},setupCallbacks:function(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(e in n)n.hasOwnProperty(e)&&(t=this.settings[n[e]],t&&this.on(e,t))},onClick:function(e){var t=this;t.isFocused||(t.focus(),e.preventDefault())},onMouseDown:function(e){var t=this,n=e.isDefaultPrevented(),r=$(e.target);if(t.isFocused){if(e.target!==t.$control_input[0])return"single"===t.settings.mode?t.isOpen?t.close():t.open():n||t.setActiveItem(null),!1}else n||window.setTimeout(function(){t.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(e){var t=this;(t.isFull()||t.isInputHidden||t.isLocked)&&e.preventDefault()},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);return this.settings.create&&t===this.settings.delimiter?(this.createItem(),e.preventDefault(),!1):void 0},onKeyDown:function(e){var t=e.target===this.$control_input[0],n=this;if(n.isLocked)return void(e.keyCode!==x&&e.preventDefault());switch(e.keyCode){case o:if(n.isCmdDown)return void n.selectAll();break;case l:return void n.close();case p:if(!e.ctrlKey||e.altKey)break;case h:if(!n.isOpen&&n.hasOptions)n.open();else if(n.$activeOption){n.ignoreHover=!0;var r=n.getAdjacentOption(n.$activeOption,1);r.length&&n.setActiveOption(r,!0,!0)}return void e.preventDefault();case d:if(!e.ctrlKey||e.altKey)break;case c:if(n.$activeOption){n.ignoreHover=!0;var s=n.getAdjacentOption(n.$activeOption,-1);s.length&&n.setActiveOption(s,!0,!0)}return void e.preventDefault();case a:return n.isOpen&&n.$activeOption&&n.onOptionSelect({currentTarget:n.$activeOption}),void e.preventDefault();case u:return void n.advanceSelection(-1,e);case f:return void n.advanceSelection(1,e);case x:return n.settings.selectOnTab&&n.isOpen&&n.$activeOption&&n.onOptionSelect({currentTarget:n.$activeOption}),void(n.settings.create&&n.createItem()&&e.preventDefault());case g:case m:return void n.deleteSelection(e)}return!n.isFull()&&!n.isInputHidden||(i?e.metaKey:e.ctrlKey)?void 0:void e.preventDefault()},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var n=t.$control_input.val()||"";t.lastValue!==n&&(t.lastValue=n,t.onSearchChange(n),t.refreshOptions(),t.trigger("type",n))},onSearchChange:function(e){var t=this,n=t.settings.load;n&&(t.loadedSearches.hasOwnProperty(e)||(t.loadedSearches[e]=!0,t.load(function(r){n.apply(t,[e,r])})))},onFocus:function(e){var t=this;return t.isFocused=!0,t.isDisabled?(t.blur(),e&&e.preventDefault(),!1):void(t.ignoreFocus||("focus"===t.settings.preload&&t.onSearchChange(""),t.$activeItems.length||(t.showInput(),t.setActiveItem(null),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState()))},onBlur:function(e){var t=this;t.isFocused=!1,t.ignoreFocus||(t.settings.create&&t.settings.createOnBlur&&t.createItem(!1),t.close(),t.setTextboxValue(""),t.setActiveItem(null),t.setActiveOption(null),t.setCaret(t.items.length),t.refreshState())},onOptionHover:function(e){this.ignoreHover||this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(e){var t,n,r,i=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),n=$(e.currentTarget),n.hasClass("create")?i.createItem():(t=n.attr("data-value"),t&&(i.lastQuery=null,i.setTextboxValue(""),i.addItem(t),!i.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&i.setActiveOption(i.getOption(t))))},onItemSelect:function(e){var t=this;t.isLocked||"multi"===t.settings.mode&&(e.preventDefault(),t.setActiveItem(e.currentTarget,e))},load:function(e){var t=this,n=t.$wrapper.addClass("loading");t.loading++,e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0),e&&e.length&&(t.addOption(e),t.refreshOptions(t.isFocused&&!t.isInputHidden)),t.loading||n.removeClass("loading"),t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input,n=t.val()!==e;n&&(t.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return this.tagType===w&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e){A(this,["change"],function(){this.clear(),this.addItems(e)})},setActiveItem:function(e,t){var n=this,r,i,o,s,a,l,u,c;if("single"!==n.settings.mode){if(e=$(e),!e.length)return $(n.$activeItems).removeClass("active"),n.$activeItems=[],void(n.isFocused&&n.showInput());if(r=t&&t.type.toLowerCase(),"mousedown"===r&&n.isShiftDown&&n.$activeItems.length){for(c=n.$control.children(".active:last"),s=Array.prototype.indexOf.apply(n.$control[0].childNodes,[c[0]]),a=Array.prototype.indexOf.apply(n.$control[0].childNodes,[e[0]]),s>a&&(u=s,s=a,a=u),i=s;a>=i;i++)l=n.$control[0].childNodes[i],-1===n.$activeItems.indexOf(l)&&($(l).addClass("active"),n.$activeItems.push(l));t.preventDefault()}else"mousedown"===r&&n.isCtrlDown||"keydown"===r&&this.isShiftDown?e.hasClass("active")?(o=n.$activeItems.indexOf(e[0]),n.$activeItems.splice(o,1),e.removeClass("active")):n.$activeItems.push(e.addClass("active")[0]):($(n.$activeItems).removeClass("active"),n.$activeItems=[e.addClass("active")[0]]);n.hideInput(),this.isFocused||n.focus()}},setActiveOption:function(e,t,n){var r,i,o,s,a,l=this;l.$activeOption&&l.$activeOption.removeClass("active"),l.$activeOption=null,e=$(e),e.length&&(l.$activeOption=e.addClass("active"),(t||!C(t))&&(r=l.$dropdown_content.height(),i=l.$activeOption.outerHeight(!0),t=l.$dropdown_content.scrollTop()||0,o=l.$activeOption.offset().top-l.$dropdown_content.offset().top+t,s=o,a=o-r+i,o+i>r+t?l.$dropdown_content.stop().animate({scrollTop:a},n?l.settings.scrollDuration:0):t>o&&l.$dropdown_content.stop().animate({scrollTop:s},n?l.settings.scrollDuration:0)))},selectAll:function(){var e=this;"single"!==e.settings.mode&&(e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active")),e.$activeItems.length&&(e.hideInput(),e.close()),e.focus())},hideInput:function(){var e=this;e.setTextboxValue(""),e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4}),e.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),window.setTimeout(function(){e.ignoreFocus=!1,e.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,t=e.sortField;return"string"==typeof t&&(t={field:t}),{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(e){var t,n,r,i,o,s=this,a=s.settings,l=this.getSearchOptions();if(a.score&&(o=s.settings.score.apply(this,[e]),"function"!=typeof o))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==s.lastQuery?(s.lastQuery=e,i=s.sifter.search(e,$.extend(l,{score:o})),s.currentResults=i):i=$.extend(!0,{},s.currentResults),a.hideSelected)for(t=i.items.length-1;t>=0;t--)-1!==s.items.indexOf(_(i.items[t].id))&&i.items.splice(t,1);return i},refreshOptions:function(e){var t,r,i,o,s,a,l,u,c,d,f,h,p,g,m,v;"undefined"==typeof e&&(e=!0);var y=this,b=y.$control_input.val(),x=y.search(b),w=y.$dropdown_content,k=y.$activeOption&&_(y.$activeOption.attr("data-value"));if(o=x.items.length,"number"==typeof y.settings.maxOptions&&(o=Math.min(o,y.settings.maxOptions)),s={},y.settings.optgroupOrder)for(a=y.settings.optgroupOrder,t=0;t<a.length;t++)s[a[t]]=[];else a=[];for(t=0;o>t;t++)for(l=y.options[x.items[t].id],u=y.render("option",l),c=l[y.settings.optgroupField]||"",d=$.isArray(c)?c:[c],r=0,i=d&&d.length;i>r;r++)c=d[r],y.optgroups.hasOwnProperty(c)||(c=""),s.hasOwnProperty(c)||(s[c]=[],a.push(c)),s[c].push(u);for(f=[],t=0,o=a.length;o>t;t++)c=a[t],y.optgroups.hasOwnProperty(c)&&s[c].length?(h=y.render("optgroup_header",y.optgroups[c])||"",h+=s[c].join(""),f.push(y.render("optgroup",$.extend({},y.optgroups[c],{html:h})))):f.push(s[c].join(""));if(w.html(f.join("")),y.settings.highlight&&x.query.length&&x.tokens.length)for(t=0,o=x.tokens.length;o>t;t++)n(w,x.tokens[t].regex);if(!y.settings.hideSelected)for(t=0,o=y.items.length;o>t;t++)y.getOption(y.items[t]).addClass("selected");p=y.settings.create&&x.query.length,p&&(w.prepend(y.render("option_create",{input:b})),v=$(w[0].childNodes[0])),y.hasOptions=x.items.length>0||p,y.hasOptions?(x.items.length>0?(m=k&&y.getOption(k),m&&m.length?g=m:"single"===y.settings.mode&&y.items.length&&(g=y.getOption(y.items[0])),g&&g.length||(g=v&&!y.settings.addPrecedence?y.getAdjacentOption(v,1):w.find("[data-selectable]:first"))):g=v,y.setActiveOption(g),e&&!y.isOpen&&y.open()):(y.setActiveOption(null),e&&y.isOpen&&y.close())},addOption:function(e){var t,n,r,i,o=this;if($.isArray(e))for(t=0,n=e.length;n>t;t++)o.addOption(e[t]);else i=_(e[o.settings.valueField]),i&&!o.options.hasOwnProperty(i)&&(o.userOptions[i]=!0,o.options[i]=e,o.lastQuery=null,o.trigger("option_add",i,e))},addOptionGroup:function(e,t){this.optgroups[e]=t,this.trigger("optgroup_add",e,t)},updateOption:function(e,t){var n=this,r,i,o,s,a,l;if(e=_(e),o=_(t[n.settings.valueField]),n.options.hasOwnProperty(e)){if(!o)throw new Error("Value must be set in option data");o!==e&&(delete n.options[e],s=n.items.indexOf(e),-1!==s&&n.items.splice(s,1,o)),n.options[o]=t,a=n.renderCache.item,l=n.renderCache.option,a&&(delete a[e],delete a[o]),l&&(delete l[e],delete l[o]),-1!==n.items.indexOf(o)&&(r=n.getItem(e),i=$(n.render("item",t)),r.hasClass("active")&&i.addClass("active"),r.replaceWith(i)),n.isOpen&&n.refreshOptions(!1)}},removeOption:function(e){var t=this;e=_(e);var n=t.renderCache.item,r=t.renderCache.option;n&&delete n[e],r&&delete r[e],delete t.userOptions[e],delete t.options[e],t.lastQuery=null,t.trigger("option_remove",e),t.removeItem(e)},clearOptions:function(){var e=this;e.loadedSearches={},e.userOptions={},e.renderCache={},e.options=e.sifter.items={},e.lastQuery=null,e.trigger("option_clear"),e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,t){var n=this.$dropdown.find("[data-selectable]"),r=n.index(e)+t;return r>=0&&r<n.length?n.eq(r):$()},getElementWithValue:function(e,t){if(e=_(e))for(var n=0,r=t.length;r>n;n++)if(t[n].getAttribute("data-value")===e)return $(t[n]);return $()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(e){for(var t=$.isArray(e)?e:[e],n=0,r=t.length;r>n;n++)this.isPending=r-1>n,this.addItem(t[n])},addItem:function(e){A(this,["change"],function(){var t,n,r,i=this,o=i.settings.mode,s,a,l;return e=_(e),-1!==i.items.indexOf(e)?void("single"===o&&i.close()):void(i.options.hasOwnProperty(e)&&("single"===o&&i.clear(),"multi"===o&&i.isFull()||(t=$(i.render("item",i.options[e])),i.items.splice(i.caretPos,0,e),i.insertAtCaret(t),i.refreshState(),i.isSetup&&(r=i.$dropdown_content.find("[data-selectable]"),this.isPending||(n=i.getOption(e),l=i.getAdjacentOption(n,1).attr("data-value"),i.refreshOptions(i.isFocused&&"single"!==o),l&&i.setActiveOption(i.getOption(l))),!r.length||null!==i.settings.maxItems&&i.items.length>=i.settings.maxItems?i.close():i.positionDropdown(),i.updatePlaceholder(),i.trigger("item_add",e,t),i.updateOriginalInput()))))})},removeItem:function(e){var t=this,n,r,i;n="object"==typeof e?e:t.getItem(e),e=_(n.attr("data-value")),r=t.items.indexOf(e),-1!==r&&(n.remove(),n.hasClass("active")&&(i=t.$activeItems.indexOf(n[0]),t.$activeItems.splice(i,1)),t.items.splice(r,1),t.lastQuery=null,!t.settings.persist&&t.userOptions.hasOwnProperty(e)&&t.removeOption(e),r<t.caretPos&&t.setCaret(t.caretPos-1),t.refreshState(),t.updatePlaceholder(),t.updateOriginalInput(),t.positionDropdown(),t.trigger("item_remove",e))},createItem:function(e){var t=this,n=$.trim(t.$control_input.val()||""),r=t.caretPos;if(!n.length)return!1;
t.lock(),"undefined"==typeof e&&(e=!0);var i="function"==typeof t.settings.create?this.settings.create:function(e){var n={};return n[t.settings.labelField]=e,n[t.settings.valueField]=e,n},o=O(function(n){if(t.unlock(),n&&"object"==typeof n){var i=_(n[t.settings.valueField]);i&&(t.setTextboxValue(""),t.addOption(n),t.setCaret(r),t.addItem(i),t.refreshOptions(e&&"single"!==t.settings.mode))}}),s=i.apply(this,[n,o]);return"undefined"!=typeof s&&o(s),!0},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var e=0;e<this.items.length;e++)this.addItem(this.items);this.refreshState(),this.updateOriginalInput()},refreshState:function(){var e=this,t=e.isRequired&&!e.items.length;t||(e.isInvalid=!1),e.$control_input.prop("required",t),e.refreshClasses()},refreshClasses:function(){var e=this,t=e.isFull(),n=e.isLocked;e.$wrapper.toggleClass("rtl",e.rtl),e.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("required",e.isRequired).toggleClass("invalid",e.isInvalid).toggleClass("locked",n).toggleClass("full",t).toggleClass("not-full",!t).toggleClass("input-active",e.isFocused&&!e.isInputHidden).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!$.isEmptyObject(e.options)).toggleClass("has-items",e.items.length>0),e.$control_input.data("grow",!t&&!n)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var e,t,n,r=this;if("select"===r.$input[0].tagName.toLowerCase()){for(n=[],e=0,t=r.items.length;t>e;e++)n.push('<option value="'+S(r.items[e])+'" selected="selected"></option>');n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),r.$input.html(n.join(""))}else r.$input.val(r.getValue());r.isSetup&&r.trigger("change",r.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var e=this.$control_input;this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder),e.triggerHandler("update",{force:!0})}},open:function(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.focus(),e.isOpen=!0,e.refreshState(),e.$dropdown.css({visibility:"hidden",display:"block"}),e.positionDropdown(),e.$dropdown.css({visibility:"visible"}),e.trigger("dropdown_open",e.$dropdown))},close:function(){var e=this,t=e.isOpen;"single"===e.settings.mode&&e.items.length&&e.hideInput(),e.isOpen=!1,e.$dropdown.hide(),e.setActiveOption(null),e.refreshState(),t&&e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0),this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(){var e=this;e.items.length&&(e.$control.children(":not(input)").remove(),e.items=[],e.setCaret(0),e.updatePlaceholder(),e.updateOriginalInput(),e.refreshState(),e.showInput(),e.trigger("clear"))},insertAtCaret:function(e){var t=Math.min(this.caretPos,this.items.length);0===t?this.$control.prepend(e):$(this.$control[0].childNodes[t]).before(e),this.setCaret(t+1)},deleteSelection:function(e){var t,n,r,i,o,s,a,l,u,c=this;if(r=e&&e.keyCode===g?-1:1,i=F(c.$control_input[0]),c.$activeOption&&!c.settings.hideSelected&&(a=c.getAdjacentOption(c.$activeOption,-1).attr("data-value")),o=[],c.$activeItems.length){for(u=c.$control.children(".active:"+(r>0?"last":"first")),s=c.$control.children(":not(input)").index(u),r>0&&s++,t=0,n=c.$activeItems.length;n>t;t++)o.push($(c.$activeItems[t]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(c.isFocused||"single"===c.settings.mode)&&c.items.length&&(0>r&&0===i.start&&0===i.length?o.push(c.items[c.caretPos-1]):r>0&&i.start===c.$control_input.val().length&&o.push(c.items[c.caretPos]));if(!o.length||"function"==typeof c.settings.onDelete&&c.settings.onDelete.apply(c,[o])===!1)return!1;for("undefined"!=typeof s&&c.setCaret(s);o.length;)c.removeItem(o.pop());return c.showInput(),c.positionDropdown(),c.refreshOptions(!0),a&&(l=c.getOption(a),l.length&&c.setActiveOption(l)),!0},advanceSelection:function(e,t){var n,r,i,o,s,a,l=this;0!==e&&(l.rtl&&(e*=-1),n=e>0?"last":"first",r=F(l.$control_input[0]),l.isFocused&&!l.isInputHidden?(o=l.$control_input.val().length,s=0>e?0===r.start&&0===r.length:r.start===o,s&&!o&&l.advanceCaret(e,t)):(a=l.$control.children(".active:"+n),a.length&&(i=l.$control.children(":not(input)").index(a),l.setActiveItem(null),l.setCaret(e>0?i+1:i))))},advanceCaret:function(e,t){var n=this,r,i;0!==e&&(r=e>0?"next":"prev",n.isShiftDown?(i=n.$control_input[r](),i.length&&(n.hideInput(),n.setActiveItem(i),t&&t.preventDefault())):n.setCaret(n.caretPos+e))},setCaret:function(e){var t=this;e="single"===t.settings.mode?t.items.length:Math.max(0,Math.min(t.items.length,e));var n,r,i,o,s;for(o=t.$control.children(":not(input)"),n=0,r=o.length;r>n;n++)s=$(o[n]).detach(),e>n?t.$control_input.before(s):t.$control.append(s);t.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",!0),e.isDisabled=!0,e.lock()},enable:function(){var e=this;e.$input.prop("disabled",!1),e.isDisabled=!1,e.unlock()},destroy:function(){var e=this,t=e.eventNS,n=e.revertSettings;e.trigger("destroy"),e.off(),e.$wrapper.remove(),e.$dropdown.remove(),e.$input.html("").append(n.$children).removeAttr("tabindex").attr({tabindex:n.tabindex}).show(),$(window).off(t),$(document).off(t),$(document.body).off(t),delete e.$input[0].selectize},render:function(e,t){var n,r,i,o="",s=!1,a=this,l=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===e||"item"===e)&&(n=_(t[a.settings.valueField]),s=!!n),s&&(C(a.renderCache[e])||(a.renderCache[e]={}),a.renderCache[e].hasOwnProperty(n))?a.renderCache[e][n]:(o=a.settings.render[e].apply(this,[t,S]),("option"===e||"option_create"===e)&&(o=o.replace(l,"<$1 data-selectable")),"optgroup"===e&&(r=t[a.settings.optgroupValueField]||"",o=o.replace(l,'<$1 data-group="'+T(S(r))+'"')),("option"===e||"item"===e)&&(o=o.replace(l,'<$1 data-value="'+T(S(n||""))+'"')),s&&(a.renderCache[e][n]=o),o)}}),P.count=0,P.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,createOnBlur:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},$.fn.selectize=function(e){var t=$.fn.selectize.defaults,n=$.extend({},t,e),r=n.dataAttr,i=n.labelField,o=n.valueField,s=n.optgroupField,a=n.optgroupLabelField,l=n.optgroupValueField,u=function(e,t){var r,s,a,l,u=$.trim(e.val()||"");if(u.length){for(a=u.split(n.delimiter),r=0,s=a.length;s>r;r++)l={},l[i]=a[r],l[o]=a[r],t.options[a[r]]=l;t.items=a}},c=function(e,t){var n,u,c,d,f=0,h=t.options,p=function(e){var t=r&&e.attr(r);return"string"==typeof t&&t.length?JSON.parse(t):null},g=function(e,n){var r,a;if(e=$(e),r=e.attr("value")||"",r.length){if(h.hasOwnProperty(r))return void(n&&(h[r].optgroup?$.isArray(h[r].optgroup)?h[r].optgroup.push(n):h[r].optgroup=[h[r].optgroup,n]:h[r].optgroup=n));a=p(e)||{},a[i]=a[i]||e.text(),a[o]=a[o]||r,a[s]=a[s]||n,a.$order=++f,h[r]=a,e.is(":selected")&&t.items.push(r)}},m=function(e){var n,r,i,o,s;for(e=$(e),i=e.attr("label"),i&&(o=p(e)||{},o[a]=i,o[l]=i,t.optgroups[i]=o),s=$("option",e),n=0,r=s.length;r>n;n++)g(s[n],i)};for(t.maxItems=e.attr("multiple")?null:1,d=e.children(),n=0,u=d.length;u>n;n++)c=d[n].tagName.toLowerCase(),"optgroup"===c?m(d[n]):"option"===c&&g(d[n])};return this.each(function(){if(!this.selectize){var n,r=$(this),i=this.tagName.toLowerCase(),o={placeholder:r.children('option[value=""]').text()||r.attr("placeholder"),options:{},optgroups:{},items:[]};"select"===i?c(r,o):u(r,o),n=new P(r,$.extend(!0,{},t,o,e)),r.data("selectize",n),r.addClass("selectized")}})},$.fn.selectize.defaults=P.defaults,P.define("drag_drop",function(e){if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var t=this;t.lock=function(){var e=t.lock;return function(){var n=t.$control.data("sortable");return n&&n.disable(),e.apply(t,arguments)}}(),t.unlock=function(){var e=t.unlock;return function(){var n=t.$control.data("sortable");return n&&n.enable(),e.apply(t,arguments)}}(),t.setup=function(){var e=t.setup;return function(){e.apply(this,arguments);var n=t.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:t.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width")),n.css({overflow:"visible"})},stop:function(){n.css({overflow:"hidden"});var e=t.$activeItems?t.$activeItems.slice():null,r=[];n.children("[data-value]").each(function(){r.push($(this).attr("data-value"))}),t.setValue(r),t.setActiveItem(e)}})}}()}}),P.define("dropdown_header",function(e){var t=this;e=$.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a></div></div>'}},e),t.setup=function(){var n=t.setup;return function(){n.apply(t,arguments),t.$dropdown_header=$(e.html(e)),t.$dropdown.prepend(t.$dropdown_header)}}()}),P.define("optgroup_columns",function(e){var t=this;e=$.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,t){var n=e.closest("[data-group]").find("[data-selectable]"),r=n.index(e)+t;return r>=0&&r<n.length?n.eq(r):$()},this.onKeyDown=function(){var e=t.onKeyDown;return function(n){var r,i,o,s;return!this.isOpen||n.keyCode!==u&&n.keyCode!==f?e.apply(this,arguments):(t.ignoreHover=!0,s=this.$activeOption.closest("[data-group]"),r=s.find("[data-selectable]").index(this.$activeOption),s=n.keyCode===u?s.prev("[data-group]"):s.next("[data-group]"),o=s.find("[data-selectable]"),i=o.eq(Math.min(o.length-1,r)),void(i.length&&this.setActiveOption(i)))}}();var n=function(){var n,r,i,o,s,a,l;if(l=$("[data-group]",t.$dropdown_content),r=l.length,r&&t.$dropdown_content.width()){if(e.equalizeHeight){for(i=0,n=0;r>n;n++)i=Math.max(i,l.eq(n).height());l.css({height:i})}e.equalizeWidth&&(a=t.$dropdown_content.innerWidth(),o=Math.round(a/r),l.css({width:o}),r>1&&(s=a-o*(r-1),l.eq(r-1).css({width:s})))}};(e.equalizeHeight||e.equalizeWidth)&&(D.after(this,"positionDropdown",n),D.after(this,"refreshOptions",n))}),P.define("remove_button",function(e){if("single"!==this.settings.mode){e=$.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e);var t=this,n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+S(e.title)+'">'+e.label+"</a>",r=function(e,t){var n=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,n)+t+e.substring(n)};this.setup=function(){var i=t.setup;return function(){if(e.append){var o=t.settings.render.item;t.settings.render.item=function(e){return r(o.apply(this,arguments),n)}}i.apply(this,arguments),this.$control.on("click","."+e.className,function(e){if(e.preventDefault(),!t.isLocked){var n=$(e.currentTarget).parent();t.setActiveItem(n),t.deleteSelection()&&t.setCaret(t.items.length)}})}}()}}),P.define("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]},this.onKeyDown=function(n){var r=t.onKeyDown;return function(t){var n,i;return t.keyCode===g&&""===this.$control_input.val()&&!this.$activeItems.length&&(n=this.caretPos-1,n>=0&&n<this.items.length)?(i=this.options[this.items[n]],this.deleteSelection(t)&&(this.setTextboxValue(e.text.apply(this,[i])),this.refreshOptions(!0)),void t.preventDefault()):r.apply(this,arguments)}}()}),P}),function($){$.fn.sharp_ref=function(e){var t={create:!1,selectOnTab:!0,render:{option_create:function(e,t){return'<div class="create">Ajouter <strong>'+t(e.input)+"</strong>&hellip;</div>"}}},n=$.extend(t,e);return this.each(function(){$(this).selectize(n)})}}(jQuery),$(window).load(function(){$(".sharp-ref").each(function(){createSharpRef($(this))})}),function($){$.fn.sharp_tags=function(e){var t={create:!1,selectOnTab:!1,persist:!1,maxItems:null,sortField:null},n=$.extend(t,e);return this.each(function(){$(this).selectize(n)})}}(jQuery),$(window).load(function(){$(".sharp-tags").each(function(){createSharpTags($(this))})}),function($){$.fn.sharp_refSublistItem=function(e){function t(e,t,n){baseRefValue=e.find("option:selected").val(),t.disable(),t.clearOptions(),n.find("optgroup").each(function(){return $(this).attr("label")==baseRefValue?(t.enable(),$(this).find("option").each(function(){t.addOption({value:$(this).val(),text:$(this).text()}),t.addItem($(this).val())}),!1):void 0})}var n={},r=$.extend(n,e);return this.each(function(){$(this).selectize(r),$datastore=$(this).prev("select[name="+$(this).attr("id")+"_values]"),$refSublistField=$(this)[0].selectize,$baseRefField=$("#"+r.linked_ref_field),$baseRefField.on("change",function(){t($baseRefField,$refSublistField,$datastore)}),t($baseRefField,$refSublistField,$datastore),r.initial_value&&$refSublistField.setValue(r.initial_value)})}}(jQuery),$(window).load(function(){$(".sharp-refSublistItem").each(function(){createSharpRefSublistItem($(this))})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function($,e){var t=0,n=Array.prototype.slice,r=$.cleanData;$.cleanData=function(e){for(var t=0,n;null!=(n=e[t]);t++)try{$(n).triggerHandler("remove")}catch(i){}r(e)},$.widget=function(e,t,n){var r,i,o,s,a={},l=e.split(".")[0];e=e.split(".")[1],r=l+"-"+e,n||(n=t,t=$.Widget),$.expr[":"][r.toLowerCase()]=function(e){return!!$.data(e,r)},$[l]=$[l]||{},i=$[l][e],o=$[l][e]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},$.extend(o,i,{version:n.version,_proto:$.extend({},n),_childConstructors:[]}),s=new t,s.options=$.widget.extend({},s.options),$.each(n,function(e,n){return $.isFunction(n)?void(a[e]=function(){var r=function(){return t.prototype[e].apply(this,arguments)},i=function(n){return t.prototype[e].apply(this,n)};return function(){var e=this._super,t=this._superApply,o;return this._super=r,this._superApply=i,o=n.apply(this,arguments),this._super=e,this._superApply=t,o}}()):void(a[e]=n)}),o.prototype=$.widget.extend(s,{widgetEventPrefix:i?s.widgetEventPrefix||e:e},a,{constructor:o,namespace:l,widgetName:e,widgetFullName:r}),i?($.each(i._childConstructors,function(e,t){var n=t.prototype;$.widget(n.namespace+"."+n.widgetName,o,t._proto)}),delete i._childConstructors):t._childConstructors.push(o),$.widget.bridge(e,o)},$.widget.extend=function(t){for(var r=n.call(arguments,1),i=0,o=r.length,s,a;o>i;i++)for(s in r[i])a=r[i][s],r[i].hasOwnProperty(s)&&a!==e&&(t[s]=$.isPlainObject(a)?$.isPlainObject(t[s])?$.widget.extend({},t[s],a):$.widget.extend({},a):a);return t},$.widget.bridge=function(t,r){var i=r.prototype.widgetFullName||t;$.fn[t]=function(o){var s="string"==typeof o,a=n.call(arguments,1),l=this;return o=!s&&a.length?$.widget.extend.apply(null,[o].concat(a)):o,this.each(s?function(){var n,r=$.data(this,i);return r?$.isFunction(r[o])&&"_"!==o.charAt(0)?(n=r[o].apply(r,a),n!==r&&n!==e?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0):$.error("no such method '"+o+"' for "+t+" widget instance"):$.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+o+"'")}:function(){var e=$.data(this,i);e?e.option(o||{})._init():$.data(this,i,new r(o,this))}),l}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=$(n||this.defaultElement||this)[0],this.element=$(n),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=$.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=$(),this.hoverable=$(),this.focusable=$(),n!==this&&($.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=$(n.style?n.ownerDocument:n.document||n),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(t,n){var r=t,i,o,s;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof t)if(r={},i=t.split("."),t=i.shift(),i.length){for(o=r[t]=$.widget.extend({},this.options[t]),s=0;s<i.length-1;s++)o[i[s]]=o[i[s]]||{},o=o[i[s]];if(t=i.pop(),1===arguments.length)return o[t]===e?null:o[t];o[t]=n}else{if(1===arguments.length)return this.options[t]===e?null:this.options[t];r[t]=n}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,t,n){var r,i=this;"boolean"!=typeof e&&(n=t,t=e,e=!1),n?(t=r=$(t),this.bindings=this.bindings.add(t)):(n=t,t=this.element,r=this.widget()),$.each(n,function(n,o){function s(){return e||i.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof o?i[o]:o).apply(i,arguments):void 0}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||$.guid++);var a=n.match(/^(\w+)\s*(.*)$/),l=a[1]+i.eventNamespace,u=a[2];u?r.delegate(u,l,s):t.bind(l,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){$(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){$(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){$(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){$(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,n){var r,i,o=this.options[e];if(n=n||{},t=$.Event(t),t.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],i=t.originalEvent)for(r in i)r in t||(t[r]=i[r]);return this.element.trigger(t,n),!($.isFunction(o)&&o.apply(this.element[0],[t].concat(n))===!1||t.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(e,t){$.Widget.prototype["_"+e]=function(n,r,i){"string"==typeof r&&(r={effect:r});var o,s=r?r===!0||"number"==typeof r?t:r.effect||t:e;r=r||{},"number"==typeof r&&(r={duration:r}),o=!$.isEmptyObject(r),r.complete=i,r.delay&&n.delay(r.delay),o&&$.effects&&$.effects.effect[s]?n[e](r):s!==e&&n[s]?n[s](r.duration,r.easing,i):n.queue(function(t){$(this)[e](),i&&i.call(n[0]),t()})}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function($){"use strict";var e=0;$.ajaxTransport("iframe",function(t){if(t.async){var n=t.initialIframeSrc||"javascript:false;",r,i,o;return{send:function(s,a){r=$('<form style="display:none;"></form>'),r.attr("accept-charset",t.formAcceptCharset),o=/\?/.test(t.url)?"&":"?","DELETE"===t.type?(t.url=t.url+o+"_method=DELETE",t.type="POST"):"PUT"===t.type?(t.url=t.url+o+"_method=PUT",t.type="POST"):"PATCH"===t.type&&(t.url=t.url+o+"_method=PATCH",t.type="POST"),e+=1,i=$('<iframe src="'+n+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var e,o=$.isArray(t.paramName)?t.paramName:[t.paramName];i.unbind("load").bind("load",function(){var e;try{if(e=i.contents(),!e.length||!e[0].firstChild)throw new Error}catch(t){e=void 0}a(200,"success",{iframe:e}),$('<iframe src="'+n+'"></iframe>').appendTo(r),window.setTimeout(function(){r.remove()},0)}),r.prop("target",i.prop("name")).prop("action",t.url).prop("method",t.type),t.formData&&$.each(t.formData,function(e,t){$('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(r)}),t.fileInput&&t.fileInput.length&&"POST"===t.type&&(e=t.fileInput.clone(),t.fileInput.after(function(t){return e[t]}),t.paramName&&t.fileInput.each(function(e){$(this).prop("name",o[e]||t.paramName)}),r.append(t.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),t.fileInput.removeAttr("form")),r.submit(),e&&e.length&&t.fileInput.each(function(t,n){var r=$(e[t]);$(n).prop("name",r.prop("name")).attr("form",r.attr("form")),r.replaceWith(n)})}),r.append(i).appendTo(document.body)},abort:function(){i&&i.unbind("load").prop("src",n),r&&r.remove()}}}}),$.ajaxSetup({converters:{"iframe text":function(e){return e&&$(e[0].body).text()},"iframe json":function(e){return e&&$.parseJSON($(e[0].body).text())},"iframe html":function(e){return e&&$(e[0].body).html()},"iframe xml":function(e){var t=e&&e[0];return t&&$.isXMLDoc(t)?t:$.parseXML(t.XMLDocument&&t.XMLDocument.xml||$(t.body).html())},"iframe script":function(e){return e&&$.globalEval($(e[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function($){"use strict";$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$('<input type="file">').prop("disabled")),$.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),$.support.xhrFormDataFileUpload=!!window.FormData,$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:$(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,t){return e=this.messages[e]||e.toString(),t&&$.each(t,function(t,n){e=e.replace("{"+t+"}",n)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){return e.isDefaultPrevented()?!1:void((t.autoUpload||t.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var r=e-this.timestamp;return(!this.bitrate||!n||r>n)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(e){var t;return"function"===$.type(e.formData)?e.formData(e.form):$.isArray(e.formData)?e.formData:"object"===$.type(e.formData)?(t=[],$.each(e.formData,function(e,n){t.push({name:e,value:n})}),t):[]},_getTotal:function(e){var t=0;return $.each(e,function(e,n){t+=n.size||1}),t},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?$.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var n=Date.now?Date.now():(new Date).getTime(),r;if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,r=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=r-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=r,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(n,r,t.bitrateInterval),this._trigger("progress",$.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",$.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(e){var t=this,n=e.xhr?e.xhr():$.ajaxSettings.xhr();n.upload&&($(n.upload).bind("progress",function(n){var r=n.originalEvent;n.lengthComputable=r.lengthComputable,n.loaded=r.loaded,n.total=r.total,t._onProgress(n,e)}),e.xhr=function(){return n})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(e){var t=this,n,r=e.files[0],i=e.multipart||!$.support.xhrFileUpload,o="array"===$.type(e.paramName)?e.paramName[0]:e.paramName;e.headers=$.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),i&&!e.blob&&this._isInstanceOf("File",r)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"'),i?$.support.xhrFormDataFileUpload&&(e.postMessage?(n=this._getFormData(e),e.blob?n.push({name:o,value:e.blob}):$.each(e.files,function(t,r){n.push({name:"array"===$.type(e.paramName)&&e.paramName[t]||o,value:r})})):(t._isInstanceOf("FormData",e.formData)?n=e.formData:(n=new FormData,$.each(this._getFormData(e),function(e,t){n.append(t.name,t.value)})),e.blob?n.append(o,e.blob,r.name):$.each(e.files,function(r,i){(t._isInstanceOf("File",i)||t._isInstanceOf("Blob",i))&&n.append("array"===$.type(e.paramName)&&e.paramName[r]||o,i,i.uploadName||i.name)})),e.data=n):(e.contentType=r.type||"application/octet-stream",e.data=e.blob||r),e.blob=null},_initIframeSettings:function(e){var t=$("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=$(e.fileInput),n=e.paramName;return n?$.isArray(n)||(n=[n]):(n=[],t.each(function(){for(var e=$(this),t=e.prop("name")||"files[]",r=(e.prop("files")||[1]).length;r;)n.push(t),r-=1}),n.length||(n=[t.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=$(e.fileInput.prop("form")),e.form.length||(e.form=$(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===$.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=$.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,n){var r=$.Deferred(),i=r.promise();return t=t||this.options.context||i,e===!0?r.resolveWith(t,n):e===!1&&r.rejectWith(t,n),i.abort=r.promise,this._enhancePromise(i)},_addConvenienceMethods:function(e,t){var n=this,r=function(e){return $.Deferred().resolveWith(n,e).promise()};t.process=function(e,i){return(e||i)&&(t._processQueue=this._processQueue=(this._processQueue||r([this])).pipe(function(){return t.errorThrown?$.Deferred().rejectWith(n,[t]).promise():r(arguments)}).pipe(e,i)),this._processQueue||r([this])},t.submit=function(){return"pending"!==this.state()&&(t.jqXHR=this.jqXHR=n._trigger("submit",$.Event("submit",{delegatedEvent:e}),this)!==!1&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},t.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},t.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},t.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},t.progress=function(){return this._progress},t.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(e,t){e.uploadedBytes=e.uploadedBytes||0;var n=this,r=e.files[0],i=r.size,o=e.uploadedBytes,s=e.maxChunkSize||i,a=this._blobSlice,l=$.Deferred(),u=l.promise(),c,d;return this._isXHRUpload(e)&&a&&(o||i>s)&&!e.data?t?!0:o>=i?(r.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",r.error])):(d=function(){var t=$.extend({},e),u=t._progress.loaded;t.blob=a.call(r,o,o+s,r.type),t.chunkSize=t.blob.size,t.contentRange="bytes "+o+"-"+(o+t.chunkSize-1)+"/"+i,n._initXHRData(t),n._initProgressListener(t),c=(n._trigger("chunksend",null,t)!==!1&&$.ajax(t)||n._getXHRPromise(!1,t.context)).done(function(r,s,a){o=n._getUploadedBytes(a)||o+t.chunkSize,u+t.chunkSize-t._progress.loaded&&n._onProgress($.Event("progress",{lengthComputable:!0,loaded:o-t.uploadedBytes,total:o-t.uploadedBytes}),t),e.uploadedBytes=t.uploadedBytes=o,t.result=r,t.textStatus=s,t.jqXHR=a,n._trigger("chunkdone",null,t),n._trigger("chunkalways",null,t),i>o?d():l.resolveWith(t.context,[r,s,a])}).fail(function(e,r,i){t.jqXHR=e,t.textStatus=r,t.errorThrown=i,n._trigger("chunkfail",null,t),n._trigger("chunkalways",null,t),l.rejectWith(t.context,[e,r,i])})},this._enhancePromise(u),u.abort=function(){return c.abort()},d(),u):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,n,r){var i=r._progress.total,o=r._response;r._progress.loaded<i&&this._onProgress($.Event("progress",{lengthComputable:!0,loaded:i,total:i}),r),o.result=r.result=e,o.textStatus=r.textStatus=t,o.jqXHR=r.jqXHR=n,this._trigger("done",null,r)
},_onFail:function(e,t,n,r){var i=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),i.jqXHR=r.jqXHR=e,i.textStatus=r.textStatus=t,i.errorThrown=r.errorThrown=n,this._trigger("fail",null,r)},_onAlways:function(e,t,n,r){this._trigger("always",null,r)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var n=this,r,i,o,s,a=n._getAJAXSettings(t),l=function(){return n._sending+=1,a._bitrateTimer=new n._BitrateTimer,r=r||((i||n._trigger("send",$.Event("send",{delegatedEvent:e}),a)===!1)&&n._getXHRPromise(!1,a.context,i)||n._chunkedUpload(a)||$.ajax(a)).done(function(e,t,r){n._onDone(e,t,r,a)}).fail(function(e,t,r){n._onFail(e,t,r,a)}).always(function(e,t,r){if(n._onAlways(e,t,r,a),n._sending-=1,n._active-=1,a.limitConcurrentUploads&&a.limitConcurrentUploads>n._sending)for(var i=n._slots.shift();i;){if("pending"===n._getDeferredState(i)){i.resolve();break}i=n._slots.shift()}0===n._active&&n._trigger("stop")})};return this._beforeSend(e,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=$.Deferred(),this._slots.push(o),s=o.pipe(l)):(this._sequence=this._sequence.pipe(l,l),s=this._sequence),s.abort=function(){return i=[void 0,"abort","abort"],r?r.abort():(o&&o.rejectWith(a.context,i),l())},this._enhancePromise(s)):l()},_onAdd:function(e,t){var n=this,r=!0,i=$.extend({},this.options,t),o=t.files,s=o.length,a=i.limitMultiFileUploads,l=i.limitMultiFileUploadSize,u=i.limitMultiFileUploadSizeOverhead,c=0,d=this._getParamName(i),f,h,p,g,m=0;if(!l||s&&void 0!==o[0].size||(l=void 0),(i.singleFileUploads||a||l)&&this._isXHRUpload(i))if(i.singleFileUploads||l||!a)if(!i.singleFileUploads&&l)for(p=[],f=[],g=0;s>g;g+=1)c+=o[g].size+u,(g+1===s||c+o[g+1].size+u>l||a&&g+1-m>=a)&&(p.push(o.slice(m,g+1)),h=d.slice(m,g+1),h.length||(h=d),f.push(h),m=g+1,c=0);else f=d;else for(p=[],f=[],g=0;s>g;g+=a)p.push(o.slice(g,g+a)),h=d.slice(g,g+a),h.length||(h=d),f.push(h);else p=[o],f=[d];return t.originalFiles=o,$.each(p||o,function(i,o){var s=$.extend({},t);return s.files=p?o:[o],s.paramName=f[i],n._initResponseObject(s),n._initProgressObject(s),n._addConvenienceMethods(e,s),r=n._trigger("add",$.Event("add",{delegatedEvent:e}),s)}),r},_replaceFileInput:function(e){var t=e.clone(!0);$("<form></form>").append(t)[0].reset(),e.after(t).detach(),$.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(n,r){return r===e[0]?t[0]:r}),e[0]===this.element[0]&&(this.element=t)},_handleFileTreeEntry:function(e,t){var n=this,r=$.Deferred(),i=function(t){t&&!t.entry&&(t.entry=e),r.resolve([t])},o;return t=t||"",e.isFile?e._file?(e._file.relativePath=t,r.resolve(e._file)):e.file(function(e){e.relativePath=t,r.resolve(e)},i):e.isDirectory?(o=e.createReader(),o.readEntries(function(o){n._handleFileTreeEntries(o,t+e.name+"/").done(function(e){r.resolve(e)}).fail(i)},i)):r.resolve([]),r.promise()},_handleFileTreeEntries:function(e,t){var n=this;return $.when.apply($,$.map(e,function(e){return n._handleFileTreeEntry(e,t)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var t=e.items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries($.map(t,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):$.Deferred().resolve($.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=$(e);var t=e.prop("webkitEntries")||e.prop("entries"),n,r;if(t&&t.length)return this._handleFileTreeEntries(t);if(n=$.makeArray(e.prop("files")),n.length)void 0===n[0].name&&n[0].fileName&&$.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(r=e.prop("value"),!r)return $.Deferred().resolve([]).promise();n=[{name:r.replace(/^.*\\/,"")}]}return $.Deferred().resolve(n).promise()},_getFileInputFiles:function(e){return e instanceof $&&1!==e.length?$.when.apply($,$.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var t=this,n={fileInput:$(e.target),form:$(e.target.form)};this._getFileInputFiles(n.fileInput).always(function(r){n.files=r,t.options.replaceFileInput&&t._replaceFileInput(n.fileInput),t._trigger("change",$.Event("change",{delegatedEvent:e}),n)!==!1&&t._onAdd(e,n)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,n={files:[]};t&&t.length&&($.each(t,function(e,t){var r=t.getAsFile&&t.getAsFile();r&&n.files.push(r)}),this._trigger("paste",$.Event("paste",{delegatedEvent:e}),n)!==!1&&this._onAdd(e,n))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=this,n=e.dataTransfer,r={};n&&n.files&&n.files.length&&(e.preventDefault(),this._getDroppedFiles(n).always(function(n){r.files=n,t._trigger("drop",$.Event("drop",{delegatedEvent:e}),r)!==!1&&t._onAdd(e,r)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==$.inArray("Files",t.types)&&this._trigger("dragover",$.Event("dragover",{delegatedEvent:e}))!==!1&&(e.preventDefault(),t.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),$.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,t){var n=-1!==$.inArray(e,this._specialOptions);n&&this._destroyEventHandlers(),this._super(e,t),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof $||(e.fileInput=$(e.fileInput)),e.dropZone instanceof $||(e.dropZone=$(e.dropZone)),e.pasteZone instanceof $||(e.pasteZone=$(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===$.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var e=this,t=this.options,n=$(this.element[0].cloneNode(!1));$.each(n.data(),function(r,i){var o="data-"+r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();n.attr(o)&&(e._isRegExpOption(r,i)&&(i=e._getRegExp(i)),t[r]=i)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var t=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(n){e.files=n,t._onAdd(null,e)}):(e.files=$.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var t=this,n=$.Deferred(),r=n.promise(),i,o;return r.abort=function(){return o=!0,i?i.abort():(n.reject(null,"abort","abort"),r)},this._getFileInputFiles(e.fileInput).always(function(r){if(!o){if(!r.length)return void n.reject();e.files=r,i=t._onSend(null,e).then(function(e,t,r){n.resolve(e,t,r)},function(e,t,r){n.reject(e,t,r)})}}),this._enhancePromise(r)}if(e.files=$.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}),function($){$.fn.sharp_file=function(e){var t={image:!1,progress:!1,url:null,thumbnail:!1,browseButton:{text:"browse",className:"btn"},deleteButton:{text:"&times; remove",className:"btn"},file_filter:"",file_filter_alert:"",file_label_pattern:'<div class="type"><i class="fa fa-file-o"></i><span>%type%</span></div><span class="mime">(%mime%)</span><span class="size">%size%</span>',done:function(e){return!0},submit:function(e){return!0}},n=$.extend(t,e);return this.each(function(){var e=$(this),t="_"+Math.random().toString(36).substr(2,9),r=$("<input/>").attr("type","file").attr("name","file").attr("id",t);r.css({display:"block",visibility:"hidden",width:"0",height:"0"}),$(this).append(r);var i=$("<a/>").addClass(n.browseButton.className).addClass("sharp-file-browse").html(n.browseButton.text);$(this).append(i);var o=null;n.progress&&(o=$("<div/>").addClass("sharp-file-progress").css({width:"0"}),$(this).prepend(o));var s=null;n.thumbnail&&(s=$(this).find(".sharp-file-thumbnail"),0==s.length&&(s=$("<img/>").addClass("sharp-file-thumbnail"),$(this).prepend(s)));var a=$(this).find(".sharp-file-label");0==a.length&&(a=$("<div/>").addClass("sharp-file-label"),$(this).append(a));var l=$(this).find(".sharp-file-id"),u=$(this).find(".sharp-file-path"),c=$("<a/>").addClass(n.deleteButton.className).addClass("sharp-file-delete").html(n.deleteButton.text);$(this).append(c),r.fileupload({dataType:"json",url:n.url,add:function(e,t){if(n.file_filter){var r=new RegExp("(\\.|\\/)("+n.file_filter.replace(/,/g,"|")+")$","i");if(t.originalFiles[0].type.length&&!r.test(t.originalFiles[0].type))return alert(n.file_filter_alert?n.file_filter_alert:n.file_filter),!1}t.submit()},submit:function(e,t){return i.css("visibility","hidden"),n.submit(t)},done:function(t,r){if(n.progress&&o.css("width","0%"),i.css("visibility","visible"),n.done(r)){e.addClass("valuated");var c=n.file_label_pattern.replace(/%type%/i,r.originalFiles[0].name.split(".").pop());c=c.replace(/%mime%/i,r.originalFiles[0].type),c=c.replace(/%size%/i,getReadableFileSizeString(r.originalFiles[0].size)),a.html(c),n.thumbnail&&r.result.file.thumbnail?(s.attr("src",r.result.file.thumbnail).show(),e.addClass("with_thumbnail")):e.removeClass("with_thumbnail"),l.val(r.result.file.name),u.val(r.result.file.path)}},progressall:function(e,t){if(n.progress){var r=parseInt(t.loaded/t.total*100,10);o.css("width",r+"%")}}}),i.on("click",function(){$("#"+t).click()}),c.on("click",function(){e.removeClass("valuated"),l.val("")}),$(this).bind("fileuploadsubmit",function(e,t){var r={};n.thumbnail&&$.each(n.thumbnail,function(e,t){var n="thumbnail_"+e;r[n]=t}),t.formData=r})})}}(jQuery),$(window).load(function(){$(".sharp-file").each(function(){createSharpFile($(this))})});